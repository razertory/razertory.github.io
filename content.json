{"meta":{"title":"Razertory çš„æŠ€æœ¯åšå®¢","subtitle":"ä¸€æ›²è‚è‚ æ–­ï¼Œå¤©æ¶¯ä½•å¤„è§…çŸ¥éŸ³","description":"Maker, Coder, Puzzle Solver","author":"Razertory","url":"https://razertory.me","root":"/"},"pages":[{"title":"è¯»ä¹¦","date":"2019-10-16T13:31:33.000Z","updated":"2020-05-04T07:19:22.465Z","comments":true,"path":"books/index.html","permalink":"https://razertory.me/books/index.html","excerpt":"","text":"ååº”å¼è®¾è®¡æ¨¡å¼ ä¸ƒå‘¨ä¸ƒè¯­è¨€ æ•°æ®å¯†é›†å‹åº”ç”¨ç³»ç»Ÿè®¾è®¡"},{"title":"ç®—æ³•é¢˜è§£","date":"2019-10-16T13:31:33.000Z","updated":"2020-05-04T07:19:57.688Z","comments":true,"path":"algo-solution/index.html","permalink":"https://razertory.me/algo-solution/index.html","excerpt":"","text":"é¡¹ç›® java-code-lab Java å®ç°çš„æ•°æ®ç»“æ„/ç®—æ³•ä»¥åŠè®¡ç®—æœºç§‘å­¦ç›¸å…³çš„ä»£ç å’Œå®Œæ•´çš„ Junit æµ‹è¯•ç”¨ä¾‹ã€‚ https://github.com/razertory/jianzhi-offer ã€Šå‰‘æŒ‡ offerã€‹ æ’åºå¿«é€Ÿæ’åº å½’å¹¶æ’åº å †æ’åº é“¾è¡¨åè½¬é“¾è¡¨ å¤åˆ¶å¤æ‚é“¾è¡¨ é“¾è¡¨çš„å…¬å…±èŠ‚ç‚¹ é“¾è¡¨ç¯çš„å…¥å£ åˆ é™¤é‡å¤çš„æœ‰åºé“¾è¡¨èŠ‚ç‚¹ é“¾è¡¨ç›¸åŠ  é“¾è¡¨ä¸¤ä¸¤äº¤æ¢ äºŒå‰æ ‘é‡å»ºäºŒå‰æ ‘ åˆ¤æ–­æ˜¯å¦æ˜¯å­æ ‘ åˆ¤æ–­æ•°ç»„æ˜¯ BST ååºéå† å’Œä¸ºå®šå€¼çš„æ‰€æœ‰è·¯å¾„ åˆ¤æ–­æ˜¯å¦æ˜¯äºŒå‰æœç´¢æ ‘ æ ˆå’Œé˜Ÿåˆ—æœ€å°æ ˆ æ ˆå®ç°é˜Ÿåˆ— æ‹¬å·çš„åˆæ³•åºåˆ— æ±‰è¯ºå¡”é—®é¢˜ ä½è¿ç®—ä½è¿ç®—å®é™…é—®é¢˜-æ‰¾æ¯’è¯ ä½è¿ç®—å®ç°åŠ æ³• äºŒè¿›åˆ¶ä¸­ 1 çš„ä¸ªæ•° åªå‡ºç°äº†ä¸€æ¬¡çš„æ•° ä¸ªæ•°å¤šäºä¸€åŠçš„æ•° æ±‰æ˜è·ç¦» æœç´¢å„ç§å±‚åºéå†äºŒå‰æ ‘ å®Œç¾çš„äºŒåˆ†æœç´¢ æœ‰åºæ•°ç»„è½¬åŒ–ä¸º BST æ— é‡å¤æ•°ç»„çš„å…¨æ’åˆ— N çš‡åé—®é¢˜ åŠ¨æ€è§„åˆ’è‚¡ç¥¨ä¹°å–æœ€å¤§åˆ©æ¶¦ æœ€å¤§å­åºåˆ— æŠ¢åŠ«æˆ¿å­ æœ€é•¿å›æ–‡å­ä¸² äºŒç»´æ•°ç»„ä¸­å’Œæœ€å°è·¯å¾„ ç¼–è¾‘è·ç¦» åŠ¨æ€è§„åˆ’åˆé›† é«˜çº§æ•°æ®ç»“æ„LRU ç¼“å­˜"},{"title":"å…³äºæœ¬åšå®¢","date":"2019-10-16T13:01:48.000Z","updated":"2020-10-26T03:37:02.719Z","comments":true,"path":"links/index.html","permalink":"https://razertory.me/links/index.html","excerpt":"","text":"åšå®¢çš„ä¸»é¢˜æ˜¯ indigoï¼ŒMaterial Design é£æ ¼ï¼ŒåŠŸèƒ½æ¯”è¾ƒå¤šçš„ã€‚åšå®¢çš„è¯„è®ºç³»ç»Ÿç”¨çš„æ˜¯ gitalkï¼Œæˆ‘ä¼šç”¨ telegram çš„æœºå™¨äººå»æ”¶è¯„è®ºæ¶ˆæ¯å¿«é€Ÿå›å¤ã€‚å½“ç„¶ï¼Œå¦‚æœæƒ³æŒç»­å…³æ³¨ï¼ŒRSS ä¾æ—§æ˜¯ä¸ªä¸é”™çš„é€‰æ‹©ã€‚ æ‰¾åˆ°æˆ‘ telegram (å¿«é€Ÿè”ç³») spring.razer AT gmail.com https://github.com/razertory vx: chendalichun å‹é“¾å¦‚æœéœ€è¦æ·»åŠ å‹é“¾ï¼Œå¯ä»¥åœ¨ telegram ä¸Šç›´æ¥è”ç³»æˆ‘ï¼ˆè¿™æ ·å¾ˆå¿«ï¼‰ï¼Œæˆ–è€…å‘æˆ‘é‚®ä»¶ ä¸ªäººwindanchaososhmkufacounter2015Atticus å›¢é˜ŸNetflixDropboxFacebookCloudflarePingCAPSnowflakeLightbendDatabricksAirbnbé˜¿é‡Œä¸­é—´ä»¶å°ç±³ä¿¡æ¯éƒ¨æŠ€æœ¯å›¢é˜Ÿ"},{"title":"","date":"2020-04-18T08:42:18.669Z","updated":"2020-04-18T08:42:18.669Z","comments":false,"path":"categories/index.html","permalink":"https://razertory.me/categories/index.html","excerpt":"","text":""},{"title":"Scala","date":"2020-03-28T13:02:10.020Z","updated":"2020-03-28T13:02:10.020Z","comments":true,"path":"scala-school/index.html","permalink":"https://razertory.me/scala-school/index.html","excerpt":"","text":"Scala åŸºç¡€Scala æ€»è§ˆ é›†åˆåˆ—è¡¨ï¼Œæ˜ å°„ï¼ŒåŠŸèƒ½ç»„åˆ (map, foreach, filter, zip, folds) æ¨¡å¼åŒ¹é…ä¸å‡½æ•°ç»„åˆæ›´å¤šå‡½æ•°ï¼åå‡½æ•°ï¼Œæ›´å¤šæ¨¡å¼åŒ¹é… ç±»å‹å’Œå¤šæ€åŸºç¡€åŸºæœ¬ç±»å‹å’Œç±»å‹å¤šæ€æ€§ï¼Œç±»å‹æ¨æ–­ï¼Œå˜æ€§ï¼Œè¾¹ç•Œï¼Œé‡åŒ– é«˜çº§ç±»å‹é«˜çº§ç±»å‹ï¼Œè§†ç•Œï¼Œæ›´é«˜çº§å¤šæ€æ€§ç±»å‹ï¼Œé€’å½’ç±»å‹ï¼Œç»“æ„ç±»å‹ å‚è€ƒèµ„æ–™ Scala School (https://twitter.github.io/scala_school/) Scala 99 (https://github.com/shekhargulati/99-problems/tree/master/scala) Databricks Scala ç¼–ç¨‹é£æ ¼æŒ‡å— (https://github.com/databricks/scala-style-guide/blob/master/README-ZH.md)"},{"title":"è®¡ç®—æœºç³»ç»Ÿ","date":"2019-10-16T13:31:33.000Z","updated":"2020-07-21T08:24:03.561Z","comments":true,"path":"cs/index.html","permalink":"https://razertory.me/cs/index.html","excerpt":"","text":"å¹¶å‘ç¼–ç¨‹ æŒ‰ç…§é¡ºåºæ‰“å° æ“ä½œç³»ç»Ÿ ã€ŒLinux å†…æ ¸ã€ç³»ç»Ÿè°ƒç”¨ ã€ŒLinux å†…æ ¸ã€ä¸­æ–­ ã€ŒLinux å†…æ ¸ã€è¿›ç¨‹ç®¡ç† ã€ŒLinux å†…æ ¸ã€ã€ä»£ç åˆ†æ select, poll, epoll çº¿ç¨‹ã€è¿›ç¨‹å’Œåç¨‹ä»¥åŠ IO å¤šè·¯å¤ç”¨å®ç°å¹¶å‘ Java ä¼ªå…±äº« Java æ§åˆ¶ CPU å ç”¨ Go Uber Go Guide æ”¹å–„ä½ çš„ Go ä»£ç  Scala Scala æ€»è§ˆ Scala åŸºç¡€ Scala é›†åˆ æ¨¡å¼åŒ¹é…ä¸å‡½æ•°ç»„åˆç±»å‹å’Œå¤šæ€åŸºç¡€ Scala é«˜çº§ç±»å‹ Scala å‡½æ•°å¼ç¼–ç¨‹è®¾è®¡ Infra å¼€æºé¡¹ç›®ä¹‹ Nginx MySQL Top Tips"},{"title":"","date":"2020-04-18T08:42:18.669Z","updated":"2020-04-18T08:42:18.669Z","comments":false,"path":"tags/index.html","permalink":"https://razertory.me/tags/index.html","excerpt":"","text":""}],"posts":[{"title":"æ”¹å–„ä½ çš„ Go ä»£ç ","slug":"go-coding-skills","date":"2020-07-21T06:29:48.000Z","updated":"2020-07-21T08:03:51.072Z","comments":true,"path":"2020/07/21/go-coding-skills/","link":"","permalink":"https://razertory.me/2020/07/21/go-coding-skills/","excerpt":"","text":"ä¹‹å‰å‚ä¸ç¿»è¯‘äº† Uber å…¬å¸åˆ†äº«çš„ Go è¯­è¨€ç¼–ç è§„èŒƒã€‚ä¸€ç›´ä»¥æ¥ï¼Œæˆ‘å¯¹ç¼–ç è§„èŒƒçš„æ€åº¦æ˜¯80%çš„æ­£ç¡®æ€§å’Œ20%çš„ä¸€è‡´æ€§ã€‚å†™ä»£ç ï¼Œé‡è¦çš„æ˜¯è®©ç¨‹åºæ­£ç¡®å’Œé«˜æ•ˆä»¥åŠå¯ç»´æŠ¤æ€§ã€‚è¿‘æœŸæ•´ç†äº†å·¥ä½œä¸­é‡åˆ°çš„æ”¹å–„ Go ç¼–ç çš„ä¸€äº›æ¡ˆä¾‹ã€‚ \bé—­åŒ…ï¼ˆClosureï¼‰å’Œ deferé—­åŒ…çš„å®˜æ–¹è§£é‡Šæ˜¯ï¼šé—­åŒ…æ˜¯ç”±å‡½æ•°å’Œä¸å…¶ç›¸å…³çš„å¼•ç”¨ç¯å¢ƒç»„åˆè€Œæˆçš„å®ä½“ã€‚defer å¯ä»¥è®©ä¸€ä¸ªé—­åŒ…åœ¨å‡½æ•° return çš„æ—¶åˆ»è°ƒç”¨ã€‚æ¯”å¦‚æœ‰ä¸€ä¸ªè¿™æ ·çš„ä»£ç  1234567for _, v := range values &#123; conn := d.redis.Get(ctx) err := conn.Send(\"SADD\") err = conn.Send(\"EXPIRE\") err = conn.Flush() conn.Close()&#125; 3 åˆ° 5 è¡Œçš„ä»£ç éƒ½éœ€è¦å¤„ç† errï¼ŒåŒæ—¶è¿˜éœ€è¦ conn.Close()ã€‚æ‰€ä»¥å¯ä»¥æ”¹ä¸º 12345678910111213141516171819for _, v := range values &#123; conn := d.redis.Get(ctx) err := conn.Send(\"SADD\") if err != nil &#123; // å¤„ç†é”™è¯¯ conn.Close() &#125; err = conn.Send(\"EXPIRE\") if err != nil &#123; // å¤„ç†é”™è¯¯ conn.Close() &#125; err = conn.Flush() if err != nil &#123; // å¤„ç†é”™è¯¯ conn.Close() &#125; conn.Close()&#125; è¿™ä¹ˆå†™é˜…è¯»èµ·æ¥æœ‰å¤ªå¤šé‡å¤çš„é€»è¾‘ï¼ŒåŒæ—¶ä¿®æ”¹ä¹‹åï¼Œä¹Ÿå®¹æ˜“å¿˜è®° conn.Close()ã€‚è¿™ç§æƒ…å†µï¼Œå¯ä»¥è¯•ç€ç”¨é—­åŒ…é…åˆ defer æ¥æ”¹å–„ 123456789101112131415161718for _, v := range values &#123; err := func() error &#123; conn := d.redis.Get(ctx) defer conn.Close() if err := conn.Send(\"SADD\"); err != nil &#123; return err &#125; if err := conn.Send(\"EXPIRE\"); err != nil &#123; return err &#125; if err := conn.Flush(); err != nil &#123; return err &#125; &#125; if err != nil &#123; // å¤„ç†é”™è¯¯ &#125;&#125; nil interface123456789101112131415161718192021222324type Audi struct &#123; price int&#125;type Tesla struct &#123; price int&#125;func main() &#123; car := getCar() if car == nil &#123; fmt.Printf(\"nil\") return &#125; fmt.Printf(\"%+v is not nil\", car)&#125;func getCar() interface&#123;&#125;&#123; var audi *Audi var tesla *Tesla if rand.Int63() / 2 == 0 &#123; return tesla &#125; return audi&#125; è¿™æ®µä»£ç çš„è¾“å‡ºæ˜¯ 14 è¡Œçš„ &lt;nil&gt; is not nilã€‚é’ˆå¯¹ interface{} ç±»å‹ï¼Œåˆ¤æ–­æ˜¯å¦ nil éœ€è¦åˆ¤æ–­ç±»å‹çš„å’Œå€¼ï¼Œæœ¬è´¨ä¸Šåªè¦ç±»å‹å­˜åœ¨ï¼Œæ¯”å¦‚è¿™é‡Œå¯èƒ½æ˜¯ *Audi æˆ–è€… *Teslaï¼Œé‚£ä¹ˆå°±ä¸ä¼šä¸º nilã€‚å¦‚æœéœ€è¦è®¾è®¡è¿”å› interface{} çš„å‡½æ•°ï¼Œå¯ä»¥åŠ ä¸Šä¸€ä¸ª ok bool è¡¨ç¤ºæ˜¯å¦å­˜åœ¨ã€‚ 123456789101112func main() &#123; car, ok := getCar() if !ok &#123; fmt.Printf(\"nil\") &#125; fmt.Printf(\"%+v is not nil\", car)&#125;func getCar() (interface&#123;&#125;, bool)&#123; var audi *Audi // åœ¨ç¡®å®šç±»å‹çš„åœ°æ–¹ï¼Œåˆ¤æ–­æ˜¯å¦ç©ºï¼Œè¿™æ ·å†ç”¨ bool ç±»å‹ç»™åˆ°å¤–é¢ return audi, false&#125; å‘½åè¿”å›å€¼named return value åœ¨å’Œ defer ç›¸é‡çš„æ—¶å€™ï¼Œä¼šæœ‰ä¸€äº›éœ€è¦æ³¨æ„çš„ç»†èŠ‚ã€‚ 1234567891011121314151617181920func main() &#123; getName() getName2()&#125;func getName() (name string)&#123; name = \"john\" defer func() &#123; fmt.Printf(name) &#125;() return \"jerry\"&#125;func getName2() (string)&#123; name := \"john\" defer func() &#123; fmt.Printf(name) &#125;() return \"jerry\"&#125; ä¸Šè¿°ä»£ç è¾“å‡ºçš„æ˜¯ jerryjohnã€‚å¦‚æœé—­åŒ…ç”¨åˆ°äº† named retrun valueï¼Œå°±æ„å‘³ç€è¿™ä¸ªå€¼åŠæ—¶æ²¡æœ‰è¢«æ˜æ˜¾çš„å¤åˆ¶ï¼Œæ¯”å¦‚ return &quot;jerry&quot; å®é™…ä¸Šæ˜¯è®© name è¿™ä¸ªå˜é‡èµ‹å€¼äº†ã€‚è¿™ç§ä»£ç éš¾ä»¥ review å’Œè°ƒè¯•ã€‚æ‰€ä»¥åœ¨è¿”å›å€¼åªæœ‰ä¸€ä¸ªã€ä¸¤ä¸ªçš„æ—¶å€™ï¼Œæ¨èä¸ç”¨ named return valueã€‚åªæœ‰è¿”å›å€¼å¤šä¸ªï¼Œæˆ–è€…è¿”å›å€¼çš„ç±»å‹ä¸€æ ·çš„æ—¶å€™ï¼Œå†æ¨è named return valueã€‚ é”™è¯¯å¤„ç†ç¼–å†™ç”Ÿäº§ç¯å¢ƒä»£ç çš„æ—¶å€™ï¼Œä¸ºäº†è®© err äº§ç”Ÿçš„æ—¶å€™ï¼Œå°½é‡å¸¦æœ‰æ›´å¤šæœ‰åˆ©äºæ’æŸ¥é—®é¢˜çš„ä¿¡æ¯ï¼Œæ¨èä»¥ä¸‹æ–¹æ³• æ ‡å‡†åº“äº§ç”Ÿçš„ errï¼Œä½¿ç”¨ `errors.WithStack() é™¤æ­¤ä¹‹å¤–çš„ errï¼Œç”¨ github.com/pkg/errors ä¸­çš„ Wrapf(), New(), Errorf() for å¾ªç¯Go è¯­è¨€çš„ for å¾ªç¯ï¼Œå¾ªç¯å˜é‡å®é™…ä¸Šæ€»æ˜¯æŒ‡å‘åŒä¸€å—åœ°å€ï¼Œåœ¨å¾ªç¯è¿‡ç¨‹ä¸­ï¼Œä¸æ–­è¿›è¡Œè¦†ç›–å€¼çš„æ“ä½œã€‚ä¾‹å¦‚ 12345678func main() &#123; var arr []*int for i := 0; i &lt; 3; i++ &#123; arr = append(arr, &amp;i) &#125; fmt.Println(\"Values:\", *arr[0], *arr[1], *arr[2]) fmt.Println(\"Addresses:\", arr[0], arr[1], arr[2])&#125; è¾“å‡ºæ˜¯:Values: 3 3 3Addresses: 0xc00001c078 0xc00001c078 0xc00001c078","categories":[],"tags":[]},{"title":"æŒ‰ç…§é¡ºåºæ‰“å°","slug":"print-in-order","date":"2020-06-21T02:41:56.000Z","updated":"2020-06-21T04:15:30.886Z","comments":true,"path":"2020/06/21/print-in-order/","link":"","permalink":"https://razertory.me/2020/06/21/print-in-order/","excerpt":"","text":"æ²¡é”™ï¼Œæˆ‘åˆå¼€äº†ä¸ªå‘ã€‚è¿™æ¬¡çš„é—®é¢˜æ˜¯ æŒ‰é¡ºåºæ‰“å°ã€‚å¤§æ„å°±æ˜¯æœ‰ one two three ä¸‰ä¸ªçº¿ç¨‹åŒæ—¶åœ¨è·‘ï¼Œä¸€å®šè¦è®© two åœ¨ one åé¢ã€three åœ¨ two åé¢æ‰§è¡Œã€‚ é¢˜ç›®æœ¬æ¥è§‰å¾—ç”¨ Go çš„ channel åº”è¯¥æ˜¯æœ€å¥½å†™çš„ã€‚ 12var oneDone chan //one ç»“æŸå°± oneDone &lt;-var twoDone chan //two ç»“æŸå°± twoDone &lt;- å¯æƒœå¹¶æ²¡æœ‰ Goã€‚æ‰€ä»¥ï¼Œè¦ä¸ Java ? é˜»å¡é˜Ÿåˆ—é‚£ä¹ˆè¦åšåˆ°å’Œ channel ç±»ä¼¼çš„æ•ˆæœï¼Œé¦–å…ˆå°±æ˜¯ç¡®ä¿ BlockingQueue èƒ½åœ¨æ²¡æœ‰å…ƒç´  pop çš„æ—¶å€™èƒ½é˜»å¡ã€‚æŸ¥ä¸€ä¸‹ api æœ‰ä¸ª take () æ–¹æ³• 12345678/** * Retrieves and removes the head of this queue, waiting if necessary * until an element becomes available. * * @return the head of this queue * @throws InterruptedException if interrupted while waiting */E take () throws InterruptedException; å·²é€šè¿‡ä»£ç  12345678910111213141516171819202122232425262728293031323334import java.util.concurrent.BlockingQueue;import java.util.concurrent.LinkedBlockingQueue;class Foo &#123; private BlockingQueue&lt;Integer&gt; one; private BlockingQueue&lt;Integer&gt; two; public Foo () &#123; one = new LinkedBlockingQueue&lt;&gt;(); two = new LinkedBlockingQueue&lt;&gt;(); &#125; public void first (Runnable printFirst) throws InterruptedException &#123; //printFirst.run () outputs \"first\". Do not change or remove this line. printFirst.run(); one.add(1); &#125; public void second (Runnable printSecond) throws InterruptedException &#123; //printSecond.run () outputs \"second\". Do not change or remove this line. one.take(); printSecond.run (); two.add(1); &#125; public void third (Runnable printThird) throws InterruptedException &#123; //printThird.run () outputs \"third\". Do not change or remove this line. two.take(); printThird.run(); &#125;&#125; è¿™é“é¢˜çš„æœ¬è´¨æ˜¯è¦åœ¨ * å¹¶å‘æ‰§è¡Œçš„è¿‡ç¨‹ä¸­ï¼Œä¿è¯éƒ¨åˆ†å•å…ƒçš„æ‰§è¡Œé¡ºåº *ã€‚ä¹Ÿå°±æ˜¯æŸä¸ªæ‰§è¡Œå•å…ƒåœ¨æ¡ä»¶æ²¡æœ‰è¾¾åˆ°çš„æ—¶å€™ï¼Œä¿æŒé˜»å¡ï¼Œè®©å‡º CPUã€‚ äº’æ–¥é”ä¿¡å·é‡ ä¿¡å·é‡ï¼ˆè‹±è¯­ï¼šsemaphoreï¼‰åˆç§°ä¸ºä¿¡å·æ ‡ï¼Œæ˜¯ä¸€ä¸ªåŒæ­¥å¯¹è±¡ï¼Œç”¨äºä¿æŒåœ¨ 0 è‡³æŒ‡å®šæœ€å¤§å€¼ä¹‹é—´çš„ä¸€ä¸ªè®¡æ•°å€¼ã€‚å½“çº¿ç¨‹å®Œæˆä¸€æ¬¡å¯¹è¯¥ semaphore å¯¹è±¡çš„ç­‰å¾…ï¼ˆwaitï¼‰æ—¶ï¼Œè¯¥è®¡æ•°å€¼å‡ä¸€ï¼›å½“çº¿ç¨‹å®Œæˆä¸€æ¬¡å¯¹ semaphore å¯¹è±¡çš„é‡Šæ”¾ï¼ˆreleaseï¼‰æ—¶ï¼Œè®¡æ•°å€¼åŠ ä¸€ã€‚å½“è®¡æ•°å€¼ä¸º 0ï¼Œåˆ™çº¿ç¨‹ç­‰å¾…è¯¥ semaphore å¯¹è±¡ä¸å†èƒ½æˆåŠŸç›´è‡³è¯¥ semaphore å¯¹è±¡å˜æˆ signaled çŠ¶æ€ã€‚semaphore å¯¹è±¡çš„è®¡æ•°å€¼å¤§äº 0ï¼Œä¸º signaled çŠ¶æ€ï¼›è®¡æ•°å€¼ç­‰äº 0ï¼Œä¸º nonsignaled çŠ¶æ€.semaphore å¯¹è±¡é€‚ç”¨äºæ§åˆ¶ä¸€ä¸ªä»…æ”¯æŒæœ‰é™ä¸ªç”¨æˆ·çš„å…±äº«èµ„æºï¼Œæ˜¯ä¸€ç§ä¸éœ€è¦ä½¿ç”¨å¿™ç¢Œç­‰å¾…ï¼ˆbusy waitingï¼‰çš„æ–¹æ³•ã€‚ä¿¡å·é‡çš„æ¦‚å¿µæ˜¯ç”±è·å…°è®¡ç®—æœºç§‘å­¦å®¶è‰¾å…¹èµ«å°”ãƒ»æˆ´å…‹æ–¯ç‰¹æ‹‰ï¼ˆEdsger W. Dijkstraï¼‰å‘æ˜çš„ï¼Œå¹¿æ³›çš„åº”ç”¨äºä¸åŒçš„æ“ä½œç³»ç»Ÿä¸­ã€‚åœ¨ç³»ç»Ÿä¸­ï¼Œç»™äºˆæ¯ä¸€ä¸ªè¿›ç¨‹ä¸€ä¸ªä¿¡å·é‡ï¼Œä»£è¡¨æ¯ä¸ªè¿›ç¨‹ç›®å‰çš„çŠ¶æ€ï¼Œæœªå¾—åˆ°æ§åˆ¶æƒçš„è¿›ç¨‹ä¼šåœ¨ç‰¹å®šåœ°æ–¹è¢«å¼ºè¿«åœä¸‹æ¥ï¼Œç­‰å¾…å¯ä»¥ç»§ç»­è¿›è¡Œçš„ä¿¡å·åˆ°æ¥ã€‚å¦‚æœä¿¡å·é‡æ˜¯ä¸€ä¸ªä»»æ„çš„æ•´æ•°ï¼Œé€šå¸¸è¢«ç§°ä¸ºè®¡æ•°ä¿¡å·é‡ï¼ˆCounting semaphoreï¼‰ï¼Œæˆ–ä¸€èˆ¬ä¿¡å·é‡ï¼ˆgeneral semaphoreï¼‰ï¼›å¦‚æœä¿¡å·é‡åªæœ‰äºŒè¿›åˆ¶çš„ 0 æˆ– 1ï¼Œç§°ä¸ºäºŒè¿›åˆ¶ä¿¡å·é‡ï¼ˆbinary semaphoreï¼‰ã€‚åœ¨ linux ç³»ç»Ÿä¸­ï¼ŒäºŒè¿›åˆ¶ä¿¡å·é‡ï¼ˆbinary semaphoreï¼‰åˆç§°äº’æ–¥é”ï¼ˆMutexï¼‰ã€‚ â€“ ç»´åŸºç™¾ç§‘ Java é‡Œé¢ä¿¡å·é‡æœ‰ä¸¤ä¸ªé‡è¦çš„è¡Œä¸ºï¼Œacquire å’Œ releaseã€‚å¯¹æ­¤åˆ†åˆ«æœ‰ä»¥ä¸‹æè¿° 12345678910111213141516171819202122232425262728293031/** * Acquires a permit from this semaphore, blocking until one is * available, or the thread is &#123;@linkplain Thread#interrupt interrupted&#125;. * * &lt;p&gt;Acquires a permit, if one is available and returns immediately, * reducing the number of available permits by one. * * &lt;p&gt;If no permit is available then the current thread becomes * disabled for thread scheduling purposes and lies dormant until * one of two things happens: * &lt;ul&gt; * &lt;li&gt;Some other thread invokes the &#123;@link #release&#125; method for this * semaphore and the current thread is next to be assigned a permit; or * &lt;li&gt;Some other thread &#123;@linkplain Thread#interrupt interrupts&#125; * the current thread. * &lt;/ul&gt; * * &lt;p&gt;If the current thread: * &lt;ul&gt; * &lt;li&gt;has its interrupted status set on entry to this method; or * &lt;li&gt;is &#123;@linkplain Thread#interrupt interrupted&#125; while waiting * for a permit, * &lt;/ul&gt; * then &#123;@link InterruptedException&#125; is thrown and the current thread's * interrupted status is cleared. * * @throws InterruptedException if the current thread is interrupted */public void acquire() throws InterruptedException &#123; sync.acquireSharedInterruptibly(1);&#125; 12345678910111213141516/** * Releases a permit, returning it to the semaphore. * * &lt;p&gt;Releases a permit, increasing the number of available permits by * one. If any threads are trying to acquire a permit, then one is * selected and given the permit that was just released. That thread * is (re) enabled for thread scheduling purposes. * * &lt;p&gt;There is no requirement that a thread that releases a permit must * have acquired that permit by calling &#123;@link #acquire&#125;. * Correct usage of a semaphore is established by programming convention * in the application. */public void release() &#123; sync.releaseShared (1);&#125; 123456789101112131415161718192021222324252627import java.util.concurrent.Semaphore;class Foo &#123; private Semaphore s1; private Semaphore s2; public Foo() &#123; s1 = new Semaphore(0); s2 = new Semaphore(0); &#125; public void first (Runnable printFirst) throws InterruptedException &#123; printFirst.run(); s1.release(); &#125; public void second (Runnable printSecond) throws InterruptedException &#123; s1.acquire(); printSecond.run(); s2.release(); &#125; public void third (Runnable printThird) throws InterruptedException &#123; s2.acquire(); printThird.run(); &#125;&#125; Wait å’Œ Notifyå…ˆè¯´ç»“è®ºï¼Œç”¨è¿™ç§å†™æ³•çš„æ˜¯ Java å¤§ä½¬ã€‚ä¼ é€é—¨ 12345678910111213141516171819202122232425262728293031323334353637class Foo &#123; private boolean firstFinished; private boolean secondFinished; private Object lock = new Object(); public Foo() &#123; &#125; public void first (Runnable printFirst) throws InterruptedException &#123; synchronized(lock) &#123; printFirst.run(); firstFinished = true; lock.notifyAll(); &#125; &#125; public void second(Runnable printSecond) throws InterruptedException &#123; synchronized(lock) &#123; while (!firstFinished) &#123; lock.wait(); &#125; printSecond.run(); secondFinished = true; lock.notifyAll(); &#125; &#125; public void third(Runnable printThird) throws InterruptedException &#123; synchronized(lock) &#123; while (!secondFinished) &#123; lock.wait(); &#125; printThird.run(); &#125; &#125;&#125; è¿™é‡Œé¢ç‰µæ¶‰åˆ°äº†å‡ ä¸ª Java å¹¶å‘ä½“ç³»çš„æ¦‚å¿µã€‚å¯¹è±¡é”å’Œ syncronizeã€Object#Waitã€Object#Notifyã€‚","categories":[],"tags":[]},{"title":"ã€ŒLinux å†…æ ¸ã€ç³»ç»Ÿè°ƒç”¨","slug":"linux-kernel-system-call","date":"2020-04-12T05:50:04.000Z","updated":"2020-04-18T08:54:30.936Z","comments":true,"path":"2020/04/12/linux-kernel-system-call/","link":"","permalink":"https://razertory.me/2020/04/12/linux-kernel-system-call/","excerpt":"","text":"å†…æ ¸å†…å­˜ç©ºé—´åœ¨æ“ä½œç³»ç»Ÿä¸­æ˜¯å—ä¿æŠ¤çš„ã€‚é€šå¸¸æƒ…å†µä¸‹ï¼Œä¸€ä¸ªæ™®é€šç¨‹åºæ‰§è¡Œåœ¨ç”¨æˆ·ç©ºé—´ã€‚å½“éœ€è¦ä¸å†…æ ¸é€šä¿¡çš„æ—¶å€™ï¼Œæ¯”å¦‚å†™æ–‡ä»¶åˆ°ç£ç›˜ï¼Œå°±éœ€è¦è¿›è¡Œç³»ç»Ÿè°ƒç”¨ã€‚ æœ‰è¶£çš„æ˜¯ï¼Œå†…æ ¸åŸç”Ÿæä¾›çš„ç³»ç»Ÿè°ƒç”¨å¾ˆå°‘(å‚è€ƒList of Linux/i386 system calls)ã€‚å½“æˆ‘ä»¬éœ€è¦ç³»ç»Ÿè°ƒç”¨çš„æ—¶å€™ï¼Œå®é™…ä¸Šæ˜¯åœ¨è°ƒç”¨è°ƒç”¨çš„ä¸Šä¸€å±‚ APIã€‚è¿™ä¸€å±‚ API å°è£…äº†å„ç§ç³»ç»Ÿè°ƒç”¨ï¼ˆé€šå¸¸å°±æ˜¯æ“ä½œç³»ç»Ÿå†…ç½®çš„ C åº“ï¼‰ã€‚ç°é˜¶æ®µï¼Œè¿™ä¸€å±‚ API çš„æ ‡å‡†æ¥è‡ªäº IEEE ï¼Œåä¸º POSIXï¼ˆPortable Operating System Interfaceï¼‰ã€‚è¿™ä¹ˆåšçš„åŸå› æ˜¯ unix å€¡å¯¼çš„ æä¾›æœºåˆ¶ï¼Œè€Œä¸æ˜¯æä¾›ç­–ç•¥ã€‚æ„æ€æ˜¯æä¾›æœ‰é™çš„ï¼Œä½†å¯ä»¥å¾ˆå¥½ç»„åˆçš„å·¥å…·ã€æ–¹æ³•ï¼Œåœ¨æ­¤åŸºç¡€ä¸Šå®ç°å„ç§åŠŸèƒ½ã€‚ ä¾‹å¦‚ï¼Œ get_pid() åœ¨å†…æ ¸ä¸­çš„è¢«å®šä¹‰ä¸º sys_getpid()bar() åœ¨å†…æ ¸ä¸­è¢«å®šä¹‰ä¸º sys_bar() ä¸€ä¸ªç”¨æˆ·ç©ºé—´çš„ç¨‹åºï¼Œè¦åšç³»ç»Ÿè°ƒç”¨ï¼Œå…·ä½“çš„è¿‡ç¨‹ä¸º é™·å…¥å†…æ ¸ ä¼ é€’ç³»ç»Ÿè°ƒç”¨ç¼–å·å’Œå‚æ•° æ‰§è¡Œç³»ç»Ÿè°ƒç”¨ å°†ç³»ç»Ÿè°ƒç”¨çš„è¿”å›å€¼å¸¦ç»™ç”¨æˆ·ç©ºé—´","categories":[],"tags":[{"name":"æ“ä½œç³»ç»Ÿ","slug":"æ“ä½œç³»ç»Ÿ","permalink":"https://razertory.me/tags/æ“ä½œç³»ç»Ÿ/"}]},{"title":"ã€ŒLinux å†…æ ¸ã€ä¸­æ–­","slug":"linux-kernel-interrupt","date":"2020-04-12T05:50:04.000Z","updated":"2020-04-19T14:28:18.526Z","comments":true,"path":"2020/04/12/linux-kernel-interrupt/","link":"","permalink":"https://razertory.me/2020/04/12/linux-kernel-interrupt/","excerpt":"","text":"ä¸­æ–­ä¿¡å·ä¸­æ–­æœºåˆ¶ï¼Œç®€å•è¯´å°±æ˜¯é”®ç›˜ã€é¼ æ ‡ã€ç£ç›˜ä¹‹ç±»çš„ç¡¬ä»¶ï¼Œåœ¨éœ€è¦çš„æ—¶å€™å‘å†…æ ¸å‘ä¿¡å·çš„ä¸€ç§æœºåˆ¶ã€‚æ¯”å¦‚æˆ‘æ­¤åˆ»æ­£åœ¨ç”¨é”®ç›˜æ‰“å­—ï¼Œå…¶å®å°±æ˜¯åœ¨å‘å‡ºç”µä¿¡å·ç»™ä¸€ä¸ªåå«ã€Œä¸­æ–­æ§åˆ¶å™¨ã€çš„ç‰©ç†èŠ¯ç‰‡ä¸­ï¼Œå†é€šè¿‡ä¸€ä¸ªå’Œå¤„ç†å™¨ç›´è¿çš„ç®¡çº¿ç»™å¤„ç†å™¨ã€‚å¤„ç†å™¨æ¥æ”¶åˆ°ä¹‹åï¼Œç›‘æµ‹åˆ°äº†æ˜¯ä¸­æ–­ä¿¡å·ï¼Œå°±ä¼šä¸­æ–­å½“å‰çš„å·¥ä½œå¤„ç†è¯¥ä¿¡å·è¿›è€Œå‘Šè¯‰æ“ä½œç³»ç»Ÿï¼Œè®©æ“ä½œç³»ç»Ÿå¤„ç†è¿™ä¸ªä¿¡å·ã€‚ä¸åŒçš„ä¸­æ–­ä¿¡å·ï¼Œæœ‰çš„ç€å”¯ä¸€çš„ IRQ ç¼–å·ã€‚æ¯”å¦‚æ—¶é’Ÿ IRQ 0ï¼Œé”®ç›˜ IRQ 1ï¼Œæœ‰çš„æ˜¯åŠ¨æ€åˆ†é…çš„ï¼Œæ¯”å¦‚åœ¨ PCI æ€»çº¿ä¸Šçš„è®¾å¤‡ã€‚ ä¸­æ–­å¤„ç†æ“ä½œç³»ç»Ÿå¤„ç†ä¸­æ–­çš„è¿‡ç¨‹ä¸€èˆ¬åˆ†æˆä¸¤ä¸ªéƒ¨åˆ†ï¼Œå‘½åä¸ºã€Œä¸ŠåŠéƒ¨ï¼ˆtop halfï¼‰ã€å’Œã€Œä¸‹åŠéƒ¨ï¼ˆbottom halfï¼‰ã€ã€‚ä¸€èˆ¬ä¸ŠåŠéƒ¨(ä¸­æ–­å¤„ç†ç¨‹åº)æœ‰ä¸¥æ ¼æ—¶é™çš„æ“ä½œï¼Œæ¯”æ–¹è¯´å¿«é€Ÿåº”ç­”ã€‚è€Œæœ‰çš„å¯ä»¥å»¶åæ‰§è¡Œçš„æ“ä½œå°±äº¤ç»™äº†ä¸‹åŠéƒ¨ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œæ“ä½œç³»ç»Ÿå¤„ç†ç½‘å¡æ•°æ®åŒ…çš„æ—¶å€™ï¼Œä¼šåœ¨ä¸ŠåŠéƒ¨æŠŠç½‘ç»œæ•°æ®æ‹·è´åˆ°å†…å­˜ï¼Œä¸‹åŠéƒ¨åšæ•°æ®å¤„ç†çš„æ“ä½œã€‚ image.png ä¸‹åŠéƒ¨æ—¶é—´æ•æ„Ÿï¼Œç¡¬ä»¶ç›¸å…³æˆ–è€…ä¿è¯ä¸èƒ½ä¸­æ–­çš„ä»»åŠ¡ï¼Œé€šå¸¸ä¸€å®šæ˜¯åœ¨ä¸ŠåŠéƒ¨ï¼Œå¦åˆ™éƒ½åœ¨ä¸‹åŠéƒ¨ã€‚ä¸‹åŠéƒ¨çš„å®ç°æœºåˆ¶ï¼Œåœ¨ linux å†…æ ¸å‘å±•ä¸­ç»å†äº†å‡ ä¸ªç‰ˆæœ¬ã€‚ tasklet åŸºäºè½¯ä¸­æ–­å®ç° è½¯ä¸­æ–­æ˜¯ç¼–è¯‘æœŸé—´åˆ†é…çš„ï¼Œç”± softirq_action è¡¨ç¤ºã€‚å®šä¹‰åœ¨ linux/interrupt.hã€‚ kernel/softirq.c é‡Œé¢å®šä¹‰äº†ä¸€ä¸ªåŒ…å« 32 ä¸ªç»“æ„ä½“çš„æ•°ç»„ã€‚æ¯ä¸ªç»“æ„ä½“è¡¨ç¤ºä¸€ä¸ªè½¯ä¸­æ–­ï¼Œå› æ­¤è½¯ä¸­æ–­æœ€å¤šæœ‰ 32 ä¸ªã€‚ä¸è¿‡ç›®å‰è¿™ç”¨åˆ°äº† 9 ä¸ªã€‚å½“è½¯ä¸­æ–­å¼€å§‹å·¥ä½œçš„æ—¶å€™ï¼Œä¼šæ‰§è¡Œä¸€ä¸ªåå« void softirq_handler(struct softirq_action *) çš„å‡½æ•°å»æ ‡è®°æ³¨å·²ç»å†Œçš„è½¯ä¸­æ–­ã€‚ ç­‰åˆ°åˆé€‚çš„æ—¶å€™ï¼Œè¯¥è½¯ä¸­æ–­å°±ä¼šæ‰§è¡Œï¼Œæ¯”å¦‚ ä»ç¡¬ä»¶ä¸­æ–­ä»£ç è¿”å›çš„æ—¶å€™ åœ¨ ksoftirqd å†…æ ¸çº¿ç¨‹ä¸­ åœ¨ä¸€äº›æ˜¾å¼æ‰§è¡Œã€æ˜¾å¼æ£€æŸ¥è½¯ä¸­æ–­çš„ç¨‹åºä¸­ï¼Œæ¯”å¦‚ç½‘ç»œç³»ç»Ÿä¸­ tasklet æºè‡ªè½¯ä¸­æ–­ï¼Œæä¾›äº†åŠ¨æ€åˆ†é…çš„ç‰¹æ€§ï¼Œæœ‰ç€æ›´å¹¿æ³›çš„åº”ç”¨åœºæ™¯ã€‚","categories":[],"tags":[{"name":"æ“ä½œç³»ç»Ÿ","slug":"æ“ä½œç³»ç»Ÿ","permalink":"https://razertory.me/tags/æ“ä½œç³»ç»Ÿ/"}]},{"title":"ã€ŒLinux å†…æ ¸ã€è¿›ç¨‹ç®¡ç†","slug":"linux-kernel-process","date":"2020-04-11T10:15:42.000Z","updated":"2020-04-11T11:54:05.665Z","comments":true,"path":"2020/04/11/linux-kernel-process/","link":"","permalink":"https://razertory.me/2020/04/11/linux-kernel-process/","excerpt":"","text":"æ¦‚è§ˆè¿›ç¨‹æ˜¯å¤„äºæ‰§è¡ŒæœŸçš„ç¨‹åºä»¥åŠç›¸å…³èµ„æºçš„æ€»ç§°ã€‚æ¯”å¦‚æ‰“å¼€çš„æ–‡ä»¶ã€æŒ‚èµ·çš„ä¿¡å·ã€å†…æ ¸å†…éƒ¨æ•°æ®ç­‰ç­‰ã€‚åœ¨ linux æºç ä¸­ï¼Œä¸€ä¸ªè¿›ç¨‹çš„ç›¸å…³ä¿¡æ¯ç»´æŠ¤åœ¨ task_struct task_structçš„ç»“æ„ä½“ä¸­ã€‚è¿™é‡Œé¢åŒ…å«äº†è¿›ç¨‹çš„çŠ¶æ€(pidï¼Œè¿è¡ŒçŠ¶æ€)ã€ç›¸å…³èµ„æºã€ä»¥åŠç›¸å…³è¿›ç¨‹ï¼ˆå­è¿›ç¨‹ã€çˆ¶è¿›ç¨‹ï¼‰ä¿¡æ¯ã€‚å†…æ ¸ä¼šç»´æŠ¤ä¸€ä¸ªåŒå‘é“¾è¡¨ï¼Œæ¯ä¸ªé“¾è¡¨çš„èŠ‚ç‚¹æŒ‡å‘å¯¹åº”çš„ task_structã€‚ çŠ¶æ€ TASK_RUNNING: å¯æ‰§è¡Œçš„ï¼›ç­‰å¾…æ‰§è¡Œçš„ TASK_INTERRUPTIBLE: å¯ä¸­æ–­çš„; æ¯”å¦‚è¢«é˜»å¡ã€æˆ–è€…åœ¨ sleep TASK_UNINTERRUPTIBLE: ä¸å¯ä¸­æ–­çš„; å¯¹å¤–ç•Œçš„ä¿¡å·ä¸åšå‡ºå“åº” EXIT_ZOMBIE: ä¸»åŠ¨é€€å‡ºï¼›è¿˜æ²¡æœ‰å®Œå…¨é‡Šæ”¾èµ„æº è¿›ç¨‹çŠ¶æ€å›¾ ç”Ÿå‘½å‘¨æœŸåœ¨è¿›ç¨‹è¢« fork å‡ºæ¥ä¹‹å task_struct ä¼šæœ‰è‡ªå·±çš„ pid å’Œçˆ¶è¿›ç¨‹çš„ pidã€‚ä½†ä¸€äº›å¿…è¦çš„ç³»ç»Ÿèµ„æºå¹¶ä¸ä¼šæ‹·è´è¿‡æ¥ï¼Œè€Œæ˜¯å½“éœ€è¦å†™å…¥çš„æ—¶å€™å†åš(copy-on-write)ã€‚è¿›ç¨‹è°ƒç”¨ exit() ç»“æŸ, éƒ¨åˆ†èµ„æºä¼šé‡Šæ”¾ï¼ŒåŒæ—¶è°ƒç”¨ exit_notify() å‘çˆ¶è¿›ç¨‹å‘ä¿¡å·ã€‚è‹¥çˆ¶è¿›ç¨‹åŠæ—¶å“åº”ï¼Œæ­¤æ—¶é‡Šæ”¾æ‰€æœ‰çš„èµ„æºï¼›å¦åˆ™è®¤ä¸ºæ­¤æ—¶çš„è¿™ä¸ªè¿›ç¨‹æ˜¯åƒµå°¸è¿›ç¨‹ã€‚åŒç†ï¼Œå¦‚æœçˆ¶è¿›ç¨‹å…ˆäºå­è¿›ç¨‹é€€å‡ºï¼Œå­è¿›ç¨‹å°±ä¼šæˆä¸ºå­¤å„¿è¿›ç¨‹ã€‚å†…æ ¸ä¼šå°†è¿™ç±»è¿›ç¨‹å½’ç»™ pid ä¸º 1 çš„è¿›ç¨‹ã€‚ çº¿ç¨‹çº¿ç¨‹æ˜¯ä¸€ç§ç‰¹æ®Šçš„è¿›ç¨‹ï¼ˆå¼ºè°ƒåªæ˜¯ linuxï¼‰åŒä¸€ä¸ªè¿›ç¨‹çš„ N ä¸ªçº¿ç¨‹åªæ˜¯ N ä¸ªå…±äº«åŒä¸€å—èµ„æºçš„task_structã€‚æ¯”å¦‚è¿›ç¨‹åˆ›å»ºçš„æ—¶å€™ä¼šä¾èµ– clone æ–¹æ³• 1clone(SIGCHLD, 0) è€Œçº¿ç¨‹çš„åˆ›å»ºå°±æ˜¯ä¼ é€’æ¥ä¸€äº›å‚æ•°æ¥æŒ‡æ˜è¢«å…±äº«çš„èµ„æºï¼Œè¿™ä¸ªè®¾è®¡ç°åœ¨çœ‹èµ·æ¥ä¹Ÿæ˜¯éå¸¸ä¼˜é›…çš„ã€‚ 1clone(CLONE_VM | CLONE_FS | CLONE_FILES | CLONE_SIGHAND, 0)","categories":[],"tags":[{"name":"æ“ä½œç³»ç»Ÿ","slug":"æ“ä½œç³»ç»Ÿ","permalink":"https://razertory.me/tags/æ“ä½œç³»ç»Ÿ/"}]},{"title":"Scala å‡½æ•°å¼ç¼–ç¨‹è®¾è®¡","slug":"functional-program-design-in-scala","date":"2020-02-20T15:53:05.000Z","updated":"2020-03-28T13:02:10.018Z","comments":true,"path":"2020/02/20/functional-program-design-in-scala/","link":"","permalink":"https://razertory.me/2020/02/20/functional-program-design-in-scala/","excerpt":"","text":"åœ¨è¿™ä¸ª 2020 å¹´åˆçš„ç‰¹æ®Šæ—¶æœŸã€‚ Scala æ˜¯ä¸€é—¨ç°ä»£åŒ–ï¼Œå¤šèŒƒå¼çš„ JVM è¯­è¨€ã€‚ ä¼ é€é—¨ï¼ˆå¯èƒ½éœ€è¦ğŸš€) Functional Program Design in Scala on Coursera æ²¡ä»€ä¹ˆç”¨çš„ certificate W1case class å’Œæ¨¡å¼åŒ¹é…ç”¨ Scala æ¥è¡¨ç¤º JSON å¯¹è±¡å¯ä»¥è¿™æ · 1234567abstract class JSONcase class JSeq (elems: List[JSON]) extends JSON // JSON çš„æ•°ç»„case class JObj (bindings: Map[String, JSON]) extends JSON // JSON å¯¹è±¡case class JNum (num: Double) extends JSON // æ•°å­—ç±»å‹case class JStr (str: String) extends JSONcase class JBool(b: Boolean) extends JSONcase object JNull extends JSON // ç©º æ‰€ä»¥ï¼Œ 12345678910111213&#123; \"firstName\" : \"John\", \"lastName\" : \"Smith\", \"address\" : &#123; \"streetAddress\" : \"21 2 nd Street\", \"state\" : \"NY\", \"postalCode\": 10021 &#125;, \"phoneNumbers\": [ &#123;\"type\" : \"home\",\"number \": \"212 555 -1234\"&#125; , &#123;\"type\" : \"fax\",\"number \": \"646 555 -4567\"&#125; ]&#125; å¯ä»¥è¡¨ç¤ºä¸º 123456789101112131415val data = JObj(Map( \"firstName\" -&gt; JStr(\"John\"), \"lastName\" -&gt; JStr(\"Smith\"), \"address\" -&gt; JObj(Map( \"streetAddress\" -&gt; JStr(\"21 2nd Street\"), \"state\" -&gt; JStr(\"NY\"), \"postalCode\" -&gt; JNum(10021))),\"phoneNumbers\" -&gt; JSeq(List( JObj(Map( \"type\" -&gt; JStr(\"home\"), \"number\" -&gt; JStr(\"212 555-1234\"))),JObj(Map( \"type\" -&gt; JStr(\"fax\"), \"number\" -&gt; JStr(\"646 555-4567\"))) )) )) æ¯”å¦‚è¯´æˆ‘è¦å®ç°ä¸€ä¸ªæ‰“å° JSON å¯¹è±¡çš„æ–¹æ³•ï¼Œå°±å¯ä»¥ 12345678910111213def show(json: JSON): String = json match &#123; case JSeq(elems) =&gt; \"[\" + (elems map show mkString \", \") + \"]\" case JObj(bindings) =&gt; val assocs = bindings map &#123; case (key, value) =&gt; \"\\\"\" + key + \"\\\": \" + show(value) &#125; \"&#123;\" + (assocs mkString \", \") + \"&#125;\" case JNum(num) =&gt; num.toString case JStr(str) =&gt; '\\\"' + str + '\\\"' case JBool(b) =&gt; b.toString case JNull =&gt; \"null\"&#125; ä¸Šè¿°çš„ show(data) å°±è¾“å‡º 1res1: String = &#123;\"firstName\": \"John\", \"lastName\": \"Smith\", \"address\": &#123;\"streetAddress\": \"21 2nd Street\", \"state\": \"NY\", \"postalCode\": 10021.0&#125;, \"phoneNumbers\": [&#123;\"type\": \"home\", \"number\": \"212 555-1234\"&#125;, &#123;\"type\": \"fax\", \"number\": \"646 555-4567\"&#125;]&#125; ç¬¬ 6 è¡Œä»£ç é‡Œé¢ map ä¼ å…¥çš„å‡½æ•°æ˜¯ï¼Œæˆ‘ä»¬çŸ¥é“ï¼Œåœ¨è¿™é‡Œ map å‡½æ•°çš„ç­¾åæ˜¯ def map[B](f: (A) =&gt; B): List[B]é‚£ä¹ˆç¬¬å…­è¡Œçš„ f å°±æ˜¯ case (key, value) =&gt; &quot;\\&quot;&quot; + key + &quot;\\&quot;: &quot; + show(value)ã€‚ è¿™ä¸ªå‡½æ•°å¦‚æœå•ç‹¬æ‹å‡ºæ¥ï¼Œå…¶å®å°±æ˜¯ 1val f: (String, JSON) =&gt; String = &#123; case (key, value) =&gt; key + â€: â€ + value &#125; // æ³¨æ„çœ‹ JObj å®šä¹‰ æ‰€ä»¥ç”¨ case class æœ€æ–¹ä¾¿çš„åœ°æ–¹åœ¨äºæ¨¡å¼åŒ¹é…ä¸­çš„ decompose å‡½æ•°å³å¯¹è±¡ä»»ä½•æƒ…å†µä¸‹ï¼Œå‡½æ•° A =&gt; B å…¶å®å°±æ˜¯ 1scala.Function1[A, B] çš„ç®€å†™ã€‚ æ™®é€šå‡½æ•°æ ¹æ® Function1 çš„å®šä¹‰ 123trait Function1[-A, +R] &#123; def apply(x: A): R&#125; ä¾‹å¦‚ï¼Œ 12val f1: Int =&gt; Int = (x: Int) =&gt; x + 1val f2 = new Function1[Int, Int] &#123;def apply(x: Int) = x + 1&#125; f1 å’Œ f2 ç­‰ä»·ã€‚ åå‡½æ•°å¯¹äºåå‡½æ•° PartialFunction å®šä¹‰ä¸º 1234trait PartialFunction[-A, +R] extends Function1[-A, +R] &#123; def apply(x: A): R def isDefinedAt(x: A): Boolean&#125; ä¾‹å¦‚ï¼Œ 12345678910val f1: PartialFunction[String, String] = &#123; case \"ping\" =&gt; \"pong\" &#125;val f2 = new PartialFunction[String, String] &#123; def apply(x: String) = x match &#123; case \"ping\" =&gt; \"pong\" &#125; def isDefinedAt(x: String) = x match &#123; case \"ping\" =&gt; true case _ =&gt; false &#125;&#125; f1 å’Œ f2 ç­‰ä»·ã€‚ ps: ä»¥ä¸Šï¼Œã€Œç­‰ä»·ã€çš„æ„æ€æ˜¯ä¸¤ä¸ªå‡½æ•°åªè¦è¾“å…¥ç›¸åŒï¼Œè¾“å‡ºä¸€å®šç›¸åŒã€‚ W2LazyListä¸‹é¢ä»£ç  1234567def f(x: Int): Boolean = &#123; println(x + \" \") x % 11 == 0&#125;val v1 = (1 to 100000).filter(f)(1)val v2 = (1 to 100000).to(LazyList).filter(f)(1) v1 å’Œ v2 ç­‰ä»·ã€‚è®¡ç®— v1 çš„æ—¶å€™ä¼šæ‰“å° 1 2 3...9999 100000, è€Œè®¡ç®— v2 çš„æ—¶å€™æ‰“å° 1 2 3 ... 21 22ã€‚è¿™æ˜¯å› ä¸ºå¯¹äº v2ï¼Œ(1 to 100000).to(LazyList) äº§ç”Ÿçš„æ˜¯ scala.collection.immutable.LazyListã€‚å…¶ä¸­å®˜æ–¹æ–‡æ¡£å¯¹å…¶æœ‰ä¸ªç®€å•çš„æè¿° This class implements an immutable linked list that evaluates elements in order and only when needed ä¹Ÿå°±æ˜¯å½“ LazyList é‡Œé¢çš„å…ƒç´ è¢«éœ€è¦çš„æ—¶å€™ï¼Œæ‰ä¼šè¿›è¡Œæœ‰åºè®¡ç®—ï¼Œå¹¶ä¸”è®¡ç®—ä¼šç»ˆæ­¢çŸ¥é“æ‰€éœ€çš„å…ƒç´ è®¡ç®—ç»“æŸã€‚è¿™ä¹Ÿå°±æ˜¯ä¸ºä»€ä¹ˆä¼šæœ‰ä¸Šè¿°çš„è¾“å‡ºäº†ã€‚ æƒ°æ€§æ±‚å€¼ Lazy Evaluationåœ¨ Scala é‡Œé¢ï¼ŒLazy æ„å‘³ç€ä¸¤ç‚¹ å°½é‡å»¶åæ±‚å€¼è®¡ç®— åªè®¡ç®—ä¸€æ¬¡ ä¾‹å¦‚ 1234567def expr = &#123; val x = &#123; print(â€xâ€); 1 &#125; lazy val y = &#123; print(â€yâ€); 2 &#125; def z = &#123; print(â€zâ€); 3 &#125; z + y + x + z + y + x // last line&#125;expr è¿™æ ·çš„è¾“å‡ºä¸º xzyz Infinite Sequencesåˆ©ç”¨ LazyList çš„ç‰¹æ€§ï¼Œå¯ä»¥æ„é€ å‡ºæ— é™åºåˆ—ã€‚æ¯”å¦‚ 1234567891011scala&gt; def from(n: Int): LazyList[Int] = n #:: from(n + 1) // æ— é™åºåˆ—from: (n: Int)LazyList[Int]scala&gt; val natures = from(0) // è‡ªç„¶æ•°natures: LazyList[Int] = LazyList(&lt;not computed&gt;)scala&gt; val hundreds = natures.filter(_ % 100 == 0)hundreds: scala.collection.immutable.LazyList[Int] = LazyList(&lt;not computed&gt;)scala&gt; val fourHundred = hundreds(4) // è®¡ç®—fourHundred: Int = 400 åŸƒæ‹‰æ‰˜æ–¯ç‰¹å°¼ç­›æ³• åŸƒæ‹‰æ‰˜æ–¯ç‰¹å°¼ç­›æ³•æ˜¯åˆ—å‡ºæ‰€æœ‰å°ç´ æ•°æœ€æœ‰æ•ˆçš„æ–¹æ³•ä¹‹ä¸€ï¼Œå…¶åå­—æ¥è‡ªäºå¤å¸Œè…Šæ•°å­¦å®¶åŸƒæ‹‰æ‰˜æ–¯ç‰¹å°¼ï¼Œå¹¶ä¸”è¢«æè¿°åœ¨å¦ä¸€ä½å¤å¸Œè…Šæ•°å­¦å®¶å°¼ç§‘é©¬åº“æ–¯æ‰€è‘—çš„ã€Šç®—æœ¯å…¥é—¨ã€‹ä¸­ã€‚-ç»´åŸºç™¾ç§‘ ç”¨ LazyList å®ç°ä¼šéå¸¸ç®€å•ï¼Œ 12345678910111213def from(n: Int): LazyList[Int] = &#123; n #:: from(n + 1)&#125;def sieve(s: LazyList[Int]): LazyList[Int] = &#123; s.head #:: sieve(s.tail.filter(_ % s.head != 0))&#125;def primeNumber(n: Int): Int = &#123; sieve(from(2))(n)&#125;val n = sieve(from(2))(100) // è¾“å‡º 547 é¢˜ç›®ï¼šå€’æ°´é—®é¢˜ç»™å‡ ä¸ªçŸ¥é“å®¹é‡ï¼Œä½†æ˜¯æ²¡æœ‰åˆ»åº¦çš„æ¯å­ï¼Œæœ‰ä¸ªå¯ä»¥å–ä¹‹ä¸å°½çš„æ°´æºç”¨æ¥ç»™æ¯å­è£…æ»¡æ°´å’Œå°†æ¯å­çš„æ°´å…¨éƒ¨å€’å‡ºã€‚æˆ‘ä»¬éœ€è¦åšçš„å°±æ˜¯ç››å‡ºç»™å®šå®¹é‡çš„æ°´ã€‚æˆ‘ä»¬èƒ½åšçš„æ“ä½œæœ‰ä¸‰ä¸ª empty æ¸…ç©º fill æ”¾æ»¡æ°´ pour(a, b) æŠŠ a çš„æ°´å…¨éƒ¨å¾€ b å€’ç›´è‡³ b æ¯æ»¡äº†æˆ–è€… a æ¯æ²¡æ°´äº† ç°åœ¨éœ€è¦æ‰¾åˆ°å–å¾—å®¹é‡ä¸º N çš„æ°´æ—¶ï¼Œéœ€è¦çš„æ“ä½œã€‚ é™„ï¼š1. Scala å®Œæ•´ä»£ç  2. python è§£æ³• W3 ä¸‹é¢ä¼šç”¨ Scala è¿›è¡ŒåŠ æ³•å™¨æ¨¡æ‹Ÿã€‚å¯¹äºè®¡ç®—æœºä¸­ï¼Œä¸¤ä¸ªæ•°å¦‚ä½•ç›¸åŠ ï¼Œå¯ä»¥æå‰é˜…è¯» ç»´åŸºç™¾ç§‘-åŠ æ³•å™¨ï¼Œæœ€å¥½èƒ½å¤Ÿåšä¸€ä¸‹ ä½è¿ç®—å®ç°åŠ æ³•ã€‚ é€šè¿‡ä»¥ä¸Šå†…å®¹ï¼Œæˆ‘ä»¬éœ€è¦çŸ¥é“çš„æœ€é‡è¦çš„ç‚¹åœ¨äºï¼šä¸¤ä¸ªä¸€ä½äºŒè¿›åˆ¶æ•°ç›¸åŠ ï¼Œå°†ä¼šäº§ç”Ÿä¸¤ä¸ªè¾“å‡ºï¼Œå…¶ä¸­ä¸€ä¸ªæ˜¯å½“å‰ä½ç›¸åŠ çš„å€¼ Sï¼Œå¦ä¸€ä¸ªæ˜¯ç›¸åŠ åçš„è¿›ä½ä¿¡æ¯ Cã€‚å…¶ä¸­ S å¯ä»¥ç”¨å¼‚æˆ–é—¨ï¼Œè¿›ä½å¯ä»¥ç”¨ä¸é—¨ã€‚ä¸¤ä¸ªåŠåŠ å™¨ç”¨æˆ–é—¨ç»„åˆä¸ºä¸€ä¸ªå…¨åŠ å™¨ã€‚ å¼‚æˆ–çš„æ“ä½œé€šè¿‡ä¸‰ç§é—¨çš„ç»„åˆå®ç° ä¸¤ä¸ªç”¨ä¸é—¨ç»„åˆçš„åŠåŠ å™¨æ„æˆä¸€ä¸ªå…¨åŠ å™¨ æ ¹æ®ä¸Šå›¾ï¼Œæˆ‘ä»¬è‡³å°‘éœ€è¦å®ç°çš„æ˜¯ ç”µçº¿ï¼šç”¨æ¥ä¼ å¯¼ä¿¡å·ï¼Œä¿¡å·å¯ä»¥ç”¨ boolean ç±»å‹è¡¨ç¤º 0 å’Œ 1 123456789class Wire &#123; private var sigVal = false def getSignal: Boolean = sigVal def setSignal(s: Boolean): Unit = if (s != sigVal) &#123; sigVal = s actions foreach(_()) &#125;&#125; ä¸é—¨ï¼šè¾“å…¥ä¸¤ä¸ªç”µä¿¡å·ï¼Œè¾“å‡º &amp; å¯¹åº”çš„ä¿¡å· 1def andGate(in1: Wire, in2: Wire, output: Wire): Unit = ??? æˆ–é—¨ï¼šè¾“å…¥ä¸¤ä¸ªç”µä¿¡å·ï¼Œè¾“å‡º | å¯¹åº”çš„ä¿¡å· 1def orGate(in1: Wire, in2: Wire, output: Wire): Unit = ??? é€†å˜å™¨ï¼šè¾“å…¥ç”µä¿¡å·ï¼Œè¾“å‡º ! å¯¹åº”çš„ä¿¡å· 1def inverter(in: Wire, output: Wire): Unit = ??? åœ¨æ­¤åŸºç¡€ä¸Šï¼Œå®ç°å‡ºåŠåŠ å™¨å’Œå…¨åŠ å™¨ 12345678def halfAdder(a: Wire, b: Wire, s: Wire, c: Wire): Unit = &#123; val d = new Wire val e = new Wire orGate(a, b, d) andGate(a, b, c) inverter(c, e) andGate(d, e, s)&#125; 12345678def fullAdder(a: Wire, b: Wire, cin: Wire, sum: Wire, cout: Wire): Unit = &#123; val s = new Wire val c1 = new Wire val c2 = new Wire halfAdder(b, cin, s, c1) halfAdder(a, s, sum, c2) orGate(c1, c2, cout)&#125; å®ç°äº†å…¨åŠ å™¨åã€‚åŠ å…¥æ¨¡æ‹Ÿä¿¡å·çš„è¾“å…¥è¾“å‡ºå³å¯ï¼Œå®Œæ•´ä»£ç  æ¨¡æ‹ŸåŠ æ³•å™¨ W4Functional Reactive Programming (FRP)åœ¨ MVC æ¨¡å‹ä¸­ï¼ŒFRP å¯ä»¥è®© model åœ¨äº§ç”Ÿå˜åŒ–çš„åŒæ—¶ view è‡ªåŠ¨å˜åŒ–ã€‚è¿™æ ·çš„æ¨¡å‹ä¸€èˆ¬ä¹Ÿå°±æ˜¯ pub-sub æ¨¡å‹æˆ–è€…å«è§‚å¯Ÿè€…æ¨¡å‹ (observers)ã€‚ 12345Subscriber1 subscribe ___________Subscriber2 ------------&gt; | |Subscriber3 |Publisher |Subscriber4 &lt;------------ | |Subscriber5 publish |__________| é€šç”¨çš„è¯´æ¯”å¦‚ a = f(b) é‡Œé¢ã€‚å½“ b åœ¨å‘ç”Ÿå˜åŒ–çš„æ—¶å€™ a ä¹Ÿä¼šè·Ÿç€å˜ã€‚å®ç°è¿™ä¸€ç‚¹ï¼Œå¯ä»¥æŠŠã€Œå˜åŒ–ã€å½’åŒ–ä¸ºã€Œeventã€ï¼Œè€Œè‡ªåŠ¨æ£€æŸ¥è¿™äº›ã€Œeventã€çš„ä¸œè¥¿å«åš Signalã€‚åœ¨ Scala é‡Œé¢é€šå¸¸æŠŠè¿™æ ·çš„ Signal å®ç°ä¸ºä¸€ä¸ªç±»å‹ï¼Œé€šè¿‡ apply() ç»™å…¶èµ‹å€¼ã€‚æ¯”å¦‚ 12val s = Signal(1)val v = s() // 1 åŒæ—¶ï¼Œä¸ºäº†ç»™ Signal å†æ¬¡èµ‹å€¼ï¼Œå¯ä»¥æ‰©å±•æ–°å¢ä¸€ä¸ª update æ–¹æ³•ã€‚æ¯”å¦‚ s.update(5)ï¼Œé¡ºå¸¦å¯ä»¥å†™æˆ s() = 5ã€‚è¿™æ ·çš„è¯ï¼Œå®ç°ä¸€ä¸ªæ‰©å±•äº† Signal åä¸º Var çš„ç±»å‹ï¼Œè®©å…¶æ‹¥æœ‰ update æ–¹æ³•ã€‚ åœ¨è¿™æ ·çš„æ¡ä»¶ä¸‹ï¼Œ 12345678// (1)val num = Var(1)val twice = Signal(num() * 2)num() = 2// (2)var num = Var(1)val twice = Signal(num() * 2)num = Var(2) (1) é‡Œé¢çš„ twice å˜ä¸º 4ï¼Œï¼ˆ2ï¼‰é‡Œé¢çš„ twice è¿˜æ˜¯ 2ã€‚ä¸Šè¿°ä½“ç°çš„ FRP é‡Œé¢ï¼Œnum æ˜¯ publisherï¼Œtwice æ˜¯ subscriberã€‚num äº§ç”Ÿäº† eventï¼Œtwice æ¥å—è¿™æ ·çš„ eventã€‚å¹¶ä¸”æ‰€æœ‰çš„å˜é‡æœ¬èº«éƒ½æ˜¯ immutableã€‚ å®ç° FRPVar å’Œ Signalæˆ‘ä»¬çŸ¥é“ Signal å’Œ Var åº”è¯¥æ˜¯è¿™æ · 12345678910111213141516// signalclass Signal[T](expr: =&gt; T) &#123; def apply(): T = ???&#125;object Signal &#123; def apply[T](expr: =&gt; T) = new Signal(expr)&#125;// varclass Var[T](expr: =&gt; T) extends Signal[T](expr) &#123; def update(expr: =&gt; T): Unit = ???&#125;object Var &#123; def apply[T](expr: =&gt; T) = new Var(expr)&#125; ç»´æŠ¤è®¢é˜…å…³ç³»æœ‰äº†è¿™äº›æ–¹æ³•ï¼Œå°±å¯ä»¥åšåˆ°èµ‹å€¼å’Œå†æ¬¡èµ‹å€¼ã€‚è¿˜éœ€è¦çš„æ˜¯ï¼Œå½“ä¸€ä¸ª publisher äº§ç”Ÿäº† event çš„æ—¶å€™ï¼Œå¦‚ä½•è‡ªåŠ¨é€šçŸ¥åˆ°å¯¹åº”çš„ subscriberï¼Œå¹¶ä¸”è®©å…¶é‡æ–°è®¡ç®—ï¼ˆre-evaluateï¼‰ã€‚ ä¾‹å¦‚ï¼Œs æ˜¯ Var ç±»å‹ï¼Œå¹¶ä¸”è¿›å…¥åˆ°äº†è¡¨è¾¾å¼ expr é‡Œï¼Œå½¢å¦‚ expr sï¼Œé‚£ä¹ˆå½“è¡¨è¾¾å¼ expr sï¼Œä½œä¸ºå‚æ•°ä¼ é€’ç»™äº†æŸä¸ª Signal å½¢å¦‚ val t = Signal(expr s) çš„æ—¶å€™ã€‚å°±éœ€è¦ç»™ s ç»´æŠ¤ä¸€ä¸ª subscriberã€‚åŒç†ï¼Œå½“æœ‰å¤šä¸ª subscribers çš„æ—¶å€™å°±ç»™ s ç»´æŠ¤ä¸€ä¸ª subscriber çš„é›†åˆã€‚æ¯”å¦‚ 12345678910// val set = Set()var num = Var(1)// è§¦å‘çš„æ¡ä»¶å°±æ˜¯ class Var çš„ apply æ–¹æ³•ã€‚// è§¦å‘ï¼šset += Signal(num() * 2)val double = Signal(num() * 2)// è§¦å‘ï¼šset += Signal(num() * 3)val tiple = Signal(num() * 3) è§¦å‘çš„æ¡ä»¶è¾¾åˆ°äº†ï¼Œå¯æ˜¯å¦‚ä½•æŠŠ Signal(num() * 3) è¿™æ ·çš„å¯¹è±¡ä¼ é€’ç»™ num çš„ set ï¼Ÿ è¿™ä¸ªæ—¶å€™å°±éœ€è¦åœ¨ Object Signal é‡Œé¢æ–°å¢ä¸€å—ç”¨äºç»´æŠ¤æ–¹æ³•è°ƒç”¨çš„æ•°æ®ç»“æ„ï¼Œæ²¡åšå°±æ˜¯ stack 1234object Signal &#123; val caller = new StackableVariable[Signal[_]](NoSignal) def apply[T](expr: =&gt; T) = new Signal(expr)&#125; StackableVariable åœ¨å½“å‰çš„ä¸Šä¸‹æ–‡ä¸­å¤šä¸ª Signal/Object ä¼šå…±äº«ã€‚å½“è°ƒç”¨ class Signal çš„ apply() æ–¹æ³•çš„æ—¶å€™å°±å»è¿™é‡Œé¢æ‰¾åˆ°å½“å‰çš„è°ƒç”¨æ–¹ã€‚ ç»´æŠ¤è°ƒç”¨æ ˆè°ƒç”¨æ ˆé‡Œé¢å­˜æ”¾æœ‰åºçš„ Signalã€‚ä¾‹å¦‚ï¼Œæœ‰ä¸‹é¢æµ‹è¯•ä»£ç  12345678910111213test(\"multi subscribers\") &#123; val publisher = Var(1) val subscriber1 = Signal(publisher() * 20) // æ³¨æ„ scala çš„ call-by-name å’Œ call-by-valueã€‚è¿™é‡Œä¼ é€’çš„æ˜¯è¡¨è¾¾å¼ val subscriber2 = Signal(publisher() * 30) val subscriber3 = Signal(publisher() * 40) assert(subscriber1() == 20) assert(subscriber2() == 30) assert(subscriber3() == 40) publisher() = 2 assert(subscriber1() == 40) assert(subscriber2() == 60) assert(subscriber3() == 80)&#125; ç¬¬ä¸‰è¡Œå¼€å§‹ï¼ŒåŒ…å«è¡¨è¾¾å¼çš„ Signal è¿›å…¥è°ƒç”¨æ ˆï¼Œå¹¶ä¸æ–­è¢«å¸¦å…¥ subscriber çš„é›†åˆã€‚ 12345678910class StackableVariable[T](init: T) &#123; private var values: List[T] = List(init) def value: T = values.head def withValue[R](newValue: T)(op: =&gt; R): R = &#123; values = newValue :: values try op finally values = values.tail &#125;&#125; å®Œæ•´ä»£ç ","categories":[],"tags":[]},{"title":"LRU ç¼“å­˜","slug":"lru-cache","date":"2020-02-16T09:39:04.000Z","updated":"2020-03-28T13:02:10.018Z","comments":true,"path":"2020/02/16/lru-cache/","link":"","permalink":"https://razertory.me/2020/02/16/lru-cache/","excerpt":"","text":"LRU çš„å…¨ç§°æ˜¯ Least recently usedï¼Œæ˜¯ç¼“å­˜æ›¿æ¢ç­–ç•¥çš„ä¸€ç§ã€‚ç”µè„‘å­˜å‚¨å™¨ç©ºé—´çš„å¤§å°å›ºå®šï¼Œæ— æ³•å®¹çº³æœåŠ¡å™¨ä¸Šæ‰€æœ‰çš„æ–‡ä»¶ï¼Œæ‰€ä»¥å½“æœ‰æ–°çš„æ–‡ä»¶è¦è¢«ç½®æ¢å…¥ç¼“å­˜æ—¶ï¼Œå¿…é¡»æ ¹æ®ä¸€å®šçš„åŸåˆ™æ¥å–ä»£æ‰é€‚å½“çš„æ–‡ä»¶ã€‚æ­¤åŸåˆ™å³æ‰€è°“ç¼“å­˜æ›¿æ¢ç­–ç•¥ã€‚ä¼ é€é—¨ å®ç° LRU ç¼“å­˜éœ€è¦ç”¨åˆ° kv ç±»å‹å’Œçº¿å‹çš„æ•°æ®ç»“æ„ï¼Œç”¨æ¥åšåˆ° O(1) çš„æŸ¥æ‰¾æ•ˆç‡å’Œå®ç°æ·˜æ±°æœºåˆ¶ã€‚æˆ‘ä»¬å¯ä»¥ç”¨ HashMap å’Œä¸€ä¸ªåŒå‘é“¾è¡¨ã€‚å…¶ä¸­ç”¨åŒå‘é“¾è¡¨çš„å¥½å¤„æ˜¯ï¼šå½“è¦åˆ é™¤çš„èŠ‚ç‚¹ä¸º node çš„æ—¶å€™ï¼Œé€šè¿‡ node.pre å’Œ node.next å¯ä»¥å¿«é€Ÿæ‰¾åˆ°å‰åèŠ‚ç‚¹ï¼Œä»è€Œåœ¨é“¾è¡¨ä¸­å»æ‰è¿™ä¸ªèŠ‚ç‚¹ã€‚ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283848586878889public class LRUCache &#123; class LinkNode &#123; int key; int value; LinkNode prev; LinkNode next; &#125; // æ–°å¢çš„ node åªä½œä¸º head private void addNode(LinkNode node) &#123; node.prev = head; node.next = head.next; head.next.prev = node; head.next = node; &#125; // é€šè¿‡ prev å’Œ next å¿«é€Ÿåˆ é™¤èŠ‚ç‚¹ private void removeNode(LinkNode node)&#123; LinkNode prev = node.prev; LinkNode next = node.next; prev.next = next; next.prev = prev; &#125; // å…ˆåˆ é™¤ï¼Œåæ–°å¢ä»è€ŒæŒ‡å‘å¤´éƒ¨ private void moveToHead(LinkNode node)&#123; removeNode(node); addNode(node); &#125; // æ·˜æ±°æœ«å°¾ private LinkNode popTail() &#123; LinkNode res = tail.prev; removeNode(res); return res; &#125; private HashMap&lt;Integer, LinkNode&gt; cache = new HashMap&lt;Integer, LinkNode&gt;(); private int size; private int capacity; private LinkNode head, tail; public LRUCache(int capacity) &#123; this.size = 0; this.capacity = capacity; head = new LinkNode(); tail = new LinkNode(); head.next = tail; tail.prev = head; &#125; public int get(int key) &#123; LinkNode node = cache.get(key); if (node == null) return -1; moveToHead(node); return node.value; &#125; public void put(int key, int value) &#123; LinkNode node = cache.get(key); if(node == null) &#123; LinkNode newNode = new LinkNode(); newNode.key = key; newNode.value = value; cache.put(key, newNode); addNode(newNode); ++size; if(size &gt; capacity) &#123; LinkNode tail = popTail(); cache.remove(tail.key); --size; &#125; &#125; else &#123; node.value = value; moveToHead(node); &#125; &#125;&#125; ä¸€ç§æ›´ä¸ºä¼˜é›…çš„å®ç°æ˜¯è®©è¿™ä¸ªåŒå‘é“¾è¡¨æˆç¯çŠ¶ï¼Œåˆå§‹åŒ–ä¸º value éƒ½ä¸º -1ï¼Œå¤§å°ä¸º capacityã€‚æ¯å½“æœ‰ get å’Œ put æ“ä½œçš„æ—¶å€™å°±è°ƒæ•´ç¯ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960class LRUCache &#123; private class Node &#123; int key, val; Node next, pre; Node(int key, int val, Node pre, Node next) &#123; this.key = key; this.val = val; this.pre = pre; this.next = next; &#125; &#125; private Node head = new Node(-1, -1, null, null); private HashMap&lt;Integer, Node&gt; map = new HashMap&lt;&gt;(); private void move2Head(Node cur)&#123; if (cur == head) &#123; head = head.pre; return; &#125; cur.pre.next = cur.next; cur.next.pre = cur.pre; cur.next = head.next; cur.next.pre = cur; head.next = cur; cur.pre = head; &#125; LRUCache(int capacity)&#123; Node cur = head; for (int i = 0; i &lt; capacity - 1; i++) &#123; cur.next = new Node(-1, -1, cur, null); cur = cur.next; &#125; cur.next = head; head.pre = cur; &#125; public int get(int key) &#123; if (!map.containsKey(key)) return -1; Node node = map.get(key); move2Head(node); return node.val; &#125; public void put(int key, int val) &#123; if (map.containsKey(key)) &#123; Node node = map.get(key); node.val = val; move2Head(node); &#125; else &#123; if (head.val != -1) map.remove(head.key); head.key = key; head.val = val; map.put(key, head); head = head.pre; &#125; &#125;&#125; æ­¤å¤–ï¼ŒJava ä¸­çš„ LinkedHashMap å¯ä»¥ç›´æ¥å®ç° LRU ç¼“å­˜ã€‚:)","categories":[],"tags":[]},{"title":"ç¼–è¾‘è·ç¦»","slug":"edit-distance","date":"2020-01-11T03:35:32.000Z","updated":"2020-03-28T13:02:10.016Z","comments":true,"path":"2020/01/11/edit-distance/","link":"","permalink":"https://razertory.me/2020/01/11/edit-distance/","excerpt":"","text":"ç»™å‡ºä¸¤ä¸ªå•è¯ word1 å’Œ word2ï¼Œæ‰¾å‡ºæŠŠ word1 ç¼–è¾‘æˆ word2 çš„æœ€çŸ­ç¼–è¾‘è·ç¦»ã€‚ç»™å‡ºçš„å¯ç”¨ç¼–è¾‘æ“ä½œæœ‰ï¼š æ’å…¥ä¸€ä¸ªå­—ç¬¦ insert åˆ é™¤ä¸€ä¸ªå­—ç¬¦ delete æ›´æ–°ä¸€ä¸ªå­—ç¬¦ update ç¼–è¾‘è·ç¦»æ˜¯é’ˆå¯¹äºŒä¸ªå­—ç¬¦ä¸²ï¼ˆä¾‹å¦‚è‹±æ–‡å­—ï¼‰çš„å·®å¼‚ç¨‹åº¦çš„é‡åŒ–é‡æµ‹ï¼Œé‡æµ‹æ–¹å¼æ˜¯çœ‹è‡³å°‘éœ€è¦å¤šå°‘æ¬¡çš„å¤„ç†æ‰èƒ½å°†ä¸€ä¸ªå­—ç¬¦ä¸²å˜æˆå¦ä¸€ä¸ªå­—ç¬¦ä¸²ã€‚ç¼–è¾‘è·ç¦»å¯ä»¥ç”¨åœ¨è‡ªç„¶è¯­è¨€å¤„ç†ä¸­ï¼Œä¾‹å¦‚æ‹¼å†™æ£€æŸ¥å¯ä»¥æ ¹æ®ä¸€ä¸ªæ‹¼é”™çš„å­—å’Œå…¶ä»–æ­£ç¡®çš„å­—çš„ç¼–è¾‘è·ç¦»ï¼Œåˆ¤æ–­å“ªä¸€ä¸ªï¼ˆæˆ–å“ªå‡ ä¸ªï¼‰æ˜¯æ¯”è¾ƒå¯èƒ½çš„å­—ã€‚DNAä¹Ÿå¯ä»¥è§†ä¸ºç”¨Aã€Cã€Gå’ŒTç»„æˆçš„å­—ç¬¦ä¸²ï¼Œå› æ­¤ç¼–è¾‘è·ç¦»ä¹Ÿç”¨åœ¨ç”Ÿç‰©ä¿¡æ¯å­¦ä¸­ï¼Œåˆ¤æ–­äºŒä¸ªDNAçš„ç±»ä¼¼ç¨‹åº¦ã€‚Unix ä¸‹çš„ diff åŠ patch å³æ˜¯åˆ©ç”¨ç¼–è¾‘è·ç¦»æ¥è¿›è¡Œæ–‡æœ¬ç¼–è¾‘å¯¹æ¯”çš„ä¾‹å­ã€‚ ä¼ é€é—¨å¯¹äº â€œaâ€, â€œâ€, æ‰§è¡Œæ­¥éª¤ 1å¯¹äº â€œâ€, â€œaâ€, æ‰§è¡Œæ­¥éª¤ 2å¯¹äº â€œaâ€, â€œbâ€, æ‰§è¡Œæ­¥éª¤ 3 å‡è®¾å­—ç¬¦ä¸²ä¸² word1 å’Œ word2 çš„æœ€å°ç¼–è¾‘è·ç¦»æ˜¯ d[i][j] (i å’Œ j ä»£è¡¨ word1 å’Œ word2 çš„é•¿åº¦ - 1)ï¼Œå½“æˆ‘ä»¬ç»™ word1 å’Œ word2 éƒ½ append ä¸€ä¸ªç›¸åŒçš„å­—ç¬¦çš„æ—¶å€™ï¼Œè¿™ä¸ªç¼–è¾‘è·ç¦»ä¸å˜ã€‚å› æ­¤å¯ä»¥è®¤ä¸ºï¼Œæ­¤æ—¶çš„ d[i+1][j+1] == d[i][j]ã€‚å½“ append çš„å­—ç¬¦ä¸åŒçš„çš„æ—¶å€™ã€‚å°±æ˜¯æ‰¾åˆ°ä¹‹å‰çš„æœ€å°ç¼–è¾‘è·ç¦» + 1ï¼Œè¿™ä¸ªä¹‹å‰çš„æœ€å°ç¼–è¾‘è·ç¦»å¯èƒ½æ˜¯ d[i][j]ã€d[i][j+1]ã€æˆ–è€… d[i+1][j]ã€‚ Edit-Distance.png 1234567891011121314151617181920212223242526272829class Solution &#123; public int minDistance(String word1, String word2) &#123; if (word1 == null || word2 == null) return 0; int m = word1.length() + 1, n = word2.length() + 1; //å¤šçš„ä¸€è¡Œç•™ç»™ç©ºå­—ç¬¦ä¸² int[][] d = new int[m][n]; for (int i = 0; i &lt; m; i++) d[i][0] = i; for (int j = 0; j &lt; n; j++) d[0][j] = j; for(int i = 1; i &lt; m; ++i) &#123; for (int j = 1; j &lt; n; ++j) &#123; if (word1.charAt(i-1) == word2.charAt(j-1)) d[i][j] = d[i-1][j-1]; else d[i][j] = min(d[i-1][j-1], d[i][j-1], d[i-1][j]) + 1; &#125; &#125; return d[m-1][n-1]; &#125; private int min(int a, int b, int c) &#123; return Math.min(a, Math.min(b, c)); &#125;&#125;","categories":[],"tags":[]},{"title":"äºŒç»´æ•°ç»„ä¸­å’Œæœ€å°è·¯å¾„","slug":"minimum-path-sum","date":"2020-01-11T02:38:44.000Z","updated":"2020-03-28T13:02:10.017Z","comments":true,"path":"2020/01/11/minimum-path-sum/","link":"","permalink":"https://razertory.me/2020/01/11/minimum-path-sum/","excerpt":"","text":"åœ¨ä¸€ä¸ª m * n å¤§çš„éè´Ÿç»„æ•´æ•°ç»„æˆçš„äºŒç»´æ•°ç»„ä¸­ï¼Œæ‰¾åˆ°ä¸€æ¡ä» left-top åˆ° right-bottom çš„å’Œæœ€å°çš„è·¯å¾„ã€‚è¾“å‡ºè¿™ä¸ªè·¯å¾„çš„å€¼ã€‚ä¼ é€é—¨ 12345[ [1,3,1], [1,5,1], [4,2,1]] åœ¨è¿™æ ·ä¸€ä¸ªçŸ©é˜µä¸­ï¼Œä» m[0][0] åˆ° m[2][2] çš„æœ€çŸ­è·¯å¾„ï¼Œå¯ä»¥çœ‹ä½œæ˜¯ m[0][0] åˆ° m[1][2] çš„æœ€çŸ­è·¯å¾„ (1-&gt;3-&gt;1-&gt;1) ä»¥åŠ m[2][1] çš„æœ€çŸ­è·¯å¾„ä¸­å–åˆ°çš„æœ€å°å€¼ (1-&gt;1-&gt;4-&gt;2) åŠ ä¸Š m[2][2] å–åˆ°çš„æœ€å°å€¼ 1-&gt;3-&gt;1-&gt;1-&gt;1ã€‚å› æ­¤å¯ä»¥å¾—åˆ°å…³ç³»å¼ dp[m][n] = min(dp[m-1][n], dp[m][n-1]) + g[m][n] åˆ©ç”¨è¿™ä¸ªå…³ç³»å¼ï¼Œå¤„ç†å¥½ mï¼Œn ä¸º 0 çš„è¾¹ç•Œæƒ…å†µå³å¯å¾—å‡ºæœ€çŸ­è·¯å¾„ 123456789101112131415161718192021class Solution &#123; // dp[m][n] = min(dp[m-1][n], dp[m][n-1]) + g[m][n] public int minPathSum(int[][] g) &#123; if (g == null || g[0] == null) return 0; int h = g.length, w = g[0].length; int[][] dp = new int[h][w]; dp[0][0] = g[0][0]; for (int i = 0; i &lt; h; i++) for (int j = 0; j &lt; w; j++) &#123; if (i == 0 &amp;&amp; j == 0) continue; if (i == 0) dp[i][j] = dp[i][j-1] + g[i][j]; else if (j == 0) dp[i][j] = dp[i-1][j] + g[i][j]; else dp[i][j] = Math.min(dp[i-1][j], dp[i][j-1]) + g[i][j]; &#125; return dp[h-1][w-1]; &#125;&#125;","categories":[],"tags":[]},{"title":"æœ€é•¿å›æ–‡å­ä¸²","slug":"longest-palindromic-substring","date":"2020-01-11T02:00:36.000Z","updated":"2020-03-28T13:02:10.017Z","comments":true,"path":"2020/01/11/longest-palindromic-substring/","link":"","permalink":"https://razertory.me/2020/01/11/longest-palindromic-substring/","excerpt":"","text":"ç»™ä¸€ä¸ªå­—ç¬¦ä¸² sï¼Œæ‰¾åˆ°å…¶ä¸­æœ€é•¿çš„å›æ–‡ä¸²ã€‚ä¼ é€é—¨ å›æ–‡ä¸²æœ‰ä¸¤ç§æ¨¡å¼ï¼Œä¸€ç§æ˜¯ aabb ç±»å‹ï¼Œå¦ä¸€ç§æ˜¯ aacbb ç±»å‹ã€‚å½“æˆ‘ä»¬å¯¹ä¸€ä¸ªå­—ç¬¦ä¸²åšæ˜¯å¦æ˜¯å›æ–‡çš„æ—¶å€™å¯ä»¥å®ç°ä¸€ä¸ª expand å‡½æ•°ç”¨ä½œåˆ¤æ–­int expand(String s, int lelf, int right) å½“ s[left] == s[right] ä¸” left å’Œ right æ²¡æœ‰åˆ°è¾¾å­—ç¬¦ä¸²è¾¹ç•Œçš„æ—¶å€™è®¡ç®—é•¿åº¦å³ right - left + 1ã€‚ å®ç°äº† expand ä¹‹åï¼Œå¯¹äºä»»æ„å­—ç¬¦ä¸²å¯ä»¥ç¡®è®¤ï¼š å­—ç¬¦ä¸²é•¿åº¦ä¸º 1 çš„æ—¶å€™ï¼Œæœ¬èº«å°±æ˜¯å›æ–‡ä¸² å­—ç¬¦ä¸²é•¿åº¦ä¸º 2 çš„æ—¶å€™ï¼Œåˆ¤æ–­ä¸¤ä¸ªå­—ç¬¦æ˜¯å¦ç›¸ç­‰ï¼Œç›¸ç­‰è¯´æ˜æœ¬èº«æ˜¯ï¼Œå¦åˆ™å’Œ 1 ä¸€è‡´ å­—ç¬¦ä¸²é•¿åº¦ä¸º n çš„æ—¶å€™ï¼Œåœ¨å¯¹å­—ç¬¦ä¸²è¿›è¡Œä»å·¦åˆ°å³æ‰«ææ‰¾åˆ°æœ€å¤§å€¼ max (expand(s, i, i), expand(s, i, i + 1)) 1234567891011121314151617181920212223class Solution &#123; public String longestPalindrome(String s) &#123; int start = 0, max = 0; for (int i = 0; i &lt; s.length(); i++) &#123; int len1 = expand(s, i, i); int len2 = expand(s, i, i + 1); int len = Math.max(len1, len2); if (len &gt; max) &#123; start = i - (len-1)/2; max = len; &#125; &#125; return s.substring(start, start + max); &#125; int expand(String s, int left, int right) &#123; while(left &gt;= 0 &amp;&amp; right &lt; s.length() &amp;&amp; s.charAt(left) == s.charAt(right))&#123; left--; right++; &#125; return right - left - 1; &#125;&#125;","categories":[],"tags":[]},{"title":"æŠ¢åŠ«æˆ¿å­","slug":"house-robber","date":"2020-01-11T01:33:19.000Z","updated":"2020-03-28T13:02:10.017Z","comments":true,"path":"2020/01/11/house-robber/","link":"","permalink":"https://razertory.me/2020/01/11/house-robber/","excerpt":"","text":"ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„å°å·ï¼Œè®¡åˆ’å·çªƒæ²¿è¡—çš„æˆ¿å±‹ã€‚æ¯é—´æˆ¿å†…éƒ½è—æœ‰ä¸€å®šçš„ç°é‡‘ï¼Œå½±å“ä½ å·çªƒçš„å”¯ä¸€åˆ¶çº¦å› ç´ å°±æ˜¯ç›¸é‚»çš„æˆ¿å±‹è£…æœ‰ç›¸äº’è¿é€šçš„é˜²ç›—ç³»ç»Ÿï¼Œå¦‚æœä¸¤é—´ç›¸é‚»çš„æˆ¿å±‹åœ¨åŒä¸€æ™šä¸Šè¢«å°å·é—¯å…¥ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨æŠ¥è­¦ã€‚ç»™å®šä¸€ä¸ªä»£è¡¨æ¯ä¸ªæˆ¿å±‹å­˜æ”¾é‡‘é¢çš„éè´Ÿæ•´æ•°æ•°ç»„ï¼Œè®¡ç®—ä½ åœ¨ä¸è§¦åŠ¨è­¦æŠ¥è£…ç½®çš„æƒ…å†µä¸‹ï¼Œèƒ½å¤Ÿå·çªƒåˆ°çš„æœ€é«˜é‡‘é¢ã€‚ ä¼ é€é—¨ å‡è®¾æˆ¿å­å®šä¹‰ä¸º house[i] æˆ¿å±‹æ•°é‡æ˜¯ 1 çš„æ—¶å€™ï¼Œå°å·åªèƒ½å·è¿™ä¸€å®¶ house[0]ã€‚ æˆ¿å±‹æ•°é‡æ˜¯ 2 çš„æ—¶å€™ï¼Œå°å·ä»ç°æœ‰çš„é€‰ä¸€ä¸ªå¤šçš„ï¼Œä¹Ÿå°±æ˜¯ max(house[0], house[1]) æˆ¿å±‹æ•°é‡æ˜¯ 3 çš„æ—¶å€™ï¼Œå°å·çš„é€‰æ‹©ä¸º max(house[0] + house[2], house[1]) å¦‚æœæˆ‘ä»¬çŸ¥é“æˆ¿å±‹æ•°é‡ä¸º i - 1 çš„æ—¶å€™ï¼Œå°å·çš„æœ€ä½³é€‰æ‹©æ˜¯ d[i-1]ï¼Œé‚£ä¹ˆå½“å†å¢åŠ ä¸€ä¸ªæˆ¿å±‹ï¼Œå³æˆ¿å±‹æ•°é‡ä¸º i çš„æ—¶å€™ã€‚ä¾æ®é¢˜æ„å¯ä»¥æ¨å¯¼å‡º 1d[i] = max(house[i] + d[i-2], d[i-1]) ç¿»è¯‘æˆä»£ç å°±æ˜¯ 123456789101112class Solution &#123; public int rob(int[] nums) &#123; if (nums == null || nums.length == 0) return 0; int[] d = new int[nums.length]; for (int i = 0; i &lt; nums.length; i++) &#123; if (i == 0) d[i] = nums[i]; else if (i == 1) d[i] = Math.max(nums[i], nums[i-1]); else d[i] = Math.max(d[i-2] + nums[i], d[i-1]); &#125; return d[nums.length - 1]; &#125;&#125;","categories":[],"tags":[]},{"title":"ä¹°å–è‚¡ç¥¨çš„æœ€å¤§åˆ©æ¶¦","slug":"max-stock-profit","date":"2020-01-09T05:02:03.000Z","updated":"2020-03-28T13:02:10.016Z","comments":true,"path":"2020/01/09/max-stock-profit/","link":"","permalink":"https://razertory.me/2020/01/09/max-stock-profit/","excerpt":"","text":"å‡è®¾æŠŠæŸè‚¡ç¥¨çš„ä»·æ ¼æŒ‰ç…§æ—¶é—´å…ˆåé¡ºåºå­˜å‚¨åœ¨æ•°ç»„ä¸­ï¼Œè¯·é—®ä¹°å– ä¸€æ¬¡ è¯¥è‚¡ç¥¨å¯èƒ½è·å¾—çš„åˆ©æ¶¦æ˜¯å¤šå°‘ï¼Ÿ ä¾‹å¦‚ä¸€åªè‚¡ç¥¨åœ¨æŸäº›æ—¶é—´èŠ‚ç‚¹çš„ä»·æ ¼ä¸º [9, 11, 8, 5, 7, 12, 16, 14]ã€‚ å¦‚æœæˆ‘ä»¬èƒ½åœ¨ä»·æ ¼ä¸º 5 çš„æ—¶å€™ä¹°å…¥å¹¶åœ¨ä»·æ ¼ä¸º 16 æ—¶å–å‡ºï¼Œåˆ™èƒ½æ”¶è·æœ€å¤§çš„åˆ©æ¶¦ 11ã€‚ä¼ é€é—¨ è‚¡ç¥¨æœ€å¤§åˆ©æ¶¦ï¼Œå…¶å®å°±æ˜¯ä¸ªä»å¤´åˆ°å°¾ä¸€ç›´æ›´æ–°æœ€å¤§åˆ©æ¶¦ã€‚æœ€å¤§åˆ©æ¶¦ = Math.max(å‰é¢çš„æœ€å¤§åˆ©æ¶¦ï¼Œå½“å‰è‚¡ç¥¨ä»·æ ¼ - å‰é¢æœ€ä½ä»·æ ¼) 123456789public int maxProfit(int[] nums) &#123; if (nums == null || nums.length == 0) return 0; int min = nums[0], maxProfit = 0; for (int i = 1; i &lt; nums.length; i++) &#123; min = Math.min(min, nums[i]); maxProfit = Math.max(maxProfit, nums[i] - min); &#125; return maxProfit;&#125;","categories":[],"tags":[]},{"title":"2020 æ–°å¹´å¿«ä¹","slug":"happy-new-year-2020","date":"2020-01-01T04:25:41.000Z","updated":"2020-03-28T13:02:10.016Z","comments":true,"path":"2020/01/01/happy-new-year-2020/","link":"","permalink":"https://razertory.me/2020/01/01/happy-new-year-2020/","excerpt":"","text":"ç°åœ¨æ˜¯ 2020 å¹´çš„ä¸€æœˆä¸€æ—¥ï¼Œå’Œæ™®é€šæ”¾å‡çš„æ—¥å¸¸ä¸€æ ·ï¼š1. KFCï¼Œ2.ç”µè„‘ï¼Œ 3.çœ‹ä¹¦/ç¼–ç¨‹ã€‚å’Œä¹‹å‰ä¸ä¸€æ ·çš„æ˜¯ï¼Œå’–å•¡ç‚¹çš„æ˜¯åŠ å†°çš„ç¾å¼ã€‚å›æƒ³èµ·è¿‡å»çš„ä¸€å¹´ï¼Œä¸åœ¨åŠå…¬å®¤çš„æ—¶å€™ï¼Œæˆ‘é€šå¸¸ä¹Ÿä¼šå»æ‰¾ä¸€ä¸ªåœ°æ–¹å­¦ä¹ ï¼Œå¸¸åšçš„äº‹æƒ…æœ‰ åˆ·è¯¾ã€‚MIT 6.824ã€SICP é‚£ç§ åˆ· OJã€‚é€šå¸¸æ˜¯ Leetcode æˆ–è€… codewarsï¼Œå…¶ä¸­åœ¨ leetcode ä¸Šæ‰“äº†ä¸€æ®µæ—¶é—´çš„å‘¨èµ› çœ‹ä¹¦ã€‚é€šå¸¸éƒ½æ˜¯è®¡ç®—æœºç›¸å…³çš„ä¹¦ç±ï¼Œæœ€è¿‘çœ‹çš„æ˜¯ FP ç›¸å…³ å†™åšå®¢ã€‚å’Œç°åœ¨ä¸€æ · è¿™äº›äº‹æƒ…éƒ½æ˜¯æˆ‘æ¢ä¸ªäººå–œæ¬¢åšçš„ï¼Œä½†æ˜¯å¯¹å¤–å´æœ‰ä¼˜å…ˆçº§ã€‚æ¯”å¦‚è¯´å¦‚æœæˆ‘æœ€è¿‘è¦å‚åŠ é¢è¯•ï¼Œæˆ‘å¯èƒ½ä¼šèŠ±æ›´å¤šçš„æ—¶é—´åœ¨åˆ· OJï¼›å¦‚æœæˆ‘æœ€è¿‘è¦ç”¨ä¸€é—¨æ–°è¯­è¨€/æ¡†æ¶ï¼Œæˆ‘å¯èƒ½ä¼šé€‰æ‹©çœ‹ä¹¦ï¼›å¦‚æœæˆ‘æœ€è¿‘æ—¶é—´æ¯”è¾ƒå……è£•ä¸”æ²¡æœ‰å¤–éƒ¨çš„éœ€æ±‚ï¼Œé‚£ä¹ˆæˆ‘ä¼šåƒç°åœ¨ä¸€æ ·å†™åšå®¢æˆ–è€…ç”¨ä¸€æ®µè¿ç»­ä¸”è¶³å¤Ÿé•¿çš„æ—¶é—´æ¥åˆ·è¯¾ç¨‹ã€‚ è¿™ä¹ˆåšæ—¢æ»¡è¶³äº†è‡ªå·±çš„å–œå¥½ï¼Œä¹Ÿèƒ½å¤Ÿæ ¹æ®å¤–éƒ¨çš„çŠ¶æ€åŠè°ƒæ•´ã€‚ éšç€æ—¶é—´çš„æ¨ç§»ï¼Œæˆ‘è¶Šæ¥è¶Šè§‰å¾—è‡ªå·±å³å°†æˆä¸ºé‚£ç§å¾ˆæ ‡å‡†çš„ã€ŒèŒåœºç å†œã€ã€‚å¿«é€Ÿå®Œæˆå¤–éƒ¨çš„éœ€æ±‚ï¼Œç»™å›¢é˜Ÿå¸¦æ¥ä»·å€¼ï¼Œå¿«é€Ÿå­¦ä¹ ä¸€é—¨æ–°æŠ€æœ¯ï¼Œå¿«é€Ÿè¡¥å¿æŠ€æœ¯å€ºã€‚ä½†æ˜¯æˆ‘è‡ªå·±ä¹Ÿä¸å¾—ä¸æ‰¿è®¤ï¼Œå› ä¸ºè¿™ç§ç­–ç•¥ï¼Œæˆ‘åˆ°ç›®å‰æ²¡æœ‰é‚£ç§èƒ½åšåˆ° top çš„äº‹æƒ…ã€‚é¦–å…ˆè§£é‡Šä¸€ä¸‹åšåˆ° topï¼šæ¯”å¦‚è¯´åˆ· OJï¼Œæˆ‘å¯ä»¥é€šè¿‡å‘¨èµ›æˆ–è€…è‡ªå·±çš„ç§¯åˆ†æ’åæ¥åˆ¤æ–­ï¼Œæˆ–è€…æˆ‘å¯ä»¥å»ç»™æŸä¸ªçŸ¥åå¼€æºçš„æ¡†æ¶åšè´¡çŒ®ï¼Œé€šè¿‡ contributors æ’åæ¥çœ‹è‡ªå·±åšçš„ç¨‹åº¦ã€‚åšåˆ° top æœ‰æ—¶å€™ä¸ä»…ä»…æ˜¯å› ä¸ºè‡ªå·±å¤šå¤šå°‘å°‘æœ‰ã€Œè¿½åé€åˆ©ã€çš„æƒ…ç»“ï¼Œæ›´å› ä¸ºæˆ‘åšæŒè®¤ä¸ºï¼Œå¦‚æœå–œæ¬¢åšä¸€ä»¶äº‹æƒ…ï¼Œè‚¯å®šæœ‰æŠŠäº‹æƒ…åšå¥½çš„æ„æ„¿ï¼Œé‚£ä¹ˆåªè¦ä¸æ–­åšæŒåšè‡ªç„¶å°±ä¼šåšåˆ° topã€‚ å‰æ®µæ—¶é—´çš„ä¸€ä¸ªå‘¨æœ«ï¼Œæˆ‘å»äº†ä¸€å®¶æ‘Šé¥¼åº—ï¼Œæ‹ä¸‹äº†ä¸€è¡Œå­— å¦‚æœè¯´ï¼Œä¸€ä¸ªäººå¯ä»¥ä¸€è¾ˆå­ä¸“æ³¨äºä¸€ä»¶äº‹æƒ…ä¸Šï¼Œå¹¶ä¸”ä¸ä¼šè¢«åˆ«çš„äº‹æƒ…æ‰€å¹²æ‰°æˆ–è€…è¯±æƒ‘åº”è¯¥æ˜¯éå¸¸å€¼å¾—ç¾¡æ…•çš„ã€‚å¯æ˜¯å¦‚æœç”¨èµ„æœ¬å®¶çš„çœ¼å…‰å»çœ‹å¾…è¿™ä¸ªï¼Œè‚¯å®šä¼šè®©äººè§‰å¾—è¿™ä¸ªäººåªçŸ¥é“æ‰“å·¥(è¿™é‡Œä¸æŠŠæ‰“å·¥åšè´¬ä¹‰)ã€‚æˆ‘è®°å¾—åœ¨ã€Œæ³°å›§ã€ç”µå½±é‡Œé¢æœ‰ä¸ªå¯¹ç™½ èµ„æœ¬å®¶çƒ­çˆ±ã€ŒæŒ£é’±ã€æœ¬èº«è¿™ä»¶äº‹æƒ…ï¼Œæ‰€ä»¥ä¼šç”¨ç»è¥ã€æ‰©å¼ çš„çœ¼å…‰å»çœ‹å¾…åšè‘±æ²¹é¥¼ã€‚è‘±æ²¹é¥¼å°å“¥è¯´ç§˜æ–¹å°±æ˜¯è¦è‡ªå·±äº²è‡ªåšï¼Œæ–°é²œå‡ºç‚‰ï¼Œè¿™æ˜¯çƒ­çˆ±åšè‘±æ²¹é¥¼äººçš„çœ¼å…‰ã€‚ä¸è¿‡è¿™ä¸ªä¸–ç•Œå°±æ˜¯éœ€è¦è¿™ä¸¤ç§äººã€‚ å¦‚æœæŠŠã€Œåšè‘±æ²¹é¥¼ã€æ¢æˆã€Œå†™ä»£ç ã€ï¼Œè¿™ä¸ªå¯¹ç™½äº§ç”Ÿçš„æ•ˆæœåº”è¯¥æ˜¯ç±»ä¼¼çš„ã€‚ æˆ‘æƒ³è¯´ä¸è®ºæ˜¯ä¸ºäº†æ›´é«˜çš„è–ªæ°´ä¸æ–­å­¦ä¹ ï¼Œè¿˜æ˜¯å› ä¸ºçƒ­çˆ±ç¼–ç¨‹æœ¬èº«ä¸æ–­å­¦ä¹ ï¼Œè¿™ä¸¤è€…åº”è¯¥æ˜¯éƒ½è¢«è®¤å¯çš„ã€‚åœ¨ç°å®ä¸–ç•Œä¸­ï¼Œæˆ‘è®¤ä¸ºè¿™ä¸¤ç§åŠ¨æœºåº”è¯¥æ˜¯éƒ½å­˜åœ¨çš„ï¼Œæˆ–è€…è¯´äººæœ¬èº«å°±æ˜¯è¿™æ ·çš„ï¼Œæ—¢å¸Œæœ›åšçš„äº‹æƒ…æ˜¯è‡ªå·±å–œæ¬¢çš„ï¼Œä¹Ÿå¸Œæœ›åšçš„äº‹æƒ…èƒ½ç»™è‡ªå·±å¸¦æ¥æ›´å¤šæ”¶å…¥ã€‚ 2020å¹´ï¼Œæˆ‘ä»¬æ˜¯é‡æ€§å’Œæ–‡æ˜å…±å­˜çš„ã€‚ æ–°å¹´å¿«ä¹ï¼","categories":[],"tags":[{"name":"æ€è€ƒ","slug":"æ€è€ƒ","permalink":"https://razertory.me/tags/æ€è€ƒ/"}]},{"title":"æœ‰åºæ•°ç»„è½¬åŒ–ä¸ºå¹³è¡¡äºŒå‰æœç´¢æ ‘ï¼ˆBSTï¼‰","slug":"sorted-arr-to-bst","date":"2019-12-12T13:41:57.000Z","updated":"2020-03-28T13:02:10.016Z","comments":true,"path":"2019/12/12/sorted-arr-to-bst/","link":"","permalink":"https://razertory.me/2019/12/12/sorted-arr-to-bst/","excerpt":"","text":"ç»™å®šä¸€ä¸ªæœ‰åºæ•°ç»„ï¼Œæ•°ç»„å…ƒç´ å‡åºæ’åˆ—ï¼Œè¯•å°†è¯¥æ•°ç»„è½¬æ¢ä¸ºä¸€æ£µå¹³è¡¡äºŒå‰æœç´¢æ ‘ï¼ˆBalanced Binary Search Treeï¼‰ã€‚ 1TreeNode convertToBST(ArrayList&lt;Integer&gt; arr) æ ¹æ® BST çš„å®šä¹‰ äºŒå‰æ’åºæ ‘çš„æŸ¥æ‰¾è¿‡ç¨‹å’Œæ¬¡ä¼˜äºŒå‰æ ‘ç±»ä¼¼ï¼Œé€šå¸¸é‡‡å–äºŒå‰é“¾è¡¨ä½œä¸ºäºŒå‰æ’åºæ ‘çš„å­˜å‚¨ç»“æ„ã€‚ä¸­åºéå†äºŒå‰æ’åºæ ‘å¯å¾—åˆ°ä¸€ä¸ªå…³é”®å­—çš„æœ‰åºåºåˆ—ï¼Œä¸€ä¸ªæ— åºåºåˆ—å¯ä»¥é€šè¿‡æ„é€ ä¸€æ£µäºŒå‰æ’åºæ ‘å˜æˆä¸€ä¸ªæœ‰åºåºåˆ—ï¼Œæ„é€ æ ‘çš„è¿‡ç¨‹å³ä¸ºå¯¹æ— åºåºåˆ—è¿›è¡Œæ’åºçš„è¿‡ç¨‹ã€‚æ¯æ¬¡æ’å…¥çš„æ–°çš„ç»“ç‚¹éƒ½æ˜¯äºŒå‰æ’åºæ ‘ä¸Šæ–°çš„å¶å­ç»“ç‚¹ï¼Œåœ¨è¿›è¡Œæ’å…¥æ“ä½œæ—¶ï¼Œä¸å¿…ç§»åŠ¨å…¶å®ƒç»“ç‚¹ï¼Œåªéœ€æ”¹åŠ¨æŸä¸ªç»“ç‚¹çš„æŒ‡é’ˆï¼Œç”±ç©ºå˜ä¸ºéç©ºå³å¯ã€‚æœç´¢,æ’å…¥,åˆ é™¤çš„å¤æ‚åº¦ç­‰äºæ ‘é«˜ï¼ŒO(log(n)). å¯ä»¥å¯¹å…¶è¿›è¡Œåä¸­åºçš„éå†ã€‚ä¹Ÿå°±æ˜¯ ä¸­-å·¦-å³ çš„ä¸€ä¸ªé€†å‘è¿‡ç¨‹ 12345678910111213TreeNode convertToBST(ArrayList&lt;Integer&gt; arr) &#123; if (arr == null || arr.length == 0) return null; return convert(arr, 0, arr.length - 1);&#125;TreeNode convert(ArrayList&lt;Integer&gt; arr, int start, int end) &#123; if (start &gt; end) return null; int mid = start + (end - start) / 2; TreeNode node = new TreeNode(arr[mid]); node.left = convert(arr, start, mid - 1); node.right = convert(arr, mid + 1, end); return node;&#125;","categories":[],"tags":[]},{"title":"é«˜çº§ç±»å‹","slug":"scala-school-advanced-types","date":"2019-12-01T03:20:54.000Z","updated":"2020-05-04T07:02:15.759Z","comments":true,"path":"2019/12/01/scala-school-advanced-types/","link":"","permalink":"https://razertory.me/2019/12/01/scala-school-advanced-types/","excerpt":"","text":"è§†ç•Œï¼ˆView Bound â€œç±»å‹ç±»â€ï¼‰æœ‰æ—¶å€™ï¼Œä½ å¹¶ä¸éœ€è¦æŒ‡å®šä¸€ä¸ªç±»å‹æ˜¯ç­‰/å­/è¶…äºå¦ä¸€ä¸ªç±»ï¼Œä½ å¯ä»¥é€šè¿‡è½¬æ¢è¿™ä¸ªç±»æ¥ä¼ªè£…è¿™ç§å…³è”å…³ç³»ã€‚ä¸€ä¸ªè§†ç•ŒæŒ‡å®šä¸€ä¸ªç±»å‹å¯ä»¥è¢«â€œçœ‹ä½œæ˜¯â€å¦ä¸€ä¸ªç±»å‹ã€‚è¿™å¯¹å¯¹è±¡çš„åªè¯»æ“ä½œæ˜¯å¾ˆæœ‰ç”¨çš„ã€‚ éšå¼ (implicit) å‡½æ•°å…è®¸ç±»å‹è‡ªåŠ¨è½¬æ¢ã€‚æ›´ç¡®åˆ‡åœ°è¯´ï¼Œå¦‚æœéšå¼å‡½æ•°æœ‰åŠ©äºæ»¡è¶³ç±»å‹æ¨æ–­æ—¶ï¼Œéšå¼å‡½æ•°å¯ä»¥æŒ‰éœ€åœ°åº”ç”¨ã€‚ä¾‹å¦‚ï¼š 1234567891011scala&gt; implicit def strToInt(x: String) = x.toIntstrToInt: (x: String)Intscala&gt; \"123\"res0: java.lang.String = 123scala&gt; val y: Int = \"123\"y: Int = 123scala&gt; math.max(\"123\", 111)res1: Int = 123 è§†ç•Œï¼Œå°±åƒç±»å‹è¾¹ç•Œï¼Œè¦æ±‚å­˜åœ¨ä¸€ä¸ªèƒ½å¤Ÿå°†æŸç±»å‹è½¬æ¢ä¸ºæŒ‡å®šç±»å‹çš„å‡½æ•°ã€‚ä½ å¯ä»¥ä½¿ç”¨ &lt;% æŒ‡å®šç±»å‹é™åˆ¶ï¼Œä¾‹å¦‚ï¼š 1234567891011121314scala&gt; class Container[A &lt;% Int] &#123; def addIt(x: A) = 123 + x &#125;defined class Containerè¿™æ˜¯è¯´ A å¿…é¡»â€œå¯è¢«è§†ä½œâ€ Int ã€‚è®©æˆ‘ä»¬è¯•è¯•ã€‚scala&gt; (new Container[String]).addIt(\"123\")res11: Int = 246scala&gt; (new Container[Int]).addIt(123) res12: Int = 246scala&gt; (new Container[Float]).addIt(123.2F)&lt;console&gt;:8: error: could not find implicit value for evidence parameter of type (Float) =&gt; Int (new Container[Float]).addIt(123.2) ^ æ³¨æ„ï¼Œæ–°ç‰ˆæœ¬çš„ Scala å¯èƒ½ä¼šæç¤ºï¼š view bounds are deprecated; use an implicit parameter instead. å…¶ä»–ç±»å‹é™åˆ¶æ–¹æ³•å¯ä»¥é€šè¿‡éšå¼å‚æ•°æ‰§è¡Œæ›´å¤æ‚çš„ç±»å‹é™åˆ¶ã€‚ä¾‹å¦‚ï¼ŒList æ”¯æŒå¯¹æ•°å­—å†…å®¹æ‰§è¡Œ sumï¼Œä½†å¯¹å…¶ä»–å†…å®¹å´ä¸è¡Œã€‚å¯æ˜¯ Scala çš„æ•°å­—ç±»å‹å¹¶ä¸éƒ½å…±äº«ä¸€ä¸ªè¶…ç±»ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸èƒ½ä½¿ç”¨ T &lt;: Numberã€‚ç›¸åï¼Œè¦ä½¿ä¹‹èƒ½å·¥ä½œï¼ŒScala çš„ math åº“å¯¹é€‚å½“çš„ç±»å‹ T å®šä¹‰äº†ä¸€ä¸ªéšå«çš„ Numeric[T]ã€‚ ç„¶ååœ¨ List å®šä¹‰ä¸­ä½¿ç”¨å®ƒï¼š 1sum[B &gt;: A](implicit num: Numeric[B]): B å¦‚æœä½ è°ƒç”¨ List(1,2).sum()ï¼Œä½ å¹¶ä¸éœ€è¦ä¼ å…¥ä¸€ä¸ª num å‚æ•°ï¼›å®ƒæ˜¯éšå¼è®¾ç½®çš„ã€‚ä½†å¦‚æœä½ è°ƒç”¨ List(â€œwhoopâ€).sum()ï¼Œå®ƒä¼šæŠ±æ€¨æ— æ³•è®¾ç½® numã€‚ åœ¨æ²¡æœ‰è®¾å®šé™Œç”Ÿçš„å¯¹è±¡ä¸º Numeric çš„æ—¶å€™ï¼Œæ–¹æ³•å¯èƒ½ä¼šè¦æ±‚æŸç§ç‰¹å®šç±»å‹çš„â€œè¯æ®â€ã€‚è¿™æ—¶å¯ä»¥ä½¿ç”¨ä»¥ä¸‹ç±»å‹-å…³ç³»è¿ç®—ç¬¦ï¼š A =:= B A å¿…é¡»å’Œ B ç›¸ç­‰ A &lt;:&lt; B A å¿…é¡»æ˜¯ B çš„å­ç±» A &lt;%&lt; B A å¿…é¡»å¯ä»¥è¢«çœ‹åšæ˜¯ B ï¼ˆå¦‚æœä½ åœ¨å°è¯•ä½¿ç”¨ &lt;:&lt; æˆ–è€… &lt;%&lt; çš„æ—¶å€™å‡ºé”™äº†ï¼Œé‚£è¯·æ³¨æ„è¿™äº›ç¬¦å·åœ¨ Scala 2.10 ä¸­è¢«ç§»é™¤äº†ã€‚Scala School é‡Œçš„ä¾‹å­ä»…èƒ½åœ¨ Scala 2.9.x ä¸‹æ­£å¸¸å·¥ä½œã€‚ä½ å¯ä»¥ä½¿ç”¨æ–°ç‰ˆæœ¬çš„ Scalaï¼Œä½†å¯èƒ½ä¼šé‡åˆ°é”™è¯¯ã€‚ï¼‰ 12345678scala&gt; class Container[A](value: A) &#123; def addIt(implicit evidence: A =:= Int) = 123 + value &#125;defined class Containerscala&gt; (new Container(123)).addItres11: Int = 246scala&gt; (new Container(\"123\")).addIt&lt;console&gt;:10: error: could not find implicit value for parameter evidence: =:=[java.lang.String,Int] ç±»ä¼¼åœ°ï¼Œæ ¹æ®ä¹‹å‰çš„éšå¼è½¬æ¢ï¼Œæˆ‘ä»¬å¯ä»¥å°†çº¦æŸæ”¾æ¾ä¸ºå¯è§†æ€§ï¼š 12345scala&gt; class Container[A](value: A) &#123; def addIt(implicit evidence: A &lt;%&lt; Int) = 123 + value &#125;defined class Containerscala&gt; (new Container(\"123\")).addItres15: Int = 246 ä½¿ç”¨è§†å›¾ (View) è¿›è¡Œæ³›å‹ç¼–ç¨‹åœ¨ Scala æ ‡å‡†åº“ä¸­ï¼Œè§†å›¾ä¸»è¦ç”¨äºå®ç°é›†åˆçš„é€šç”¨å‡½æ•°ã€‚ä¾‹å¦‚ min å‡½æ•°ï¼ˆåœ¨ Seq[] ä¸Šï¼‰å°±ä½¿ç”¨äº†è¿™ç§æŠ€æœ¯ï¼š 123456def min[B &gt;: A](implicit cmp: Ordering[B]): A = &#123; if (isEmpty) throw new UnsupportedOperationException(\"empty.min\") reduceLeft((x, y) =&gt; if (cmp.lteq(x, y)) x else y)&#125; å…¶ä¸»è¦ä¼˜ç‚¹æ˜¯ï¼š é›†åˆä¸­çš„å…ƒç´ ä¸å¿…å®ç° Ordered traitï¼Œä½† Ordered çš„ä½¿ç”¨ä»ç„¶å¯ä»¥æ‰§è¡Œé™æ€ç±»å‹æ£€æŸ¥ã€‚æ— éœ€ä»»ä½•é¢å¤–çš„åº“æ”¯æŒï¼Œä½ ä¹Ÿå¯ä»¥å®šä¹‰è‡ªå·±çš„æ’åºï¼š 12345scala&gt; List(1,2,3,4).minres0: Int = 1scala&gt; List(1,2,3,4).min(new Ordering[Int] &#123; def compare(a: Int, b: Int) = b compare a &#125;)res3: Int = 4 ä½œä¸ºæ—æ³¨ï¼Œæ ‡å‡†åº“ä¸­æœ‰è§†å›¾æ¥å°† Ordered è½¬æ¢ä¸º Orderingï¼ˆåä¹‹äº¦ç„¶ï¼‰ã€‚ 12345trait LowPriorityOrderingImplicits &#123; implicit def ordered[A &lt;: Ordered[A]]: Ordering[A] = new Ordering[A] &#123; def compare(x: A, y: A) = x.compare(y) &#125;&#125; ä¸Šä¸‹æ–‡è¾¹ç•Œå’Œ implicitly[]Scala 2.8 å¼•å…¥äº†ä¸€ç§ä¸²è”å’Œè®¿é—®éšå¼å‚æ•°çš„ç®€å•è®°æ³•ã€‚ 12345scala&gt; def foo[A](implicit x: Ordered[A]) &#123;&#125;foo: [A](implicit x: Ordered[A])Unitscala&gt; def foo[A : Ordered] &#123;&#125; foo: [A](implicit evidence$1: Ordered[A])Unit éšå¼å€¼å¯ä»¥é€šè¿‡ implicitly è¢«è®¿é—® 12scala&gt; implicitly[Ordering[Int]]res37: Ordering[Int] = scala.math.Ordering$Int$@3a9291cf ç›¸ç»“åˆåå¾€å¾€ä¼šä½¿ç”¨æ›´å°‘çš„ä»£ç ï¼Œå°¤å…¶æ˜¯ä¸²è”è§†å›¾çš„æ—¶å€™ã€‚ é«˜é˜¶å¤šæ€æ€§ç±»å‹å’Œç‰¹è®¾å¤šæ€æ€§Scala å¯ä»¥å¯¹â€œé«˜é˜¶â€çš„ç±»å‹è¿›è¡ŒæŠ½è±¡ã€‚ä¾‹å¦‚ï¼Œå‡è®¾ä½ éœ€è¦ç”¨å‡ ç§ç±»å‹çš„å®¹å™¨å¤„ç†å‡ ç§ç±»å‹çš„æ•°æ®ã€‚ä½ å¯èƒ½å®šä¹‰äº†ä¸€ä¸ª Container çš„æ¥å£ï¼Œå®ƒå¯ä»¥è¢«å®ç°ä¸ºå‡ ç§ç±»å‹çš„å®¹å™¨ï¼šOptionã€List ç­‰ã€‚ä½ è¦å®šä¹‰å¯ä»¥ä½¿ç”¨è¿™äº›å®¹å™¨é‡Œçš„å€¼çš„æ¥å£ï¼Œä½†ä¸æƒ³ç¡®å®šå€¼çš„ç±»å‹ã€‚ è¿™ç±»ä¼¼äºå‡½æ•°æŸ¯é‡ŒåŒ–ã€‚ä¾‹å¦‚ï¼Œå°½ç®¡â€œä¸€å…ƒç±»å‹â€æœ‰ç±»ä¼¼ List[A] çš„æ„é€ å™¨ï¼Œè¿™æ„å‘³ç€æˆ‘ä»¬å¿…é¡»æ»¡è¶³ä¸€ä¸ªâ€œçº§åˆ«â€çš„ç±»å‹å˜é‡æ¥äº§ç”Ÿä¸€ä¸ªå…·ä½“çš„ç±»å‹ï¼ˆå°±åƒä¸€ä¸ªæ²¡æœ‰æŸ¯é‡ŒåŒ–çš„å‡½æ•°éœ€è¦åªæä¾›ä¸€ä¸ªå‚æ•°åˆ—è¡¨æ¥è¢«è°ƒç”¨ï¼‰ï¼Œæ›´é«˜é˜¶çš„ç±»å‹éœ€è¦æ›´å¤šã€‚ 12345678910scala&gt; trait Container[M[_]] &#123; def put[A](x: A): M[A]; def get[A](m: M[A]): A &#125;scala&gt; val container = new Container[List] &#123; def put[A](x: A) = List(x); def get[A](m: List[A]) = m.head &#125;container: java.lang.Object with Container[List] = $anon$1@7c8e3f75scala&gt; container.put(\"hey\")res24: List[java.lang.String] = List(hey)scala&gt; container.put(123)res25: List[Int] = List(123) æ³¨æ„ï¼šContainer æ˜¯å‚æ•°åŒ–ç±»å‹çš„å¤šæ€ï¼ˆâ€œå®¹å™¨ç±»å‹â€ï¼‰ã€‚ å¦‚æœæˆ‘ä»¬ç»“åˆéšå¼è½¬æ¢ implicits ä½¿ç”¨å®¹å™¨ï¼Œæˆ‘ä»¬ä¼šå¾—åˆ°â€œç‰¹è®¾çš„â€å¤šæ€æ€§ï¼šå³å¯¹å®¹å™¨å†™æ³›å‹å‡½æ•°çš„èƒ½åŠ›ã€‚ 1234567891011121314151617scala&gt; trait Container[M[_]] &#123; def put[A](x: A): M[A]; def get[A](m: M[A]): A &#125;scala&gt; implicit val listContainer = new Container[List] &#123; def put[A](x: A) = List(x); def get[A](m: List[A]) = m.head &#125;scala&gt; implicit val optionContainer = new Container[Some] &#123; def put[A](x: A) = Some(x); def get[A](m: Some[A]) = m.get &#125;scala&gt; def tupleize[M[_]: Container, A, B](fst: M[A], snd: M[B]) = &#123; | val c = implicitly[Container[M]] | c.put(c.get(fst), c.get(snd)) | &#125;tupleize: [M[_],A,B](fst: M[A],snd: M[B])(implicit evidence$1: Container[M])M[(A, B)]scala&gt; tupleize(Some(1), Some(2))res33: Some[(Int, Int)] = Some((1,2))scala&gt; tupleize(List(1), List(2))res34: List[(Int, Int)] = List((1,2)) F-ç•Œå¤šæ€æ€§é€šå¸¸æœ‰å¿…è¦æ¥è®¿é—®ä¸€ä¸ªæ³›å‹ trait çš„å…·ä½“å­ç±»ã€‚ä¾‹å¦‚ï¼Œæƒ³è±¡ä½ æœ‰ä¸€äº›æ³›å‹ traitï¼Œä½†éœ€è¦å¯ä»¥ä¸å®ƒçš„æŸä¸€å­ç±»è¿›è¡Œæ¯”è¾ƒã€‚ 1trait Container extends Ordered[Container] ç°åœ¨å­ç±»å¿…é¡»å®ç° compare æ–¹æ³• 1def compare(that: Container): Int ä½†æˆ‘ä»¬ä¸èƒ½è®¿é—®å…·ä½“å­ç±»å‹ï¼Œä¾‹å¦‚ï¼š 123class MyContainer extends Container &#123; def compare(that: MyContainer): Int&#125; ç¼–è¯‘å¤±è´¥ï¼Œå› ä¸ºæˆ‘ä»¬å¯¹ Container æŒ‡å®šäº† Ordered ç‰¹è´¨ï¼Œè€Œä¸æ˜¯å¯¹ç‰¹å®šå­ç±»å‹æŒ‡å®šçš„ã€‚ ä¸€ä¸ªå¯é€‰çš„è§£å†³æ–¹æ¡ˆæ˜¯å°† Container å‚æ•°åŒ–ï¼Œä»¥ä¾¿æˆ‘ä»¬èƒ½åœ¨å­ç±»ä¸­è®¿é—®å…¶å­ç±»å‹ã€‚ 1trait Container[A] extends Ordered[A] ç°åœ¨å­ç±»å¯ä»¥è¿™æ ·åšï¼š 123class MyContainer extends Container[MyContainer] &#123; def compare(that: MyContainer): Int&#125; ä½†é—®é¢˜åœ¨äº A ç±»å‹æ²¡æœ‰è¢«ä»»ä½•ä¸œè¥¿çº¦æŸï¼Œè¿™å¯¼è‡´ä½ å¯èƒ½ä¼šåšç±»ä¼¼è¿™æ ·çš„äº‹æƒ…ï¼š 123class MyContainer extends Container[String] &#123; def compare(that: String): Int&#125; ä¸ºäº†è°ƒå’Œè¿™ä¸€ç‚¹ï¼Œæˆ‘ä»¬æ”¹ç”¨ F-ç•Œçš„å¤šæ€æ€§ã€‚ 1trait Container[A &lt;: Container[A]] extends Ordered[A] å¥‡æ€ªçš„ç±»å‹ï¼ä½†æ³¨æ„ç°åœ¨å¦‚ä½•ç”¨ A ä½œä¸º Ordered çš„ç±»å‹å‚æ•°ï¼Œè€Œ A æœ¬èº«å°±æ˜¯ Container[A] æ‰€ä»¥ï¼Œç°åœ¨ 123class MyContainer extends Container[MyContainer] &#123; def compare(that: MyContainer) = 0 &#125; ä»–ä»¬æ˜¯æœ‰åºçš„äº†ï¼š 12345scala&gt; List(new MyContainer, new MyContainer, new MyContainer)res3: List[MyContainer] = List(MyContainer@30f02a6d, MyContainer@67717334, MyContainer@49428ffa)scala&gt; List(new MyContainer, new MyContainer, new MyContainer).minres4: MyContainer = MyContainer@33dfeb30 é‰´äºä»–ä»¬éƒ½æ˜¯ Container[_] çš„å­ç±»å‹ï¼Œæˆ‘ä»¬å¯ä»¥å®šä¹‰å¦ä¸€ä¸ªå­ç±»å¹¶åˆ›å»º Container[_] çš„ä¸€ä¸ªæ··åˆåˆ—è¡¨ï¼š 123456scala&gt; class YourContainer extends Container[YourContainer] &#123; def compare(that: YourContainer) = 0 &#125;defined class YourContainerscala&gt; List(new MyContainer, new MyContainer, new MyContainer, new YourContainer) res2: List[Container[_ &gt;: YourContainer with MyContainer &lt;: Container[_ &gt;: YourContainer with MyContainer &lt;: ScalaObject]]] = List(MyContainer@3be5d207, MyContainer@6d3fe849, MyContainer@7eab48a7, YourContainer@1f2f0ce9) æ³¨æ„ç°åœ¨ç»“æœç±»å‹æ˜¯ç”± YourContainer with MyContainer ç±»å‹ç¡®å®šçš„ä¸‹ç•Œã€‚è¿™æ˜¯ç±»å‹æ¨æ–­å™¨çš„å·¥ä½œã€‚æœ‰è¶£çš„æ˜¯ï¼Œè¿™ç§ç±»å‹ç”šè‡³ä¸éœ€è¦æ˜¯æœ‰æ„ä¹‰çš„ï¼Œå®ƒä»…ä»…å¯¹åˆ—è¡¨çš„ç»Ÿä¸€ç±»å‹æä¾›äº†ä¸€ä¸ªé€»è¾‘ä¸Šæœ€ä¼˜çš„ä¸‹ç•Œã€‚å¦‚æœç°åœ¨æˆ‘ä»¬å°è¯•ä½¿ç”¨ Ordered ä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ 123(new MyContainer, new MyContainer, new MyContainer, new YourContainer).min&lt;console&gt;:9: error: could not find implicit value for parameter cmp: Ordering[Container[_ &gt;: YourContainer with MyContainer &lt;: Container[_ &gt;: YourContainer with MyContainer &lt;: ScalaObject]]] å¯¹ç»Ÿä¸€çš„ç±»å‹ Ordered[] ä¸å­˜åœ¨äº†ã€‚å¤ªç³Ÿç³•äº†ã€‚ ç»“æ„ç±»å‹Scala æ”¯æŒç»“æ„ç±»å‹ï¼ˆstructural typesï¼‰ â€” ç±»å‹éœ€æ±‚ç”±æ¥å£ç»“æ„è¡¨ç¤ºï¼Œè€Œä¸æ˜¯ç”±å…·ä½“çš„ç±»å‹è¡¨ç¤ºã€‚ 12345scala&gt; def foo(x: &#123; def get: Int &#125;) = 123 + x.getfoo: (x: AnyRef&#123;def get: Int&#125;)Intscala&gt; foo(new &#123; def get = 10 &#125;) res0: Int = 133 è¿™å¯èƒ½åœ¨å¾ˆå¤šåœºæ™¯éƒ½æ˜¯ç›¸å½“ä¸é”™çš„ï¼Œä½†è¿™ä¸ªå®ç°ä¸­ä½¿ç”¨äº†åå°„ï¼Œæ‰€ä»¥è¦æ³¨æ„æ€§èƒ½ï¼ æŠ½è±¡ç±»å‹æˆå‘˜åœ¨ç‰¹è´¨ä¸­ï¼Œä½ å¯ä»¥è®©ç±»å‹æˆå‘˜ä¿æŒæŠ½è±¡ã€‚ 12345678scala&gt; trait Foo &#123; type A; val x: A; def getX: A = x &#125;defined trait Fooscala&gt; (new Foo &#123; type A = Int; val x = 123 &#125;).getX res3: Int = 123scala&gt; (new Foo &#123; type A = String; val x = \"hey\" &#125;).getXres4: java.lang.String = hey åœ¨åšä¾èµ–æ³¨å…¥ç­‰æƒ…å†µä¸‹ï¼Œè¿™å¾€å¾€æ˜¯ä¸€ä¸ªæœ‰ç”¨çš„æŠ€å·§ã€‚ ä½ å¯ä»¥ä½¿ç”¨ hash æ“ä½œç¬¦æ¥å¼•ç”¨ä¸€ä¸ªæŠ½è±¡ç±»å‹çš„å˜é‡ï¼š 12345scala&gt; trait Foo[M[_]] &#123; type t[A] = M[A] &#125;defined trait Fooscala&gt; val x: Foo[List]#t[Int] = List(1)x: List[Int] = List(1) ç±»å‹æ“¦é™¤å’Œæ¸…å•æ­£å¦‚æˆ‘ä»¬æ‰€çŸ¥é“çš„ï¼Œç±»å‹ä¿¡æ¯åœ¨ç¼–è¯‘çš„æ—¶å€™ä¼šå› ä¸ºæ“¦é™¤è€Œä¸¢å¤±ã€‚ Scala æä¾›äº†æ¸…å•ï¼ˆManifestsï¼‰åŠŸèƒ½ï¼Œä½¿æˆ‘ä»¬èƒ½å¤Ÿé€‰æ‹©æ€§åœ°æ¢å¤ç±»å‹ä¿¡æ¯ã€‚æ¸…å•ä½œä¸ºä¸€ä¸ªéšå¼çš„å€¼è¢«æä¾›ï¼Œå®ƒç”±ç¼–è¯‘å™¨æ ¹æ®éœ€è¦ç”Ÿæˆã€‚ 1234scala&gt; class MakeFoo[A](implicit manifest: Manifest[A]) &#123; def make: A = manifest.erasure.newInstance.asInstanceOf[A] &#125;scala&gt; (new MakeFoo[String]).makeres10: String = \"\" æ¡ˆä¾‹åˆ†æï¼šFinagleå‚è§ï¼šhttps://github.com/twitter/finagle 123456789101112131415161718192021222324trait Service[-Req, +Rep] extends (Req =&gt; Future[Rep])trait Filter[-ReqIn, +RepOut, +ReqOut, -RepIn] extends ((ReqIn, Service[ReqOut, RepIn]) =&gt; Future[RepOut])&#123; def andThen[Req2, Rep2](next: Filter[ReqOut, RepIn, Req2, Rep2]) = new Filter[ReqIn, RepOut, Req2, Rep2] &#123; def apply(request: ReqIn, service: Service[Req2, Rep2]) = &#123; Filter.this.apply(request, new Service[ReqOut, RepIn] &#123; def apply(request: ReqOut): Future[RepIn] = next(request, service) override def release() = service.release() override def isAvailable = service.isAvailable &#125;) &#125; &#125; def andThen(service: Service[ReqOut, RepIn]) = new Service[ReqIn, RepOut] &#123; private[this] val refcounted = new RefcountedService(service) def apply(request: ReqIn) = Filter.this.apply(request, refcounted) override def release() = refcounted.release() override def isAvailable = refcounted.isAvailable &#125; &#125; ä¸€ä¸ªæœåŠ¡å¯ä»¥é€šè¿‡è¿‡æ»¤å™¨å¯¹è¯·æ±‚è¿›è¡Œèº«ä»½éªŒè¯ã€‚ 12345678910111213141516trait RequestWithCredentials extends Request &#123; def credentials: Credentials&#125;class CredentialsFilter(credentialsParser: CredentialsParser) extends Filter[Request, Response, RequestWithCredentials, Response]&#123; def apply(request: Request, service: Service[RequestWithCredentials, Response]): Future[Response] = &#123; val requestWithCredentials = new RequestWrapper with RequestWithCredentials &#123; val underlying = request val credentials = credentialsParser(request) getOrElse NullCredentials &#125; service(requestWithCredentials) &#125;&#125; æ³¨æ„åº•å±‚æœåŠ¡æ˜¯å¦‚ä½•éœ€è¦å¯¹è¯·æ±‚è¿›è¡Œèº«ä»½éªŒè¯çš„ï¼Œè€Œä¸”è¿˜æ˜¯é™æ€éªŒè¯ã€‚å› æ­¤ï¼Œè¿‡æ»¤å™¨å¯ä»¥è¢«çœ‹ä½œæ˜¯æœåŠ¡è½¬æ¢å™¨ã€‚ è®¸å¤šè¿‡æ»¤å™¨å¯ä»¥è¢«ç»„åˆåœ¨ä¸€èµ·ï¼š 1234567val upFilter = logTransaction andThen handleExceptions andThen extractCredentials andThen homeUser andThen authenticate andThen route äº«ç”¨å®‰å…¨çš„ç±»å‹å§ï¼","categories":[],"tags":[]},{"title":"ç±»å‹å’Œå¤šæ€åŸºç¡€","slug":"scala-school-type-basics","date":"2019-12-01T02:47:32.000Z","updated":"2020-05-04T07:03:04.626Z","comments":true,"path":"2019/12/01/scala-school-type-basics/","link":"","permalink":"https://razertory.me/2019/12/01/scala-school-type-basics/","excerpt":"","text":"ä»€ä¹ˆæ˜¯é™æ€ç±»å‹ï¼Ÿå®ƒä»¬ä¸ºä»€ä¹ˆæœ‰ç”¨ï¼Ÿ æŒ‰ Pierce çš„è¯è®²ï¼šâ€œç±»å‹ç³»ç»Ÿæ˜¯ä¸€ä¸ªè¯­æ³•æ–¹æ³•ï¼Œå®ƒä»¬æ ¹æ®ç¨‹åºè®¡ç®—çš„å€¼çš„ç§ç±»å¯¹ç¨‹åºçŸ­è¯­è¿›è¡Œåˆ†ç±»ï¼Œé€šè¿‡åˆ†ç±»ç»“æœé”™è¯¯è¡Œä¸ºè¿›è¡Œè‡ªåŠ¨æ£€æŸ¥ã€‚â€ å¦å¤–ï¼Œç¬”è€…æ¨èé˜…è¯» ç¼–ç¨‹è¯­è¨€çš„ç±»å‹ç³»ç»Ÿä¸ºä½•å¦‚æ­¤é‡è¦ï¼Ÿ ç±»å‹å…è®¸ä½ è¡¨ç¤ºå‡½æ•°çš„å®šä¹‰åŸŸå’Œå€¼åŸŸã€‚ä¾‹å¦‚ï¼Œä»æ•°å­¦è§’åº¦çœ‹è¿™ä¸ªå®šä¹‰ï¼š f: R -&gt; N // å®ƒå‘Šè¯‰æˆ‘ä»¬å‡½æ•° f æ˜¯ä»å®æ•°é›†åˆ°è‡ªç„¶æ•°é›†çš„æ˜ å°„ã€‚ æŠ½è±¡åœ°è¯´ï¼Œè¿™å°±æ˜¯å…·ä½“ç±»å‹çš„å‡†ç¡®å®šä¹‰ã€‚ç±»å‹ç³»ç»Ÿç»™æˆ‘ä»¬æä¾›äº†ä¸€äº›æ›´å¼ºå¤§çš„æ–¹å¼æ¥è¡¨è¾¾è¿™äº›é›†åˆã€‚é‰´äºè¿™äº›æ³¨é‡Šï¼Œç¼–è¯‘å™¨å¯ä»¥é™æ€åœ°ï¼ˆåœ¨ç¼–è¯‘æ—¶ï¼‰éªŒè¯ç¨‹åºæ˜¯åˆç†çš„ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœå€¼ï¼ˆåœ¨è¿è¡Œæ—¶ï¼‰ä¸ç¬¦åˆç¨‹åºè§„å®šçš„çº¦æŸï¼Œç¼–è¯‘å°†å¤±è´¥ã€‚ä¸€èˆ¬è¯´æ¥ï¼Œç±»å‹æ£€æŸ¥åªèƒ½ä¿è¯ä¸åˆç†çš„ç¨‹åºä¸èƒ½ç¼–è¯‘é€šè¿‡ã€‚å®ƒä¸èƒ½ä¿è¯æ¯ä¸€ä¸ªåˆç†çš„ç¨‹åºéƒ½å¯ä»¥ç¼–è¯‘é€šè¿‡ã€‚ éšç€ç±»å‹ç³»ç»Ÿè¡¨è¾¾èƒ½åŠ›çš„æé«˜ï¼Œæˆ‘ä»¬å¯ä»¥ç”Ÿäº§æ›´å¯é çš„ä»£ç ï¼Œå› ä¸ºå®ƒèƒ½å¤Ÿåœ¨æˆ‘ä»¬è¿è¡Œç¨‹åºä¹‹å‰éªŒè¯ç¨‹åºçš„ä¸å˜æ€§ï¼ˆå½“ç„¶æ˜¯å‘ç°ç±»å‹æœ¬èº«çš„æ¨¡å‹ bugï¼ï¼‰ã€‚å­¦æœ¯ç•Œä¸€ç›´å¾ˆåŠªåŠ›åœ°æé«˜ç±»å‹ç³»ç»Ÿçš„è¡¨ç°åŠ›ï¼ŒåŒ…æ‹¬å€¼ä¾èµ–ï¼ˆvalue-dependentï¼‰ç±»å‹ï¼ éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæ‰€æœ‰çš„ç±»å‹ä¿¡æ¯ä¼šåœ¨ç¼–è¯‘æ—¶è¢«åˆ å»ï¼Œå› ä¸ºå®ƒå·²ä¸å†éœ€è¦ã€‚è¿™å°±æ˜¯æ‰€è°“çš„ç±»å‹æ“¦é™¤ã€‚ Scala ä¸­çš„ç±»å‹Scala å¼ºå¤§çš„ç±»å‹ç³»ç»Ÿæ‹¥æœ‰éå¸¸ä¸°å¯Œçš„è¡¨ç°åŠ›ã€‚å…¶ä¸»è¦ç‰¹æ€§æœ‰ï¼š å‚æ•°åŒ–å¤šæ€æ€§ (parametric polymorphism )ï¼Œç²—ç•¥åœ°è¯´ï¼Œå°±æ˜¯æ³›å‹ç¼–ç¨‹ å±€éƒ¨ç±»å‹æ¨æ–­ï¼Œç²—ç•¥åœ°è¯´ï¼Œå°±æ˜¯ä¸ºä»€ä¹ˆä½ ä¸éœ€è¦è¿™æ ·å†™ä»£ç  val i: Int = 12: Int *å­˜åœ¨é‡åŒ– (existential quantification) *ç²—ç•¥åœ°è¯´ï¼Œä¸ºä¸€äº›æ²¡æœ‰åç§°çš„ç±»å‹è¿›è¡Œå®šä¹‰ *è§†å›¾ (views) *ç²—ç•¥åœ°è¯´ï¼Œå°±æ˜¯å°†ä¸€ç§ç±»å‹çš„å€¼â€œå¼ºåˆ¶è½¬æ¢â€ä¸ºå¦ä¸€ç§ç±»å‹ å‚æ•°åŒ–å¤šæ€æ€§å¤šæ€æ€§æ˜¯åœ¨ä¸å½±å“é™æ€ç±»å‹ä¸°å¯Œæ€§çš„å‰æä¸‹ï¼Œç”¨æ¥ï¼ˆç»™ä¸åŒç±»å‹çš„å€¼ï¼‰ç¼–å†™é€šç”¨ä»£ç çš„ã€‚ ä¾‹å¦‚ï¼Œå¦‚æœæ²¡æœ‰å‚æ•°åŒ–å¤šæ€æ€§ï¼Œä¸€ä¸ªé€šç”¨çš„åˆ—è¡¨æ•°æ®ç»“æ„æ€»æ˜¯çœ‹èµ·æ¥åƒè¿™æ ·ï¼ˆäº‹å®ä¸Šï¼Œå®ƒçœ‹èµ·æ¥å¾ˆåƒä½¿ç”¨æ³›å‹å‰çš„ Javaï¼‰ï¼š 12scala&gt; 2 :: 1 :: \"bar\" :: \"foo\" :: Nilres5: List[Any] = List(2, 1, bar, foo) ç°åœ¨æˆ‘ä»¬æ— æ³•æ¢å¤å…¶ä¸­æˆå‘˜çš„ä»»ä½•ç±»å‹ä¿¡æ¯ã€‚ 12scala&gt; res5.headres6: Any = 2 æ‰€ä»¥æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºå°†ä¼šé€€åŒ–ä¸ºä¸€ç³»åˆ—ç±»å‹è½¬æ¢ï¼ˆâ€œasInstanceOf[]â€ï¼‰ï¼Œå¹¶ä¸”ä¼šç¼ºä¹ç±»å‹å®‰å…¨çš„ä¿éšœï¼ˆå› ä¸ºè¿™äº›éƒ½æ˜¯åŠ¨æ€çš„ï¼‰ã€‚ å¤šæ€æ€§æ˜¯é€šè¿‡æŒ‡å®šç±»å‹å˜é‡å®ç°çš„ã€‚ 12345scala&gt; def drop1[A](l: List[A]) = l.taildrop1: [A](l: List[A])List[A]scala&gt; drop1(List(1,2,3))res1: List[Int] = List(2, 3) Scala æœ‰ rank-1 å¤šæ€æ€§ (rank-1 polymorphism)ç²—ç•¥åœ°è¯´ï¼Œè¿™æ„å‘³ç€åœ¨ Scala ä¸­ï¼Œæœ‰ä¸€äº›ä½ æƒ³è¡¨è¾¾çš„ç±»å‹æ¦‚å¿µâ€œè¿‡äºæ³›åŒ–â€ï¼ˆæ³›åŒ–çš„å±‚çº§å¤§äº 1) ä»¥è‡³äºç¼–è¯‘å™¨æ— æ³•ç†è§£ã€‚å‡è®¾ä½ æœ‰ä¸€ä¸ªå‡½æ•° 1def toList[A](a: A) = List(a) ä½ å¸Œæœ›ç»§ç»­æ³›å‹åœ°ä½¿ç”¨å®ƒï¼š 1def foo[A, B](f: A =&gt; List[A], b: B) = f(b) è¿™æ®µä»£ç ä¸èƒ½ç¼–è¯‘ï¼Œå› ä¸ºæ‰€æœ‰çš„ç±»å‹å˜é‡åªæœ‰åœ¨è°ƒç”¨ä¸Šä¸‹æ–‡ä¸­æ‰è¢«å›ºå®šã€‚å³ä½¿ä½ â€œé’‰ä½â€äº†ç±»å‹ Bï¼š 1def foo[A](f: A =&gt; List[A], i: Int) = f(i) ä½ ä¹Ÿä¼šå¾—åˆ°ä¸€ä¸ªç±»å‹ä¸åŒ¹é…çš„é”™è¯¯ã€‚ ç±»å‹æ¨æ–­é™æ€ç±»å‹çš„ä¸€ä¸ªä¼ ç»Ÿåå¯¹æ„è§æ˜¯ï¼Œå®ƒæœ‰å¤§é‡çš„è¯­æ³•å¼€é”€ã€‚Scala é€šè¿‡ç±»å‹æ¨æ–­æ¥ç¼“è§£è¿™ä¸ªé—®é¢˜ã€‚ åœ¨å‡½æ•°å¼ç¼–ç¨‹è¯­è¨€ä¸­ï¼Œç±»å‹æ¨æ–­çš„ç»å…¸æ–¹æ³•æ˜¯ Hindley Milner ç®—æ³•ï¼Œå®ƒæœ€æ—©æ˜¯å®ç°åœ¨ ML ä¸­çš„ã€‚ Scala ç±»å‹æ¨æ–­ç³»ç»Ÿçš„å®ç°ç¨æœ‰ä¸åŒï¼Œä½†æœ¬è´¨ç±»ä¼¼ï¼šæ¨æ–­çº¦æŸï¼Œå¹¶è¯•å›¾ç»Ÿä¸€ç±»å‹ã€‚ ä¾‹å¦‚ï¼Œåœ¨ Scala ä¸­ä½ æ— æ³•è¿™æ ·åšï¼š 123scala&gt; &#123; x =&gt; x &#125;&lt;console&gt;:7: error: missing parameter type &#123; x =&gt; x &#125; è€Œåœ¨ OCaml ä¸­ä½ å¯ä»¥ï¼š 12# fun x -&gt; x;;- : 'a -&gt; 'a = &lt;fun&gt; åœ¨ Scala ä¸­æ‰€æœ‰ç±»å‹æ¨æ–­æ˜¯å±€éƒ¨çš„ã€‚Scala ä¸€æ¬¡åˆ†æä¸€ä¸ªè¡¨è¾¾å¼ã€‚ä¾‹å¦‚ï¼š 1234567891011scala&gt; def id[T](x: T) = xid: [T](x: T)Tscala&gt; val x = id(322)x: Int = 322scala&gt; val x = id(\"hey\")x: java.lang.String = heyscala&gt; val x = id(Array(1,2,3,4))x: Array[Int] = Array(1, 2, 3, 4) ç±»å‹ä¿¡æ¯éƒ½ä¿å­˜å®Œå¥½ï¼ŒScala ç¼–è¯‘å™¨ä¸ºæˆ‘ä»¬è¿›è¡Œäº†ç±»å‹æ¨æ–­ã€‚è¯·æ³¨æ„æˆ‘ä»¬å¹¶ä¸éœ€è¦æ˜ç¡®æŒ‡å®šè¿”å›ç±»å‹ã€‚ å˜æ€§ (Variance)Scala çš„ç±»å‹ç³»ç»Ÿå¿…é¡»åŒæ—¶è§£é‡Šç±»å±‚æ¬¡å’Œå¤šæ€æ€§ã€‚ç±»å±‚æ¬¡ç»“æ„å¯ä»¥è¡¨è¾¾å­ç±»å…³ç³»ã€‚åœ¨æ··åˆ OO å’Œå¤šæ€æ€§æ—¶ï¼Œä¸€ä¸ªæ ¸å¿ƒé—®é¢˜æ˜¯ï¼šå¦‚æœ Tâ€™æ˜¯ T ä¸€ä¸ªå­ç±»ï¼ŒContainer[Tâ€™] åº”è¯¥è¢«çœ‹åšæ˜¯ Container[T] çš„å­ç±»å—ï¼Ÿå˜æ€§ï¼ˆVarianceï¼‰æ³¨è§£å…è®¸ä½ è¡¨è¾¾ç±»å±‚æ¬¡ç»“æ„å’Œå¤šæ€ç±»å‹ä¹‹é—´çš„å…³ç³»ã€‚ å«ä¹‰ Scala æ ‡è®° åå˜ (covariant) C[Tâ€™] æ˜¯ C[T] çš„å­ç±» [+T] é€†å˜ (contravariant) C[T] æ˜¯ C[Tâ€™] çš„å­ç±» [-T] ä¸å˜ (invariant) C[T] å’Œ C[Tâ€™] æ— å…³ [T] é€†å˜åå˜æ›´å¤šä¿¡æ¯å‚è€ƒç»´åŸºç™¾ç§‘ å­ç±»å‹å…³ç³»çš„çœŸæ­£å«ä¹‰ï¼šå¯¹ä¸€ä¸ªç»™å®šçš„ç±»å‹ Tï¼Œå¦‚æœ Tâ€™æ˜¯å…¶å­ç±»å‹ï¼Œä½ èƒ½æ›¿æ¢å®ƒå—ï¼Ÿ åå˜123456789101112scala&gt; class Covariant[+A]defined class Covariantscala&gt; val cv: Covariant[AnyRef] = new Covariant[String]cv: Covariant[AnyRef] = Covariant@4035acf6scala&gt; val cv: Covariant[String] = new Covariant[AnyRef]&lt;console&gt;:6: error: type mismatch; found : Covariant[AnyRef] required: Covariant[String] val cv: Covariant[String] = new Covariant[AnyRef] ^ é€†å˜123456789101112scala&gt; class Contravariant[-A]defined class Contravariantscala&gt; val cv: Contravariant[String] = new Contravariant[AnyRef]cv: Contravariant[AnyRef] = Contravariant@49fa7bascala&gt; val fail: Contravariant[AnyRef] = new Contravariant[String]&lt;console&gt;:6: error: type mismatch; found : Contravariant[String] required: Contravariant[AnyRef] val fail: Contravariant[AnyRef] = new Contravariant[String] ^ é€†å˜ä¼¼ä¹å¾ˆå¥‡æ€ªã€‚ä»€ä¹ˆæ—¶å€™æ‰ä¼šç”¨åˆ°å®ƒå‘¢ï¼Ÿä»¤äººæƒŠè®¶çš„æ˜¯ï¼Œå‡½æ•°ç‰¹è´¨çš„å®šä¹‰å°±ä½¿ç”¨äº†å®ƒï¼ 1trait Function1 [-T1, +R] extends AnyRef å¦‚æœä½ ä»”ç»†ä»æ›¿æ¢çš„è§’åº¦æ€è€ƒä¸€ä¸‹ï¼Œä¼šå‘ç°å®ƒæ˜¯éå¸¸åˆç†çš„ã€‚è®©æˆ‘ä»¬å…ˆå®šä¹‰ä¸€ä¸ªç®€å•çš„ç±»å±‚æ¬¡ç»“æ„ï¼š 12345678scala&gt; class Animal &#123; val sound = \"rustle\" &#125;defined class Animalscala&gt; class Bird extends Animal &#123; override val sound = \"call\" &#125;defined class Birdscala&gt; class Chicken extends Bird &#123; override val sound = \"cluck\" &#125;defined class Chicken å‡è®¾ä½ éœ€è¦ä¸€ä¸ªä»¥ Bird ä¸ºå‚æ•°çš„å‡½æ•°ï¼š 1scala&gt; val getTweet: (Bird =&gt; String) = // TODO æ ‡å‡†åŠ¨ç‰©åº“æœ‰ä¸€ä¸ªå‡½æ•°æ»¡è¶³äº†ä½ çš„éœ€æ±‚ï¼Œä½†å®ƒçš„å‚æ•°æ˜¯ Animalã€‚åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œå¦‚æœä½ è¯´â€œæˆ‘éœ€è¦ä¸€ä¸ªï¼Œæˆ‘æœ‰ä¸€ä¸ªçš„å­ç±»â€æ˜¯å¯ä»¥çš„ã€‚ä½†æ˜¯ï¼Œåœ¨å‡½æ•°å‚æ•°è¿™é‡Œæ˜¯é€†å˜çš„ã€‚å¦‚æœä½ éœ€è¦ä¸€ä¸ªæ¥å—å‚æ•°ç±»å‹ Bird çš„å‡½æ•°å˜é‡ï¼Œä½†å´å°†è¿™ä¸ªå˜é‡æŒ‡å‘äº†æ¥å—å‚æ•°ç±»å‹ä¸º Chicken çš„å‡½æ•°ï¼Œé‚£ä¹ˆç»™å®ƒä¼ å…¥ä¸€ä¸ª Duck æ—¶å°±ä¼šå‡ºé”™ã€‚ç„¶è€Œï¼Œå¦‚æœå°†è¯¥å˜é‡æŒ‡å‘ä¸€ä¸ªæ¥å—å‚æ•°ç±»å‹ä¸º Animal çš„å‡½æ•°å°±ä¸ä¼šæœ‰è¿™ç§é—®é¢˜ï¼š 12scala&gt; val getTweet: (Bird =&gt; String) = ((a: Animal) =&gt; a.sound )getTweet: Bird =&gt; String = &lt;function1&gt; å‡½æ•°çš„è¿”å›å€¼ç±»å‹æ˜¯åå˜çš„ã€‚å¦‚æœä½ éœ€è¦ä¸€ä¸ªè¿”å› Bird çš„å‡½æ•°ï¼Œä½†æŒ‡å‘çš„å‡½æ•°è¿”å›ç±»å‹æ˜¯ Chickenï¼Œè¿™å½“ç„¶æ˜¯å¯ä»¥çš„ã€‚ 12scala&gt; val hatch: (() =&gt; Bird) = (() =&gt; new Chicken )hatch: () =&gt; Bird = &lt;function0&gt; æ‰€ä»¥å¯¹äº Scala ä¸­çš„å‡½æ•°è€Œè¨€ï¼Œåœ¨å…¥å‚é€†å˜ï¼Œè¿”å›å€¼åå˜çš„åŸºç¡€ä¸Šä¸€åˆ‡éƒ½ä¼šå˜å¾—çµæ´»è€Œä¸¥è°¨ã€‚ è¾¹ç•ŒScala å…è®¸ä½ é€šè¿‡è¾¹ç•Œæ¥é™åˆ¶å¤šæ€å˜é‡ã€‚è¿™äº›è¾¹ç•Œè¡¨è¾¾äº†å­ç±»å‹å…³ç³»ã€‚ 12345678910scala&gt; def cacophony[T](things: Seq[T]) = things map (_.sound)&lt;console&gt;:7: error: value sound is not a member of type parameter T def cacophony[T](things: Seq[T]) = things map (_.sound) ^scala&gt; def biophony[T &lt;: Animal](things: Seq[T]) = things map (_.sound)biophony: [T &lt;: Animal](things: Seq[T])Seq[java.lang.String]scala&gt; biophony(Seq(new Chicken, new Bird))res5: Seq[java.lang.String] = List(cluck, call) ç±»å‹ä¸‹ç•Œä¹Ÿæ˜¯æ”¯æŒçš„ï¼Œè¿™è®©é€†å˜å’Œå·§å¦™åå˜çš„å¼•å…¥å¾—å¿ƒåº”æ‰‹ã€‚List[+T] æ˜¯åå˜çš„ï¼›ä¸€ä¸ª Bird çš„åˆ—è¡¨ä¹Ÿæ˜¯ Animal çš„åˆ—è¡¨ã€‚List å®šä¹‰ä¸€ä¸ªæ“ä½œ :: (elem T) è¿”å›ä¸€ä¸ªåŠ å…¥äº† elem çš„æ–°çš„ Listã€‚æ–°çš„ List å’ŒåŸæ¥çš„åˆ—è¡¨å…·æœ‰ç›¸åŒçš„ç±»å‹ï¼š 12345scala&gt; val flock = List(new Bird, new Bird)flock: List[Bird] = List(Bird@7e1ec70e, Bird@169ea8d2)scala&gt; new Chicken :: flockres53: List[Bird] = List(Chicken@56fbda05, Bird@7e1ec70e, Bird@169ea8d2) List åŒæ · å®šä¹‰äº† :: [B &gt;: T](x: B) æ¥è¿”å›ä¸€ä¸ª List[B]ã€‚è¯·æ³¨æ„ B &gt;: Tï¼Œè¿™æŒ‡æ˜äº†ç±»å‹ B ä¸ºç±»å‹ T çš„è¶…ç±»ã€‚è¿™ä¸ªæ–¹æ³•è®©æˆ‘ä»¬èƒ½å¤Ÿåšæ­£ç¡®åœ°å¤„ç†åœ¨ä¸€ä¸ª List[Bird] å‰é¢åŠ ä¸€ä¸ª Animal çš„æ“ä½œï¼š 12scala&gt; new Animal :: flockres59: List[Animal] = List(Animal@11f8d3a8, Bird@7e1ec70e, Bird@169ea8d2) æ³¨æ„è¿”å›ç±»å‹æ˜¯ Animalã€‚ é‡åŒ–æœ‰æ—¶å€™ï¼Œä½ å¹¶ä¸å…³å¿ƒæ˜¯å¦èƒ½å¤Ÿå‘½åä¸€ä¸ªç±»å‹å˜é‡ï¼Œä¾‹å¦‚ï¼š 12scala&gt; def count[A](l: List[A]) = l.sizecount: [A](List[A])Int è¿™æ—¶ä½ å¯ä»¥ä½¿ç”¨é€šé…ç¬¦ _ å–è€Œä»£ä¹‹ï¼š 12scala&gt; def count(l: List[_]) = l.sizecount: (List[_])Int è¿™ç›¸å½“äºæ˜¯ä¸‹é¢ä»£ç çš„ç®€å†™ï¼š 12scala&gt; def count(l: List[T forSome &#123; type T &#125;]) = l.sizecount: (List[T forSome &#123; type T &#125;])Int æ³¨æ„é‡åŒ–ä¼šçš„ç»“æœä¼šå˜å¾—éå¸¸éš¾ä»¥ç†è§£ï¼š 12scala&gt; def drop1(l: List[_]) = l.taildrop1: (List[_])List[Any] çªç„¶ï¼Œæˆ‘ä»¬å¤±å»äº†ç±»å‹ä¿¡æ¯ï¼è®©æˆ‘ä»¬ç»†åŒ–ä»£ç çœ‹çœ‹å‘ç”Ÿäº†ä»€ä¹ˆï¼š 12scala&gt; def drop1(l: List[T forSome &#123; type T &#125;]) = l.taildrop1: (List[T forSome &#123; type T &#125;])List[T forSome &#123; type T &#125;] æˆ‘ä»¬ä¸èƒ½ä½¿ç”¨ T å› ä¸ºç±»å‹ä¸å…è®¸è¿™æ ·åšã€‚ ä½ ä¹Ÿå¯ä»¥ä¸ºé€šé…ç¬¦ç±»å‹å˜é‡åº”ç”¨è¾¹ç•Œï¼š 1234567891011121314scala&gt; def hashcodes(l: Seq[_ &lt;: AnyRef]) = l map (_.hashCode)hashcodes: (Seq[_ &lt;: AnyRef])Seq[Int]scala&gt; hashcodes(Seq(1,2,3))&lt;console&gt;:7: error: type mismatch; found : Int(1) required: AnyRefNote: primitive types are not implicitly converted to AnyRef.You can safely force boxing by casting x.asInstanceOf[AnyRef]. hashcodes(Seq(1,2,3)) ^scala&gt; hashcodes(Seq(\"one\", \"two\", \"three\"))res1: Seq[Int] = List(110182, 115276, 110339486) å‚è€ƒ D. R. MacIver å†™çš„ Scala ä¸­çš„å­˜åœ¨ç±»å‹","categories":[],"tags":[]},{"title":"æ¨¡å¼åŒ¹é…ä¸å‡½æ•°ç»„åˆ","slug":"scala-school-pattern-matching-and-functional-composition","date":"2019-12-01T02:28:36.000Z","updated":"2020-05-04T07:03:11.841Z","comments":true,"path":"2019/12/01/scala-school-pattern-matching-and-functional-composition/","link":"","permalink":"https://razertory.me/2019/12/01/scala-school-pattern-matching-and-functional-composition/","excerpt":"","text":"å‡½æ•°ç»„åˆè®©æˆ‘ä»¬åˆ›å»ºä¸¤ä¸ªå‡½æ•°ï¼š 12scala&gt; def f(s: String) = \"f(\" + s + \")\"f: (String)java.lang.String 12scala&gt; def g(s: String) = \"g(\" + s + \")\"g: (String)java.lang.String composecompose ç»„åˆå…¶ä»–å‡½æ•°å½¢æˆä¸€ä¸ªæ–°çš„å‡½æ•° f(g(x)) 12scala&gt; val fComposeG = f _ compose g _fComposeG: (String) =&gt; java.lang.String = &lt;function&gt; 12scala&gt; fComposeG(\"yay\")res0: java.lang.String = f(g(yay)) andThenandThen å’Œ compose å¾ˆåƒï¼Œä½†æ˜¯è°ƒç”¨é¡ºåºæ˜¯å…ˆè°ƒç”¨ç¬¬ä¸€ä¸ªå‡½æ•°ï¼Œç„¶åè°ƒç”¨ç¬¬äºŒä¸ªï¼Œå³ g(f(x)) 1234scala&gt; val fAndThenG = f _ andThen g _fAndThenG: (String) =&gt; java.lang.String = &lt;function&gt;scala&gt; fAndThenG(\"yay\")res1: java.lang.String = g(f(yay)) æŸ¯é‡ŒåŒ–(Curried) vs éƒ¨åˆ†åº”ç”¨(Partial Application)case è¯­å¥ é‚£ä¹ˆç©¶ç«Ÿä»€ä¹ˆæ˜¯ case è¯­å¥ï¼Ÿ è¿™æ˜¯ä¸€ä¸ªåä¸º PartialFunction çš„å‡½æ•°çš„å­ç±»ã€‚ å¤šä¸ª case è¯­å¥çš„é›†åˆæ˜¯ä»€ä¹ˆï¼Ÿ ä»–ä»¬æ˜¯å…±åŒç»„åˆåœ¨ä¸€èµ·çš„å¤šä¸ª PartialFunctionã€‚ ps: PartialFunction è¯¦è§ https://www.scala-lang.org/api/2.12.9/scala/PartialFunction.html å‡½æ•° vs åå‡½æ•° (PartialFunction)å‡½æ•°: å¯¹ç»™å®šçš„è¾“å…¥å‚æ•°ç±»å‹ï¼Œå‡½æ•°å¯æ¥å—è¯¥ç±»å‹çš„ä»»ä½•å€¼ã€‚æ¢å¥è¯è¯´ï¼Œä¸€ä¸ª (Int) =&gt; String çš„å‡½æ•°å¯ä»¥æ¥æ”¶ä»»æ„ Int å€¼ï¼Œå¹¶è¿”å›ä¸€ä¸ªå­—ç¬¦ä¸²ã€‚ åå‡½æ•°: å¯¹ç»™å®šçš„è¾“å…¥å‚æ•°ç±»å‹ï¼Œåå‡½æ•°åªèƒ½æ¥å—è¯¥ç±»å‹çš„æŸäº›ç‰¹å®šçš„å€¼ã€‚ä¸€ä¸ªå®šä¹‰ä¸º (Int) =&gt; String çš„åå‡½æ•°å¯èƒ½ä¸èƒ½æ¥å—æ‰€æœ‰ Int å€¼ä¸ºè¾“å…¥ã€‚isDefinedAt æ˜¯åå‡½æ•°çš„ä¸€ä¸ªæ–¹æ³•ï¼Œç”¨æ¥ç¡®å®šæ˜¯å¦èƒ½æ¥å—ä¸€ä¸ªç»™å®šçš„å‚æ•°ã€‚æ³¨æ„åå‡½æ•°å’Œæˆ‘ä»¬å‰é¢æåˆ°çš„éƒ¨åˆ†åº”ç”¨å‡½æ•°æ˜¯æ— å…³çš„ã€‚ å‚è€ƒ Effective Scala å¯¹ PartialFunction çš„æ„è§ã€‚ 123456789scala&gt; val one: PartialFunction[Int, String] = &#123; case 1 =&gt; \"one\" &#125;one: PartialFunction[Int,String] = &lt;function1&gt;// `isDefinedAt` æ˜¯`åå‡½æ•°`çš„ä¸€ä¸ªæ–¹æ³•ï¼Œç”¨æ¥ç¡®å®šæ˜¯å¦èƒ½æ¥å—ä¸€ä¸ªç»™å®šçš„å‚æ•°scala&gt; one.isDefinedAt(1)res0: Boolean = truescala&gt; one.isDefinedAt(2)res1: Boolean = false æ‚¨å¯ä»¥è°ƒç”¨ä¸€ä¸ªåå‡½æ•°ã€‚ 12scala&gt; one(1)res2: String = one åå‡½æ•°å¯ä»¥ä½¿ç”¨ orElse ç»„æˆæ–°çš„å‡½æ•°ï¼Œå¾—åˆ°çš„åå‡½æ•°åæ˜ äº†æ˜¯å¦å¯¹ç»™å®šå‚æ•°è¿›è¡Œäº†å®šä¹‰ã€‚ 1234567891011121314151617181920212223242526scala&gt; val two: PartialFunction[Int, String] = &#123; case 2 =&gt; \"two\" &#125;two: PartialFunction[Int,String] = &lt;function1&gt;scala&gt; val three: PartialFunction[Int, String] = &#123; case 3 =&gt; \"three\" &#125;three: PartialFunction[Int,String] = &lt;function1&gt;scala&gt; val wildcard: PartialFunction[Int, String] = &#123; case _ =&gt; \"something else\" &#125;wildcard: PartialFunction[Int,String] = &lt;function1&gt;scala&gt; val partial = one orElse two orElse three orElse wildcardpartial: PartialFunction[Int,String] = &lt;function1&gt;scala&gt; partial(5)res24: String = something elsescala&gt; partial(3)res25: String = threescala&gt; partial(2)res26: String = twoscala&gt; partial(1)res27: String = onescala&gt; partial(0)res28: String = something else case ä¹‹è°œä¸Šä¸€ç¯‡ æˆ‘ä»¬çœ‹åˆ°ä¸€äº›æ–°å¥‡çš„ä¸œè¥¿ã€‚æˆ‘ä»¬åœ¨é€šå¸¸åº”è¯¥ä½¿ç”¨å‡½æ•°çš„åœ°æ–¹çœ‹åˆ°äº†ä¸€ä¸ª case è¯­å¥ã€‚ 12345678scala&gt; case class PhoneExt(name: String, ext: Int)defined class PhoneExtscala&gt; val extensions = List(PhoneExt(\"steve\", 100), PhoneExt(\"robey\", 200))extensions: List[PhoneExt] = List(PhoneExt(steve,100), PhoneExt(robey,200))scala&gt; extensions.filter &#123; case PhoneExt(name, extension) =&gt; extension &lt; 200 &#125;res0: List[PhoneExt] = List(PhoneExt(steve,100)) ä¸ºä»€ä¹ˆè¿™æ®µä»£ç å¯ä»¥å·¥ä½œï¼Ÿ filter ä½¿ç”¨ä¸€ä¸ªå‡½æ•°ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­æ˜¯ä¸€ä¸ªè°“è¯å‡½æ•°(PhoneExt) =&gt; Booleanã€‚(è¿”å›ä¸€ä¸ªå¸ƒå°”å€¼çš„å‡½æ•°é€šå¸¸è¢«ç§°ä¸ºè°“è¯å‡½æ•°) åå‡½æ•° PartialFunction æ˜¯ Function çš„å­ç±»å‹ï¼Œæ‰€ä»¥ filter ä¹Ÿå¯ä»¥ä½¿ç”¨ PartialFunctionã€‚","categories":[],"tags":[]},{"title":"Scala è¯¾å ‚ - é›†åˆ","slug":"scala-school-collections","date":"2019-12-01T01:10:36.000Z","updated":"2020-05-04T07:02:42.386Z","comments":true,"path":"2019/12/01/scala-school-collections/","link":"","permalink":"https://razertory.me/2019/12/01/scala-school-collections/","excerpt":"","text":"åŸºæœ¬æ•°æ®ç»“æ„Scala æä¾›äº†ä¸€äº›ä¸é”™çš„é›†åˆã€‚ å‚è€ƒ Effective Scala å¯¹æ€æ ·ä½¿ç”¨é›†åˆçš„è§‚ç‚¹ã€‚ æ•°ç»„ (Array)æ•°ç»„æ˜¯æœ‰åºçš„ï¼Œå¯ä»¥åŒ…å«é‡å¤é¡¹ï¼Œå¹¶ä¸”å¯å˜ã€‚ 123456scala&gt; val numbers = Array(1, 2, 3, 4, 5, 1, 2, 3, 4, 5)numbers: Array[Int] = Array(1, 2, 3, 4, 5, 1, 2, 3, 4, 5)scala&gt; numbers(3) = 10scala&gt; numbersnumbers: Array[Int] = Array(1, 2, 3, 10, 5, 1, 2, 3, 4, 5) åˆ—è¡¨ (List)åˆ—è¡¨æ˜¯æœ‰åºçš„ï¼Œå¯ä»¥åŒ…å«é‡å¤é¡¹ï¼Œä¸å¯å˜ã€‚ 123456scala&gt; val numbers = List(1, 2, 3, 4, 5, 1, 2, 3, 4, 5)numbers: List[Int] = List(1, 2, 3, 4, 5, 1, 2, 3, 4, 5)scala&gt; numbers(3) = 10&lt;console&gt;:9: error: value update is not a member of List[Int] numbers(3) = 10 é›†åˆ (Set)é›†åˆæ— åºä¸”ä¸å¯åŒ…å«é‡å¤é¡¹ã€‚ 12scala&gt; val numbers = Set(1, 2, 3, 4, 5, 1, 2, 3, 4, 5)numbers: scala.collection.immutable.Set[Int] = Set(5, 1, 2, 3, 4) å…ƒç»„ (Tuple)å…ƒç»„åœ¨ä¸ä½¿ç”¨ç±»çš„æƒ…å†µä¸‹ï¼Œå°†å…ƒç´ ç»„åˆèµ·æ¥å½¢æˆç®€å•çš„é€»è¾‘é›†åˆã€‚ 12scala&gt; val hostPort = (\"localhost\", 80)hostPort: (String, Int) = (localhost, 80) ä¸æ ·æœ¬ç±»ä¸åŒï¼Œå…ƒç»„ä¸èƒ½é€šè¿‡åç§°è·å–å­—æ®µï¼Œè€Œæ˜¯ä½¿ç”¨ä½ç½®ä¸‹æ ‡æ¥è¯»å–å¯¹è±¡ï¼›è€Œä¸”è¿™ä¸ªä¸‹æ ‡åŸºäº 1ï¼Œè€Œä¸æ˜¯åŸºäº 0ã€‚ 12345scala&gt; hostPort._1res0: String = localhostscala&gt; hostPort._2res1: Int = 80 å…ƒç»„å¯ä»¥å¾ˆå¥½å¾—ä¸æ¨¡å¼åŒ¹é…ç›¸ç»“åˆã€‚ 1234hostPort match &#123; case (\"localhost\", port) =&gt; ... case (host, port) =&gt; ...&#125; åœ¨åˆ›å»ºä¸¤ä¸ªå…ƒç´ çš„å…ƒç»„æ—¶ï¼Œå¯ä»¥ä½¿ç”¨ç‰¹æ®Šè¯­æ³•ï¼š-&gt; 12scala&gt; 1 -&gt; 2res0: (Int, Int) = (1,2) å‚è€ƒ Effective Scala å¯¹ è§£æ„ç»‘å®šï¼ˆâ€œæ‹†è§£â€ä¸€ä¸ªå…ƒç»„ï¼‰çš„è§‚ç‚¹ã€‚ æ˜ å°„ (Map)å®ƒå¯ä»¥æŒæœ‰åŸºæœ¬æ•°æ®ç±»å‹ã€‚ 12Map(1 -&gt; 2)Map(\"foo\" -&gt; \"bar\") è¿™çœ‹èµ·æ¥åƒæ˜¯ç‰¹æ®Šçš„è¯­æ³•ï¼Œä¸è¿‡ä¸è¦å¿˜äº†ä¸Šæ–‡è®¨è®ºçš„ -&gt; å¯ä»¥ç”¨æ¥åˆ›å»ºäºŒå…ƒç»„ã€‚ Map() æ–¹æ³•ä¹Ÿä½¿ç”¨äº†ä»ç¬¬ä¸€èŠ‚è¯¾å­¦åˆ°çš„å˜å‚åˆ—è¡¨ï¼šMap(1 -&gt; â€œoneâ€, 2 -&gt; â€œtwoâ€) å°†å˜ä¸º Map((1, â€œoneâ€), (2, â€œtwoâ€))ï¼Œå…¶ä¸­ç¬¬ä¸€ä¸ªå…ƒç´ æ˜¯æ˜ å°„çš„é”®ï¼Œç¬¬äºŒä¸ªå…ƒç´ æ˜¯æ˜ å°„çš„å€¼ã€‚ æ˜ å°„çš„å€¼å¯ä»¥æ˜¯æ˜ å°„ç”šè‡³æ˜¯å‡½æ•°ã€‚ 12Map(1 -&gt; Map(\"foo\" -&gt; \"bar\"))Map(\"timesTwo\" -&gt; &#123; timesTwo(_) &#125;) é€‰é¡¹ (Option)Option æ˜¯ä¸€ä¸ªè¡¨ç¤ºæœ‰å¯èƒ½åŒ…å«å€¼çš„å®¹å™¨ã€‚ Option åŸºæœ¬çš„æ¥å£æ˜¯è¿™æ ·çš„ï¼š 12345trait Option[T] &#123; def isDefined: Boolean def get: T def getOrElse(t: T): T&#125; Option æœ¬èº«æ˜¯æ³›å‹çš„ï¼Œå¹¶ä¸”æœ‰ä¸¤ä¸ªå­ç±»ï¼š Some[T] æˆ– None æˆ‘ä»¬çœ‹ä¸€ä¸ªä½¿ç”¨ Option çš„ä¾‹å­ï¼š Map.get ä½¿ç”¨ Option ä½œä¸ºå…¶è¿”å›å€¼ï¼Œè¡¨ç¤ºè¿™ä¸ªæ–¹æ³•ä¹Ÿè®¸ä¸ä¼šè¿”å›ä½ è¯·æ±‚çš„å€¼ã€‚ 12345678scala&gt; val numbers = Map(\"one\" -&gt; 1, \"two\" -&gt; 2)numbers: scala.collection.immutable.Map[java.lang.String,Int] = Map(one -&gt; 1, two -&gt; 2)scala&gt; numbers.get(\"two\")res0: Option[Int] = Some(2)scala&gt; numbers.get(\"three\")res1: Option[Int] = None ç°åœ¨æˆ‘ä»¬çš„æ•°æ®ä¼¼ä¹é™·åœ¨ Option ä¸­äº†ï¼Œæˆ‘ä»¬æ€æ ·è·å–è¿™ä¸ªæ•°æ®å‘¢ï¼Ÿ ç›´è§‰ä¸Šæƒ³åˆ°çš„å¯èƒ½æ˜¯åŸºäº isDefined æ–¹æ³•è¿›è¡Œæ¡ä»¶åˆ¤æ–­ã€‚ 123456// We want to multiply the number by two, otherwise return 0.val result = if (res1.isDefined) &#123; res1.get * 2&#125; else &#123; 0&#125; æˆ‘ä»¬å»ºè®®ä½¿ç”¨ getOrElse æˆ–æ¨¡å¼åŒ¹é…å¤„ç†è¿™ä¸ªç»“æœã€‚ getOrElse è®©ä½ è½»æ¾åœ°å®šä¹‰ä¸€ä¸ªé»˜è®¤å€¼ã€‚ 1234567val result = res1.getOrElse(0) * 2æ¨¡å¼åŒ¹é…èƒ½è‡ªç„¶åœ°é…åˆ Option ä½¿ç”¨ã€‚val result = res1 match &#123; case Some(n) =&gt; n * 2 case None =&gt; 0&#125; å‚è€ƒ Effective Scala å¯¹ä½¿ç”¨ Options çš„æ„è§ã€‚ å‡½æ•°ç»„åˆå­ï¼ˆFunctional Combinatorsï¼‰List(1, 2, 3) map squared å¯¹åˆ—è¡¨ä¸­çš„æ¯ä¸€ä¸ªå…ƒç´ éƒ½åº”ç”¨äº† squared å¹³æ–¹å‡½æ•°ï¼Œå¹¶è¿”å›ä¸€ä¸ªæ–°çš„åˆ—è¡¨ List(1, 4, 9)ã€‚æˆ‘ä»¬æŠŠç±»ä¼¼äº map çš„æ“ä½œç§°ä½œç»„åˆå­ã€‚ ï¼ˆå¦‚æœæƒ³è¦æ›´å¥½çš„å®šä¹‰ï¼Œä½ å¯ä»¥çœ‹çœ‹ Stackoverflow ä¸Šå¯¹ ç»„åˆå­ çš„è¯´æ˜ã€‚ï¼‰ä»–ä»¬å¸¸è¢«ç”¨åœ¨æ ‡å‡†çš„æ•°æ®ç»“æ„ä¸Šã€‚ mapmap å¯¹åˆ—è¡¨ä¸­çš„æ¯ä¸ªå…ƒç´ åº”ç”¨ä¸€ä¸ªå‡½æ•°ï¼Œè¿”å›åº”ç”¨åçš„å…ƒç´ æ‰€ç»„æˆçš„åˆ—è¡¨ã€‚ 12345scala&gt; val numbers = List(1, 2, 3, 4)numbers: List[Int] = List(1, 2, 3, 4)scala&gt; numbers.map((i: Int) =&gt; i * 2)res0: List[Int] = List(2, 4, 6, 8) æˆ–ä¼ å…¥ä¸€ä¸ªå‡½æ•° (Scala ç¼–è¯‘å™¨è‡ªåŠ¨æŠŠæˆ‘ä»¬çš„æ–¹æ³•è½¬æ¢ä¸ºå‡½æ•°ï¼‰ 12345scala&gt; def timesTwo(i: Int): Int = i * 2timesTwo: (i: Int)Intscala&gt; numbers.map(timesTwo)res0: List[Int] = List(2, 4, 6, 8) foreachforeach å¾ˆåƒ mapï¼Œä½†æ²¡æœ‰è¿”å›å€¼ã€‚foreach ä»…ç”¨äºæœ‰å‰¯ä½œç”¨ side-effects çš„å‡½æ•°ã€‚ 12scala&gt; numbers.foreach((i: Int) =&gt; i * 2)// ä»€ä¹ˆä¹Ÿæ²¡æœ‰è¿”å›ã€‚ ä½ å¯ä»¥å°è¯•å­˜å‚¨è¿”å›å€¼ï¼Œä½†å®ƒä¼šæ˜¯ Unit ç±»å‹ï¼ˆå³ voidï¼‰ 12scala&gt; val doubled = numbers.foreach((i: Int) =&gt; i * 2)doubled: Unit = () filterfilter ç§»é™¤ä»»ä½•å¯¹ä¼ å…¥å‡½æ•°è®¡ç®—ç»“æœä¸º false çš„å…ƒç´ ã€‚è¿”å›ä¸€ä¸ªå¸ƒå°”å€¼çš„å‡½æ•°é€šå¸¸è¢«ç§°ä¸ºè°“è¯å‡½æ•° ï¼ˆæˆ–åˆ¤å®šå‡½æ•°ï¼‰ã€‚ 1234567scala&gt; numbers.filter((i: Int) =&gt; i % 2 == 0)res0: List[Int] = List(2, 4)scala&gt; def isEven(i: Int): Boolean = i % 2 == 0isEven: (i: Int)Booleanscala&gt; numbers.filter(isEven)res2: List[Int] = List(2, 4) zipzip å°†ä¸¤ä¸ªåˆ—è¡¨çš„å†…å®¹èšåˆåˆ°ä¸€ä¸ªå¯¹å¶åˆ—è¡¨ä¸­ã€‚ 12scala&gt; List(1, 2, 3).zip(List(\"a\", \"b\", \"c\"))res0: List[(Int, String)] = List((1,a), (2,b), (3,c)) partitionpartition å°†ä½¿ç”¨ç»™å®šçš„è°“è¯å‡½æ•°åˆ†å‰²åˆ—è¡¨ã€‚ 123scala&gt; val numbers = List(1, 2, 3, 4, 5, 6, 7, 8, 9, 10)scala&gt; numbers.partition(_ % 2 == 0)res0: (List[Int], List[Int]) = (List(2, 4, 6, 8, 10),List(1, 3, 5, 7, 9)) findfind è¿”å›é›†åˆä¸­ç¬¬ä¸€ä¸ªåŒ¹é…è°“è¯å‡½æ•°çš„å…ƒç´ ã€‚ 12scala&gt; numbers.find((i: Int) =&gt; i &gt; 5)res0: Option[Int] = Some(6) drop &amp; dropWhiledrop å°†åˆ é™¤å‰ i ä¸ªå…ƒç´  12scala&gt; numbers.drop(5)res0: List[Int] = List(6, 7, 8, 9, 10) dropWhile å°†åˆ é™¤åŒ¹é…è°“è¯å‡½æ•°çš„ç¬¬ä¸€ä¸ªå…ƒç´ ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæˆ‘ä»¬åœ¨ numbers åˆ—è¡¨ä¸Šä½¿ç”¨ dropWhile å‡½æ•°æ¥å»é™¤å¥‡æ•°ï¼Œ1 å°†è¢«ä¸¢å¼ƒï¼ˆä½† 3 ä¸ä¼šè¢«ä¸¢å¼ƒï¼Œå› ä¸ºä»–è¢« 2 ä¿æŠ¤äº†ï¼‰ã€‚ 12scala&gt; numbers.dropWhile(_ % 2 != 0)res0: List[Int] = List(2, 3, 4, 5, 6, 7, 8, 9, 10) foldLeft12scala&gt; numbers.foldLeft(0)((m: Int, n: Int) =&gt; m + n)res0: Int = 55 0 ä¸ºåˆå§‹å€¼ï¼ˆè®°ä½ numbers æ˜¯ List[Int] ç±»å‹ï¼‰ï¼Œm ä½œä¸ºä¸€ä¸ªç´¯åŠ å™¨ã€‚åœ¨æ ‡å‡†åº“çš„å®ç°ä¸ºï¼š 12345def foldLeft[B](z: B)(op: (B, A) =&gt; B): B = &#123; var result = z this.seq foreach (x =&gt; result = op(result, x)) result&#125; å¯è§†åŒ–è§‚å¯Ÿè¿è¡Œè¿‡ç¨‹ï¼š 123456789101112scala&gt; numbers.foldLeft(0) &#123; (m: Int, n: Int) =&gt; println(\"m: \" + m + \" n: \" + n); m + n &#125;m: 0 n: 1m: 1 n: 2m: 3 n: 3m: 6 n: 4m: 10 n: 5m: 15 n: 6m: 21 n: 7m: 28 n: 8m: 36 n: 9m: 45 n: 10res0: Int = 55 foldRightå’Œ foldLeft ä¸€æ ·ï¼Œåªæ˜¯è¿è¡Œè¿‡ç¨‹ç›¸åã€‚åœ¨æ ‡å‡†åº“çš„å®ç°ä¸ºï¼š 12def foldRight[B](z: B)(op: (A, B) =&gt; B): B = reversed.foldLeft(z)((x, y) =&gt; op(y, x)) 123456789101112scala&gt; numbers.foldRight(0) &#123; (m: Int, n: Int) =&gt; println(\"m: \" + m + \" n: \" + n); m + n &#125;m: 10 n: 0m: 9 n: 10m: 8 n: 19m: 7 n: 27m: 6 n: 34m: 5 n: 40m: 4 n: 45m: 3 n: 49m: 2 n: 52m: 1 n: 54res0: Int = 55 flattenflatten å°†åµŒå¥—ç»“æ„æ‰å¹³åŒ–ä¸€ä¸ªå±‚çº§ã€‚ 12scala&gt; List(List(1, 2), List(3, 4)).flattenres0: List[Int] = List(1, 2, 3, 4) flatMapflatMap æ˜¯ä¸€ç§å¸¸ç”¨çš„ç»„åˆå­ï¼Œç»“åˆæ˜ å°„ mapping å’Œæ‰å¹³åŒ– flatteningã€‚ flatMap éœ€è¦ä¸€ä¸ªå¤„ç†åµŒå¥—åˆ—è¡¨çš„å‡½æ•°ï¼Œç„¶åå°†ç»“æœä¸²è¿èµ·æ¥ã€‚ 12345scala&gt; val nestedNumbers = List(List(1, 2), List(3, 4))nestedNumbers: List[List[Int]] = List(List(1, 2), List(3, 4))scala&gt; nestedNumbers.flatMap(x =&gt; x.map(_ * 2))res0: List[Int] = List(2, 4, 6, 8) å¯ä»¥æŠŠå®ƒçœ‹åšæ˜¯â€œå…ˆæ˜ å°„åæ‰å¹³åŒ–â€çš„å¿«æ·æ“ä½œï¼š 12scala&gt; nestedNumbers.map((x: List[Int]) =&gt; x.map(_ * 2)).flattenres1: List[Int] = List(2, 4, 6, 8) è¿™ä¸ªä¾‹å­å…ˆè°ƒç”¨ mapï¼Œç„¶åè°ƒç”¨ flattenï¼Œè¿™å°±æ˜¯ ç»„åˆå­ çš„ç‰¹å¾ï¼Œä¹Ÿæ˜¯è¿™äº›å‡½æ•°çš„æœ¬è´¨ã€‚ å‚è€ƒ Effective Scala å¯¹ flatMap çš„æ„è§ã€‚ æ‰©å±•å‡½æ•°ç»„åˆå­ç°åœ¨æˆ‘ä»¬å·²ç»å­¦è¿‡é›†åˆä¸Šçš„ä¸€äº›å‡½æ•°ã€‚ æˆ‘ä»¬å°†å°è¯•å†™è‡ªå·±çš„å‡½æ•°ç»„åˆå­ã€‚ æœ‰è¶£çš„æ˜¯ï¼Œä¸Šé¢æ‰€å±•ç¤ºçš„æ¯ä¸€ä¸ªå‡½æ•°ç»„åˆå­éƒ½å¯ä»¥ç”¨ fold æ–¹æ³•å®ç°ã€‚è®©æˆ‘ä»¬çœ‹ä¸€äº›ä¾‹å­ã€‚ 12345678def ourMap(numbers: List[Int], fn: Int =&gt; Int): List[Int] = &#123; numbers.foldRight(List[Int]()) &#123; (x: Int, xs: List[Int]) =&gt; fn(x) :: xs // ä¸¤ä¸ªå†’å·è¡¨ç¤ºæ™®é€šå…ƒç´ ä¸ List çš„è¿æ¥æ“ä½œ &#125;&#125;scala&gt; ourMap(numbers, timesTwo(_))res0: List[Int] = List(2, 4, 6, 8, 10, 12, 14, 16, 18, 20) ä¸ºä»€ä¹ˆæ˜¯ List[Int]()ï¼ŸScala æ²¡æœ‰èªæ˜åˆ°ç†è§£ä½ çš„ç›®çš„æ˜¯å°†ç»“æœç§¯èšåœ¨ä¸€ä¸ªç©ºçš„ Int ç±»å‹çš„åˆ—è¡¨ä¸­ã€‚ Map?æ‰€æœ‰å±•ç¤ºçš„å‡½æ•°ç»„åˆå­éƒ½å¯ä»¥åœ¨ Map ä¸Šä½¿ç”¨ã€‚Map å¯ä»¥è¢«çœ‹ä½œæ˜¯ä¸€ä¸ªäºŒå…ƒç»„çš„åˆ—è¡¨ï¼Œæ‰€ä»¥ä½ å†™çš„å‡½æ•°è¦å¤„ç†ä¸€ä¸ªé”®å’Œå€¼çš„äºŒå…ƒç»„ã€‚ 12scala&gt; val extensions = Map(\"steve\" -&gt; 100, \"bob\" -&gt; 101, \"joe\" -&gt; 201)extensions: scala.collection.immutable.Map[String,Int] = Map((steve,100), (bob,101), (joe,201)) ç°åœ¨ç­›é€‰å‡ºç”µè¯åˆ†æœºå·ç ä½äº 200 çš„æ¡ç›®ã€‚ 12scala&gt; extensions.filter((namePhone: (String, Int)) =&gt; namePhone._2 &lt; 200)res0: scala.collection.immutable.Map[String,Int] = Map((steve,100), (bob,101)) å› ä¸ºå‚æ•°æ˜¯å…ƒç»„ï¼Œæ‰€ä»¥ä½ å¿…é¡»ä½¿ç”¨ä½ç½®è·å–å™¨æ¥è¯»å–å®ƒä»¬çš„é”®å’Œå€¼ã€‚å‘ƒï¼ å¹¸è¿çš„æ˜¯ï¼Œæˆ‘ä»¬å…¶å®å¯ä»¥ä½¿ç”¨æ¨¡å¼åŒ¹é…æ›´ä¼˜é›…åœ°æå–é”®å’Œå€¼ã€‚ 12scala&gt; extensions.filter(&#123;case (name, extension) =&gt; extension &lt; 200&#125;)res0: scala.collection.immutable.Map[String,Int] = Map((steve,100), (bob,101)) ä¸ºä»€ä¹ˆè¿™ä¸ªä»£ç å¯ä»¥å·¥ä½œï¼Ÿä¸ºä»€ä¹ˆä½ å¯ä»¥ä¼ é€’ä¸€ä¸ªéƒ¨åˆ†æ¨¡å¼åŒ¹é…ï¼Ÿä¸‹ä¸€ç« å°†æ­æ™“ã€‚","categories":[],"tags":[]},{"title":"Scala è¯¾å ‚ - åŸºç¡€ï¼ˆç»­ï¼‰","slug":"scala-school-bascis2","date":"2019-11-30T14:20:10.000Z","updated":"2020-05-04T07:02:32.099Z","comments":true,"path":"2019/11/30/scala-school-bascis2/","link":"","permalink":"https://razertory.me/2019/11/30/scala-school-bascis2/","excerpt":"","text":"apply æ–¹æ³•å½“ç±»æˆ–å¯¹è±¡æœ‰ä¸€ä¸ªä¸»è¦ç”¨é€”çš„æ—¶å€™ï¼Œapply æ–¹æ³•ä¸ºä½ æä¾›äº†ä¸€ä¸ªå¾ˆå¥½çš„è¯­æ³•ç³–ã€‚ 12345678910scala&gt; class Foo &#123;&#125;defined class Fooscala&gt; object FooMaker &#123; | def apply() = new Foo | &#125;defined module FooMakerscala&gt; val newFoo = FooMaker()newFoo: Foo = Foo@5b83f762 æˆ– 12345678910scala&gt; class Bar &#123; | def apply() = 0 | &#125;defined class Barscala&gt; val bar = new Barbar: Bar = Bar@47711479scala&gt; bar()res8: Int = 0 åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬å®ä¾‹åŒ–å¯¹è±¡çœ‹èµ·æ¥åƒæ˜¯åœ¨è°ƒç”¨ä¸€ä¸ªæ–¹æ³•ã€‚ä»¥åä¼šæœ‰æ›´å¤šä»‹ç»ï¼ å•ä¾‹å¯¹è±¡ (object)å•ä¾‹å¯¹è±¡ç”¨äºæŒæœ‰ä¸€ä¸ªç±»çš„å”¯ä¸€å®ä¾‹ã€‚é€šå¸¸ç”¨äº å·¥å‚æ¨¡å¼ã€‚ 12345678object Timer &#123; var count = 0 def currentCount(): Long = &#123; count += 1 count &#125;&#125; å¯ä»¥è¿™æ ·ä½¿ç”¨ï¼š 12scala&gt; Timer.currentCount()res0: Long = 1 å•ä¾‹å¯¹è±¡å¯ä»¥å’Œç±»å…·æœ‰ç›¸åŒçš„åç§°ï¼Œæ­¤æ—¶è¯¥å¯¹è±¡ä¹Ÿè¢«ç§°ä¸ºä¼´ç”Ÿå¯¹è±¡ã€‚æˆ‘ä»¬é€šå¸¸å°†ä¼´ç”Ÿå¯¹è±¡ä½œä¸ºå·¥å‚ä½¿ç”¨ã€‚ ä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼Œå¯ä»¥ä¸éœ€è¦ä½¿ç”¨ new æ¥åˆ›å»ºä¸€ä¸ªå®ä¾‹äº†ã€‚ 12345class Bar(foo: String)object Bar &#123; def apply(foo: String) = new Bar(foo)&#125; å‡½æ•°å³å¯¹è±¡ Scala ä¸­ï¼Œæˆ‘ä»¬ç»å¸¸è°ˆè®ºå¯¹è±¡çš„å‡½æ•°å¼ç¼–ç¨‹ã€‚è¿™æ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿåˆ°åº•ä»€ä¹ˆæ˜¯å‡½æ•°å‘¢ï¼Ÿ å‡½æ•°æ˜¯ä¸€äº›ç‰¹è´¨çš„é›†åˆã€‚å…·ä½“æ¥è¯´ï¼Œå…·æœ‰ä¸€ä¸ªå‚æ•°çš„å‡½æ•°æ˜¯ Function1 trait çš„ä¸€ä¸ªå®ä¾‹ã€‚è¿™ä¸ª trait å®šä¹‰äº† apply è¯­æ³•ç³–ï¼Œè®©ä½ è°ƒç”¨ä¸€ä¸ªå¯¹è±¡æ—¶å°±åƒä½ åœ¨è°ƒç”¨ä¸€ä¸ªå‡½æ•°ã€‚ï¼ˆå…³äº Function1 trait åœ¨ Scala API doc ä¸­æœ‰è¯¦ç»†ä»‹ç» https://www.scala-lang.org/api/2.7.5/scala/Function1.html ) 1234567scala&gt; object addOne extends Function1[Int, Int] &#123; | def apply(m: Int): Int = m + 1 | &#125;defined module addOnescala&gt; addOne(1)res2: Int = 2 è¿™ä¸ª Function trait é›†åˆä¸‹æ ‡ä» 0 å¼€å§‹ä¸€ç›´åˆ° 22ã€‚ä¸ºä»€ä¹ˆæ˜¯ 22ï¼Ÿè¿™æ˜¯ä¸€ä¸ªä¸»è§‚çš„é­”å¹»æ•°å­— (magic number)ã€‚æˆ‘ä»æ¥æ²¡æœ‰ä½¿ç”¨è¿‡å¤šäº 22 ä¸ªå‚æ•°çš„å‡½æ•°ï¼Œæ‰€ä»¥è¿™ä¸ªæ•°å­—ä¼¼ä¹æ˜¯åˆç†çš„ã€‚ï¼ˆåœ¨ Scala ) apply è¯­æ³•ç³–æœ‰åŠ©äºç»Ÿä¸€å¯¹è±¡å’Œå‡½æ•°å¼ç¼–ç¨‹çš„äºŒé‡æ€§ã€‚ä½ å¯ä»¥ä¼ é€’ç±»ï¼Œå¹¶æŠŠå®ƒä»¬å½“åšå‡½æ•°ä½¿ç”¨ï¼Œè€Œå‡½æ•°æœ¬è´¨ä¸Šæ˜¯ç±»çš„å®ä¾‹ã€‚ è¿™æ˜¯å¦æ„å‘³ç€ï¼Œå½“ä½ åœ¨ç±»ä¸­å®šä¹‰ä¸€ä¸ªæ–¹æ³•æ—¶ï¼Œå¾—åˆ°çš„å®é™…ä¸Šæ˜¯ä¸€ä¸ª Function *çš„å®ä¾‹ï¼Ÿä¸æ˜¯çš„ï¼Œåœ¨ç±»ä¸­å®šä¹‰çš„æ–¹æ³•æ˜¯æ–¹æ³•è€Œä¸æ˜¯å‡½æ•°ã€‚åœ¨ repl ä¸­ç‹¬ç«‹å®šä¹‰çš„æ–¹æ³•æ˜¯ Function *çš„å®ä¾‹ã€‚ ç±»ä¹Ÿå¯ä»¥æ‰©å±• Functionï¼Œè¿™äº›ç±»çš„å®ä¾‹å¯ä»¥ä½¿ç”¨ () è°ƒç”¨ã€‚ 12345678910scala&gt; class AddOne extends Function1[Int, Int] &#123; | def apply(m: Int): Int = m + 1 | &#125;defined class AddOnescala&gt; val plusOne = new AddOne()plusOne: AddOne = &lt;function1&gt;scala&gt; plusOne(1)res0: Int = 2 å¯ä»¥ä½¿ç”¨æ›´ç›´è§‚å¿«æ·çš„ extends (Int =&gt; Int) ä»£æ›¿ extends Function1[Int, Int] 123class AddOne extends (Int =&gt; Int) &#123; def apply(m: Int): Int = m + 1&#125; åŒ… (package)ä½ å¯ä»¥å°†ä»£ç ç»„ç»‡åœ¨åŒ…é‡Œã€‚ 1package com.twitter.example åœ¨æ–‡ä»¶å¤´éƒ¨å®šä¹‰åŒ…ï¼Œä¼šå°†æ–‡ä»¶ä¸­æ‰€æœ‰çš„ä»£ç å£°æ˜åœ¨é‚£ä¸ªåŒ…ä¸­ã€‚ å€¼å’Œå‡½æ•°ä¸èƒ½åœ¨ç±»æˆ–å•ä¾‹å¯¹è±¡ä¹‹å¤–å®šä¹‰ã€‚å•ä¾‹å¯¹è±¡æ˜¯ç»„ç»‡é™æ€å‡½æ•° static function çš„æœ‰æ•ˆå·¥å…·ã€‚ 123456package com.twitter.exampleobject colorHolder &#123; val BLUE = \"Blue\" val RED = \"Red\"&#125; ç°åœ¨ä½ å¯ä»¥ç›´æ¥è®¿é—®è¿™äº›æˆå‘˜ 1println(\"the color is: \" + com.twitter.example.colorHolder.BLUE) æ³¨æ„åœ¨ä½ å®šä¹‰è¿™ä¸ªå¯¹è±¡æ—¶ Scala è§£é‡Šå™¨çš„è¿”å›ï¼š 12345scala&gt; object colorHolder &#123; | val Blue = \"Blue\" | val Red = \"Red\" | &#125;defined module colorHolder è¿™æš—ç¤ºäº† Scala çš„è®¾è®¡è€…æ˜¯æŠŠå¯¹è±¡ä½œä¸º Scala çš„æ¨¡å—ç³»ç»Ÿçš„ä¸€éƒ¨åˆ†è¿›è¡Œè®¾è®¡çš„ã€‚ æ¨¡å¼åŒ¹é…è¿™æ˜¯ Scala ä¸­æœ€æœ‰ç”¨çš„éƒ¨åˆ†ä¹‹ä¸€ã€‚ åŒ¹é…å€¼ 1234567val times = 1times match &#123; case 1 =&gt; \"one\" case 2 =&gt; \"two\" case _ =&gt; \"some other number\"&#125; ä½¿ç”¨å®ˆå«è¿›è¡ŒåŒ¹é… 12345times match &#123; case i if i == 1 =&gt; \"one\" case i if i == 2 =&gt; \"two\" case _ =&gt; \"some other number\"&#125; æ³¨æ„æˆ‘ä»¬æ˜¯æ€æ ·è·å–å˜é‡ i çš„å€¼çš„ã€‚ åœ¨æœ€åä¸€è¡ŒæŒ‡ä»¤ä¸­çš„_æ˜¯ä¸€ä¸ªé€šé…ç¬¦ï¼›å®ƒä¿è¯äº†æˆ‘ä»¬å¯ä»¥å¤„ç†æ‰€æœ‰çš„æƒ…å†µã€‚ (æ³¨æ„ç¬¬ä¸€ç« æåˆ°çš„ _ åœ¨ä¸åŒä¸Šä¸‹æ–‡ä¸­æœ‰ä¸åŒå«ä¹‰)å¦åˆ™å½“ä¼ è¿›ä¸€ä¸ªä¸èƒ½è¢«åŒ¹é…çš„æ•°å­—çš„æ—¶å€™ï¼Œä½ å°†è·å¾—ä¸€ä¸ªè¿è¡Œæ—¶é”™è¯¯ã€‚æˆ‘ä»¬ä»¥åä¼šç»§ç»­è®¨è®ºè¿™ä¸ªè¯é¢˜çš„ã€‚ å‚è€ƒ Effective Scala å¯¹ä»€ä¹ˆæ—¶å€™ä½¿ç”¨æ¨¡å¼åŒ¹é…å’Œæ¨¡å¼åŒ¹é…æ ¼å¼åŒ–çš„å»ºè®®ã€‚A Tour of Scala ä¹Ÿæè¿°äº†æ¨¡å¼åŒ¹é… åŒ¹é…ç±»å‹ä½ å¯ä»¥ä½¿ç”¨ match æ¥åˆ†åˆ«å¤„ç†ä¸åŒç±»å‹çš„å€¼ã€‚ 123456789def bigger(o: Any): Any = &#123; o match &#123; case i: Int if i &lt; 0 =&gt; i - 1 case i: Int =&gt; i + 1 case d: Double if d &lt; 0.0 =&gt; d - 0.1 case d: Double =&gt; d + 0.1 case text: String =&gt; text + \"s\" &#125;&#125; åŒ¹é…ç±»æˆå‘˜è¿˜è®°å¾—æˆ‘ä»¬ä¹‹å‰çš„è®¡ç®—å™¨å—ã€‚ è®©æˆ‘ä»¬é€šè¿‡ç±»å‹å¯¹å®ƒä»¬è¿›è¡Œåˆ†ç±»ã€‚ ä¸€å¼€å§‹ä¼šå¾ˆç—›è‹¦ã€‚ 123456def calcType(calc: Calculator) = calc match &#123; case _ if calc.brand == \"HP\" &amp;&amp; calc.model == \"20B\" =&gt; \"financial\" case _ if calc.brand == \"HP\" &amp;&amp; calc.model == \"48G\" =&gt; \"scientific\" case _ if calc.brand == \"HP\" &amp;&amp; calc.model == \"30B\" =&gt; \"business\" case _ =&gt; \"unknown\"&#125; (âŠ™oâŠ™) å“¦ï¼Œå¤ªç—›è‹¦äº†ã€‚å¹¸å¥½ Scala æä¾›äº†ä¸€äº›åº”å¯¹è¿™ç§æƒ…å†µçš„æœ‰æ•ˆå·¥å…·ã€‚ æ ·æœ¬ç±» (Case Classes)ä½¿ç”¨æ ·æœ¬ç±»å¯ä»¥æ–¹ä¾¿æå‰å‡†å¤‡å¥½éœ€è¦è¿›è¡ŒåŒ¹é…ç±»å†…å®¹ï¼Œå¹¶ä¸”ä¸ç”¨ new å…³é”®å­—å°±å¯ä»¥åˆ›å»ºå®ƒä»¬ã€‚ 12345scala&gt; case class Calculator(brand: String, model: String)defined class Calculatorscala&gt; val hp20b = Calculator(\"HP\", \"20b\")hp20b: Calculator = Calculator(hp,20b) æ ·æœ¬ç±»åŸºäºæ„é€ å‡½æ•°çš„å‚æ•°ï¼Œè‡ªåŠ¨åœ°å®ç°äº†ç›¸ç­‰æ€§å’Œæ˜“è¯»çš„ toString æ–¹æ³•ã€‚ 12345678scala&gt; val hp20b = Calculator(\"HP\", \"20b\")hp20b: Calculator = Calculator(hp,20b)scala&gt; val hp20B = Calculator(\"HP\", \"20b\")hp20B: Calculator = Calculator(hp,20b)scala&gt; hp20b == hp20Bres6: Boolean = true æ ·æœ¬ç±»ä¹Ÿå¯ä»¥åƒæ™®é€šç±»é‚£æ ·æ‹¥æœ‰æ–¹æ³•ã€‚ ä½¿ç”¨æ ·æœ¬ç±»è¿›è¡Œæ¨¡å¼åŒ¹é…æ ·æœ¬ç±»å°±æ˜¯è¢«è®¾è®¡ç”¨åœ¨æ¨¡å¼åŒ¹é…ä¸­çš„ã€‚è®©æˆ‘ä»¬ç®€åŒ–ä¹‹å‰çš„è®¡ç®—å™¨åˆ†ç±»å™¨çš„ä¾‹å­ã€‚ 123456789val hp20b = Calculator(\"HP\", \"20B\")val hp30b = Calculator(\"HP\", \"30B\")def calcType(calc: Calculator) = calc match &#123; case Calculator(\"HP\", \"20B\") =&gt; \"financial\" case Calculator(\"HP\", \"48G\") =&gt; \"scientific\" case Calculator(\"HP\", \"30B\") =&gt; \"business\" case Calculator(ourBrand, ourModel) =&gt; \"Calculator: %s %s is of unknown type\".format(ourBrand, ourModel)&#125; æœ€åä¸€å¥ä¹Ÿå¯ä»¥è¿™æ ·å†™ 1case Calculator(_, _) =&gt; \"Calculator of unknown type\" æˆ–è€…æˆ‘ä»¬å®Œå…¨å¯ä»¥ä¸å°†åŒ¹é…å¯¹è±¡æŒ‡å®šä¸º Calculator ç±»å‹ 1case _ =&gt; \"Calculator of unknown type\" æˆ–è€…æˆ‘ä»¬ä¹Ÿå¯ä»¥å°†åŒ¹é…çš„å€¼é‡æ–°å‘½åã€‚ 1case c@Calculator(_, _) =&gt; \"Calculator: %s of unknown type\".format(c) å¼‚å¸¸Scala ä¸­çš„å¼‚å¸¸å¯ä»¥åœ¨ try-catch-finally è¯­æ³•ä¸­é€šè¿‡æ¨¡å¼åŒ¹é…ä½¿ç”¨ã€‚ 12345678910111213141516171819try &#123; remoteCalculatorService.add(1, 2)&#125; catch &#123; case e: ServerIsDownException =&gt; log.error(e, \"the remote calculator service is unavailable. should have kept your trusty HP.\")&#125; finally &#123; remoteCalculatorService.close()&#125;// try ä¹Ÿæ˜¯é¢å‘è¡¨è¾¾å¼çš„val result: Int = try &#123; remoteCalculatorService.add(1, 2)&#125; catch &#123; case e: ServerIsDownException =&gt; &#123; log.error(e, \"the remote calculator service is unavailable. should have kept your trusty HP.\") 0 &#125;&#125; finally &#123; remoteCalculatorService.close()&#125; è¿™å¹¶ä¸æ˜¯ä¸€ä¸ªå®Œç¾ç¼–ç¨‹é£æ ¼çš„å±•ç¤ºï¼Œè€Œåªæ˜¯ä¸€ä¸ªä¾‹å­ï¼Œç”¨æ¥è¯´æ˜ try-catch-finally å’Œ Scala ä¸­å…¶ä»–å¤§éƒ¨åˆ†äº‹ç‰©ä¸€æ ·æ˜¯è¡¨è¾¾å¼ã€‚ å½“ä¸€ä¸ªå¼‚å¸¸è¢«æ•è·å¤„ç†äº†ï¼Œfinally å—å°†è¢«è°ƒç”¨ï¼›å®ƒä¸æ˜¯è¡¨è¾¾å¼çš„ä¸€éƒ¨åˆ†ã€‚","categories":[],"tags":[]},{"title":"Scala æ€»è§ˆ","slug":"scala-overview","date":"2019-11-30T13:26:36.000Z","updated":"2020-05-04T07:02:57.428Z","comments":true,"path":"2019/11/30/scala-overview/","link":"","permalink":"https://razertory.me/2019/11/30/scala-overview/","excerpt":"","text":"Why Scala JVM ç”Ÿæ€ ç®€æ´ ç±»å‹æ¨æ–­ å‡½æ•°å¼ å¤šèŒƒå¼ Actor ä¸‹é¢çš„æ‰€æœ‰æ“ä½œéƒ½åœ¨ Scala REPL ä¸­è¿›è¡Œ è¡¨è¾¾å¼12scala&gt; 1 + 1res0: Int = 2 res0 æ˜¯è§£é‡Šå™¨è‡ªåŠ¨åˆ›å»ºçš„å˜é‡åç§°ï¼Œç”¨æ¥æŒ‡ä»£è¡¨è¾¾å¼çš„è®¡ç®—ç»“æœã€‚å®ƒæ˜¯ Int ç±»å‹ï¼Œå€¼ä¸º 2ã€‚æ„å‘³ç€ä½ å¯ä»¥ç»§ç»­ä½¿ç”¨è¿™ä¸ªå˜é‡ã€‚ 12scala&gt; res0 + 1res1: Int = 3 Scala ä¸­ï¼ˆå‡ ä¹ï¼‰ä¸€åˆ‡éƒ½æ˜¯è¡¨è¾¾å¼ã€‚ å€¼ (val) å’Œå˜é‡ (var)ä½ å¯ä»¥ç»™ä¸€ä¸ªè¡¨è¾¾å¼çš„ç»“æœèµ·ä¸ªåå­—èµ‹æˆä¸€ä¸ªä¸å˜é‡ï¼ˆvalï¼‰ã€‚ 12345scala&gt; val two = 1 + 1two: Int = 2scala&gt; two = 3 ^ error: reassignment to val ä½ ä¸èƒ½æ”¹å˜è¿™ä¸ªä¸å˜é‡çš„å€¼ï¼Œä½†å¦‚æœæ˜¯ var å£°æ˜çš„å°±å¯ä»¥æ”¹å˜ã€‚ å‡½æ•°ä½ å¯ä»¥ä½¿ç”¨ def åˆ›å»ºå‡½æ•°ã€‚ 12scala&gt; def addOne(m: Int): Int = m + 1addOne: (m: Int)Int ä½ å¯ä»¥åˆ›å»ºåŒ¿åå‡½æ•°ã€‚ 12scala&gt; (x: Int) =&gt; x + 1res2: (Int) =&gt; Int = &lt;function1&gt; ä½ å¯ä»¥æŠŠåŒ¿åå‡½æ•°èµ‹å€¼ç»™ valã€‚ 12345scala&gt; val addOne = (x: Int) =&gt; x + 1addOne: (Int) =&gt; Int = &lt;function1&gt;scala&gt; addOne(1)res4: Int = 2 ä½ å¯ä»¥éƒ¨åˆ†åº”ç”¨ä¸€ä¸ªå‡½æ•° 123456789scala&gt; def adder(m: Int, n: Int) = m + nadder: (m: Int,n: Int)Int// ä½ å¯ä»¥ã€Œéƒ¨åˆ†åº”ç”¨ã€å‚æ•°åˆ—è¡¨ä¸­çš„ä»»æ„å‚æ•°ï¼Œè€Œä¸ä»…ä»…æ˜¯æœ€åä¸€ä¸ªã€‚scala&gt; val add2 = adder(2, _:Int) add2: (Int) =&gt; Int = &lt;function1&gt;scala&gt; add2(3)res50: Int = 5 ä½ å¯ä»¥æŸ¯é‡ŒåŒ–å‡½æ•° (Currying Function) 1234567891011121314151617scala&gt; def multiply(m: Int)(n: Int): Int = m * nmultiply: (m: Int)(n: Int)Int//ä½ å¯ä»¥ç›´æ¥ä¼ å…¥ä¸¤ä¸ªå‚æ•°ã€‚scala&gt; multiply(2)(3)res0: Int = 6//ä½ å¯ä»¥å¡«ä¸Šç¬¬ä¸€ä¸ªå‚æ•°å¹¶ä¸”éƒ¨åˆ†åº”ç”¨ç¬¬äºŒä¸ªå‚æ•°ã€‚scala&gt; val timesTwo = multiply(2) _timesTwo: (Int) =&gt; Int = &lt;function1&gt;scala&gt; timesTwo(3)res1: Int = 6// ä½ å¯ä»¥å¯¹ä»»ä½•å¤šå‚æ•°å‡½æ•°æ‰§è¡ŒæŸ¯é‡ŒåŒ– (`.curried`)scala&gt; (adder _).curriedres1: (Int) =&gt; (Int) =&gt; Int = &lt;function1&gt; ä½ å¯ä»¥å‚æ•°å¯å˜å‚æ•°å‡½æ•° 12345678def capitalizeAll(args: String*) = &#123; args.map &#123; arg =&gt; arg.capitalize &#125;&#125;scala&gt; capitalizeAll(\"rarity\", \"applejack\")res2: Seq[String] = ArrayBuffer(Rarity, Applejack) OOPç±»ã€ç»§æ‰¿å’Œ Java æ¯”è¾ƒç±»ä¼¼ã€‚é¢å¤–çš„ Scala è¿˜å¼•å…¥äº† traitã€‚å®ç°ç±»ä¼¼äº Rubyã€Python è¿™æ ·çš„åŠ¨æ€è¯­è¨€çš„ mix-in object å…³é”®å­— å’Œ apply() æ–¹æ³•ã€‚æ–¹ä¾¿å®ç° single instance case classã€‚ä¸ºæ–¹ä¾¿å­˜æ”¾å€¼å’Œæ¨¡å¼åŒ¹é…å¼•å…¥äº† Trait 1234567891011121314151617// trait æ˜¯ä¸€äº›å­—æ®µå’Œè¡Œä¸ºçš„é›†åˆï¼Œå¯ä»¥æ‰©å±•æˆ–æ··å…¥ï¼ˆ`mixin`ï¼‰ä½ çš„ç±»ä¸­ã€‚trait Car &#123; val brand: String&#125;trait Shiny &#123; val shineRefraction: Int&#125;class BMW extends Car &#123; val brand = \"BMW\"&#125;// é€šè¿‡ with å…³é”®å­—ï¼Œä¸€ä¸ªç±»å¯ä»¥æ‰©å±•å¤šä¸ª traitï¼šclass BMW extends Car with Shiny &#123; val brand = \"BMW\" val shineRefraction = 12&#125; object 123456789101112131415161718// object å®ç° single instanceobject Timer &#123; var count = 0 def currentCount(): Long = &#123; count += 1 count &#125;&#125;// ä¸å¿…å†ç”¨ new å…³é”®å­—scala&gt; Timer.currentCount()res0: Long = 1// Companion Objec ä¼´ç”Ÿå¯¹è±¡ï¼Œç”¨æ¥ç»™ object åˆå§‹åŒ–å€¼class Bar(foo: String)object Bar &#123; def apply(foo: String) = new Bar(foo)&#125; case class 12345678case class Calculator(brand: String, model: String)def calcType(calc: Calculator) = calc match &#123; case Calculator(\"HP\", \"20B\") =&gt; \"financial\" case Calculator(\"HP\", \"48G\") =&gt; \"scientific\" case Calculator(\"HP\", \"30B\") =&gt; \"business\" case Calculator(_, _) =&gt; \"Calculator: %s %s is of unknown type\".format(ourBrand, ourModel) case _ =&gt; \"Not a calculator\"&#125;","categories":[],"tags":[]},{"title":"å®Œç¾çš„äºŒåˆ†æœç´¢","slug":"binary-search","date":"2019-11-28T14:45:06.000Z","updated":"2020-03-28T13:02:10.014Z","comments":true,"path":"2019/11/28/binary-search/","link":"","permalink":"https://razertory.me/2019/11/28/binary-search/","excerpt":"","text":"å‡è®¾ç»™ä¸€ä¸ªæœ‰åºçš„ int ç±»å‹çš„æ•°ç»„ arrï¼Œå’Œä¸€ä¸ªç›®æ ‡å€¼ targetï¼Œæ‰¾åˆ°è¿™ä¸ªç›®æ ‡å€¼åœ¨æ•°ç»„ä¸­çš„ä¸‹æ ‡ã€‚å¦‚æœæ•°ç»„ä¸­æ²¡æœ‰target è¿”å› -1ã€‚ 12345678910111213int search(int[] arr, int target) &#123; int start = 0, end = arr.length - 1; while (start &lt;= end) &#123; int mid = start + (end - start) / 2; // éœ€è¦æ³¨æ„ç”¨ (start + end) / 2 åœ¨æ•°å­¦ä¸Šæ²¡æœ‰é—®é¢˜ã€‚ä½†æ˜¯è€ƒè™‘åˆ° start + end å¯èƒ½ä¼šæº¢å‡ºã€‚ if (target == arr[mid]) return mid; else if (target &lt; arr[mid]) end = mid - 1; else start + mid + 1; &#125; return -1;&#125;","categories":[],"tags":[]},{"title":"æ±‰æ˜è·ç¦»","slug":"hamming-distance","date":"2019-11-17T02:46:03.000Z","updated":"2020-03-28T13:02:10.013Z","comments":true,"path":"2019/11/17/hamming-distance/","link":"","permalink":"https://razertory.me/2019/11/17/hamming-distance/","excerpt":"","text":"ä¸¤ä¸ªæ•´æ•°ä¹‹é—´çš„æ±‰æ˜è·ç¦»æŒ‡çš„æ˜¯è¿™ä¸¤ä¸ªæ•°å­—å¯¹åº”äºŒè¿›åˆ¶ä½ä¸åŒçš„ä½ç½®çš„æ•°ç›®ã€‚ç»™å‡ºä¸¤ä¸ªæ•´æ•° x å’Œ yï¼Œè®¡ç®—å®ƒä»¬ä¹‹é—´çš„æ±‰æ˜è·ç¦»ã€‚ 1int hammingDistance(int x, int y) å¯¹äº x, å’Œ y å…ˆè¿›è¡Œå¼‚æˆ–ï¼Œç„¶åå†è®¡ç®—ç»“æœä¸­çš„ 1 çš„ä¸ªæ•°å³å¯ã€‚ï¼ˆå…¶ä¸­ count ç®—æ³•æ¥è‡ª äºŒè¿›åˆ¶ä¸­ 1 çš„ä¸ªæ•°ï¼‰ 1234int hammingDistance(int x, int y) &#123; int n = x ^ y; return count(n); &#125;","categories":[],"tags":[]},{"title":"åªå‡ºç°ä¸€æ¬¡çš„æ•°","slug":"single-number","date":"2019-11-17T02:31:09.000Z","updated":"2020-03-28T13:02:10.013Z","comments":true,"path":"2019/11/17/single-number/","link":"","permalink":"https://razertory.me/2019/11/17/single-number/","excerpt":"","text":"ç»™å®šä¸€ä¸ªéç©ºæ•´æ•°æ•°ç»„ï¼Œé™¤äº†æŸä¸ªå…ƒç´ åªå‡ºç°ä¸€æ¬¡ä»¥å¤–ï¼Œå…¶ä½™æ¯ä¸ªå…ƒç´ å‡å‡ºç°ä¸¤æ¬¡ã€‚æ‰¾å‡ºé‚£ä¸ªåªå‡ºç°äº†ä¸€æ¬¡çš„å…ƒç´ ã€‚ 1int singleNumber(int[] nums) è®¡ç®—æœºç§‘å­¦ä¸­ï¼Œå¼‚æˆ–æ»¡è¶³å››å¤§å®šå¾‹ 12341.æ’å®šå¾‹ï¼šA ^ 0 = A2.å½’é›¶ç‡ï¼šA ^ A = 03.äº¤æ¢å¾‹ï¼šA ^ B = B ^ A4.ç»“åˆå¾‹ï¼š(A ^ B) ^ C = A ^ (B ^ C) å‡å¦‚ç»™å®šçš„æ•°ç»„æ˜¯ [1, 3, 1, 3, 2, 4, 4]ã€‚æ ¹æ®å¼‚æˆ–çš„å®šå¾‹ï¼Œå¯¹æ•°ç»„ä»å¤´åˆ°å°¾è¿›è¡Œå¼‚æˆ–å¯ä»¥ç­‰ä»·æˆåˆ†ç»„ä¹‹åçš„å¼‚æˆ–ï¼Œè¿™é‡Œå¯ä»¥ç†è§£æˆ [1, 1, 2, 3, 3, 4, 4]ã€‚ç›¸åŒçš„æ•°éƒ½ä¼šå˜ä¸º 0 ï¼Œæœ€åå‰©ä¸‹çš„é‚£ä¸ªæ•°ä¹Ÿå°±å’Œ 0 è¿›è¡Œå¼‚æˆ–ç­‰åˆ°è‡ªå·±æœ¬èº«ã€‚ 1234567int singleNumber(int[] nums) &#123; int result = 0; for (int num : nums) &#123; result ^= num; &#125; return result;&#125;","categories":[],"tags":[]},{"title":"ä¸ªæ•°å¤šäºä¸€åŠçš„æ•°","slug":"major-element","date":"2019-11-16T12:08:11.000Z","updated":"2020-03-28T13:02:10.013Z","comments":true,"path":"2019/11/16/major-element/","link":"","permalink":"https://razertory.me/2019/11/16/major-element/","excerpt":"","text":"ç»™å®šä¸€ä¸ªå¤§å°ä¸º n çš„æ•°ç»„ï¼Œæ‰¾å‡ºå…¶ä¸­åœ¨æ•°ç»„ä¸­å‡ºç°æ¬¡æ•°å¤§äº âŒŠ n/2 âŒ‹ çš„å…ƒç´ ï¼ˆä¼—æ•°ï¼‰ã€‚ 1int majorityElement(int[] nums) ç†è§£è¿™ä¸ªé—®é¢˜ï¼Œé¦–å…ˆå¯ä»¥æŠŠæ•°ç»„åˆ†ä¸ºä¸¤ä¸ªéƒ¨åˆ†ï¼šæ‰€æœ‰çš„ä¼—æ•°å’Œéä¼—æ•°ã€‚æŠŠä¼—æ•°å’Œéä¼—æ•°è¿›è¡Œä¸¤ä¸¤æŠµæ¶ˆï¼Œé‚£ä¹ˆæœ€åä¸€å®šè¿˜å‰©ä¸‹ä¼—æ•°ã€‚å®é™…ä¸Šè¿™ä¸ªä¹Ÿå°±æ˜¯æ‘©å°”æŠ•ç¥¨æ³•ã€‚åœ¨éå†æ•°ç»„çš„æ—¶å€™ä¸æ–­ç¡®è®¤å½“å‰çš„ä¼—æ•°ï¼Œå¦‚æœæ²¡æœ‰ï¼Œåˆ™è®¤ä¸ºä¸‹ä¸€ä¸ªå°±æ˜¯ã€‚ç»´æŠ¤ä¸€ä¸ªè®¡æ•°å™¨ï¼Œåœ¨é‡åˆ°ç›¸åŒçš„æ—¶å€™ç»™ä¼—æ•° +1ï¼Œä¸åŒçš„æ—¶å€™ -1ã€‚å½“è®¡æ•°å™¨ä¸º 0 çš„æ—¶å€™è®¤ä¸ºæ²¡æœ‰ä¼—æ•°ã€‚ 12345678910111213int majorityElement(int[] nums) &#123; int count = 0; Integer candidate = null; for (int num : nums) &#123; if (count == 0) &#123; candidate = num; &#125; count += (num == candidate) ? 1 : -1; &#125; return candidate;&#125;","categories":[],"tags":[]},{"title":"äºŒè¿›åˆ¶ä¸­ 1 çš„ä¸ªæ•°","slug":"count-of-one","date":"2019-11-14T01:42:44.000Z","updated":"2020-03-28T13:02:10.013Z","comments":true,"path":"2019/11/14/count-of-one/","link":"","permalink":"https://razertory.me/2019/11/14/count-of-one/","excerpt":"","text":"å¯¹äºä»»æ„æ•´æ•°ï¼Œæ±‚è½¬æ¢æˆäºŒè¿›åˆ¶æ•°ä¹‹åï¼Œ1 çš„ä¸ªæ•°ã€‚æ¯”å¦‚ 5 è½¬æ¢æˆäºŒè¿›åˆ¶æ˜¯ 101ï¼Œå…¶ä¸­ 1 çš„ä¸ªæ•°æ˜¯ 2ã€‚ 1int count (int num) è¦åˆ¤æ–­ä¸€ä¸ªäºŒè¿›åˆ¶æ•°çš„æœ€ä½ä½æ˜¯å¦æ˜¯ 1ï¼Œåªéœ€è¦å’Œ 1 è¿›è¡Œ &amp; è¿ç®—å³å¯ã€‚é‚£ä¹ˆå…·ä½“çš„åšæ³•å°±ä¸€è¾¹ç§»ä½ä¸€è¾¹ç»Ÿè®¡ã€‚ 12345678int count (int num) &#123; int count = 0; while(num != 0) &#123; if (num &amp; 1 == 1) count++; num &gt;&gt; 1; &#125; return count;&#125;","categories":[],"tags":[]},{"title":"ä½è¿ç®—å®ç°åŠ æ³•","slug":"add-by-bit","date":"2019-11-11T14:56:31.000Z","updated":"2020-03-28T13:02:10.013Z","comments":true,"path":"2019/11/11/add-by-bit/","link":"","permalink":"https://razertory.me/2019/11/11/add-by-bit/","excerpt":"","text":"è®¡ç®—æœºç§‘å­¦ä¸­ï¼ŒåŸºç¡€è¿ç®—è¿ç®—éƒ½æ¥è‡ªäºäºŒè¿›åˆ¶ä¸­çš„ä½è¿ç®—ã€‚å…¶ä¸­ä¸å…æåˆ°åŠ æ³•å™¨ï¼Œç»´åŸºç™¾ç§‘æ˜¯è¿™ä¹ˆå®šä¹‰çš„ åœ¨ç”µå­å­¦ä¸­ï¼ŒåŠ æ³•å™¨ï¼ˆè‹±è¯­ï¼šadderï¼‰æ˜¯ä¸€ç§ç”¨äºæ‰§è¡ŒåŠ æ³•è¿ç®—çš„æ•°å­—ç”µè·¯éƒ¨ä»¶ï¼Œæ˜¯æ„æˆç”µå­è®¡ç®—æœºæ ¸å¿ƒå¾®å¤„ç†å™¨ä¸­ç®—æœ¯é€»è¾‘å•å…ƒçš„åŸºç¡€ã€‚åœ¨è¿™äº›ç”µå­ç³»ç»Ÿä¸­ï¼ŒåŠ æ³•å™¨ä¸»è¦è´Ÿè´£è®¡ç®—åœ°å€ã€ç´¢å¼•ç­‰æ•°æ®ã€‚é™¤æ­¤ä¹‹å¤–ï¼ŒåŠ æ³•å™¨ä¹Ÿæ˜¯å…¶ä»–ä¸€äº›ç¡¬ä»¶ï¼Œä¾‹å¦‚äºŒè¿›åˆ¶æ•°çš„ä¹˜æ³•å™¨çš„é‡è¦ç»„æˆéƒ¨åˆ†ã€‚å°½ç®¡å¯ä»¥ä¸ºä¸åŒè®¡æ•°ç³»ç»Ÿè®¾è®¡ä¸“é—¨çš„åŠ æ³•å™¨ï¼Œä½†æ˜¯ç”±äºæ•°å­—ç”µè·¯é€šå¸¸ä»¥äºŒè¿›åˆ¶ä¸ºåŸºç¡€ï¼Œå› æ­¤äºŒè¿›åˆ¶åŠ æ³•å™¨åœ¨å®é™…åº”ç”¨ä¸­æœ€ä¸ºæ™®éã€‚åœ¨æ•°å­—ç”µè·¯ä¸­ï¼ŒäºŒè¿›åˆ¶æ•°çš„å‡æ³•å¯ä»¥é€šè¿‡åŠ ä¸€ä¸ªè´Ÿæ•°æ¥é—´æ¥å®Œæˆã€‚ä¸ºäº†ä½¿è´Ÿæ•°çš„è®¡ç®—èƒ½å¤Ÿç›´æ¥ç”¨åŠ æ³•å™¨æ¥å®Œæˆï¼Œè®¡ç®—ä¸­çš„è´Ÿæ•°å¯ä»¥ä½¿ç”¨äºŒè¡¥æ•°ï¼ˆè¡¥ç ï¼‰æ¥è¡¨ç¤ºï¼Œå…·ä½“çš„ç»†èŠ‚å¯ä»¥å‚è€ƒæ•°å­—ç”µè·¯ç›¸å…³çš„ä¹¦ç± å¯¹ä¸¤ä¸ªäºŒè¿›åˆ¶æ•°åšç›¸åŠ ï¼Œæœ‰ä»¥ä¸‹è§„å¾‹ äºŒè¿›åˆ¶åŠ æ³• x y å’Œ è¿›ä½ 0 0 0 0 0 1 1 0 1 0 1 0 1 1 0 1 å‡è®¾ x + y ç›¸åŠ ç”¨ä»£ç è¡¨ç¤ºï¼Œé‚£ä¹ˆå°±éœ€è¦ä¸€ä¸ª sum å’Œ carry åˆ†åˆ«è¡¨ç¤ºå’Œä¸è¿›ä½ã€‚ä¸è¿‡è¿™ä¸ªè¿˜ä¸è¶³å¤Ÿè¡¨ç¤ºä¸¤ä¸ªæ•°ç›¸åŠ ã€‚ ä»”ç»†è§‚å¯Ÿå¯ä»¥å‘ç° x + y çš„ sum å’Œ carry å…¶å®åˆ†åˆ«æ˜¯å¼‚æˆ–^å’Œä¸&amp;è¿ç®—ã€‚å¦‚ä¸‹ï¼š å¼‚æˆ– x y ^ 0 0 0 0 1 1 1 0 1 1 1 0 ä¸ x y &amp; 0 0 0 0 1 0 1 0 0 1 1 1 123456789101112// äºŒè¿›åˆ¶å®ç°åŠ æ³•int add(int a, int b) &#123; int sum = a; int carry = b; while(carry != 0 ) &#123; int tmps = sum; sum = tmps ^ carry; carry = (tmps &amp; carry) &lt;&lt; 1; &#125; return sum;&#125;","categories":[],"tags":[]},{"title":"æ‹¬å·çš„åˆæ³•åºåˆ—","slug":"valid-brackets","date":"2019-11-10T01:55:10.000Z","updated":"2020-03-28T13:02:10.012Z","comments":true,"path":"2019/11/10/valid-brackets/","link":"","permalink":"https://razertory.me/2019/11/10/valid-brackets/","excerpt":"","text":"ç»™ä½ ä¸€ä¸ªæ‹¬å·åºåˆ—ï¼Œé‡Œé¢åŒ…å«å°æ‹¬å·ï¼Œä¸­æ‹¬å·å’Œå¤§æ‹¬å·ã€‚ä½ è¦åˆ¤æ–­è¿™ä¸ªæ‹¬å·åºåˆ—æ˜¯å¦æœ‰æ•ˆã€‚æœ‰æ•ˆçš„æ‹¬å·åºåˆ—è¦æ±‚ï¼Œæ¯ä¸ªå·¦æ‹¬å·éƒ½å¿…é¡»æœ‰ä¸€ä¸ªåŒç±»çš„å³æ‹¬å·ä¸å®ƒæ­£ç¡®é…å¯¹ã€‚å¦å¤–ï¼Œç©ºå­—ç¬¦ä¸²è®¤ä¸ºæ˜¯æœ‰æ•ˆçš„æ‹¬å·åºåˆ—ã€‚ 1234567891011æ¯”å¦‚è¯´ï¼Œç»™ä½ çš„åºåˆ—æ˜¯ï¼š()[]&#123;&#125;å°æ‹¬å·/ä¸­æ‹¬å·/å¤§æ‹¬å·çš„å·¦å³æ‹¬å·éƒ½èƒ½æ­£ç¡®é…å¯¹ï¼Œå› æ­¤è¿™æ˜¯ä¸€ä¸ªæœ‰æ•ˆçš„æ‹¬å·åºåˆ—ã€‚å†æ¯”å¦‚è¯´ç»™ä½ çš„åºåˆ—æ˜¯ï¼š([)]è¿™é‡Œé¢è™½ç„¶æ­£å¥½æœ‰ä¸€å¯¹å°æ‹¬å·å’Œä¸€å¯¹ä¸­æ‹¬å·ï¼Œä½†å®ƒä»¬çš„é¡ºåºä¸å¯¹ï¼Œæ‹¬å·é—´æ— æ³•æ­£ç¡®é…å¯¹ï¼Œå› æ­¤è¿™ä¸æ˜¯ä¸€ä¸ªæœ‰æ•ˆçš„æ‹¬å·åºåˆ— 1public boolean isValidBrackets(String s) &#123; ç»´æŠ¤ä¸€ä¸ª stackï¼Œå­˜æ”¾ charã€‚åœ¨éå† s çš„è¿‡ç¨‹ä¸­ï¼Œä¸æ–­å¯¹é‡åˆ°å·¦æ‹¬å·è¿›è¡Œ pushï¼Œå³æ‹¬å·è¿›è¡Œ popã€‚å½“æœ€å stack ä¸ºç©ºçš„æ—¶å€™è¯´æ˜æ˜¯åˆæ³•çš„æ‹¬å·åºåˆ—. 1234567891011121314151617public boolean isValidBrackets(String s) &#123; Stack&lt;Character&gt; stack = new Stack&lt;&gt;(); for (int i = 0; i &lt; s.length(); ++i) &#123; if (s.charAt(i) == '(' || s.charAt(i) == '[' || s.charAt(i) == '&#123;') &#123; stack.push(s.charAt(i)); &#125; else if (stack.isEmpty()) &#123; return false; &#125; else &#123; if (s.charAt(i) == ')' &amp;&amp; stack.peek() != '(') return false; if (s.charAt(i) == ']' &amp;&amp; stack.peek() != '[') return false; if (s.charAt(i) == '&#125;' &amp;&amp; stack.peek() != '&#123;') return false; stack.pop(); &#125; &#125; return stack.isEmpty(); &#125;","categories":[],"tags":[]},{"title":"æ ˆå®ç°é˜Ÿåˆ—","slug":"queue-by-stack","date":"2019-11-10T01:45:31.000Z","updated":"2020-03-28T13:02:10.012Z","comments":true,"path":"2019/11/10/queue-by-stack/","link":"","permalink":"https://razertory.me/2019/11/10/queue-by-stack/","excerpt":"","text":"ç»´æŠ¤ä¸€ä¸ª inï¼Œout æ ˆè¡¨ç¤ºè¿›å‡ºé¡ºåºï¼Œå®ç°ä¸€ä¸ªä» in åˆ° out çš„è½¬ç§»æ–¹æ³•ã€‚ 1234567891011121314151617181920212223242526272829303132333435class MyQueue &#123; private Stack&lt;Integer&gt; in, out; MyQueue() &#123; in = new Stack&lt;&gt;(); out = new Stack&lt;&gt;(); &#125; void push(int val) &#123; in.push(val); &#125; int pop() &#123; transferIfEmpty(); return out.pop(); &#125; int peek() &#123; transferIfEmpty(); return out.peek(); &#125; boolean isEmpty() &#123; return in.isEmpty() &amp;&amp; out.empty(); &#125; private void transferIfEmpty() &#123; if(out.empty()) &#123; while(!in.empty()) &#123; out.push(in.pop()); &#125; &#125; &#125;&#125;","categories":[],"tags":[]},{"title":"uber-go-guide","slug":"uber-go-guide-cn","date":"2019-11-08T00:04:22.000Z","updated":"2020-03-28T13:02:10.012Z","comments":true,"path":"2019/11/08/uber-go-guide-cn/","link":"","permalink":"https://razertory.me/2019/11/08/uber-go-guide-cn/","excerpt":"","text":"æœ¬æ–‡é•¿æœŸç»´æŠ¤åœ°å€: https://github.com/xxjwxc/uber_go_guide_cn Uber Go è¯­è¨€ç¼–ç è§„èŒƒ Uber æ˜¯ä¸€å®¶ç¾å›½ç¡…è°·çš„ç§‘æŠ€å…¬å¸ï¼Œä¹Ÿæ˜¯ Go è¯­è¨€çš„æ—©æœŸ adopterã€‚å…¶å¼€æºäº†å¾ˆå¤š golang é¡¹ç›®ï¼Œè¯¸å¦‚è¢« Gopher åœˆç†ŸçŸ¥çš„ zapã€jaeger ç­‰ã€‚2018 å¹´å¹´æœ« Uber å°†å†…éƒ¨çš„ Go é£æ ¼è§„èŒƒ å¼€æºåˆ° GitHubï¼Œç»è¿‡ä¸€å¹´çš„ç§¯ç´¯å’Œæ›´æ–°ï¼Œè¯¥è§„èŒƒå·²ç»åˆå…·è§„æ¨¡ï¼Œå¹¶å—åˆ°å¹¿å¤§ Gopher çš„å…³æ³¨ã€‚æœ¬æ–‡æ˜¯è¯¥è§„èŒƒçš„ä¸­æ–‡ç‰ˆæœ¬ã€‚æœ¬ç‰ˆæœ¬ä¼šæ ¹æ®åŸç‰ˆå®æ—¶æ›´æ–°ã€‚ ç‰ˆæœ¬ å½“å‰æ›´æ–°ç‰ˆæœ¬ï¼š2019-11-01 ç‰ˆæœ¬åœ°å€ï¼šcommit:#68 å¦‚æœæ‚¨å‘ç°ä»»ä½•æ›´æ–°ã€é—®é¢˜æˆ–æ”¹è¿›ï¼Œè¯·éšæ—¶ fork å’Œ PR Please feel free to fork and PR if you find any updates, issues or improvement. ç›®å½• ä»‹ç» æŒ‡å¯¼åŸåˆ™ æŒ‡å‘ interface çš„æŒ‡é’ˆ æ¥æ”¶å™¨ (receiver) ä¸æ¥å£ é›¶å€¼ Mutex æ˜¯æœ‰æ•ˆçš„ åœ¨è¾¹ç•Œå¤„æ‹·è´ Slices å’Œ Maps ä½¿ç”¨ defer é‡Šæ”¾èµ„æº Channel çš„ size è¦ä¹ˆæ˜¯ 1ï¼Œè¦ä¹ˆæ˜¯æ— ç¼“å†²çš„ æšä¸¾ä» 1 å¼€å§‹ é”™è¯¯ç±»å‹ é”™è¯¯åŒ…è£… (Error Wrapping) å¤„ç†ç±»å‹æ–­è¨€å¤±è´¥ ä¸è¦ panic ä½¿ç”¨ go.uber.org/atomic æ€§èƒ½ ä¼˜å…ˆä½¿ç”¨ strconv è€Œä¸æ˜¯ fmt é¿å…å­—ç¬¦ä¸²åˆ°å­—èŠ‚çš„è½¬æ¢ å°½é‡åˆå§‹åŒ–æ—¶æŒ‡å®š Map å®¹é‡ è§„èŒƒ ä¸€è‡´æ€§ ç›¸ä¼¼çš„å£°æ˜æ”¾åœ¨ä¸€ç»„ import åˆ†ç»„ åŒ…å å‡½æ•°å å¯¼å…¥åˆ«å å‡½æ•°åˆ†ç»„ä¸é¡ºåº å‡å°‘åµŒå¥— ä¸å¿…è¦çš„ else é¡¶å±‚å˜é‡å£°æ˜ å¯¹äºæœªå¯¼å‡ºçš„é¡¶å±‚å¸¸é‡å’Œå˜é‡ï¼Œä½¿ç”¨_ä½œä¸ºå‰ç¼€ ç»“æ„ä½“ä¸­çš„åµŒå…¥ ä½¿ç”¨å­—æ®µååˆå§‹åŒ–ç»“æ„ä½“ æœ¬åœ°å˜é‡å£°æ˜ nil æ˜¯ä¸€ä¸ªæœ‰æ•ˆçš„ slice å°å˜é‡ä½œç”¨åŸŸ é¿å…å‚æ•°è¯­ä¹‰ä¸æ˜ç¡®ï¼ˆAvoid Naked Parametersï¼‰ ä½¿ç”¨åŸå§‹å­—ç¬¦ä¸²å­—é¢å€¼ï¼Œé¿å…è½¬ä¹‰ åˆå§‹åŒ– Struct å¼•ç”¨ åˆå§‹åŒ– Maps å­—ç¬¦ä¸² string format å‘½å Printf æ ·å¼çš„å‡½æ•° ç¼–ç¨‹æ¨¡å¼ è¡¨é©±åŠ¨æµ‹è¯• åŠŸèƒ½é€‰é¡¹ ä»‹ç»æ ·å¼ (style) æ˜¯æ”¯é…æˆ‘ä»¬ä»£ç çš„æƒ¯ä¾‹ã€‚æœ¯è¯­æ ·å¼æœ‰ç‚¹ç”¨è¯ä¸å½“ï¼Œå› ä¸ºè¿™äº›çº¦å®šæ¶µç›–çš„èŒƒå›´ä¸é™äºç”± gofmt æ›¿æˆ‘ä»¬å¤„ç†çš„æºæ–‡ä»¶æ ¼å¼ã€‚ æœ¬æŒ‡å—çš„ç›®çš„æ˜¯é€šè¿‡è¯¦ç»†æè¿°åœ¨ Uber ç¼–å†™ Go ä»£ç çš„æ³¨æ„äº‹é¡¹æ¥ç®¡ç†è¿™ç§å¤æ‚æ€§ã€‚è¿™äº›è§„åˆ™çš„å­˜åœ¨æ˜¯ä¸ºäº†ä½¿ä»£ç åº“æ˜“äºç®¡ç†ï¼ŒåŒæ—¶ä»ç„¶å…è®¸å·¥ç¨‹å¸ˆæ›´æœ‰æ•ˆåœ°ä½¿ç”¨ Go è¯­è¨€åŠŸèƒ½ã€‚ è¯¥æŒ‡å—æœ€åˆç”± Prashant Varanasi å’Œ Simon Newton ç¼–å†™ï¼Œç›®çš„æ˜¯ä½¿ä¸€äº›åŒäº‹èƒ½å¿«é€Ÿä½¿ç”¨ Goã€‚å¤šå¹´æ¥ï¼Œè¯¥æŒ‡å—å·²æ ¹æ®å…¶ä»–äººçš„åé¦ˆè¿›è¡Œäº†ä¿®æ”¹ã€‚ æœ¬æ–‡æ¡£è®°å½•äº†æˆ‘ä»¬åœ¨ Uber éµå¾ªçš„ Go ä»£ç ä¸­çš„æƒ¯ç”¨çº¦å®šã€‚å…¶ä¸­è®¸å¤šæ˜¯ Go çš„é€šç”¨å‡†åˆ™ï¼Œè€Œå…¶ä»–æ‰©å±•å‡†åˆ™ä¾èµ–äºä¸‹é¢å¤–éƒ¨çš„æŒ‡å—ï¼š Effective Go The Go common mistakes guide æ‰€æœ‰ä»£ç éƒ½åº”è¯¥é€šè¿‡golintå’Œgo vetçš„æ£€æŸ¥å¹¶æ— é”™è¯¯ã€‚æˆ‘ä»¬å»ºè®®æ‚¨å°†ç¼–è¾‘å™¨è®¾ç½®ä¸ºï¼š ä¿å­˜æ—¶è¿è¡Œ goimports è¿è¡Œ golint å’Œ go vet æ£€æŸ¥é”™è¯¯ æ‚¨å¯ä»¥åœ¨ä»¥ä¸‹ Go ç¼–è¾‘å™¨å·¥å…·æ”¯æŒé¡µé¢ä¸­æ‰¾åˆ°æ›´ä¸ºè¯¦ç»†çš„ä¿¡æ¯ï¼šhttps://github.com/golang/go/wiki/IDEsAndTextEditorPlugins æŒ‡å¯¼åŸåˆ™æŒ‡å‘ interface çš„æŒ‡é’ˆæ‚¨å‡ ä¹ä¸éœ€è¦æŒ‡å‘æ¥å£ç±»å‹çš„æŒ‡é’ˆã€‚æ‚¨åº”è¯¥å°†æ¥å£ä½œä¸ºå€¼è¿›è¡Œä¼ é€’ï¼Œåœ¨è¿™æ ·çš„ä¼ é€’è¿‡ç¨‹ä¸­ï¼Œå®è´¨ä¸Šä¼ é€’çš„åº•å±‚æ•°æ®ä»ç„¶å¯ä»¥æ˜¯æŒ‡é’ˆã€‚ æ¥å£å®è´¨ä¸Šåœ¨åº•å±‚ç”¨ä¸¤ä¸ªå­—æ®µè¡¨ç¤ºï¼š ä¸€ä¸ªæŒ‡å‘æŸäº›ç‰¹å®šç±»å‹ä¿¡æ¯çš„æŒ‡é’ˆã€‚æ‚¨å¯ä»¥å°†å…¶è§†ä¸ºâ€typeâ€ã€‚ æ•°æ®æŒ‡é’ˆã€‚å¦‚æœå­˜å‚¨çš„æ•°æ®æ˜¯æŒ‡é’ˆï¼Œåˆ™ç›´æ¥å­˜å‚¨ã€‚å¦‚æœå­˜å‚¨çš„æ•°æ®æ˜¯ä¸€ä¸ªå€¼ï¼Œåˆ™å­˜å‚¨æŒ‡å‘è¯¥å€¼çš„æŒ‡é’ˆã€‚ å¦‚æœå¸Œæœ›æ¥å£æ–¹æ³•ä¿®æ”¹åŸºç¡€æ•°æ®ï¼Œåˆ™å¿…é¡»ä½¿ç”¨æŒ‡é’ˆä¼ é€’ã€‚ æ¥æ”¶å™¨ (receiver) ä¸æ¥å£ä½¿ç”¨å€¼æ¥æ”¶å™¨çš„æ–¹æ³•æ—¢å¯ä»¥é€šè¿‡å€¼è°ƒç”¨ï¼Œä¹Ÿå¯ä»¥é€šè¿‡æŒ‡é’ˆè°ƒç”¨ã€‚ ä¾‹å¦‚ï¼Œ 12345678910111213141516171819202122232425type S struct &#123; data string&#125;func (s S) Read() string &#123; return s.data&#125;func (s *S) Write(str string) &#123; s.data = str&#125;sVals := map[int]S&#123;1: &#123;\"A\"&#125;&#125;// ä½ åªèƒ½é€šè¿‡å€¼è°ƒç”¨ ReadsVals[1].Read()// è¿™ä¸èƒ½ç¼–è¯‘é€šè¿‡ï¼š// sVals[1].Write(\"test\")sPtrs := map[int]*S&#123;1: &#123;\"A\"&#125;&#125;// é€šè¿‡æŒ‡é’ˆæ—¢å¯ä»¥è°ƒç”¨ Readï¼Œä¹Ÿå¯ä»¥è°ƒç”¨ Write æ–¹æ³•sPtrs[1].Read()sPtrs[1].Write(\"test\") åŒæ ·ï¼Œå³ä½¿è¯¥æ–¹æ³•å…·æœ‰å€¼æ¥æ”¶å™¨ï¼Œä¹Ÿå¯ä»¥é€šè¿‡æŒ‡é’ˆæ¥æ»¡è¶³æ¥å£ã€‚ 123456789101112131415161718192021222324type F interface &#123; f()&#125;type S1 struct&#123;&#125;func (s S1) f() &#123;&#125;type S2 struct&#123;&#125;func (s *S2) f() &#123;&#125;s1Val := S1&#123;&#125;s1Ptr := &amp;S1&#123;&#125;s2Val := S2&#123;&#125;s2Ptr := &amp;S2&#123;&#125;var i Fi = s1Vali = s1Ptri = s2Ptr// ä¸‹é¢ä»£ç æ— æ³•é€šè¿‡ç¼–è¯‘ã€‚å› ä¸º s2Val æ˜¯ä¸€ä¸ªå€¼ï¼Œè€Œ S2 çš„ f æ–¹æ³•ä¸­æ²¡æœ‰ä½¿ç”¨å€¼æ¥æ”¶å™¨// i = s2Val Effective Go ä¸­æœ‰ä¸€æ®µå…³äº pointers vs. values çš„ç²¾å½©è®²è§£ã€‚ é›¶å€¼ Mutex æ˜¯æœ‰æ•ˆçš„é›¶å€¼ sync.Mutex å’Œ sync.RWMutex æ˜¯æœ‰æ•ˆçš„ã€‚æ‰€ä»¥æŒ‡å‘ mutex çš„æŒ‡é’ˆåŸºæœ¬æ˜¯ä¸å¿…è¦çš„ã€‚ BadGood 12mu := new(sync.Mutex)mu.Lock() 12var mu sync.Mutexmu.Lock() å¦‚æœä½ ä½¿ç”¨ç»“æ„ä½“æŒ‡é’ˆï¼Œmutex å¯ä»¥éæŒ‡é’ˆå½¢å¼ä½œä¸ºç»“æ„ä½“çš„ç»„æˆå­—æ®µï¼Œæˆ–è€…æ›´å¥½çš„æ–¹å¼æ˜¯ç›´æ¥åµŒå…¥åˆ°ç»“æ„ä½“ä¸­ã€‚å¦‚æœæ˜¯ç§æœ‰ç»“æ„ä½“ç±»å‹æˆ–æ˜¯è¦å®ç° Mutex æ¥å£çš„ç±»å‹ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨åµŒå…¥ mutex çš„æ–¹æ³•ï¼š 123456789101112131415161718type smap struct &#123; sync.Mutex // only for unexported typesï¼ˆä»…é€‚ç”¨äºéå¯¼å‡ºç±»å‹ï¼‰ data map[string]string&#125;func newSMap() *smap &#123; return &amp;smap&#123; data: make(map[string]string), &#125;&#125;func (m *smap) Get(k string) string &#123; m.Lock() defer m.Unlock() return m.data[k]&#125; 123456789101112131415161718type SMap struct &#123; mu sync.Mutex // å¯¹äºå¯¼å‡ºç±»å‹ï¼Œè¯·ä½¿ç”¨ç§æœ‰é” data map[string]string&#125;func NewSMap() *SMap &#123; return &amp;SMap&#123; data: make(map[string]string), &#125;&#125;func (m *SMap) Get(k string) string &#123; m.mu.Lock() defer m.mu.Unlock() return m.data[k]&#125; ä¸ºç§æœ‰ç±»å‹æˆ–éœ€è¦å®ç°äº’æ–¥æ¥å£çš„ç±»å‹åµŒå…¥ã€‚ å¯¹äºå¯¼å‡ºçš„ç±»å‹ï¼Œè¯·ä½¿ç”¨ä¸“ç”¨å­—æ®µã€‚ åœ¨è¾¹ç•Œå¤„æ‹·è´ Slices å’Œ Mapsslices å’Œ maps åŒ…å«äº†æŒ‡å‘åº•å±‚æ•°æ®çš„æŒ‡é’ˆï¼Œå› æ­¤åœ¨éœ€è¦å¤åˆ¶å®ƒä»¬æ—¶è¦ç‰¹åˆ«æ³¨æ„ã€‚ æ¥æ”¶ Slices å’Œ Mapsè¯·è®°ä½ï¼Œå½“ map æˆ– slice ä½œä¸ºå‡½æ•°å‚æ•°ä¼ å…¥æ—¶ï¼Œå¦‚æœæ‚¨å­˜å‚¨äº†å¯¹å®ƒä»¬çš„å¼•ç”¨ï¼Œåˆ™ç”¨æˆ·å¯ä»¥å¯¹å…¶è¿›è¡Œä¿®æ”¹ã€‚ Bad Good 123456789func (d *Driver) SetTrips(trips []Trip) &#123; d.trips = trips&#125;trips := ...d1.SetTrips(trips)// ä½ æ˜¯è¦ä¿®æ”¹ d1.trips å—ï¼Ÿtrips[0] = ... 12345678910func (d *Driver) SetTrips(trips []Trip) &#123; d.trips = make([]Trip, len(trips)) copy(d.trips, trips)&#125;trips := ...d1.SetTrips(trips)// è¿™é‡Œæˆ‘ä»¬ä¿®æ”¹ trips[0]ï¼Œä½†ä¸ä¼šå½±å“åˆ° d1.tripstrips[0] = ... è¿”å› slices æˆ– mapsåŒæ ·ï¼Œè¯·æ³¨æ„ç”¨æˆ·å¯¹æš´éœ²å†…éƒ¨çŠ¶æ€çš„ map æˆ– slice çš„ä¿®æ”¹ã€‚ BadGood 123456789101112131415161718type Stats struct &#123; mu sync.Mutex counters map[string]int&#125;// Snapshot è¿”å›å½“å‰çŠ¶æ€ã€‚func (s *Stats) Snapshot() map[string]int &#123; s.mu.Lock() defer s.mu.Unlock() return s.counters&#125;// snapshot ä¸å†å—äº’æ–¥é”ä¿æŠ¤// å› æ­¤å¯¹ snapshot çš„ä»»ä½•è®¿é—®éƒ½å°†å—åˆ°æ•°æ®ç«äº‰çš„å½±å“// å½±å“ stats.counterssnapshot := stats.Snapshot() 12345678910111213141516171819type Stats struct &#123; mu sync.Mutex counters map[string]int&#125;func (s *Stats) Snapshot() map[string]int &#123; s.mu.Lock() defer s.mu.Unlock() result := make(map[string]int, len(s.counters)) for k, v := range s.counters &#123; result[k] = v &#125; return result&#125;// snapshot ç°åœ¨æ˜¯ä¸€ä¸ªæ‹·è´snapshot := stats.Snapshot() ä½¿ç”¨ defer é‡Šæ”¾èµ„æºä½¿ç”¨ defer é‡Šæ”¾èµ„æºï¼Œè¯¸å¦‚æ–‡ä»¶å’Œé”ã€‚ BadGood 12345678910111213p.Lock()if p.count &lt; 10 &#123; p.Unlock() return p.count&#125;p.count++newCount := p.countp.Unlock()return newCount// å½“æœ‰å¤šä¸ª return åˆ†æ”¯æ—¶ï¼Œå¾ˆå®¹æ˜“é—å¿˜ unlock 1234567891011p.Lock()defer p.Unlock()if p.count &lt; 10 &#123; return p.count&#125;p.count++return p.count// æ›´å¯è¯» Defer çš„å¼€é”€éå¸¸å°ï¼Œåªæœ‰åœ¨æ‚¨å¯ä»¥è¯æ˜å‡½æ•°æ‰§è¡Œæ—¶é—´å¤„äºçº³ç§’çº§çš„ç¨‹åº¦æ—¶ï¼Œæ‰åº”é¿å…è¿™æ ·åšã€‚ä½¿ç”¨ defer æå‡å¯è¯»æ€§æ˜¯å€¼å¾—çš„ï¼Œå› ä¸ºä½¿ç”¨å®ƒä»¬çš„æˆæœ¬å¾®ä¸è¶³é“ã€‚å°¤å…¶é€‚ç”¨äºé‚£äº›ä¸ä»…ä»…æ˜¯ç®€å•å†…å­˜è®¿é—®çš„è¾ƒå¤§çš„æ–¹æ³•ï¼Œåœ¨è¿™äº›æ–¹æ³•ä¸­å…¶ä»–è®¡ç®—çš„èµ„æºæ¶ˆè€—è¿œè¶…è¿‡ deferã€‚ Channel çš„ size è¦ä¹ˆæ˜¯ 1ï¼Œè¦ä¹ˆæ˜¯æ— ç¼“å†²çš„channel é€šå¸¸ size åº”ä¸º 1 æˆ–æ˜¯æ— ç¼“å†²çš„ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œchannel æ˜¯æ— ç¼“å†²çš„ï¼Œå…¶ size ä¸ºé›¶ã€‚ä»»ä½•å…¶ä»–å°ºå¯¸éƒ½å¿…é¡»ç»è¿‡ä¸¥æ ¼çš„å®¡æŸ¥ã€‚è€ƒè™‘å¦‚ä½•ç¡®å®šå¤§å°ï¼Œæ˜¯ä»€ä¹ˆé˜»æ­¢äº† channel åœ¨è´Ÿè½½ä¸‹è¢«å¡«æ»¡å¹¶é˜»æ­¢å†™å…¥ï¼Œä»¥åŠå‘ç”Ÿè¿™ç§æƒ…å†µæ—¶å‘ç”Ÿäº†ä»€ä¹ˆã€‚ BadGood 12// åº”è¯¥è¶³ä»¥æ»¡è¶³ä»»ä½•æƒ…å†µï¼c := make(chan int, 64) 1234// å¤§å°ï¼š1c := make(chan int, 1) // æˆ–è€…// æ— ç¼“å†² channelï¼Œå¤§å°ä¸º 0c := make(chan int) æšä¸¾ä» 1 å¼€å§‹åœ¨ Go ä¸­å¼•å…¥æšä¸¾çš„æ ‡å‡†æ–¹æ³•æ˜¯å£°æ˜ä¸€ä¸ªè‡ªå®šä¹‰ç±»å‹å’Œä¸€ä¸ªä½¿ç”¨äº† iota çš„ const ç»„ã€‚ç”±äºå˜é‡çš„é»˜è®¤å€¼ä¸º 0ï¼Œå› æ­¤é€šå¸¸åº”ä»¥éé›¶å€¼å¼€å¤´æšä¸¾ã€‚ BadGood 123456789type Operation intconst ( Add Operation = iota Subtract Multiply)// Add=0, Subtract=1, Multiply=2 123456789type Operation intconst ( Add Operation = iota + 1 Subtract Multiply)// Add=1, Subtract=2, Multiply=3 åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œä½¿ç”¨é›¶å€¼æ˜¯æœ‰æ„ä¹‰çš„ï¼ˆæšä¸¾ä»é›¶å¼€å§‹ï¼‰ï¼Œä¾‹å¦‚ï¼Œå½“é›¶å€¼æ˜¯ç†æƒ³çš„é»˜è®¤è¡Œä¸ºæ—¶ã€‚ 123456789type LogOutput intconst ( LogToStdout LogOutput = iota LogToFile LogToRemote)// LogToStdout=0, LogToFile=1, LogToRemote=2 é”™è¯¯ç±»å‹Go ä¸­æœ‰å¤šç§å£°æ˜é”™è¯¯ï¼ˆError) çš„é€‰é¡¹ï¼š errors.New å¯¹äºç®€å•é™æ€å­—ç¬¦ä¸²çš„é”™è¯¯ fmt.Errorf ç”¨äºæ ¼å¼åŒ–çš„é”™è¯¯å­—ç¬¦ä¸² å®ç° Error() æ–¹æ³•çš„è‡ªå®šä¹‰ç±»å‹ ç”¨ &quot;pkg/errors&quot;.Wrap çš„ Wrapped errors è¿”å›é”™è¯¯æ—¶ï¼Œè¯·è€ƒè™‘ä»¥ä¸‹å› ç´ ä»¥ç¡®å®šæœ€ä½³é€‰æ‹©ï¼š è¿™æ˜¯ä¸€ä¸ªä¸éœ€è¦é¢å¤–ä¿¡æ¯çš„ç®€å•é”™è¯¯å—ï¼Ÿå¦‚æœæ˜¯è¿™æ ·ï¼Œerrors.New è¶³å¤Ÿäº†ã€‚ å®¢æˆ·éœ€è¦æ£€æµ‹å¹¶å¤„ç†æ­¤é”™è¯¯å—ï¼Ÿå¦‚æœæ˜¯è¿™æ ·ï¼Œåˆ™åº”ä½¿ç”¨è‡ªå®šä¹‰ç±»å‹å¹¶å®ç°è¯¥ Error() æ–¹æ³•ã€‚ æ‚¨æ˜¯å¦æ­£åœ¨ä¼ æ’­ä¸‹æ¸¸å‡½æ•°è¿”å›çš„é”™è¯¯ï¼Ÿå¦‚æœæ˜¯è¿™æ ·ï¼Œè¯·æŸ¥çœ‹æœ¬æ–‡åé¢æœ‰å…³é”™è¯¯åŒ…è£… section on error wrapping éƒ¨åˆ†çš„å†…å®¹ã€‚ å¦åˆ™ fmt.Errorf å°±å¯ä»¥äº†ã€‚ å¦‚æœå®¢æˆ·ç«¯éœ€è¦æ£€æµ‹é”™è¯¯ï¼Œå¹¶ä¸”æ‚¨å·²ä½¿ç”¨åˆ›å»ºäº†ä¸€ä¸ªç®€å•çš„é”™è¯¯ errors.Newï¼Œè¯·ä½¿ç”¨ä¸€ä¸ªé”™è¯¯å˜é‡ã€‚ BadGood 1234567891011121314151617// package foofunc Open() error &#123; return errors.New(\"could not open\")&#125;// package barfunc use() &#123; if err := foo.Open(); err != nil &#123; if err.Error() == \"could not open\" &#123; // handle &#125; else &#123; panic(\"unknown error\") &#125; &#125;&#125; 1234567891011121314151617// package foovar ErrCouldNotOpen = errors.New(\"could not open\")func Open() error &#123; return ErrCouldNotOpen&#125;// package barif err := foo.Open(); err != nil &#123; if err == foo.ErrCouldNotOpen &#123; // handle &#125; else &#123; panic(\"unknown error\") &#125;&#125; å¦‚æœæ‚¨æœ‰å¯èƒ½éœ€è¦å®¢æˆ·ç«¯æ£€æµ‹çš„é”™è¯¯ï¼Œå¹¶ä¸”æƒ³å‘å…¶ä¸­æ·»åŠ æ›´å¤šä¿¡æ¯ï¼ˆä¾‹å¦‚ï¼Œå®ƒä¸æ˜¯é™æ€å­—ç¬¦ä¸²ï¼‰ï¼Œåˆ™åº”ä½¿ç”¨è‡ªå®šä¹‰ç±»å‹ã€‚ BadGood 12345678910111213func open(file string) error &#123; return fmt.Errorf(\"file %q not found\", file)&#125;func use() &#123; if err := open(); err != nil &#123; if strings.Contains(err.Error(), \"not found\") &#123; // handle &#125; else &#123; panic(\"unknown error\") &#125; &#125;&#125; 123456789101112131415161718192021type errNotFound struct &#123; file string&#125;func (e errNotFound) Error() string &#123; return fmt.Sprintf(\"file %q not found\", e.file)&#125;func open(file string) error &#123; return errNotFound&#123;file: file&#125;&#125;func use() &#123; if err := open(); err != nil &#123; if _, ok := err.(errNotFound); ok &#123; // handle &#125; else &#123; panic(\"unknown error\") &#125; &#125;&#125; ç›´æ¥å¯¼å‡ºè‡ªå®šä¹‰é”™è¯¯ç±»å‹æ—¶è¦å°å¿ƒï¼Œå› ä¸ºå®ƒä»¬å·²æˆä¸ºç¨‹åºåŒ…å…¬å…± API çš„ä¸€éƒ¨åˆ†ã€‚æœ€å¥½å…¬å¼€åŒ¹é…å™¨åŠŸèƒ½ä»¥æ£€æŸ¥é”™è¯¯ã€‚ 12345678910111213141516171819202122232425262728// package footype errNotFound struct &#123; file string&#125;func (e errNotFound) Error() string &#123; return fmt.Sprintf(\"file %q not found\", e.file)&#125;func IsNotFoundError(err error) bool &#123; _, ok := err.(errNotFound) return ok&#125;func Open(file string) error &#123; return errNotFound&#123;file: file&#125;&#125;// package barif err := foo.Open(\"foo\"); err != nil &#123; if foo.IsNotFoundError(err) &#123; // handle &#125; else &#123; panic(\"unknown error\") &#125;&#125; é”™è¯¯åŒ…è£… (Error Wrapping)ä¸€ä¸ªï¼ˆå‡½æ•°/æ–¹æ³•ï¼‰è°ƒç”¨å¤±è´¥æ—¶ï¼Œæœ‰ä¸‰ç§ä¸»è¦çš„é”™è¯¯ä¼ æ’­æ–¹å¼ï¼š å¦‚æœæ²¡æœ‰è¦æ·»åŠ çš„å…¶ä»–ä¸Šä¸‹æ–‡ï¼Œå¹¶ä¸”æ‚¨æƒ³è¦ç»´æŠ¤åŸå§‹é”™è¯¯ç±»å‹ï¼Œåˆ™è¿”å›åŸå§‹é”™è¯¯ã€‚ æ·»åŠ ä¸Šä¸‹æ–‡ï¼Œä½¿ç”¨ &quot;pkg/errors&quot;.Wrap ä»¥ä¾¿é”™è¯¯æ¶ˆæ¯æä¾›æ›´å¤šä¸Šä¸‹æ–‡ ,&quot;pkg/errors&quot;.Cause å¯ç”¨äºæå–åŸå§‹é”™è¯¯ã€‚Use fmt.Errorf if the callers do not need to detect or handle that specific error case. å¦‚æœè°ƒç”¨è€…ä¸éœ€è¦æ£€æµ‹æˆ–å¤„ç†çš„ç‰¹å®šé”™è¯¯æƒ…å†µï¼Œä½¿ç”¨ fmt.Errorfã€‚ å»ºè®®åœ¨å¯èƒ½çš„åœ°æ–¹æ·»åŠ ä¸Šä¸‹æ–‡ï¼Œä»¥ä½¿æ‚¨è·å¾—è¯¸å¦‚â€œè°ƒç”¨æœåŠ¡ fooï¼šè¿æ¥è¢«æ‹’ç»â€ä¹‹ç±»çš„æ›´æœ‰ç”¨çš„é”™è¯¯ï¼Œè€Œä¸æ˜¯è¯¸å¦‚â€œè¿æ¥è¢«æ‹’ç»â€ä¹‹ç±»çš„æ¨¡ç³Šé”™è¯¯ã€‚ åœ¨å°†ä¸Šä¸‹æ–‡æ·»åŠ åˆ°è¿”å›çš„é”™è¯¯æ—¶ï¼Œè¯·é¿å…ä½¿ç”¨â€œfailed toâ€ä¹‹ç±»çš„çŸ­è¯­æ¥ä¿æŒä¸Šä¸‹æ–‡ç®€æ´ï¼Œè¿™äº›çŸ­è¯­ä¼šé™ˆè¿°æ˜æ˜¾çš„å†…å®¹ï¼Œå¹¶éšç€é”™è¯¯åœ¨å †æ ˆä¸­çš„æ¸—é€è€Œé€æ¸å †ç§¯ï¼š BadGood 12345s, err := store.New()if err != nil &#123; return fmt.Errorf( \"failed to create new store: %s\", err)&#125; 12345s, err := store.New()if err != nil &#123; return fmt.Errorf( \"new store: %s\", err)&#125; 1failed to x: failed to y: failed to create new store: the error 1x: y: new store: the error ä½†æ˜¯ï¼Œä¸€æ—¦å°†é”™è¯¯å‘é€åˆ°å¦ä¸€ä¸ªç³»ç»Ÿï¼Œå°±åº”è¯¥æ˜ç¡®æ¶ˆæ¯æ˜¯é”™è¯¯æ¶ˆæ¯ï¼ˆä¾‹å¦‚ä½¿ç”¨erræ ‡è®°ï¼Œæˆ–åœ¨æ—¥å¿—ä¸­ä»¥â€Failedâ€ä¸ºå‰ç¼€ï¼‰ã€‚ å¦è¯·å‚è§ Donâ€™t just check errors, handle them gracefully. ä¸è¦åªæ˜¯æ£€æŸ¥é”™è¯¯ï¼Œè¦ä¼˜é›…åœ°å¤„ç†é”™è¯¯ å¤„ç†ç±»å‹æ–­è¨€å¤±è´¥type assertion çš„å•ä¸ªè¿”å›å€¼å½¢å¼é’ˆå¯¹ä¸æ­£ç¡®çš„ç±»å‹å°†äº§ç”Ÿ panicã€‚å› æ­¤ï¼Œè¯·å§‹ç»ˆä½¿ç”¨â€œcomma okâ€çš„æƒ¯ç”¨æ³•ã€‚ BadGood 1t := i.(string) 1234t, ok := i.(string)if !ok &#123; // ä¼˜é›…åœ°å¤„ç†é”™è¯¯&#125; ä¸è¦ panicåœ¨ç”Ÿäº§ç¯å¢ƒä¸­è¿è¡Œçš„ä»£ç å¿…é¡»é¿å…å‡ºç° panicã€‚panic æ˜¯ cascading failures çº§è”å¤±è´¥çš„ä¸»è¦æ ¹æº ã€‚å¦‚æœå‘ç”Ÿé”™è¯¯ï¼Œè¯¥å‡½æ•°å¿…é¡»è¿”å›é”™è¯¯ï¼Œå¹¶å…è®¸è°ƒç”¨æ–¹å†³å®šå¦‚ä½•å¤„ç†å®ƒã€‚ BadGood 1234567891011121314func foo(bar string) &#123; if len(bar) == 0 &#123; panic(\"bar must not be empty\") &#125; // ...&#125;func main() &#123; if len(os.Args) != 2 &#123; fmt.Println(\"USAGE: foo &lt;bar&gt;\") os.Exit(1) &#125; foo(os.Args[1])&#125; 1234567891011121314151617func foo(bar string) error &#123; if len(bar) == 0 &#123; return errors.New(\"bar must not be empty\") &#125; // ... return nil&#125;func main() &#123; if len(os.Args) != 2 &#123; fmt.Println(\"USAGE: foo &lt;bar&gt;\") os.Exit(1) &#125; if err := foo(os.Args[1]); err != nil &#123; panic(err) &#125;&#125; panic/recover ä¸æ˜¯é”™è¯¯å¤„ç†ç­–ç•¥ã€‚ä»…å½“å‘ç”Ÿä¸å¯æ¢å¤çš„äº‹æƒ…ï¼ˆä¾‹å¦‚ï¼šnil å¼•ç”¨ï¼‰æ—¶ï¼Œç¨‹åºæ‰å¿…é¡» panicã€‚ç¨‹åºåˆå§‹åŒ–æ˜¯ä¸€ä¸ªä¾‹å¤–ï¼šç¨‹åºå¯åŠ¨æ—¶åº”ä½¿ç¨‹åºä¸­æ­¢çš„ä¸è‰¯æƒ…å†µå¯èƒ½ä¼šå¼•èµ· panicã€‚ 1var _statusTemplate = template.Must(template.New(\"name\").Parse(\"_statusHTML\")) å³ä½¿åœ¨æµ‹è¯•ä»£ç ä¸­ï¼Œä¹Ÿä¼˜å…ˆä½¿ç”¨t.Fatalæˆ–è€…t.FailNowè€Œä¸æ˜¯ panic æ¥ç¡®ä¿å¤±è´¥è¢«æ ‡è®°ã€‚ BadGood 123456// func TestFoo(t *testing.T)f, err := ioutil.TempFile(\"\", \"test\")if err != nil &#123; panic(\"failed to set up test\")&#125; 123456// func TestFoo(t *testing.T)f, err := ioutil.TempFile(\"\", \"test\")if err != nil &#123; t.Fatal(\"failed to set up test\")&#125; ä½¿ç”¨ go.uber.org/atomicä½¿ç”¨ sync/atomic åŒ…çš„åŸå­æ“ä½œå¯¹åŸå§‹ç±»å‹ (int32, int64ç­‰ï¼‰è¿›è¡Œæ“ä½œï¼Œå› ä¸ºå¾ˆå®¹æ˜“å¿˜è®°ä½¿ç”¨åŸå­æ“ä½œæ¥è¯»å–æˆ–ä¿®æ”¹å˜é‡ã€‚ go.uber.org/atomic é€šè¿‡éšè—åŸºç¡€ç±»å‹ä¸ºè¿™äº›æ“ä½œå¢åŠ äº†ç±»å‹å®‰å…¨æ€§ã€‚æ­¤å¤–ï¼Œå®ƒåŒ…æ‹¬ä¸€ä¸ªæ–¹ä¾¿çš„atomic.Boolç±»å‹ã€‚ BadGood 123456789101112131415type foo struct &#123; running int32 // atomic&#125;func (f* foo) start() &#123; if atomic.SwapInt32(&amp;f.running, 1) == 1 &#123; // already runningâ€¦ return &#125; // start the Foo&#125;func (f *foo) isRunning() bool &#123; return f.running == 1 // race!&#125; 123456789101112131415type foo struct &#123; running atomic.Bool&#125;func (f *foo) start() &#123; if f.running.Swap(true) &#123; // already runningâ€¦ return &#125; // start the Foo&#125;func (f *foo) isRunning() bool &#123; return f.running.Load()&#125; æ€§èƒ½æ€§èƒ½æ–¹é¢çš„ç‰¹å®šå‡†åˆ™åªé€‚ç”¨äºé«˜é¢‘åœºæ™¯ã€‚ ä¼˜å…ˆä½¿ç”¨ strconv è€Œä¸æ˜¯ fmtå°†åŸè¯­è½¬æ¢ä¸ºå­—ç¬¦ä¸²æˆ–ä»å­—ç¬¦ä¸²è½¬æ¢æ—¶ï¼Œstrconvé€Ÿåº¦æ¯”fmtå¿«ã€‚ BadGood 123for i := 0; i &lt; b.N; i++ &#123; s := fmt.Sprint(rand.Int())&#125; 123for i := 0; i &lt; b.N; i++ &#123; s := strconv.Itoa(rand.Int())&#125; 1BenchmarkFmtSprint-4 143 ns/op 2 allocs/op 1BenchmarkStrconv-4 64.2 ns/op 1 allocs/op é¿å…å­—ç¬¦ä¸²åˆ°å­—èŠ‚çš„è½¬æ¢ä¸è¦åå¤ä»å›ºå®šå­—ç¬¦ä¸²åˆ›å»ºå­—èŠ‚ sliceã€‚ç›¸åï¼Œè¯·æ‰§è¡Œä¸€æ¬¡è½¬æ¢å¹¶æ•è·ç»“æœã€‚ BadGood 123for i := 0; i &lt; b.N; i++ &#123; w.Write([]byte(\"Hello world\"))&#125; 1234data := []byte(\"Hello world\")for i := 0; i &lt; b.N; i++ &#123; w.Write(data)&#125; 1BenchmarkBad-4 50000000 22.2 ns/op 1BenchmarkGood-4 500000000 3.25 ns/op å°½é‡åˆå§‹åŒ–æ—¶æŒ‡å®š Map å®¹é‡åœ¨å°½å¯èƒ½çš„æƒ…å†µä¸‹ï¼Œåœ¨ä½¿ç”¨ make() åˆå§‹åŒ–çš„æ—¶å€™æä¾›å®¹é‡ä¿¡æ¯ 1make(map[T1]T2, hint) ä¸º make() æä¾›å®¹é‡ä¿¡æ¯ï¼ˆhintï¼‰å°è¯•åœ¨åˆå§‹åŒ–æ—¶è°ƒæ•´ map å¤§å°ï¼Œè¿™å‡å°‘äº†åœ¨å°†å…ƒç´ æ·»åŠ åˆ° map æ—¶å¢é•¿å’Œåˆ†é…çš„å¼€é”€ã€‚æ³¨æ„ï¼Œmap ä¸èƒ½ä¿è¯åˆ†é… hint ä¸ªå®¹é‡ã€‚å› æ­¤ï¼Œå³ä½¿æä¾›äº†å®¹é‡ï¼Œæ·»åŠ å…ƒç´ ä»ç„¶å¯ä»¥è¿›è¡Œåˆ†é…ã€‚ BadGood 123456m := make(map[string]os.FileInfo)files, _ := ioutil.ReadDir(\"./files\")for _, f := range files &#123; m[f.Name()] = f&#125; 1234567files, _ := ioutil.ReadDir(\"./files\")m := make(map[string]os.FileInfo, len(files))for _, f := range files &#123; m[f.Name()] = f&#125; m æ˜¯åœ¨æ²¡æœ‰å¤§å°æç¤ºçš„æƒ…å†µä¸‹åˆ›å»ºçš„ï¼› åœ¨è¿è¡Œæ—¶å¯èƒ½ä¼šæœ‰æ›´å¤šåˆ†é…ã€‚ m æ˜¯æœ‰å¤§å°æç¤ºåˆ›å»ºçš„ï¼›åœ¨è¿è¡Œæ—¶å¯èƒ½ä¼šæœ‰æ›´å°‘çš„åˆ†é…ã€‚ è§„èŒƒä¸€è‡´æ€§æœ¬æ–‡ä¸­æ¦‚è¿°çš„ä¸€äº›æ ‡å‡†éƒ½æ˜¯å®¢è§‚æ€§çš„è¯„ä¼°ï¼Œæ˜¯æ ¹æ®åœºæ™¯ã€ä¸Šä¸‹æ–‡ã€æˆ–è€…ä¸»è§‚æ€§çš„åˆ¤æ–­ï¼› ä½†æ˜¯æœ€é‡è¦çš„æ˜¯ï¼Œä¿æŒä¸€è‡´. ä¸€è‡´æ€§çš„ä»£ç æ›´å®¹æ˜“ç»´æŠ¤ã€æ˜¯æ›´åˆç†çš„ã€éœ€è¦æ›´å°‘çš„å­¦ä¹ æˆæœ¬ã€å¹¶ä¸”éšç€æ–°çš„çº¦å®šå‡ºç°æˆ–è€…å‡ºç°é”™è¯¯åæ›´å®¹æ˜“è¿ç§»ã€æ›´æ–°ã€ä¿®å¤ bug ç›¸åï¼Œä¸€ä¸ªå•ä¸€çš„ä»£ç åº“ä¼šå¯¼è‡´ç»´æŠ¤æˆæœ¬å¼€é”€ã€ä¸ç¡®å®šæ€§å’Œè®¤çŸ¥åå·®ã€‚æ‰€æœ‰è¿™äº›éƒ½ä¼šç›´æ¥å¯¼è‡´é€Ÿåº¦é™ä½ã€ä»£ç å®¡æŸ¥ç—›è‹¦ã€è€Œä¸”å¢åŠ  bug æ•°é‡ å°†è¿™äº›æ ‡å‡†åº”ç”¨äºä»£ç åº“æ—¶ï¼Œå»ºè®®åœ¨ packageï¼ˆæˆ–æ›´å¤§ï¼‰çº§åˆ«è¿›è¡Œæ›´æ”¹ï¼Œå­åŒ…çº§åˆ«çš„åº”ç”¨ç¨‹åºé€šè¿‡å°†å¤šä¸ªæ ·å¼å¼•å…¥åˆ°åŒä¸€ä»£ç ä¸­ï¼Œè¿åäº†ä¸Šè¿°å…³æ³¨ç‚¹ã€‚ ç›¸ä¼¼çš„å£°æ˜æ”¾åœ¨ä¸€ç»„Go è¯­è¨€æ”¯æŒå°†ç›¸ä¼¼çš„å£°æ˜æ”¾åœ¨ä¸€ä¸ªç»„å†…ã€‚ BadGood 12import \"a\"import \"b\" 1234import ( \"a\" \"b\") è¿™åŒæ ·é€‚ç”¨äºå¸¸é‡ã€å˜é‡å’Œç±»å‹å£°æ˜ï¼š BadGood 123456789const a = 1const b = 2var a = 1var b = 2type Area float64type Volume float64 1234567891011121314const ( a = 1 b = 2)var ( a = 1 b = 2)type ( Area float64 Volume float64) ä»…å°†ç›¸å…³çš„å£°æ˜æ”¾åœ¨ä¸€ç»„ã€‚ä¸è¦å°†ä¸ç›¸å…³çš„å£°æ˜æ”¾åœ¨ä¸€ç»„ã€‚ BadGood 12345678type Operation intconst ( Add Operation = iota + 1 Subtract Multiply ENV_VAR = \"MY_ENV\") 123456789type Operation intconst ( Add Operation = iota + 1 Subtract Multiply)const ENV_VAR = \"MY_ENV\" åˆ†ç»„ä½¿ç”¨çš„ä½ç½®æ²¡æœ‰é™åˆ¶ï¼Œä¾‹å¦‚ï¼šä½ å¯ä»¥åœ¨å‡½æ•°å†…éƒ¨ä½¿ç”¨å®ƒä»¬ï¼š BadGood 1234567func f() string &#123; var red = color.New(0xff0000) var green = color.New(0x00ff00) var blue = color.New(0x0000ff) ...&#125; 123456789func f() string &#123; var ( red = color.New(0xff0000) green = color.New(0x00ff00) blue = color.New(0x0000ff) ) ...&#125; import åˆ†ç»„å¯¼å…¥åº”è¯¥åˆ†ä¸ºä¸¤ç»„ï¼š æ ‡å‡†åº“ å…¶ä»–åº“ é»˜è®¤æƒ…å†µä¸‹ï¼Œè¿™æ˜¯ goimports åº”ç”¨çš„åˆ†ç»„ã€‚ BadGood 123456import ( \"fmt\" \"os\" \"go.uber.org/atomic\" \"golang.org/x/sync/errgroup\") 1234567import ( \"fmt\" \"os\" \"go.uber.org/atomic\" \"golang.org/x/sync/errgroup\") åŒ…åå½“å‘½ååŒ…æ—¶ï¼Œè¯·æŒ‰ä¸‹é¢è§„åˆ™é€‰æ‹©ä¸€ä¸ªåç§°ï¼š å…¨éƒ¨å°å†™ã€‚æ²¡æœ‰å¤§å†™æˆ–ä¸‹åˆ’çº¿ã€‚ å¤§å¤šæ•°ä½¿ç”¨å‘½åå¯¼å…¥çš„æƒ…å†µä¸‹ï¼Œä¸éœ€è¦é‡å‘½åã€‚ ç®€çŸ­è€Œç®€æ´ã€‚è¯·è®°ä½ï¼Œåœ¨æ¯ä¸ªä½¿ç”¨çš„åœ°æ–¹éƒ½å®Œæ•´æ ‡è¯†äº†è¯¥åç§°ã€‚ ä¸ç”¨å¤æ•°ã€‚ä¾‹å¦‚net/urlï¼Œè€Œä¸æ˜¯net/urlsã€‚ ä¸è¦ç”¨â€œcommonâ€ï¼Œâ€œutilâ€ï¼Œâ€œsharedâ€æˆ–â€œlibâ€ã€‚è¿™äº›æ˜¯ä¸å¥½çš„ï¼Œä¿¡æ¯é‡ä¸è¶³çš„åç§°ã€‚ å¦è¯·å‚é˜… Package Names å’Œ Go åŒ…æ ·å¼æŒ‡å—. å‡½æ•°åæˆ‘ä»¬éµå¾ª Go ç¤¾åŒºå…³äºä½¿ç”¨ MixedCaps ä½œä¸ºå‡½æ•°å çš„çº¦å®šã€‚æœ‰ä¸€ä¸ªä¾‹å¤–ï¼Œä¸ºäº†å¯¹ç›¸å…³çš„æµ‹è¯•ç”¨ä¾‹è¿›è¡Œåˆ†ç»„ï¼Œå‡½æ•°åå¯èƒ½åŒ…å«ä¸‹åˆ’çº¿ï¼Œå¦‚ï¼šTestMyFunction_WhatIsBeingTested. å¯¼å…¥åˆ«åå¦‚æœç¨‹åºåŒ…åç§°ä¸å¯¼å…¥è·¯å¾„çš„æœ€åä¸€ä¸ªå…ƒç´ ä¸åŒ¹é…ï¼Œåˆ™å¿…é¡»ä½¿ç”¨å¯¼å…¥åˆ«åã€‚ 123456import ( \"net/http\" client \"example.com/client-go\" trace \"example.com/trace/v2\") åœ¨æ‰€æœ‰å…¶ä»–æƒ…å†µä¸‹ï¼Œé™¤éå¯¼å…¥ä¹‹é—´æœ‰ç›´æ¥å†²çªï¼Œå¦åˆ™åº”é¿å…å¯¼å…¥åˆ«åã€‚ BadGood 123456import ( \"fmt\" \"os\" nettrace \"golang.net/x/trace\") 1234567import ( \"fmt\" \"os\" \"runtime/trace\" nettrace \"golang.net/x/trace\") å‡½æ•°åˆ†ç»„ä¸é¡ºåº å‡½æ•°åº”æŒ‰ç²—ç•¥çš„è°ƒç”¨é¡ºåºæ’åºã€‚ åŒä¸€æ–‡ä»¶ä¸­çš„å‡½æ•°åº”æŒ‰æ¥æ”¶è€…åˆ†ç»„ã€‚ å› æ­¤ï¼Œå¯¼å‡ºçš„å‡½æ•°åº”å…ˆå‡ºç°åœ¨æ–‡ä»¶ä¸­ï¼Œæ”¾åœ¨struct, const, varå®šä¹‰çš„åé¢ã€‚ åœ¨å®šä¹‰ç±»å‹ä¹‹åï¼Œä½†åœ¨æ¥æ”¶è€…çš„å…¶ä½™æ–¹æ³•ä¹‹å‰ï¼Œå¯èƒ½ä¼šå‡ºç°ä¸€ä¸ª newXYZ()/NewXYZ() ç”±äºå‡½æ•°æ˜¯æŒ‰æ¥æ”¶è€…åˆ†ç»„çš„ï¼Œå› æ­¤æ™®é€šå·¥å…·å‡½æ•°åº”åœ¨æ–‡ä»¶æœ«å°¾å‡ºç°ã€‚ BadGood 12345678910111213func (s *something) Cost() &#123; return calcCost(s.weights)&#125;type something struct&#123; ... &#125;func calcCost(n []int) int &#123;...&#125;func (s *something) Stop() &#123;...&#125;func newSomething() *something &#123; return &amp;something&#123;&#125;&#125; 12345678910111213type something struct&#123; ... &#125;func newSomething() *something &#123; return &amp;something&#123;&#125;&#125;func (s *something) Cost() &#123; return calcCost(s.weights)&#125;func (s *something) Stop() &#123;...&#125;func calcCost(n []int) int &#123;...&#125; å‡å°‘åµŒå¥—ä»£ç åº”é€šè¿‡å°½å¯èƒ½å…ˆå¤„ç†é”™è¯¯æƒ…å†µ/ç‰¹æ®Šæƒ…å†µå¹¶å°½æ—©è¿”å›æˆ–ç»§ç»­å¾ªç¯æ¥å‡å°‘åµŒå¥—ã€‚å‡å°‘åµŒå¥—å¤šä¸ªçº§åˆ«çš„ä»£ç çš„ä»£ç é‡ã€‚ BadGood 123456789101112for _, v := range data &#123; if v.F1 == 1 &#123; v = process(v) if err := v.Call(); err == nil &#123; v.Send() &#125; else &#123; return err &#125; &#125; else &#123; log.Printf(\"Invalid v: %v\", v) &#125;&#125; 123456789101112for _, v := range data &#123; if v.F1 != 1 &#123; log.Printf(\"Invalid v: %v\", v) continue &#125; v = process(v) if err := v.Call(); err != nil &#123; return err &#125; v.Send()&#125; ä¸å¿…è¦çš„ elseå¦‚æœåœ¨ if çš„ä¸¤ä¸ªåˆ†æ”¯ä¸­éƒ½è®¾ç½®äº†å˜é‡ï¼Œåˆ™å¯ä»¥å°†å…¶æ›¿æ¢ä¸ºå•ä¸ª ifã€‚ BadGood 123456var a intif b &#123; a = 100&#125; else &#123; a = 10&#125; 1234a := 10if b &#123; a = 100&#125; é¡¶å±‚å˜é‡å£°æ˜åœ¨é¡¶å±‚ï¼Œä½¿ç”¨æ ‡å‡†varå…³é”®å­—ã€‚è¯·å‹¿æŒ‡å®šç±»å‹ï¼Œé™¤éå®ƒä¸è¡¨è¾¾å¼çš„ç±»å‹ä¸åŒã€‚ BadGood 123var _s string = F()func F() string &#123; return \"A\" &#125; 12345var _s = F()// ç”±äº F å·²ç»æ˜ç¡®äº†è¿”å›ä¸€ä¸ªå­—ç¬¦ä¸²ç±»å‹ï¼Œå› æ­¤æˆ‘ä»¬æ²¡æœ‰å¿…è¦æ˜¾å¼æŒ‡å®š_s çš„ç±»å‹// è¿˜æ˜¯é‚£ç§ç±»å‹func F() string &#123; return \"A\" &#125; å¦‚æœè¡¨è¾¾å¼çš„ç±»å‹ä¸æ‰€éœ€çš„ç±»å‹ä¸å®Œå…¨åŒ¹é…ï¼Œè¯·æŒ‡å®šç±»å‹ã€‚ 12345678type myError struct&#123;&#125;func (myError) Error() string &#123; return \"error\" &#125;func F() myError &#123; return myError&#123;&#125; &#125;var _e error = F()// F è¿”å›ä¸€ä¸ª myError ç±»å‹çš„å®ä¾‹ï¼Œä½†æ˜¯æˆ‘ä»¬è¦ error ç±»å‹ å¯¹äºæœªå¯¼å‡ºçš„é¡¶å±‚å¸¸é‡å’Œå˜é‡ï¼Œä½¿ç”¨_ä½œä¸ºå‰ç¼€åœ¨æœªå¯¼å‡ºçš„é¡¶çº§varså’Œconstsï¼Œ å‰é¢åŠ ä¸Šå‰ç¼€_ï¼Œä»¥ä½¿å®ƒä»¬åœ¨ä½¿ç”¨æ—¶æ˜ç¡®è¡¨ç¤ºå®ƒä»¬æ˜¯å…¨å±€ç¬¦å·ã€‚ ä¾‹å¤–ï¼šæœªå¯¼å‡ºçš„é”™è¯¯å€¼ï¼Œåº”ä»¥errå¼€å¤´ã€‚ åŸºæœ¬ä¾æ®ï¼šé¡¶çº§å˜é‡å’Œå¸¸é‡å…·æœ‰åŒ…èŒƒå›´ä½œç”¨åŸŸã€‚ä½¿ç”¨é€šç”¨åç§°å¯èƒ½å¾ˆå®¹æ˜“åœ¨å…¶ä»–æ–‡ä»¶ä¸­æ„å¤–ä½¿ç”¨é”™è¯¯çš„å€¼ã€‚ BadGood 1234567891011121314151617// foo.goconst ( defaultPort = 8080 defaultUser = \"user\")// bar.gofunc Bar() &#123; defaultPort := 9090 ... fmt.Println(\"Default port\", defaultPort) // We will not see a compile error if the first line of // Bar() is deleted.&#125; 123456// foo.goconst ( _defaultPort = 8080 _defaultUser = \"user\") ç»“æ„ä½“ä¸­çš„åµŒå…¥åµŒå…¥å¼ç±»å‹ï¼ˆä¾‹å¦‚ mutexï¼‰åº”ä½äºç»“æ„ä½“å†…çš„å­—æ®µåˆ—è¡¨çš„é¡¶éƒ¨ï¼Œå¹¶ä¸”å¿…é¡»æœ‰ä¸€ä¸ªç©ºè¡Œå°†åµŒå…¥å¼å­—æ®µä¸å¸¸è§„å­—æ®µåˆ†éš”å¼€ã€‚ BadGood 1234type Client struct &#123; version int http.Client&#125; 12345type Client struct &#123; http.Client version int&#125; ä½¿ç”¨å­—æ®µååˆå§‹åŒ–ç»“æ„ä½“åˆå§‹åŒ–ç»“æ„ä½“æ—¶ï¼Œå‡ ä¹å§‹ç»ˆåº”è¯¥æŒ‡å®šå­—æ®µåç§°ã€‚ç°åœ¨ç”± go vet å¼ºåˆ¶æ‰§è¡Œã€‚ BadGood 1k := User&#123;\"John\", \"Doe\", true&#125; 12345k := User&#123; FirstName: \"John\", LastName: \"Doe\", Admin: true,&#125; ä¾‹å¤–ï¼šå¦‚æœæœ‰ 3 ä¸ªæˆ–æ›´å°‘çš„å­—æ®µï¼Œåˆ™å¯ä»¥åœ¨æµ‹è¯•è¡¨ä¸­çœç•¥å­—æ®µåç§°ã€‚ 1234567tests := []struct&#123; op Operation want string&#125;&#123; &#123;Add, \"add\"&#125;, &#123;Subtract, \"subtract\"&#125;,&#125; æœ¬åœ°å˜é‡å£°æ˜å¦‚æœå°†å˜é‡æ˜ç¡®è®¾ç½®ä¸ºæŸä¸ªå€¼ï¼Œåˆ™åº”ä½¿ç”¨çŸ­å˜é‡å£°æ˜å½¢å¼ (:=)ã€‚ BadGood 1var s = \"foo\" 1s := \"foo\" ä½†æ˜¯ï¼Œåœ¨æŸäº›æƒ…å†µä¸‹ï¼Œvar ä½¿ç”¨å…³é”®å­—æ—¶é»˜è®¤å€¼ä¼šæ›´æ¸…æ™°ã€‚ä¾‹å¦‚ï¼Œå£°æ˜ç©ºåˆ‡ç‰‡ã€‚ BadGood 12345678func f(list []int) &#123; filtered := []int&#123;&#125; for _, v := range list &#123; if v &gt; 10 &#123; filtered = append(filtered, v) &#125; &#125;&#125; 12345678func f(list []int) &#123; var filtered []int for _, v := range list &#123; if v &gt; 10 &#123; filtered = append(filtered, v) &#125; &#125;&#125; nil æ˜¯ä¸€ä¸ªæœ‰æ•ˆçš„ slicenil æ˜¯ä¸€ä¸ªæœ‰æ•ˆçš„é•¿åº¦ä¸º 0 çš„ sliceï¼Œè¿™æ„å‘³ç€ï¼Œ æ‚¨ä¸åº”æ˜ç¡®è¿”å›é•¿åº¦ä¸ºé›¶çš„åˆ‡ç‰‡ã€‚åº”è¯¥è¿”å›nil æ¥ä»£æ›¿ã€‚ BadGood 123if x == \"\" &#123; return []int&#123;&#125;&#125; 123if x == \"\" &#123; return nil&#125; è¦æ£€æŸ¥åˆ‡ç‰‡æ˜¯å¦ä¸ºç©ºï¼Œè¯·å§‹ç»ˆä½¿ç”¨len(s) == 0ã€‚è€Œé nilã€‚ BadGood 123func isEmpty(s []string) bool &#123; return s == nil&#125; 123func isEmpty(s []string) bool &#123; return len(s) == 0&#125; é›¶å€¼åˆ‡ç‰‡ï¼ˆç”¨varå£°æ˜çš„åˆ‡ç‰‡ï¼‰å¯ç«‹å³ä½¿ç”¨ï¼Œæ— éœ€è°ƒç”¨make()åˆ›å»ºã€‚ BadGood 12345678910nums := []int&#123;&#125;// or, nums := make([]int)if add1 &#123; nums = append(nums, 1)&#125;if add2 &#123; nums = append(nums, 2)&#125; 123456789var nums []intif add1 &#123; nums = append(nums, 1)&#125;if add2 &#123; nums = append(nums, 2)&#125; å°å˜é‡ä½œç”¨åŸŸå¦‚æœæœ‰å¯èƒ½ï¼Œå°½é‡ç¼©å°å˜é‡ä½œç”¨èŒƒå›´ã€‚é™¤éå®ƒä¸ å‡å°‘åµŒå¥—çš„è§„åˆ™å†²çªã€‚ BadGood 1234err := ioutil.WriteFile(name, data, 0644)if err != nil &#123; return err&#125; 123if err := ioutil.WriteFile(name, data, 0644); err != nil &#123; return err&#125; å¦‚æœéœ€è¦åœ¨ if ä¹‹å¤–ä½¿ç”¨å‡½æ•°è°ƒç”¨çš„ç»“æœï¼Œåˆ™ä¸åº”å°è¯•ç¼©å°èŒƒå›´ã€‚ BadGood 1234567891011if data, err := ioutil.ReadFile(name); err == nil &#123; err = cfg.Decode(data) if err != nil &#123; return err &#125; fmt.Println(cfg) return nil&#125; else &#123; return err&#125; 1234567891011data, err := ioutil.ReadFile(name)if err != nil &#123; return err&#125;if err := cfg.Decode(data); err != nil &#123; return err&#125;fmt.Println(cfg)return nil é¿å…å‚æ•°è¯­ä¹‰ä¸æ˜ç¡®(Avoid Naked Parameters)å‡½æ•°è°ƒç”¨ä¸­çš„æ„ä¹‰ä¸æ˜ç¡®çš„å‚æ•°å¯èƒ½ä¼šæŸå®³å¯è¯»æ€§ã€‚å½“å‚æ•°åç§°çš„å«ä¹‰ä¸æ˜æ˜¾æ—¶ï¼Œè¯·ä¸ºå‚æ•°æ·»åŠ  C æ ·å¼æ³¨é‡Š (/* ... */) BadGood 123// func printInfo(name string, isLocal, done bool)printInfo(\"foo\", true, true) 123// func printInfo(name string, isLocal, done bool)printInfo(\"foo\", true /* isLocal */, true /* done */) å¯¹äºä¸Šé¢çš„ç¤ºä¾‹ä»£ç ï¼Œè¿˜æœ‰ä¸€ç§æ›´å¥½çš„å¤„ç†æ–¹å¼æ˜¯å°†ä¸Šé¢çš„ bool ç±»å‹æ¢æˆè‡ªå®šä¹‰ç±»å‹ã€‚å°†æ¥ï¼Œè¯¥å‚æ•°å¯ä»¥æ”¯æŒä¸ä»…ä»…å±€é™äºä¸¤ä¸ªçŠ¶æ€ï¼ˆtrue/falseï¼‰ã€‚ 12345678910111213141516type Region intconst ( UnknownRegion Region = iota Local)type Status intconst ( StatusReady = iota + 1 StatusDone // Maybe we will have a StatusInProgress in the future.)func printInfo(name string, region Region, status Status) ä½¿ç”¨åŸå§‹å­—ç¬¦ä¸²å­—é¢å€¼ï¼Œé¿å…è½¬ä¹‰Go æ”¯æŒä½¿ç”¨ åŸå§‹å­—ç¬¦ä¸²å­—é¢å€¼ï¼Œä¹Ÿå°±æ˜¯ â€œ ` â€œ æ¥è¡¨ç¤ºåŸç”Ÿå­—ç¬¦ä¸²ï¼Œåœ¨éœ€è¦è½¬ä¹‰çš„åœºæ™¯ä¸‹ï¼Œæˆ‘ä»¬åº”è¯¥å°½é‡ä½¿ç”¨è¿™ç§æ–¹æ¡ˆæ¥æ›¿æ¢ã€‚ å¯ä»¥è·¨è¶Šå¤šè¡Œå¹¶åŒ…å«å¼•å·ã€‚ä½¿ç”¨è¿™äº›å­—ç¬¦ä¸²å¯ä»¥é¿å…æ›´éš¾é˜…è¯»çš„æ‰‹å·¥è½¬ä¹‰çš„å­—ç¬¦ä¸²ã€‚ BadGood 1wantError := \"unknown name:\\\"test\\\"\" 1wantError := `unknown error:\"test\"` åˆå§‹åŒ– Struct å¼•ç”¨åœ¨åˆå§‹åŒ–ç»“æ„å¼•ç”¨æ—¶ï¼Œè¯·ä½¿ç”¨&amp;T{}ä»£æ›¿new(T)ï¼Œä»¥ä½¿å…¶ä¸ç»“æ„ä½“åˆå§‹åŒ–ä¸€è‡´ã€‚ BadGood 12345sval := T&#123;Name: \"foo\"&#125;// inconsistentsptr := new(T)sptr.Name = \"bar\" 123sval := T&#123;Name: \"foo\"&#125;sptr := &amp;T&#123;Name: \"bar\"&#125; åˆå§‹åŒ– Mapså¯¹äºç©º map è¯·ä½¿ç”¨ make(..) åˆå§‹åŒ–ï¼Œ å¹¶ä¸” map æ˜¯é€šè¿‡ç¼–ç¨‹æ–¹å¼å¡«å……çš„ã€‚è¿™ä½¿å¾— map åˆå§‹åŒ–åœ¨è¡¨ç°ä¸Šä¸åŒäºå£°æ˜ï¼Œå¹¶ä¸”å®ƒè¿˜å¯ä»¥æ–¹ä¾¿åœ°åœ¨ make åæ·»åŠ å¤§å°æç¤ºã€‚ BadGood 123456var ( // m1 è¯»å†™å®‰å…¨; // m2 åœ¨å†™å…¥æ—¶ä¼š panic m1 = map[T1]T2&#123;&#125; m2 map[T1]T2) 123456var ( // m1 è¯»å†™å®‰å…¨; // m2 åœ¨å†™å…¥æ—¶ä¼š panic m1 = make(map[T1]T2) m2 map[T1]T2) å£°æ˜å’Œåˆå§‹åŒ–çœ‹èµ·æ¥éå¸¸ç›¸ä¼¼çš„ã€‚ å£°æ˜å’Œåˆå§‹åŒ–çœ‹èµ·æ¥å·®åˆ«éå¸¸å¤§ã€‚ åœ¨å°½å¯èƒ½çš„æƒ…å†µä¸‹ï¼Œè¯·åœ¨åˆå§‹åŒ–æ—¶æä¾› map å®¹é‡å¤§å°ï¼Œè¯¦ç»†è¯·çœ‹ å°½é‡åˆå§‹åŒ–æ—¶æŒ‡å®š Map å®¹é‡ã€‚ å¦å¤–ï¼Œå¦‚æœ map åŒ…å«å›ºå®šçš„å…ƒç´ åˆ—è¡¨ï¼Œåˆ™ä½¿ç”¨ map literals(map åˆå§‹åŒ–åˆ—è¡¨) åˆå§‹åŒ–æ˜ å°„ã€‚ BadGood 1234m := make(map[T1]T2, 3)m[k1] = v1m[k2] = v2m[k3] = v3 12345m := map[T1]T2&#123; k1: v1, k2: v2, k3: v3,&#125; åŸºæœ¬å‡†åˆ™æ˜¯ï¼šåœ¨åˆå§‹åŒ–æ—¶ä½¿ç”¨ map åˆå§‹åŒ–åˆ—è¡¨ æ¥æ·»åŠ ä¸€ç»„å›ºå®šçš„å…ƒç´ ã€‚å¦åˆ™ä½¿ç”¨ make (å¦‚æœå¯ä»¥ï¼Œè¯·å°½é‡æŒ‡å®š map å®¹é‡)ã€‚ å­—ç¬¦ä¸² string formatå¦‚æœä½ ä¸ºPrintf-style å‡½æ•°å£°æ˜æ ¼å¼å­—ç¬¦ä¸²ï¼Œè¯·å°†æ ¼å¼åŒ–å­—ç¬¦ä¸²æ”¾åœ¨å¤–é¢ï¼Œå¹¶å°†å…¶è®¾ç½®ä¸ºconstå¸¸é‡ã€‚ è¿™æœ‰åŠ©äºgo vetå¯¹æ ¼å¼å­—ç¬¦ä¸²æ‰§è¡Œé™æ€åˆ†æã€‚ BadGood 12msg := \"unexpected values %v, %v\\n\"fmt.Printf(msg, 1, 2) 12const msg = \"unexpected values %v, %v\\n\"fmt.Printf(msg, 1, 2) å‘½å Printf æ ·å¼çš„å‡½æ•°å£°æ˜Printf-style å‡½æ•°æ—¶ï¼Œè¯·ç¡®ä¿go vetå¯ä»¥æ£€æµ‹åˆ°å®ƒå¹¶æ£€æŸ¥æ ¼å¼å­—ç¬¦ä¸²ã€‚ è¿™æ„å‘³ç€æ‚¨åº”å°½å¯èƒ½ä½¿ç”¨é¢„å®šä¹‰çš„Printf-style å‡½æ•°åç§°ã€‚go vetå°†é»˜è®¤æ£€æŸ¥è¿™äº›ã€‚æœ‰å…³æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚è§ Printf ç³»åˆ—ã€‚ å¦‚æœä¸èƒ½ä½¿ç”¨é¢„å®šä¹‰çš„åç§°ï¼Œè¯·ä»¥ f ç»“æŸé€‰æ‹©çš„åç§°ï¼šWrapfï¼Œè€Œä¸æ˜¯Wrapã€‚go vetå¯ä»¥è¦æ±‚æ£€æŸ¥ç‰¹å®šçš„ Printf æ ·å¼åç§°ï¼Œä½†åç§°å¿…é¡»ä»¥fç»“å°¾ã€‚ 1$ go vet -printfuncs=wrapf,statusf å¦è¯·å‚é˜… go vet: Printf family check. ç¼–ç¨‹æ¨¡å¼è¡¨é©±åŠ¨æµ‹è¯•å½“æµ‹è¯•é€»è¾‘æ˜¯é‡å¤çš„æ—¶å€™ï¼Œé€šè¿‡ subtests ä½¿ç”¨ table é©±åŠ¨çš„æ–¹å¼ç¼–å†™ case ä»£ç çœ‹ä¸Šå»ä¼šæ›´ç®€æ´ã€‚ BadGood 123456789101112131415161718192021// func TestSplitHostPort(t *testing.T)host, port, err := net.SplitHostPort(\"192.0.2.0:8000\")require.NoError(t, err)assert.Equal(t, \"192.0.2.0\", host)assert.Equal(t, \"8000\", port)host, port, err = net.SplitHostPort(\"192.0.2.0:http\")require.NoError(t, err)assert.Equal(t, \"192.0.2.0\", host)assert.Equal(t, \"http\", port)host, port, err = net.SplitHostPort(\":8000\")require.NoError(t, err)assert.Equal(t, \"\", host)assert.Equal(t, \"8000\", port)host, port, err = net.SplitHostPort(\"1:8\")require.NoError(t, err)assert.Equal(t, \"1\", host)assert.Equal(t, \"8\", port) 12345678910111213141516171819202122232425262728293031323334353637// func TestSplitHostPort(t *testing.T)tests := []struct&#123; give string wantHost string wantPort string&#125;&#123; &#123; give: \"192.0.2.0:8000\", wantHost: \"192.0.2.0\", wantPort: \"8000\", &#125;, &#123; give: \"192.0.2.0:http\", wantHost: \"192.0.2.0\", wantPort: \"http\", &#125;, &#123; give: \":8000\", wantHost: \"\", wantPort: \"8000\", &#125;, &#123; give: \"1:8\", wantHost: \"1\", wantPort: \"8\", &#125;,&#125;for _, tt := range tests &#123; t.Run(tt.give, func(t *testing.T) &#123; host, port, err := net.SplitHostPort(tt.give) require.NoError(t, err) assert.Equal(t, tt.wantHost, host) assert.Equal(t, tt.wantPort, port) &#125;)&#125; å¾ˆæ˜æ˜¾ï¼Œä½¿ç”¨ test table çš„æ–¹å¼åœ¨ä»£ç é€»è¾‘æ‰©å±•çš„æ—¶å€™ï¼Œæ¯”å¦‚æ–°å¢ test caseï¼Œéƒ½ä¼šæ˜¾å¾—æ›´åŠ çš„æ¸…æ™°ã€‚ æˆ‘ä»¬éµå¾ªè¿™æ ·çš„çº¦å®šï¼šå°†ç»“æ„ä½“åˆ‡ç‰‡ç§°ä¸ºtestsã€‚ æ¯ä¸ªæµ‹è¯•ç”¨ä¾‹ç§°ä¸ºttã€‚æ­¤å¤–ï¼Œæˆ‘ä»¬é¼“åŠ±ä½¿ç”¨giveå’Œwantå‰ç¼€è¯´æ˜æ¯ä¸ªæµ‹è¯•ç”¨ä¾‹çš„è¾“å…¥å’Œè¾“å‡ºå€¼ã€‚ 1234567891011tests := []struct&#123; give string wantHost string wantPort string&#125;&#123; // ...&#125;for _, tt := range tests &#123; // ...&#125; åŠŸèƒ½é€‰é¡¹åŠŸèƒ½é€‰é¡¹æ˜¯ä¸€ç§æ¨¡å¼ï¼Œæ‚¨å¯ä»¥åœ¨å…¶ä¸­å£°æ˜ä¸€ä¸ªä¸é€æ˜ Option ç±»å‹ï¼Œè¯¥ç±»å‹åœ¨æŸäº›å†…éƒ¨ç»“æ„ä¸­è®°å½•ä¿¡æ¯ã€‚æ‚¨æ¥å—è¿™äº›é€‰é¡¹çš„å¯å˜ç¼–å·ï¼Œå¹¶æ ¹æ®å†…éƒ¨ç»“æ„ä¸Šçš„é€‰é¡¹è®°å½•çš„å…¨éƒ¨ä¿¡æ¯é‡‡å–è¡ŒåŠ¨ã€‚ å°†æ­¤æ¨¡å¼ç”¨äºæ‚¨éœ€è¦æ‰©å±•çš„æ„é€ å‡½æ•°å’Œå…¶ä»–å…¬å…± API ä¸­çš„å¯é€‰å‚æ•°ï¼Œå°¤å…¶æ˜¯åœ¨è¿™äº›åŠŸèƒ½ä¸Šå·²ç»å…·æœ‰ä¸‰ä¸ªæˆ–æ›´å¤šå‚æ•°çš„æƒ…å†µä¸‹ã€‚ BadGood 1234567891011121314151617// package dbfunc Connect( addr string, timeout time.Duration, caching bool,) (*Connection, error) &#123; // ...&#125;// Timeout and caching must always be provided,// even if the user wants to use the default.db.Connect(addr, db.DefaultTimeout, db.DefaultCaching)db.Connect(addr, newTimeout, db.DefaultCaching)db.Connect(addr, db.DefaultTimeout, false /* caching */)db.Connect(addr, newTimeout, false /* caching */) 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455type options struct &#123; timeout time.Duration caching bool&#125;// Option overrides behavior of Connect.type Option interface &#123; apply(*options)&#125;type optionFunc func(*options)func (f optionFunc) apply(o *options) &#123; f(o)&#125;func WithTimeout(t time.Duration) Option &#123; return optionFunc(func(o *options) &#123; o.timeout = t &#125;)&#125;func WithCaching(cache bool) Option &#123; return optionFunc(func(o *options) &#123; o.caching = cache &#125;)&#125;// Connect creates a connection.func Connect( addr string, opts ...Option,) (*Connection, error) &#123; options := options&#123; timeout: defaultTimeout, caching: defaultCaching, &#125; for _, o := range opts &#123; o.apply(&amp;options) &#125; // ...&#125;// Options must be provided only if needed.db.Connect(addr)db.Connect(addr, db.WithTimeout(newTimeout))db.Connect(addr, db.WithCaching(false))db.Connect( addr, db.WithCaching(false), db.WithTimeout(newTimeout),) è¿˜å¯ä»¥å‚è€ƒä¸‹é¢èµ„æ–™ï¼š Self-referential functions and the design of options Functional options for friendly APIs","categories":[],"tags":[{"name":"Golang","slug":"Golang","permalink":"https://razertory.me/tags/Golang/"}]},{"title":"æœ€å°æ ˆ","slug":"min-stack","date":"2019-11-04T04:58:26.000Z","updated":"2020-03-28T13:02:10.011Z","comments":true,"path":"2019/11/04/min-stack/","link":"","permalink":"https://razertory.me/2019/11/04/min-stack/","excerpt":"","text":"å®ç°ä¸€ä¸ªæœ€å°æ ˆï¼Œæœ‰ä¸‰ç§æ“ä½œï¼Œminï¼šå¾—åˆ°æ ˆä¸­çš„æœ€å°å€¼ï¼Œpushï¼šåœ¨æ ˆé¡¶æ’å…¥ä¸€ä¸ªå…ƒç´ ï¼Œpopï¼šå¼¹å‡ºæ ˆé¡¶å…ƒç´ ï¼Œä½¿è¿™ä¸‰ç§æ“ä½œçš„æ—¶é—´å¤æ‚åº¦éƒ½æ˜¯O(1) 1234public class StackWithMin extends Stack&lt;Integer&gt; &#123; public Integer push(Integer item) public Integer pop()&#125; é¢å¤–ç»´æŠ¤ä¸€ä¸ªæ ˆ minStack ç”¨æ¥éšæ—¶è·å–å½“å‰æœ€å°å€¼ã€‚ å¯¹äº push(value) åˆ¤æ–­å½“å‰ minStack çš„ top æ˜¯å¦å°äº valueï¼Œå¦‚æœå°äºå°± minStack.push(value) å¯¹äº pop() åˆ¤æ–­å½“å‰ minStack çš„ top æ˜¯å¦ç­‰äº valueï¼Œå¦‚æœç­‰äºå°± minStack.pop() å®ç°ä¸€ä¸ªè·å–æœ€å°å€¼çš„å‡½æ•° getMin() ç”¨æ¥å®Œå–„ä¸Šè¿°çš„ top 12345678910111213141516171819202122232425262728293031public class StackWithMin extends Stack&lt;Integer&gt; &#123; Stack&lt;Integer&gt; stackMin; public StackWithMin()&#123; stackMin = new Stack&lt;Integer&gt;(); &#125; public Integer push(Integer item)&#123; if(item &lt;= min())&#123; stackMin.push(item); &#125; super.push(item); return item; &#125; public Integer pop()&#123; int value = super.pop(); if(value == min())&#123; stackMin.pop(); &#125; return value; &#125; public Integer min()&#123; if(stackMin.isEmpty())&#123; return Integer.MAX_VALUE; &#125; else &#123; return stackMin.peek(); &#125; &#125;&#125;","categories":[],"tags":[]},{"title":"åˆ¤æ–­æ˜¯å¦æ˜¯äºŒå‰æœç´¢æ ‘","slug":"is-bst","date":"2019-11-04T02:30:22.000Z","updated":"2020-03-28T13:02:10.011Z","comments":true,"path":"2019/11/04/is-bst/","link":"","permalink":"https://razertory.me/2019/11/04/is-bst/","excerpt":"","text":"è¾“å…¥ä¸€ä¸ªäºŒå‰æ ‘çš„ root èŠ‚ç‚¹ï¼Œåˆ¤æ–­æ˜¯å¦æ˜¯äºŒå‰æœç´¢æ ‘ã€‚ 1public boolean isBST(TreeNode root) äºŒå‰æœç´¢æ ‘çš„å®šä¹‰ï¼š è‹¥ä»»æ„èŠ‚ç‚¹çš„å·¦å­æ ‘ä¸ç©ºï¼Œåˆ™å·¦å­æ ‘ä¸Šæ‰€æœ‰èŠ‚ç‚¹çš„å€¼å‡å°äºå®ƒçš„æ ¹èŠ‚ç‚¹çš„å€¼ï¼› è‹¥ä»»æ„èŠ‚ç‚¹çš„å³å­æ ‘ä¸ç©ºï¼Œåˆ™å³å­æ ‘ä¸Šæ‰€æœ‰èŠ‚ç‚¹çš„å€¼å‡å¤§äºå®ƒçš„æ ¹èŠ‚ç‚¹çš„å€¼ï¼› ä»»æ„èŠ‚ç‚¹çš„å·¦ã€å³å­æ ‘ä¹Ÿåˆ†åˆ«ä¸ºäºŒå‰æŸ¥æ‰¾æ ‘ï¼› æ²¡æœ‰é”®å€¼ç›¸ç­‰çš„èŠ‚ç‚¹ã€‚ æ ¹æ®è¿™ä¸ªå®šä¹‰ï¼Œæ¯”å¦‚æœ‰ä¸ªå‡½æ•° f(root) ç”¨ä½œåˆ¤æ–­æ˜¯å¦æ˜¯ BSTï¼Œé‚£ä¹ˆè¿™ä¸ªå‡½æ•°è¿›ä¸€æ­¥å¯ä»¥å®šä¹‰ä¸º f(root, min, max)ï¼Œmin å’Œ max è¡¨ç¤ºéå†è¿‡ç¨‹ä¸­çš„æœ€å¤§å€¼å’Œæœ€å°å€¼ã€‚åœ¨å½“å‰çŠ¶æ€ä¸‹ï¼Œroot.val &gt; min ä¸” root.val &lt; max å°±æ˜¯åˆæ³•çš„ã€‚åŒæ ·çš„ï¼Œå¯¹äº root.left å’Œ root.right ä¹Ÿéœ€è¦æ»¡è¶³ä¸Šè¿°æ¡ä»¶ã€‚å†™æˆçš„ä¼ªä»£ç å°±æ˜¯ 12345f(root, min, max) &#123;if root.val &lt; min return falseif root.val &gt; max return falsereturn f(root.left, min, root.val) &amp;&amp; f (root.right, root.val, max)&#125; é€šè¿‡ inOrder(ä¸­åºéå†) æ˜¯å¦ä¸€ç§å·§å¦™çš„æ–¹æ³•ï¼ŒåŸºäºäºŒå‰æœç´¢æ ‘çš„å®šä¹‰å¯ä»¥æ˜ç¡®çŸ¥é“ä¸­åºéå†çš„è¿‡ç¨‹ä¸€å®šæ˜¯èŠ‚ç‚¹å€¼ä»å°åˆ°å¤§çš„ï¼Œå› æ­¤å¯ä»¥è®¤ä¸º åªè¦æ²¡æœ‰æ»¡è¶³é€’å¢çš„åºåˆ—ï¼Œå°±ä¸æ˜¯åˆæ³•çš„äºŒå‰æœç´¢æ ‘ 123456789101112131415161718192021222324// min, max æ³•boolean isValidBST(TreeNode root, TreeNode lower, TreeNode upper) &#123; if (root == null) return true; if (lower != null &amp;&amp; lower.val &gt;= root.val) return false; if (upper != null &amp;&amp; upper.val &lt;= root.val) return false; return isValidBST(root.left, lower, root) &amp;&amp; isValidBST(root.right, root, upper);&#125;// ä¸­åºéå†æ³•public boolean isValidBST(TreeNode root) &#123; ArrayList&lt;Integer&gt; order = new ArrayList&lt;&gt;(); inOrder(root, order); for (int i = 1; i &lt; order.size(); i++) &#123; if (order.get(i) &lt;= order.get(i - 1)) return false; &#125; return true;&#125;private void inOrder(TreeNode root, ArrayList&lt;Integer&gt; order) &#123; if (root == null) return; inOrder(root.left, order); order.add(root.val); inOrder(root.right, order);&#125;","categories":[],"tags":[]},{"title":"å’Œä¸ºæŸä¸ªå€¼çš„äºŒå‰æ ‘è·¯å¾„","slug":"sum-path","date":"2019-11-04T02:19:06.000Z","updated":"2020-03-28T13:02:10.011Z","comments":true,"path":"2019/11/04/sum-path/","link":"","permalink":"https://razertory.me/2019/11/04/sum-path/","excerpt":"","text":"è¾“å…¥ä¸€é¢—äºŒå‰æ ‘çš„è·ŸèŠ‚ç‚¹å’Œä¸€ä¸ªæ•´æ•°ï¼Œæ‰“å°å‡ºäºŒå‰æ ‘ä¸­ç»“ç‚¹å€¼çš„å’Œä¸ºè¾“å…¥æ•´æ•°çš„æ‰€æœ‰è·¯å¾„ã€‚è·¯å¾„å®šä¹‰ä¸ºä»æ ‘çš„æ ¹ç»“ç‚¹å¼€å§‹å¾€ä¸‹ä¸€ç›´åˆ°å¶ç»“ç‚¹æ‰€ç»è¿‡çš„ç»“ç‚¹å½¢æˆä¸€æ¡è·¯å¾„ã€‚(æ³¨æ„: åœ¨è¿”å›å€¼çš„listä¸­ï¼Œæ•°ç»„é•¿åº¦å¤§çš„æ•°ç»„é å‰) 1public ArrayList&lt;ArrayList&lt;Integer&gt;&gt; FindPath(TreeNode root,int target) ç»´æŠ¤ä¸€ä¸ªäºŒç»´æ•°ç»„ï¼Œä» root èŠ‚ç‚¹å¼€å§‹è¿›è¡Œ dfsã€‚æ¯éå†ä¸€ä¸ªèŠ‚ç‚¹ï¼Œ target - èŠ‚ç‚¹å€¼ï¼›åŒæ—¶ç»™æ•°ç»„åŠ ä¸Šè¯¥èŠ‚ç‚¹ã€‚å½“ target çš„å€¼å’ŒèŠ‚ç‚¹å€¼ç›¸ç­‰çš„æ—¶å€™ï¼Œè¯´æ˜è¿™æ¡è·¯å¾„æ˜¯åˆæ³•è·¯å¾„ã€‚åœ¨äºŒç»´æ•°ç»„ä¸­åŠ ä¸Šè¯¥è·¯å¾„ã€‚ 123456789101112131415public ArrayList&lt;ArrayList&lt;Integer&gt;&gt; FindPath(TreeNode root,int target) &#123; ArrayList&lt;ArrayList&lt;Integer&gt;&gt; paths = new ArrayList&lt;&gt;(); ArrayList&lt;Integer&gt; path = new ArrayList&lt;&gt;(); dfs(root, path, paths, target); return paths;&#125;private void dfs(TreeNode root, ArrayList&lt;Integer&gt; path, ArrayList&lt;ArrayList&lt;Integer&gt;&gt; paths, int sum) &#123; if (root == null) return; path.add(root.val); if (root.left == null &amp;&amp; root.right == null &amp;&amp; sum == root.val) paths.add(new ArrayList&lt;&gt;(path)); dfs(root.left, path, paths, sum - root.val); dfs(root.right, path, paths, sum - root.val); path.remove(path.size() - 1);&#125;","categories":[],"tags":[]},{"title":"æ˜¯å¦æ˜¯äºŒå‰æœç´¢æ ‘çš„åºéå†","slug":"is-post-order","date":"2019-10-27T07:58:38.000Z","updated":"2020-03-28T13:02:10.010Z","comments":true,"path":"2019/10/27/is-post-order/","link":"","permalink":"https://razertory.me/2019/10/27/is-post-order/","excerpt":"","text":"è¾“å…¥ä¸€ä¸ªæ•´æ•°æ•°ç»„ï¼Œåˆ¤æ–­è¯¥æ•°ç»„æ˜¯ä¸æ˜¯æŸäºŒå‰æœç´¢æ ‘çš„ååºéå†çš„ç»“æœã€‚å¦‚æœæ˜¯åˆ™è¾“å‡ºYes,å¦åˆ™è¾“å‡ºNoã€‚å‡è®¾è¾“å…¥çš„æ•°ç»„çš„ä»»æ„ä¸¤ä¸ªæ•°å­—éƒ½äº’ä¸ç›¸åŒã€‚ 1boolean VerifySquenceOfBST(int [] sequence) BSTçš„ååºåºåˆ—çš„åˆæ³•åºåˆ—æ˜¯ï¼Œå¯¹äºä¸€ä¸ªåºåˆ—Sï¼Œæœ€åä¸€ä¸ªå…ƒç´ æ˜¯x ï¼ˆä¹Ÿå°±æ˜¯æ ¹ï¼‰ï¼Œå¦‚æœå»æ‰æœ€åä¸€ä¸ªå…ƒç´ çš„åºåˆ—ä¸ºTï¼Œé‚£ä¹ˆTæ»¡è¶³ï¼šTå¯ä»¥åˆ†æˆä¸¤æ®µï¼Œå‰ä¸€æ®µï¼ˆå·¦å­æ ‘ï¼‰å°äºxï¼Œåä¸€æ®µï¼ˆå³å­æ ‘ï¼‰å¤§äºxï¼Œä¸”è¿™ä¸¤æ®µï¼ˆå­æ ‘ï¼‰éƒ½æ˜¯åˆæ³•çš„ååºåºåˆ—ã€‚å®Œç¾çš„é€’å½’å®šä¹‰ : ) ã€‚ 1234567891011121314boolean VerifySquenceOfBST(int [] sequence) &#123; if (sequence == null || sequence.length == 0) return false; return validate(sequence, 0, sequence.length - 1);&#125;boolean validate(int[] s, int left, int right)&#123; if (left &gt;= right) return true; int cur = right; while(cur &gt; left &amp;&amp; s[cur - 1] &gt; s[right]) cur--; for (int i = left; i &lt; cur - 1; i++) &#123; if (s[i] &gt;= s[right]) return false; &#125; return validate(s, left, cur - 1) &amp;&amp; validate(s, cur, right - 1);&#125;","categories":[],"tags":[]},{"title":"åˆ¤æ–­æ˜¯å¦æ˜¯å­æ ‘","slug":"is-subtree","date":"2019-10-27T07:49:47.000Z","updated":"2020-03-28T13:02:10.011Z","comments":true,"path":"2019/10/27/is-subtree/","link":"","permalink":"https://razertory.me/2019/10/27/is-subtree/","excerpt":"","text":"è¾“å…¥ä¸¤æ£µäºŒå‰æ ‘Aï¼ŒBï¼Œåˆ¤æ–­Bæ˜¯ä¸æ˜¯Açš„å­ç»“æ„ã€‚ï¼ˆpsï¼šæˆ‘ä»¬çº¦å®šç©ºæ ‘ä¸æ˜¯ä»»æ„ä¸€ä¸ªæ ‘çš„å­ç»“æ„ï¼‰ 1boolean HasSubtree(TreeNode root1,TreeNode root2) é¦–å…ˆåœ¨ A ä¸­æ‰¾åˆ°ä¸€ä¸ªèŠ‚ç‚¹ï¼Œæ»¡è¶³è¿™ä¸ªèŠ‚ç‚¹æ˜¯ B çš„ root èŠ‚ç‚¹ï¼Œåœ¨æ­¤åŸºç¡€ä¸ŠæŒ‰ç…§ B çš„ç»“æ„éå† Aï¼ŒBã€‚ 12345678910111213141516171819202122boolean HasSubtree(TreeNode root1,TreeNode root2) &#123; boolean result =false; if(root1!=null&amp;&amp;root2!=null)&#123; if(root1.val==root2.val) result=isSubtree(root1,root2); if(!result) result= HasSubtree(root1.left,root2); if(!result) result= HasSubtree(root1.right,root2); &#125; return result;&#125;boolean isSubtree(TreeNode root1,TreeNode root2)&#123; if(root1==null&amp;&amp;root2!=null) return false; if(root2==null) return true; if (root1.val!=root2.val) return false; return isSubtree(root1.left, root2.left) &amp;&amp; isSubtree(root1.right, root2.right);&#125;","categories":[],"tags":[]},{"title":"é“¾è¡¨ä¸­äº¤æ¢èŠ‚ç‚¹","slug":"swap-nodes-in-pairs","date":"2019-10-26T06:47:13.000Z","updated":"2020-03-28T13:02:10.010Z","comments":true,"path":"2019/10/26/swap-nodes-in-pairs/","link":"","permalink":"https://razertory.me/2019/10/26/swap-nodes-in-pairs/","excerpt":"","text":"Given a linked list, swap every two adjacent nodes and return its head.You may not modify the values in the listâ€™s nodes, only nodes itself may be changed. 1ListNode swapPairs(ListNode head) ç”±äºè¦äº¤æ¢å‰åä¸¤ä¸ªé“¾è¡¨èŠ‚ç‚¹ï¼Œå®šä¹‰ä¸€ä¸ª dummyï¼Œcurã€‚é‚£ä¹ˆæ ¸å¿ƒå°±æ˜¯äº¤æ¢ cur.next å’Œ cur.next.nextã€‚ 123456789101112ListNode swapPairs(ListNode head) &#123; ListNode dummy = new ListNode(0); dummy.next = head; ListNode cur = dummy; while(cur.next != null &amp;&amp; cur.next.next != null) &#123; ListNode a = cur.next, b = cur.next.next; cur.next = b; a.next = b.next; b.next = a; cur = a; &#125; return dummy.next;","categories":[],"tags":[]},{"title":"é“¾è¡¨ç›¸åŠ ","slug":"add-two-numbers","date":"2019-10-26T06:38:48.000Z","updated":"2020-03-28T13:02:10.009Z","comments":true,"path":"2019/10/26/add-two-numbers/","link":"","permalink":"https://razertory.me/2019/10/26/add-two-numbers/","excerpt":"","text":"You are given two non-empty linked lists representing two non-negative integers. The digits are stored in reverse order and each of their nodes contain a single digit. Add the two numbers and return it as a linked list.You may assume the two numbers do not contain any leading zero, except the number 0 itself. 1ListNode addTwoNumbers(ListNode l1, ListNode l2) è¿™é“é¢˜æœ¬è´¨ä¸Šå°±æ˜¯åœ¨æ¨¡æ‹ŸåŠ æ³•è¿ç®—ä¸­è¿›ä½çš„è¿‡ç¨‹ã€‚ 12345678910111213141516171819ListNode addTwoNumbers(ListNode l1, ListNode l2) &#123; ListNode dummy = new ListNode(0), p = dummy; int carry = 0; while (l1 != null || l2 != null || carry != 0) &#123; int cur = carry; if (l1 != null) &#123; cur += l1.val; l1 = l1.next; &#125; if (l2 != null) &#123; cur += l2.val; l2 = l2.next; &#125; p.next = new ListNode(cur % 10); p = p.next; carry = cur / 10; &#125; return dummy.next;&#125;","categories":[],"tags":[]},{"title":"æœ‰åºé“¾è¡¨å»é‡","slug":"delete-duplication","date":"2019-10-26T06:32:58.000Z","updated":"2020-03-28T13:02:10.009Z","comments":true,"path":"2019/10/26/delete-duplication/","link":"","permalink":"https://razertory.me/2019/10/26/delete-duplication/","excerpt":"","text":"åœ¨ä¸€ä¸ªæ’åºçš„é“¾è¡¨ä¸­ï¼Œå­˜åœ¨é‡å¤çš„ç»“ç‚¹ï¼Œè¯·åˆ é™¤è¯¥é“¾è¡¨ä¸­é‡å¤çš„ç»“ç‚¹ï¼Œé‡å¤çš„ç»“ç‚¹ä¸ä¿ç•™ï¼Œè¿”å›é“¾è¡¨å¤´æŒ‡é’ˆã€‚ ä¾‹å¦‚ï¼Œé“¾è¡¨1-&gt;2-&gt;3-&gt;3-&gt;4-&gt;4-&gt;5 å¤„ç†åä¸º 1-&gt;2-&gt;5 ä¼ é€é—¨ å®šä¹‰ä¸€ä¸ª dummy èŠ‚ç‚¹ï¼Œpreï¼Œcur èŠ‚ç‚¹ã€‚æ¯”è¾ƒ pre.next å’Œ curã€‚å¦‚æœç›¸åŒè®© pre = pre.next åšåˆ é™¤æ“ä½œ 123456789101112131415ListNode deleteDuplication(ListNode pHead) &#123; if (pHead == null) return null; ListNode dummy = new ListNode(0); dummy.next = pHead; ListNode prev= dummy, cur = pHead; while (cur != null) &#123; while(cur.next != null &amp;&amp; cur.val == cur.next.val) cur = cur.next; if (prev.next != cur) prev.next = cur.next; else prev = prev.next; cur = prev.next; &#125; return dummy.next;&#125;","categories":[],"tags":[]},{"title":"é“¾è¡¨ç¯çš„å…¥å£","slug":"entry-node-of-loop","date":"2019-10-26T06:28:43.000Z","updated":"2020-03-28T13:02:10.009Z","comments":true,"path":"2019/10/26/entry-node-of-loop/","link":"","permalink":"https://razertory.me/2019/10/26/entry-node-of-loop/","excerpt":"","text":"ç»™ä¸€ä¸ªé“¾è¡¨ï¼Œè‹¥å…¶ä¸­åŒ…å«ç¯ï¼Œè¯·æ‰¾å‡ºè¯¥é“¾è¡¨çš„ç¯çš„å…¥å£ç»“ç‚¹ï¼Œå¦åˆ™ï¼Œè¾“å‡ºnullã€‚ ä¼ é€é—¨ å®šä¹‰ä¸€ä¸ªæ…¢å’Œä¸€ä¸ªå¿«æŒ‡é’ˆï¼Œå½“ä¸¤ä¸ªæŒ‡é’ˆç›¸é‡çš„æ—¶å€™ã€‚å¿«æŒ‡é’ˆé€Ÿåº¦å’Œæ…¢æŒ‡é’ˆä¸€è‡´ï¼Œç­‰å†æ¬¡ç›¸é‡çš„æ—¶å€™è¿™ä¸ªç‚¹å°±æ˜¯ç¯å…¥å£ã€‚ 1234567891011121314151617ListNode EntryNodeOfLoop(ListNode pHead) &#123; if (pHead == null || pHead.next == null) return null; ListNode slow = pHead, fast = pHead; while(fast != null &amp;&amp; fast.next != null)&#123; slow = slow.next; fast = fast.next.next; if (fast == slow) &#123; slow = pHead; while(slow != fast)&#123; slow = slow.next; fast = fast.next; &#125; return slow; &#125; &#125; return null;&#125;","categories":[],"tags":[]},{"title":"é“¾è¡¨çš„å…¬å…±èŠ‚ç‚¹","slug":"first-common-node","date":"2019-10-26T06:23:52.000Z","updated":"2020-03-28T13:02:10.010Z","comments":true,"path":"2019/10/26/first-common-node/","link":"","permalink":"https://razertory.me/2019/10/26/first-common-node/","excerpt":"","text":"è¾“å…¥ä¸¤ä¸ªé“¾è¡¨ï¼Œæ‰¾å‡ºå®ƒä»¬çš„ç¬¬ä¸€ä¸ªå…¬å…±ç»“ç‚¹ã€‚ ä¼ é€é—¨ é¦–å…ˆè®¡ç®—å‡ºä¸¤ä¸ªé“¾è¡¨çš„å„è‡ªé•¿åº¦ï¼Œç„¶åè®¡ç®—å‡ºä¸€ä¸ªå·®å€¼ deltaã€‚ç„¶ååŸºäº delta çš„å€¼èµ°å¯¹åº”çš„èŠ‚ç‚¹ï¼Œå½“ delta å˜ä¸º 0 çš„æ—¶å€™åœæ­¢ã€‚å¹¶åˆ¤æ–­æ˜¯å¦æœ‰å…¬å…±èŠ‚ç‚¹ 12345678910111213141516171819202122232425ListNode FindFirstCommonNode(ListNode pHead1, ListNode pHead2) &#123; if (pHead1 == null || pHead2 == null ) return null; ListNode node1 = pHead1, node2 = pHead2; int len1 = 0, len2 = 0; for (; node1 !=null; node1 = node1.next, len1++); for (; node2 !=null; node2 = node2.next, len2++); int delta = len1 - len2; node1 = pHead1; node2 = pHead2; while (delta &gt; 0) &#123; node1 = node1.next; delta--; &#125; while (delta &lt; 0) &#123; node2 = node2.next; delta++; &#125; while (node1 != node2) &#123; node1 = node1.next; node2 = node2.next; &#125; return node1;&#125;","categories":[],"tags":[]},{"title":"å¤åˆ¶å¤æ‚é“¾è¡¨","slug":"copy-linked-list","date":"2019-10-26T06:14:46.000Z","updated":"2020-03-28T13:02:10.009Z","comments":true,"path":"2019/10/26/copy-linked-list/","link":"","permalink":"https://razertory.me/2019/10/26/copy-linked-list/","excerpt":"","text":"è¾“å…¥ä¸€ä¸ªå¤æ‚é“¾è¡¨ï¼ˆæ¯ä¸ªèŠ‚ç‚¹ä¸­æœ‰èŠ‚ç‚¹å€¼ï¼Œä»¥åŠä¸¤ä¸ªæŒ‡é’ˆï¼Œä¸€ä¸ªæŒ‡å‘ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ï¼Œå¦ä¸€ä¸ªç‰¹æ®ŠæŒ‡é’ˆæŒ‡å‘ä»»æ„ä¸€ä¸ªèŠ‚ç‚¹ï¼‰ï¼Œè¿”å›ç»“æœä¸ºå¤åˆ¶åå¤æ‚é“¾è¡¨çš„ headã€‚ï¼ˆæ³¨æ„ï¼Œè¾“å‡ºç»“æœä¸­è¯·ä¸è¦è¿”å›å‚æ•°ä¸­çš„èŠ‚ç‚¹å¼•ç”¨ï¼Œå¦åˆ™åˆ¤é¢˜ç¨‹åºä¼šç›´æ¥è¿”å›ç©ºï¼‰ ä¼ é€é—¨ æ¯ä¸ªé“¾è¡¨éƒ½æœ‰ä¸¤ä¸ªæŒ‡é’ˆï¼Œè¿™ç§æƒ…å†µä¸‹æœ€ç®€å•çš„åšæ³•æ˜¯ç”¨ä¸€ä¸ª k, v çš„æ–¹å¼å­˜æ”¾æ‰€æœ‰çš„èŠ‚ç‚¹ä»¥åŠæ–°çš„åªæœ‰ labelï¼ŒæŒ‡é’ˆæŒ‡å‘çš„èŠ‚ç‚¹ä¸ºç©ºçš„èŠ‚ç‚¹ã€‚ç„¶åç”¨åŸæ¥çš„èŠ‚ç‚¹æŒ‡é’ˆæŒ‡å‘çš„å€¼å¤åˆ¶åˆ°æ–°èŠ‚ç‚¹ã€‚ 123456789101112131415161718192021222324// public class RandomListNode &#123;// int label;// RandomListNode next = null;// RandomListNode random = null;// RandomListNode(int label) &#123;// this.label = label;// &#125;// &#125;RandomListNode Clone(RandomListNode pHead) &#123; HashMap&lt;RandomListNode, RandomListNode&gt; map = new HashMap&lt;&gt;(); RandomListNode cur = pHead; while(cur != null) &#123; map.put(cur, new RandomListNode(cur.label)); cur = cur.next; &#125; cur = pHead; while(cur != null) &#123; map.get(cur).next = map.get(cur.next); map.get(cur).random = map.get(cur.random); cur = cur.next; &#125; return map.get(pHead);&#125;","categories":[],"tags":[]},{"title":"åè½¬é“¾è¡¨","slug":"reverse-list","date":"2019-10-26T06:05:27.000Z","updated":"2020-03-28T13:02:10.010Z","comments":true,"path":"2019/10/26/reverse-list/","link":"","permalink":"https://razertory.me/2019/10/26/reverse-list/","excerpt":"","text":"è¾“å…¥ä¸€ä¸ªé“¾è¡¨ï¼Œåè½¬é“¾è¡¨åï¼Œè¾“å‡ºæ–°é“¾è¡¨çš„è¡¨å¤´ã€‚Example: 12Input: 1-&gt;2-&gt;3-&gt;4-&gt;5-&gt;NULLOutput: 5-&gt;4-&gt;3-&gt;2-&gt;1-&gt;NULL ä¼ é€é—¨ åè½¬çš„è¿‡ç¨‹éœ€è¦æå‰å‡†å¤‡å¥½ä¸‹ä¸ªèŠ‚ç‚¹çš„ï¼Œç”¨åˆ°ä¸¤ä¸ªæŒ‡é’ˆï¼Œcur å’Œ pre æŒ‡å‘æ–°èŠ‚ç‚¹å’Œç”¨äºå­˜æ”¾åŸæœ¬çš„ä¸‹ä¸ªèŠ‚ç‚¹ 12345678910ListNode reverseList(ListNode head) &#123; ListNode cur = head, pre = null; while (cur != null) &#123; ListNode next = cur.next; // æå‰å‡†å¤‡å¥½æŒ‡å‘ä¸‹ä¸ªèŠ‚ç‚¹ cur.next = pre; pre = cur; cur = next; &#125; return pre;&#125;","categories":[],"tags":[]},{"title":"å½’å¹¶æ’åº","slug":"merge-sort","date":"2019-10-26T03:36:12.000Z","updated":"2020-03-28T13:02:10.010Z","comments":true,"path":"2019/10/26/merge-sort/","link":"","permalink":"https://razertory.me/2019/10/26/merge-sort/","excerpt":"","text":"å½’å¹¶æ’åºæœ€æ ¸å¿ƒçš„æ€æƒ³å°±æ˜¯ merge ä¸¤ä¸ªæœ‰åºçš„æ•°ç»„ã€‚å‡è®¾ä¸¤ä¸ªåªæœ‰ä¸€ä¸ªå…ƒç´ çš„æ•°ç»„åˆå¹¶ï¼Œæ¯”å¦‚ [34], [33]ï¼Œåˆå¹¶ä¹‹åå°±æ˜¯ [33, 34]ã€‚å‡è®¾è¿™ä¸ªæ•°ç»„è¦å’Œ [1, 100] åˆå¹¶ï¼Œåˆå¹¶ä¹‹åå°±æ˜¯ [1, 33, 34, 100]ã€‚ å¯ä»¥çœ‹å‡ºå½“å¤§å°ä¸º n çš„æœ‰åºæ•°ç»„å’Œå¤§å°ä¸º m çš„æœ‰åºæ•°ç»„åˆå¹¶ä¹‹åå¤§å°å°±æ˜¯ n + mã€‚æ‰€ä»¥æœ€é‡è¦çš„å°±æ˜¯å†™å‡ºé«˜æ•ˆçš„åˆå¹¶ç®—æ³•ï¼Œå‡è®¾å‡½æ•°çš„ç­¾åæ˜¯ 123// aï¼Œ b éœ€è¦åˆå¹¶çš„æ•°ç»„// temp ç”¨æ¥å­˜æ”¾åˆå¹¶åçš„æ•°ç»„void merge (int[] a, int[] b, int[] temp) å…¶ä¸­ aï¼Œb å¯ä»¥ç”¨åŒä¸€ä¸ªæ•°ç»„ä¸­çš„ lowï¼Œmidï¼Œhigh ä¸‰ç»„ä¸‹æ ‡è¡¨ç¤ºï¼Œè¿™æ ·åšçš„åŸå› æ˜¯ä¸ºäº†å°½é‡å‡å°‘å†…å­˜å¼€é”€ã€‚ 123456789101112// arr åŸæ•°ç»„// low, mid, high åˆ†å‰²æˆä¸¤ä¸ªéœ€è¦ merge çš„å­æ•°ç»„void merge (int[] arr, int low, int mid, int high, int[] temp) &#123; int i = low, j = mid + 1, k = 0; while (i &lt;= mid &amp;&amp; j &lt;= high) &#123; if (arr[i] &lt;= arr[j]) tmp[k++] = arr[i++]; else tmp[k++] = arr[j++]; &#125; while (i &lt;= mid) tmp[k++] = arr[i++]; while (j &lt;= high) tmp[k++] = arr[j++]; System.arraycopy(tmp, 0, arr, low, k);&#125; åœ¨ merge å‡½æ•°å·²ç»å®Œæˆçš„æƒ…å†µä¸‹ï¼Œæ¥ä¸‹æ¥å°±éœ€è¦æŠŠåŸæ¥çš„æ•°ç»„è¿›è¡Œé€’å½’åœ°æ‹†åˆ†ç„¶å mergeã€‚ 12345678void mergeSort(int[] arr, int low, int high, int[] tmp) &#123; if (low &lt; high) &#123; int mid = low + (high - low) / 2; mergeSort(arr, low, mid, tmp); mergeSort(arr, mid + 1, high, tmp); merge(arr, low, mid, high, tmp); &#125;&#125;","categories":[],"tags":[]},{"title":"å †æ’åº","slug":"heap-sort","date":"2019-10-20T06:20:42.000Z","updated":"2020-03-28T13:02:10.008Z","comments":true,"path":"2019/10/20/heap-sort/","link":"","permalink":"https://razertory.me/2019/10/20/heap-sort/","excerpt":"","text":"å †æ˜¯ä¸€ç§èƒ½æ–¹ä¾¿è§£å†³ top é—®é¢˜çš„æ ‘å½¢æ•°æ®ç»“æ„ï¼Œåˆ©ç”¨è¿™ä¸ªæ€§è´¨ä¹Ÿå¯ä»¥ç”¨æ¥è§£å†³æ’åºé—®é¢˜ã€‚é¦–å…ˆç”Ÿæˆæœ€å¤§å †ï¼Œç„¶åé€†åºéå†è¯¥æ•°ç»„ï¼Œè¿‡ç¨‹ä¸­é€šè¿‡æ¯”è¾ƒå †çš„æœ€å¤§å€¼ã€‚å¦‚æœå°äºï¼Œå°±æ”¾åˆ°æ•°ç»„çš„æœ€åä¸€ä¸ªï¼Œå¹¶ä¸”è°ƒæ•´å †ã€‚æ‰€ä»¥åœ¨å †æ’åºä¸­ï¼Œå¦‚ä½•æ„å»ºå †å’Œè°ƒæ•´å †æˆä¸ºäº†é—®é¢˜çš„å…³é”®ã€‚æœ€ç®€å•ï¼Œæœ‰æ•ˆçš„åšæ³•å°±æ˜¯ç”¨ä¸€ä¸ªä¸€ä½æ•°ç»„æ¥è¡¨ç¤ºå †ã€‚æ¯”å¦‚ä¸€é¢—äºŒå‰æ ‘å¯ä»¥ç”¨æ•°ç»„æ¥è¡¨ç¤ºï¼š 123456[9, 4, 7, 3, 1, 2] 9 / \\ 4 7 / \\ / 3 1 2 åœ¨ä¸€ä½æ•°ç»„è¡¨ç¤ºæ³•ä¸­ï¼Œæ¯”å¦‚ root èŠ‚ç‚¹ 9 çš„ä¸‹æ ‡æ˜¯ 0ï¼Œå®ƒçš„ä¸¤ä¸ªå­èŠ‚ç‚¹ä¸‹æ ‡åˆ†åˆ«æ˜¯ 1ï¼Œ2 â€¦ é€šè¿‡ä¸æ–­æ¯”è¾ƒå¯ä»¥å‘ç°è§„å¾‹ã€‚ä¸‹æ ‡ä¸º n çš„æ ‘çš„èŠ‚ç‚¹ï¼Œä¸¤ä¸ªå­èŠ‚ç‚¹çš„ä¸‹æ ‡åˆ†åˆ«æ˜¯ 2 * n + 1, 2 * n + 2; åŒæ ·çš„ï¼Œå¦‚æœä¸€ä¸ªèŠ‚ç‚¹ä¸‹æ ‡æ˜¯ mï¼Œå¯¹åº”çš„çˆ¶èŠ‚ç‚¹çš„ä¸‹æ ‡æ˜¯ (m - 1) / 2ã€‚é‚£ä¹ˆå½“ç»™ä¸€ä¸ªè½¬æ¢æˆäºŒå‰æ ‘çš„æ•°ç»„ 123456[3, 1, 2, 5, 6] 3 / \\ 1 2 / \\ 5 6 éœ€è¦é€šè¿‡ä¸€ä¸ªæ–¹æ³•è®©è¿™ä¸ªäºŒå‰æ ‘æ»¡è¶³æœ€å¤§å †æ€§è´¨ã€‚ é¦–å…ˆï¼Œåœ¨è¿™ä¸ªäºŒå‰æ ‘ä¸­æ¯ä¸ªèŠ‚ç‚¹å¯¹åº”çš„æ•°åœ¨æ•°ç»„ä¸­éƒ½æœ‰å¯¹åº”çš„ä¸‹æ ‡ï¼ŒæŒ‰ç…§ä¸Šè¿°çš„æ ¹èŠ‚ç‚¹ï¼Œå­èŠ‚ç‚¹çš„å…³ç³»ï¼Œåœ¨æ•°ç»„ä¸­é—´ä¹‹åçš„æ•°å°±ä¸ä¼šæœ‰å¯¹åº”çš„å­èŠ‚ç‚¹äº†å‡è®¾æ•°ç»„é•¿åº¦æ˜¯ mï¼Œé‚£ä¹ˆï¼ˆ2 * m / 2 + 1) &gt; m è¿™ç§æƒ…å†µæ˜¾ç„¶ä¸éœ€è¦ã€‚ä¹Ÿå°±æ˜¯è¯´ç›®å‰åªéœ€è¦ä»ä¸‹æ ‡ä¸º 5 / 2 = 2 çš„èŠ‚ç‚¹å¼€å§‹ã€‚ï¼ˆè€ƒè™‘åˆ°æ•´æ•°ç›¸é™¤ä¼šæœ‰å–æ•´ï¼Œå› æ­¤è¿™ä¸ªåœ°æ–¹ä»ä¸­é—´å¼€å§‹åªæ˜¯ä¸ºäº†æ€§èƒ½æ›´å¥½ï¼‰ã€‚è¿™ä¸ªæ—¶å€™ï¼Œ ä»ä¸‹æ ‡ä¸º 2 çš„èŠ‚ç‚¹ 2 å¼€å§‹ï¼Œå‘ç°æ²¡æœ‰å­èŠ‚ç‚¹ï¼Œä¸‹æ ‡å‡ 1 ä»ä¸‹æ ‡ä¸º 1 çš„èŠ‚ç‚¹ 1 å¼€å§‹ï¼Œå‘ç°å·¦èŠ‚ç‚¹æ›´å¤§ï¼Œäºæ˜¯äº¤æ¢å˜æˆ123456[3, 5, 2, 1, 6] 3 / \\ 5 2 / \\ 1 6 æ­¤æ—¶ï¼ŒèŠ‚ç‚¹ 1 æ²¡æœ‰å­èŠ‚ç‚¹ï¼Œç»§ç»­ä»ä¸‹æ ‡ 1 æ¯”è¾ƒï¼Œå‘ç°å³èŠ‚ç‚¹æ›´å¤§ï¼Œäºæ˜¯äº¤æ¢å˜æˆ 123456[3, 6, 2, 1, 5] 3 / \\ 6 2 / \\ 1 5 æ­¤æ—¶ï¼ŒèŠ‚ç‚¹ 5 æ²¡æœ‰å­èŠ‚ç‚¹ï¼Œä¸‹æ ‡å‡ 1 ä»ä¸‹æ ‡ä¸º 0 çš„èŠ‚ç‚¹ 3 å¼€å§‹ï¼Œå‘ç°å·¦èŠ‚ç‚¹æ›´å¤§ï¼Œäºæ˜¯äº¤æ¢å˜æˆ123456[6, 3, 2, 1, 5] 6 / \\ 3 2 / \\ 1 5 æ­¤æ—¶ï¼ŒèŠ‚ç‚¹ 3 çš„å³è¾¹èŠ‚ç‚¹æ›´å¤§ï¼Œäºæ˜¯äº¤æ¢å˜æˆ 123456[6, 5, 2, 1, 3] 6 / \\ 5 2 / \\ 1 3 æ­¤æ—¶ï¼ŒèŠ‚ç‚¹ 3 æ²¡æœ‰å­èŠ‚ç‚¹ï¼Œä¸‹æ ‡å‡ 1 ä¸‹æ ‡ç›®å‰å·²ç»å°äº 0 ç»“æŸã€‚ ä»¥ä¸Šå°±æ˜¯å¦‚ä½•æ„å»ºå †çš„è¿‡ç¨‹ï¼Œå¯ä»¥çœ‹åˆ°æœ¬è´¨ä¸Šå°±æ˜¯åˆ©ç”¨æ•°ç»„ä¸­èŠ‚ç‚¹ä¹‹å‰çš„å…³ç³»ï¼Œé€šè¿‡æ¯”è¾ƒå¤§å°çš„æ–¹æ³•æ¥äº¤æ¢é¡ºåºã€‚ å½“ä¸€ä¸ªæœ€å¤§å †æ„å»ºæˆåŠŸåï¼Œå¦‚ä½•åšæ’åºå‘¢ï¼Ÿ åœ¨æœ€å¤§å †ä¸­ï¼ŒæŠŠ root èŠ‚ç‚¹å’Œæ•°ç»„ä¸­æœ€åä¸€ä¸ªå€¼äº¤æ¢ã€‚è¿™ä¸ªæ—¶å€™æŠŠæ•°ç»„åˆ†ä¸ºä¸¤ä¸ªåŒºåŸŸï¼Œæœ‰åºåŒºå’Œæ— åºåŒºã€‚ 123456[3, 5, 2, 1, 6] 3 / \\ 5 2 / \\ 1 6 æ­¤æ—¶è®¤ä¸º [6] ä¸ºæœ‰åºåŒºï¼Œ[3, 5, 2, 1] ä¸ºæ— åºåŒºã€‚æ­¤æ—¶å¯ä»¥è®¤ä¸ºå †æ˜¯ 12345 3 / \\ 5 2 / 1 è¿™ä¸ªæ—¶å€™ç»§ç»­è°ƒæ•´æˆä¸ºæœ€å¤§å †å³å¯ã€‚æœ€ç»ˆæœ‰åºåŒºä¼šé€æ¸å¡«æ»¡çš„åŒæ—¶ï¼Œæ— åºåŒºä¼šé€æ¸å˜å°ç›´åˆ°æ¶ˆå¤±ã€‚è¿™ä¸ªè¿‡ç¨‹å¯ä»¥è¡¨ç¤ºä¸º 123456789101112131415private void buildMaxHeap(int[] arr, int end) &#123; for (int i = end/2; i &gt;= 0; --i) &#123; siftDown(arr, i, end); &#125;&#125;private void siftDown(int[] arr, int i, int end) &#123; int parent = i, child = 2 * parent + 1; while (child &lt;= end) &#123; if (child+1 &lt;= end &amp;&amp; arr[child+1] &gt; arr[child]) ++child; if (arr[parent] &gt;= arr[child]) break; swap(arr, parent, child); parent = child; child = 2 * parent + 1; &#125;","categories":[],"tags":[]},{"title":"å¿«é€Ÿæ’åº","slug":"quick-sort","date":"2019-10-19T08:52:23.000Z","updated":"2020-03-28T13:02:10.008Z","comments":true,"path":"2019/10/19/quick-sort/","link":"","permalink":"https://razertory.me/2019/10/19/quick-sort/","excerpt":"","text":"é¦–å…ˆæŒ‘é€‰åŸºå‡†å€¼ï¼›ç„¶ååˆ†å‰²æ•°ç»„ï¼ŒæŠŠå°äºåŸºå‡†å€¼çš„å…ƒç´ æ”¾åˆ°åŸºå‡†å€¼å‰é¢ï¼Œå¤§äºåŸºå‡†å€¼çš„å…ƒç´ æ”¾åˆ°åŸºå‡†å€¼åé¢ï¼›æœ€åé€’å½’åœ°å¯¹å°äºåŸºå‡†å€¼çš„å­åºåˆ—å’Œå¤§äºåŸºå‡†å€¼çš„å­åºåˆ—è¿›è¡Œæ’åºã€‚å¦‚æœç”¨å‡½æ•°å®šä¹‰å¿«é€Ÿæ’åº f()ï¼Œé‚£ä¹ˆé¦–å…ˆç»™è¿™ä¸ªå‡½æ•°ç­¾åä¸º f(arr, low, high)ã€‚å…¶ä¸­ï¼Œarr è¡¨ç¤ºä¼ å…¥çš„æ•°ç»„å¯¹è±¡ï¼Œlow è¡¨ç¤ºéœ€è¦æ’åºçš„å¼€å§‹ä¸‹æ ‡ï¼Œhigh è¡¨ç¤ºéœ€è¦æ’åºçš„ç»“æŸä¸‹æ ‡ï¼Œé‚£ä¹ˆè¿™ä¸ªå‡½æ•°å¯ä»¥å®Œæ•´åœ°è¡¨ç¤ºä¸ºã€‚ 12345f(arr, low, high) = if low &lt; high pivot = partition(arr, low, high) f(arr, low, pivot - 1) f(arr, pivot + 1, high) æ€»ç»“èµ·æ¥å°±æ˜¯ï¼Œé€‰åŸºï¼Œåˆ†ç»„ï¼Œé€’å½’ã€‚åˆ†ç»„å‡½æ•° partition(arr, low, high) çš„ä½œç”¨æ˜¯æŠŠå°äºåŸºå‡†å€¼çš„æ”¾åœ¨å‰é¢ï¼Œå¤§äºåŸºå‡†å€¼çš„æ”¾åœ¨åé¢ï¼Œæœ€åè¾“å‡ºåˆ†ç»„ä¹‹ååŸºå‡†å€¼æ‰€åœ¨çš„ä½ç½®ã€‚åšåˆ†ç»„æœ€ç»å…¸çš„åšæ³•æ˜¯ç”¨ lomuto æˆ–è€… hoare åˆ†ç»„æ³•ã€‚lomuto åˆ†ç»„æ³•é€‰ä¸­ç¬¬ä¸€ä¸ºä¸ª pivotï¼Œåˆ©ç”¨ä¸¤ä¸ªæ¸¸æ ‡ i å’Œ j æŠŠæ•°ç»„åˆ’åˆ†æˆ 1234arr[pivot] | arr[(pivot+1)..(j)] | arr[(j + 1)..(i-1)] | arr[i..high]pivot | æ¯” pivot å° | æ¯” pivot å¤§ | æœªå¤„ç†åœ¨åˆ’åˆ†ç»“æŸä¹‹åï¼Œäº¤æ¢ pivot å’Œ jlomuto åˆ†å‰²æ³•é‡Œé¢ï¼Œpivot çš„é€‰å–ä¼šå†³å®šæ•°ç»„çš„åˆ†ç»„æ–¹å¼ 1234567891011int partition(int[] array, int low, int high) &#123; int pivot = array[low], index = low; for (int i = low; i &lt;= high; i++) &#123; if (array[i] &lt; pivot) &#123; index++; swap(array, i, index); &#125; &#125; swap(array, index, low); return index;&#125; hoare åˆ†ç»„æ³•é€‰ä¸­ä»»æ„ä¸€ä¸ªä½œä¸º pivotï¼Œåˆ©ç”¨ä¸¤ä¸ªæ¸¸æ ‡ i å’Œ jï¼Œåšæ•°ç»„çš„å·¦å³å¾€é‡Œé¢æ‰«æã€‚i æ‰«è¿‡çš„åŒºåŸŸä¸€å®šè¦æ¯” pivot å°ï¼Œj æ‰«è¿‡çš„åŒºåŸŸä¸€å®šæ¯” pivot å¤§ã€‚å½“é‡åˆ°ä¸æ»¡è¶³æ¡ä»¶çš„æ—¶å€™ï¼Œäº¤æ¢ i, j æŒ‡å‘çš„å†…å®¹ã€‚ 1234567891011int partition(int[] array, int low, int high) &#123; int p = array[low]; int i = low, j = high; while(i &lt; j) &#123; while (i &lt; j &amp;&amp; array[j] &gt; p) j--; if(i &lt; j) swap(array, i, j); while (i &lt; j &amp;&amp; array[i] &lt;= p) i++; if(i &lt; j) swap(array, i, j); &#125; return i;&#125; ps: hoare åˆ†ç»„æ³•ä¼šæ¯” lomuto åˆ†ç»„æ³•æœ‰å¹³å‡å°‘ 3 å€çš„ swap æ¬¡æ•°ã€‚å‚è€ƒ hoare å’Œ lomuto éƒ½æ˜¯ä¸ç¨³å®šçš„ï¼Œå¹¶ä¸”åœ¨å…ƒç´ å…¨éƒ¨æœ‰åºçš„æƒ…å†µä¸‹å¤æ‚åº¦éƒ½æ˜¯ O(n^2) å®Œæ•´ä»£ç å’Œæµ‹è¯•ç”¨ä¾‹ å‘æ˜è€… Tony Hoare","categories":[],"tags":[]},{"title":"æ‰€ä»¥æ€ä¹ˆå‡å°‘ bug å‘¢ï¼Ÿ","slug":"how-to-reduce-bug","date":"2019-09-22T07:41:36.000Z","updated":"2020-03-28T13:02:10.008Z","comments":true,"path":"2019/09/22/how-to-reduce-bug/","link":"","permalink":"https://razertory.me/2019/09/22/how-to-reduce-bug/","excerpt":"","text":"ä»è½¯ä»¶å·¥ç¨‹è¯ç”Ÿä¹‹åˆï¼Œã€Œå‡å°‘ bugã€æˆäº†æ‰€æœ‰å¼€å‘å›¢é˜Ÿçš„å…±åŒç›®æ ‡ã€‚è¦å‡å°‘ bug å°±è¦çŸ¥é“ bug æ˜¯æ€ä¹ˆæ¥çš„: åŸå›  äº§å“è®¾è®¡ã€‚äº§å“é€»è¾‘å­˜åœ¨æ¼æ´ï¼Œæˆ–è€…æ‚–è®ºã€‚è¡¨ç°å‡ºæ¥çš„ç—‡çŠ¶æ˜¯ç”¨æˆ·ä½¿ç”¨æˆæœ¬é«˜ï¼Œä»¥åŠåœ¨éå¸¸è§„çš„æ“ä½œæƒ…å†µä¸‹ï¼Œäº§ç”Ÿäº†éå¸¸æ„å¤–çš„ç»“æœã€‚ä¾‹å¦‚æœåŠ¡å™¨æŠ¥é”™ï¼Œå®¢æˆ·ç«¯é—ªé€€ï¼Œä¸¥é‡çš„æ¯”å¦‚æ”¯ä»˜ç›¸å…³çš„ç³»ç»Ÿå¸¦æ¥å·¨å¤§çš„éšæ‚£ã€‚ ä¸šåŠ¡ç†è§£ã€‚å¯¹ä¸šåŠ¡ä¸ç†Ÿæ‚‰ï¼Œå†™å‡ºçš„ä»£ç ä¸€å®šç¨‹åº¦ä¸Šå’Œä¸šåŠ¡ç›¸èƒŒã€‚ ç»†èŠ‚æŠŠæ§ã€‚æ²¡æœ‰å¤„ç†å¥½ä»£ç ä¸­çš„è¾¹ç•Œæ¡ä»¶ã€‚ å†å²æ•°æ®ã€‚æ–°çš„ feature ä¸å¯é¿å…çš„ä¼šå»è¯»å†™å†å²æ•°æ®ï¼Œè€Œå†å²æ•°æ®å¯èƒ½æœ‰çš„æ˜¯è„æ•°æ®ã€‚ åŸºç¡€ä¸è¶³ã€‚ä¾‹å¦‚å¯¹è¯­è¨€ã€æ¡†æ¶ä¸ç†Ÿæ‚‰ï¼Œæˆ–è€…ç†è§£é”™äº†ã€‚å‡ºç°äº†ä¸»è§‚ä¸Šè®¤ä¸ºæ„æ–™ä¹‹å¤–çš„äº‹æƒ… å‡†å¤–éƒ¨åŸå› ã€‚ä¾‹å¦‚æŸäº›æ¡†æ¶å¯èƒ½è‡ªèº«æœ‰æ²¡æœ‰ä¿®å¤æˆ–è€…æ²¡æœ‰è¢«å‘ç°çš„ bug å¤–éƒ¨åŸå› ã€‚æ¯”å¦‚å„ç§æœåŠ¡æä¾›å•†å‡ºç°äº†æ•…éšœã€‚ æŠ€æœ¯åè°ƒé—®é¢˜ã€‚ æ¯”å¦‚å‰ç«¯å’ŒæœåŠ¡ç«¯ï¼ŒæœåŠ¡ç«¯ä¹‹é—´çš„å¾®æœåŠ¡è°ƒç”¨ï¼Œä¸€æ–¹æä¾›çš„æœåŠ¡æ²¡æœ‰æŒ‰ç…§é¢„æœŸçš„é€»è¾‘æ‰§è¡Œ è§£å†³&amp;é¿å… äº§å“å°½é‡åšåˆ°å¯ä»¥é¡ºåˆ©è¿›è¡Œ ã€Œprd reviewã€ï¼Œéƒ¨åˆ†å…·ä½“çš„å®ç°éœ€è¦å’Œ dev ä¸€èµ·è®¨è®ºã€‚å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œç®€åŒ–é€»è¾‘æ˜¯å¯ä»¥ä¼˜å…ˆè€ƒè™‘çš„ç‚¹ï¼Œå¯¹ç”¨æˆ·å’Œå¼€å‘éƒ½ä¼šæ¯”è¾ƒå‹å¥½ã€‚ ç¨‹åºå‘˜è‡ªèº«çš„ç†è§£èƒ½åŠ›å’Œå·¥ä½œæ€åº¦ã€‚ç†è§£èƒ½åŠ›åŸåˆ™ä¸Šåœ¨æ‹›è˜æœŸé—´å°±éœ€è¦è¢«è¿‡æ»¤ï¼Œå·¥ä½œæ€åº¦éœ€è¦ä»ç®¡ç†è€…è‡ªä¸Šè€Œä¸‹åœ°å»å½±å“ï¼Œè¿™æ˜¯ä¸€ä¸ªéœ€è¦é•¿æœŸæ§åˆ¶è°ƒæ•´çš„äº‹æƒ…ã€‚ æé«˜ç¼–ç¨‹èƒ½åŠ›å’Œä¿æŒ unit test æ¥æœ€å¤§ç¨‹åº¦é¿å…é—æ¼æ‰ä»£ç ä¸­çš„è¾¹ç•Œæ¡ä»¶ã€‚ æ•°æ®åº“è®¾è®¡æ»¡è¶³åŸºç¡€èŒƒå¼å’Œç°ä»£åŒ–çš„è®¾è®¡è§„åˆ™ã€‚å¦‚æœå·²å­˜åœ¨è„æ•°æ®ï¼Œé‚£ä¹ˆä¾ç…§é—®é¢˜çš„ä¸¥é‡æ€§æ¥ç¡®å®šçŸ­æœŸå†…æ˜¯å¦è€ƒè™‘åŠ å¤§æ—¶é—´æˆæœ¬ã€‚åŒæ—¶å…³é”®èŠ‚ç‚¹æ‰“å°å¥½æ—¥å¿—ï¼Œå¹¶å®Œå–„æ—¥å¿—æ”¶é›†ç³»ç»Ÿã€‚ åŸåˆ™ä¸Šé€šè¿‡æ‹›è˜æ¥æ§åˆ¶ã€‚ä½†ä¸ªäººçš„å­¦ä¹ ç§¯ç´¯ä¹ŸåŒæ ·é‡è¦ï¼Œéœ€è¦é¿å…ä¸ªäººå‘å±•é€Ÿåº¦æ…¢äºå…¬å¸å‘å±•é€Ÿåº¦ã€‚ æŠ€æœ¯é€‰å‹ä¸Šä¿æŒè°¨æ…çš„æ€åº¦ã€‚å¦‚æœæŸäº›æŠ€æœ¯æ²¡æœ‰ç»è¿‡å¯é çš„éªŒè¯ï¼ŒåŸåˆ™ä¸Šä¸å¼•å…¥ã€‚é™¤éè¿™ä¸ªæŠ€æœ¯å®ç°æ–¹å¼éå¸¸æ¸…æ™°ï¼Œå¹¶ä¸”å›¢é˜Ÿæˆå‘˜ä¸€è‡´è®¤å¯ã€‚ ç¼–ç ä¸Šä¸ç¬¬ 3 ç‚¹ä¿æŒä¸€è‡´ã€‚æ¶æ„è®¾è®¡ä¸Šåšåˆ°èƒ½å¤Ÿç†”æ–­ã€é™çº§ï¼Œç¡®ä¿ä¸å› ä¸ºå•ç‹¬æ•…éšœå½±å“åˆ°æ•´ä¸ªç³»ç»Ÿã€‚ ç»™é¡¹ç›®/APIåŠ ä¸Š change log ç”šè‡³ hook æ¥ç¡®ä¿åè®®ç¨³å®šï¼Œæ­é…ä¸Šè‡ªåŠ¨ç”Ÿæˆçš„æ–‡æ¡£ã€‚å¼€å‘è¿‡ç¨‹ä¸­ä¿æŒé«˜æ•ˆçš„æ²Ÿé€šã€‚","categories":[],"tags":[{"name":"æ€è€ƒ","slug":"æ€è€ƒ","permalink":"https://razertory.me/tags/æ€è€ƒ/"}]},{"title":"ã€Œè¯»ä¹¦ã€ååº”å¼è®¾è®¡æ¨¡å¼","slug":"reactive-design-pattern","date":"2019-08-04T02:23:27.000Z","updated":"2020-03-28T13:02:10.007Z","comments":true,"path":"2019/08/04/reactive-design-pattern/","link":"","permalink":"https://razertory.me/2019/08/04/reactive-design-pattern/","excerpt":"","text":"ä¸€ç›´ä»¥æ¥æˆ‘éƒ½æ²¡æœ‰åˆ»æ„å»å­¦è®¾è®¡æ¨¡å¼è¿™ä¸€å—ï¼Œå› ä¸ºè®¤ä¸ºè¯­è¨€æœ¬èº«çš„è®¾è®¡ä¼šéœ€è¦äººé™„å¸¦å‡ºä¸€äº›è®¾è®¡æ¨¡å¼ï¼Œç‰¹åˆ«æ˜¯ä»¥ Java ä¸ºä¸»å¯¼çš„ OOP è¯­è¨€ï¼Œè€Œè¿™äº›è®¾è®¡æ¨¡å¼å‡ºç°å…¶å®å°±æ˜¯è®©äººä¸ºäº†æ¥å—è¿™æ ·çš„è¯­è¨€æ„é€ è€Œåˆä¸å¾—ä¸å­¦çš„ä¸œè¥¿ã€‚æˆ‘è®¤ä¸ºã€Œè®¾è®¡æ¨¡å¼ã€åº”è¯¥æ˜¯è¯­è¨€æ— å…³çš„ï¼Œæ˜¯ design-pattern è€Œä¸æ˜¯ coding-patternã€‚ Part 1ååº”å¼å®£è¨€ äº 2014 å¹´å‘å¸ƒï¼Œæ˜¯ç§»åŠ¨äº’è”ç½‘å‘å±•æœ€è¿…çŒ›çš„æ—¶é—´æ®µã€‚å›½å†…ç§»åŠ¨äº’è”ç½‘çš„ç”¨æˆ·é‡ï¼Œæµé‡åœ¨ç–¯ç‹‚å¢é•¿ã€‚åœ¨è¿™æ ·çš„æ—¶ä»£èƒŒæ™¯ä¸‹ï¼Œæœ‰ä¸€æ³¢ç‰›é€¼çš„å·¥ç¨‹å¸ˆä¸ºäº†è®©è‡ªå·±çš„ç³»ç»Ÿèƒ½å¤Ÿæ›´ç¬¦åˆå½“å‰çš„çŠ¶å†µä»¥åŠä»Šåçš„å‘å±•æå‡ºäº†è¿™ä¹ˆä¸€å¥—å‡†åˆ™ï¼š responsive å³æ—¶å“åº”æ€§ï¼šå¿…é¡»å¯¹ç”¨æˆ·ä½œå‡ºå“åº”ã€‚å½“ç³»ç»Ÿæœ‰å¤–éƒ¨è°ƒç”¨çš„æ—¶å€™ï¼Œåº”è¯¥æœ‰ä¸”ä¸€å®šæœ‰å¿«é€Ÿï¼Œä¸€è‡´çš„å“åº”æ—¶é—´ã€‚è¿™å¯ä»¥ä½œä¸ºç³»ç»Ÿå¯ç”¨æ€§çš„æ ¸å¿ƒæŒ‡æ ‡ã€‚è·å¾—è¿™æ ·çš„ç‰¹æ€§ï¼Œæœ¬è´¨ä¸Šå°±æ˜¯é™ä½å»¶è¿Ÿã€‚é‡‡ç”¨çš„æ–¹æ³•æœ‰åˆ©ç”¨é˜Ÿåˆ—ã€å¹¶è¡ŒåŒ–ç­‰ã€‚æ•´ä½“çš„è®¾è®¡éœ€è¦ä¸€å®šç¨‹åº¦é¿å…å‡ºç°å¤§æ³¥çƒï¼Œè¿™ä¸€ç‚¹å’Œåæ¥ç«çƒ­çš„ä¸ºå¾®æœåŠ¡ç†å¿µä¸è°‹è€Œåˆã€‚ä½†æœ‰æ—¶å€™æˆ‘ä»¬çš„ç³»ç»Ÿä¼šå»é›†æˆå¤–éƒ¨çš„éååº”å¼çš„ç³»ç»Ÿï¼Œå¹¶ä¸”æˆ‘ä»¬çš„ç³»ç»Ÿä¹Ÿä¾æ—§éœ€è¦ä¿æŒè¿™æ ·çš„å³æ—¶å“åº”æ€§ã€‚åæ–‡æåˆ°çš„èµ„æºç®¡ç†æ¨¡å¼ï¼Œæµé‡æ§åˆ¶æ¨¡å¼åœ¨è¿™ç§åœºæ™¯ä¸‹ä¼šæœ‰æ‰€å¸®åŠ©ã€‚ resilent å›å¼¹æ€§: å¿…é¡»å¯¹å¤±è´¥ä½œå‡ºååº”ï¼Œä¿æŒé«˜å¯ç”¨æ€§ã€‚è½¯ä»¶ï¼Œç¡¬ä»¶ï¼Œç¼–ç¨‹äººå‘˜éƒ½å¯èƒ½çŠ¯é”™ï¼Œå‡ºç°å¤±è¯¯ã€‚åœ¨å¾ˆå¤šæƒ…å†µä¸‹æˆ‘ä»¬ä¼šéå¸¸å…³æ³¨ä¸€ä¸ªç³»ç»Ÿçš„å¯é æ€§ reliabilityï¼Œä½†æ˜¯é”™è¯¯æ€»æ˜¯ä¼šä¸æœŸè€Œè‡³ã€‚äººä»¬ä¸€æ–¹é¢éœ€è¦å»é¿å…é”™è¯¯çš„å‘ç”Ÿï¼Œå¦ä¸€æ–¹é¢ï¼Œåœ¨ååº”å¼å®£è¨€ä¸­ï¼Œè®¾è®¡ç³»ç»Ÿåº”è¯¥æ›´åŠ å…³æ³¨å‘ç”Ÿäº†é”™è¯¯å¦‚ä½•è®©å³æ—¶å“åº”æ€§å¿«é€Ÿæ¢å¤ã€‚å¯¹äºè½¯ä»¶ç¡¬ä»¶æœ€æ™®éçš„åšæ³•æ˜¯ replicationï¼Œæä¾›ä¸€ä¸ªå‰¯æœ¬ï¼Œç”±äºæä¾›äº†å‰¯æœ¬ä¹Ÿå°±æ„å‘³ç€å¯èƒ½ä¼šæœ‰åˆ†å¸ƒå¼ä¸€è‡´æ€§é—®é¢˜ï¼Œæ‰€ä»¥åˆæœ‰å¾ˆå¤šçš„å¤§ä½¬æ´»è·ƒåœ¨åˆ†å¸ƒå¼å­˜å‚¨é¢†åŸŸã€‚é™¤äº†æä¾›å‰¯æœ¬ï¼Œè¿˜æœ‰ä¸€ç§æ–¹æ³•å°±æ˜¯éš”ç¦»ï¼Œè¿™å°±å¥½æ¯”è®¾è®¡å¤§å‹èˆ¹èˆ¶çš„èˆ¹èˆ±æ˜¯ä¸€ä¸ªä¸ªçš„å°èˆ±å®¤äº’ç›¸éš”ç¦»çš„ï¼Œå³æ—¶èˆ¹è§¦ç¤ç ´åäº†å‡ ä¸ªèˆ±å®¤ï¼Œä¹Ÿä¸è‡³äºå¯¼è‡´æ²‰èˆ¹äº‹æ•…ã€‚è¿˜æœ‰å°±æ˜¯ç†”æ–­ï¼Œæœ‰æ—¶å€™å¯èƒ½å› ä¸ºä¸€äº›çš„é”™è¯¯å¯¼è‡´æŸä¸ªæœåŠ¡çš„ API éå¸¸æ…¢ï¼Œå¤§é‡çš„ socket è¢«æ— æ•ˆå ç”¨ä»¥è‡³äºæ•´ä¸ªæœåŠ¡ä¸å¯ç”¨ã€‚è¿™ä¸ªæ—¶å€™å°±éœ€è¦çŸ­æœŸå†…è®©è¯¥ API ç«‹å³ä½œå‡ºå¿«é€Ÿå¤±è´¥è€Œä¸è‡³äºå½±å“æ•´ä¸ªç³»ç»Ÿã€‚ elastic å¼¹æ€§: å¿…é¡»å¯¹ä¸åŒçš„è´Ÿè½½æƒ…å†µä½œå‡ºååº”ã€‚å½“ç³»ç»Ÿæœ‰æ›´é«˜è´Ÿè½½çš„æ—¶å€™æ”¯æŒè‡ªåŠ¨å¼€å¯æ›´å¤šèµ„æºï¼Œç›¸åå‡å°‘ã€‚ message-driven æ¶ˆæ¯é©±åŠ¨: å¿…é¡»å¯¹è¾“å…¥ä½œå‡ºååº”ã€‚ååº”å¼å®£è¨€ä¸­æåˆ°çš„æ˜¯ååº”å¼ç³»ç»Ÿä¾èµ–å¼‚æ­¥çš„æ¶ˆæ¯ä¼ é€’ã€‚ å‡½æ•°å¼ç¼–ç¨‹çš„æœ¬è´¨æ˜¯ï¼šæ´å¯Ÿåˆ°ç¨‹åºæ—¶é—´ä¸Šå¯ä»¥æŒ‰ç…§çº¯ç²¹çš„æ•°å­¦å‡½æ•°æ¥ç¼–å†™ï¼›ä¹Ÿå°±æ˜¯è¯´ï¼Œæ¯æ¬¡ç»™è¿™äº›å‡½æ•°è¾“å…¥ç›¸åŒçš„å†…å®¹æ—¶ï¼Œå®ƒä»¬å°†æ€»æ˜¯è¿”å›ç›¸åŒçš„å€¼ï¼Œå¹¶ä¸”ä¸ä¼šäº§ç”Ÿå‰¯ä½œç”¨ã€‚è¿™æ ·åšçš„å¥½å¤„æ˜¯ä»£ç çš„ç¼–å†™ï¼Œç¼–è¯‘ï¼Œåˆ†æéƒ½å¯ä»¥é‡‡ç”¨çº¯ç²¹çš„é€»è¾‘æ¨ç†æ¥ä¿è¯æ­£ç¡®æ€§ã€‚è€Œæ»¡è¶³å‡½æ•°å¼é€šå¸¸éœ€è¦åšåˆ°ï¼š å‡½æ•°æ˜¯ä¸€ç­‰å…¬æ°‘ã€‚è¿™ä¸€ç‚¹ç›®å‰æœ‰å¤§é‡çš„è¯­è¨€éƒ½åšåˆ°äº†ã€‚æµè¡Œçš„æ¯”å¦‚ JavaScriptï¼ŒGolangã€‚ æ— å‰¯ä½œç”¨ï¼Œæˆ–è€…å«åšå¼•ç”¨é€æ˜æ€§ã€‚å¦‚æœå°†ä¸€ä¸ªè¡¨è¾¾å¼æ›¿æ¢ä¸ºå…¶æ±‚å€¼åçš„ç»“æœï¼Œç¨‹åºçš„çš„æ‰§è¡Œåº”è¯¥ä¸å—åˆ°å½±å“ã€‚ æ¯”å¦‚å¯¹äºä¸€ä¸ª Java ä»£ç ã€‚ 12final StringBuffer a = new StringBuffer(\"foo\");final StringBuffer b = a.reverse(); æ‰§è¡Œä¹‹åï¼Œb ä¸º â€œoofâ€, a ä¹Ÿä¸º â€œoofâ€ã€‚è€Œå¯¹äºåˆ«çš„è¯­è¨€æ¯”å¦‚ Ruby 12a = \"foo\"b = a.reverse æ‰§è¡Œä¹‹åï¼Œb ä¸º â€œoofâ€, a ä¸æ”¹å˜ã€‚ å¦‚ä»Šå¹¶å‘å·²ç»æœ‰éå¸¸å¤šçš„åšæ³•ã€‚æœ€æ—©æœŸçš„åšæ³•å°±æ˜¯ 1-1 æ¨¡å‹ï¼Œå³ç”¨æˆ·é€»è¾‘çº¿ç¨‹ä¸å†…æ ¸è°ƒåº¦çš„çº¿ç¨‹ä¸€ä¸€å¯¹åº”çš„å…³ç³»æ¯”å¦‚ Javaï¼ŒC/C++ ã€‚è¿™æ ·åšé€šå¸¸å› ä¸ºéœ€è¦å†…æ ¸åšä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œåœ¨å¹¶å‘é‡å¤§çš„æƒ…å†µä¸‹æ€§èƒ½å¼€é”€ä¼šéå¸¸å¤§ã€‚è¿˜æœ‰æ˜¯ N - 1 æ¨¡å‹ï¼Œæ¯”å¦‚ lua, è¿™æ ·åšå¯ä»¥é¿å¼€ä¸Šä¸‹æ–‡åˆ‡æ¢å¸¦æ¥çš„å¼€é”€ã€‚å¹¶ä¸”ç”±äºæ²¡æœ‰å®è´¨ä¸Šçš„å¹¶è¡Œï¼Œå¯ä»¥é¿å¼€ä¸€åˆ‡æ•°æ®ç«äº‰çš„é—®é¢˜ã€‚è¿™ä¸€ç‚¹ä¹Ÿæ˜¯æˆ‘è®¤ä¸º lua èƒ½å¤Ÿåœ¨ç»™ nginxã€redis åšæ‰©å±•è„šæœ¬çš„æ—¶å€™æµè¡Œèµ·æ¥çš„åŸå› ã€‚è¿˜æœ‰ä¸€ç§å°±æ˜¯ N - M æ¨¡å‹ï¼Œæ¯”å¦‚ Golang è‡ªå¸¦çš„ goroutine è°ƒåº¦å™¨å’Œ Clojure ä¸­çš„ core.async åº“å®ç°ã€‚è¿™æ ·çš„åšæ³•å½“ç„¶å°±æ˜¯å¯¹å‰ä¸¤ç§çš„å–é•¿è¡¥çŸ­ã€‚è¿˜æœ‰ä¸€ç§å°±æ˜¯é€šè¿‡ä¸€ä¸ªçº¿ç¨‹ï¼Œç„¶ååœ¨å¾ªç¯ä¸­ç»™æ¯ä¸ªè¦å¹¶å‘æ‰§è¡Œçš„é€»è¾‘éƒ½æ³¨å†Œè‡ªå·±çš„æ–¹æ³•ï¼Œä¹‹åå†ç­‰å¾…å›è°ƒå³å¯ã€‚è¿™æ ·çš„åšæ³•é€šå¸¸å«åšäº‹ä»¶å¾ªç¯ï¼ˆevent loopï¼‰ï¼Œåœ¨ IO å¯†é›†ä¸šåŠ¡ä¸­éå¸¸é€‚åˆã€‚ åœ¨å®é™…çš„ç¼–ç ä¸­ï¼Œæ–¹é¢åœ°ç¼–å†™å¼‚æ­¥éé˜»å¡çš„ä»£ç é€šå¸¸ä¼šç”¨åˆ° Future å’Œ Promiseã€‚ä¸€ç§ç†è§£çš„æ–¹å¼æ˜¯ï¼ŒFuture æ˜¯ä¸€ä¸ªå’Œæ—¶é—´è§£è€¦çš„å€¼ã€‚å³ â€œFuture is a value decoupled from timeâ€ã€‚ è‹±æ–‡ç†è§£è¿™ä¸ªæ„ä¸ªä¾‹å­æ€å°±æ˜¯ï¼ŒI promise you a futureã€‚åœ¨æœªæ¥çš„æŸä¸ªæ—¶é—´ç‚¹ä½ å°±å¯ä»¥é€šè¿‡æˆ‘ Fulfill the promise æ¥å®ç°ã€‚è¿™ä¸ª Promise åªä¼šå®Œæˆä¸€æ¬¡ã€‚ç”¨ Java ä¸¾ä¸ªä¾‹å­ï¼Œæ¯”æ–¹è¯´ç°åœ¨æœ‰ä¸ªæ–¹æ³• retrive() è¿”å›æŸä¸ªæ•°æ®ï¼Œè¿™ä¸ªæ•°æ®å­˜åœ¨ DB ä¸­ä¹Ÿå¯èƒ½å­˜åœ¨ç¼“å­˜ä¸­ï¼Œåœ¨ç¼“å­˜ä¸­æ‰¾ä¼šæ¯”åœ¨ DB ä¸­æ‰¾æ›´å¿«ã€‚æ‰€ä»¥ï¼Œæˆ‘éœ€è¦åšçš„æ˜¯å…ˆä»ç¼“å­˜ä¸­æŸ¥æ‰¾è¿™ä¸ªæ•°æ®ï¼Œå¦‚æœæ²¡æœ‰çš„è¯å°±ä» DB ä¸­æ‰¾åˆ°ã€‚å‡è®¾ç®€åŒ–æˆæ–¹æ³• retrieveFromCache() å’Œ retrieveFromDB()ã€‚ä¼ ç»Ÿçš„åšæ³•å°±æ˜¯ 12345678Object retrive(Object param) &#123; Object value = retrieveFromCache(param); if (value == null) value = retrieveFromDB(param); return value;&#125; å¦‚æœæ”¹æˆå¹¶å‘è°ƒç”¨è¿™ä¸¤ä¸ªæ–¹æ³•ä»¥é«˜æ€§èƒ½ï¼Œé‚£ä¹ˆå°±éœ€è¦ç«‹å³æ‹¿åˆ°å…ˆè¿”å›æ–¹æ³•çš„ç»“æœã€‚é¦–å…ˆå¯ä»¥ç»™ cache å’Œ db ç»™è‡ªæ³¨å†Œä¸€ä¸ª futureã€‚cacheFuture å’Œ dbFutureã€‚è¿™ä¸¤ä¸ª future éƒ½åŒ…å«å„è‡ªçš„æ–¹æ³•ã€‚ç„¶ååªéœ€è¦é‡‡ç”¨ CompletableFuture.anyOf(dbFuture, cacheFuture)å³å¯ã€‚å¦‚æœæ˜¯ Golang å¯ä»¥ç›´æ¥ç”¨ channel é…åˆ select ä¹Ÿè¡Œã€‚ ç”±äºç»å¸¸ä¼šé‡åˆ°ä¸åŒçš„çº¿ç¨‹ä¹‹é—´åœ¨é€»è¾‘ä¸Šä¼šæœ‰å…³è”ï¼Œæ¯”æ–¹è¯´æœ‰æ—¶å€™å½“æŸä¸ªå˜é‡å€¼å‘ç”Ÿçš„æ›´æ”¹éœ€è¦åˆ«çš„çº¿ç¨‹éƒ½çŸ¥æ™“ã€‚åœ¨ç›®å‰ï¼Œé€šè¿‡å…±äº«å˜é‡çš„æ–¹å¼å·²ç»è¢«éƒ¨åˆ†æ›¿ä»£ä¸ºä¼ é€’æ¶ˆæ¯çš„æ–¹å¼ï¼Œæ¯”å¦‚ CSP ç¼–ç¨‹æ¨¡å‹ï¼Œè€Œè¿™ä¸ªæ¨¡å‹ç”¨çš„æœ€å¤šçš„å°±æ˜¯ Golang ä¸­çš„ channelã€‚ä¸€ä¸ª goroutine åªéœ€è¦æŠŠå€¼äº¤ç»™ channelï¼Œé‚£ä¹ˆåˆ«çš„ goroutine å°±ä»è¿™ä¸ª channel ä¸­è·å–å€¼ï¼Œä»è€Œè¾¾åˆ°å…±äº«æ•°æ®çš„æ•ˆæœã€‚Actor æ¨¡å‹å’Œè¿™ä¸€ç‚¹ç›¸ä¼¼ã€‚éƒ½æ˜¯é‡‡ç”¨æ¶ˆæ¯ä¼ é€’è€Œéå…±äº«å˜é‡çš„æ–¹å¼ã€‚ä¸åŒçš„æ˜¯ï¼Œåœ¨ Actor æ¨¡å‹ä¸­ï¼Œæ¯ä¸ªå¹¶å‘çš„é€»è¾‘å•å…ƒè¢«ç§°ä¸ºä¸€ä¸ª actorï¼Œæ¯ä¸ª actor æœ‰è‡ªå·±ç‹¬ç«‹çš„é‚®ç®±ã€‚æ¶ˆæ¯å‘é€è€…éœ€è¦çŸ¥é“åˆ«çš„ actor çš„åœ°å€ä»è€Œå¹¿æ’­å‡ºå»ï¼ˆè‡³äºæ€ä¹ˆå¹¿æ’­ï¼Œå…·ä½“å¹¿æ’­ç»™è°ä¼šæœ‰ä¸€å®šçš„é…ç½®å’Œè§„åˆ™ï¼‰ã€‚è¿™æ ·åšç›¸æ¯” CSP æœ‰ä¸¤ä¸ªä¼˜ç‚¹ï¼š ç”±äºæ¯ä¸ª Actor éƒ½å¯èƒ½å­˜æœ‰é‡è¦çš„æ¶ˆæ¯ï¼Œæ‰€ä»¥éƒ¨åˆ† Actor æŒ‚æ‰ä¹Ÿä¸è‡³äºå½±å“æ•´ä¸ªç³»ç»Ÿ Actor ä¹‹é—´ä¸ä»…å¯ä»¥åœ¨å†…å­˜ä¸­å¯»å€è¿˜å¯ä»¥è·¨è¶Šå®ä¾‹é€šä¿¡ï¼ˆæ¯”å¦‚ Erlang å’Œ Akkaï¼‰ï¼Œä»è€Œæœ‰æ›´é«˜çš„å¯æ‰©å±•æ€§ã€‚ Part 2â€œäº‹ä»¶â€æ˜¯å»ºç«‹æ¶ˆæ¯ä¼ é€’çš„åŸºçŸ³ã€‚è¿™äº›äº‹ä»¶å¯èƒ½æ˜¯å½“å…ˆæ‰§è¡Œç¨‹åºä¸­å‡½æ•°çš„å†…å®¹ä»¥åŠä¸Šä¸‹æ–‡ï¼Œä¹Ÿå¯èƒ½æ˜¯æ¶ˆæ¯é˜Ÿåˆ—ä¸­çš„å…·ä½“æŸäº›æ¶ˆæ¯ã€‚æœ‰ä¸¤ç§æ–¹å¼è¿›è¡Œæ¶ˆæ¯ä¼ é€’ï¼šäº‹ä»¶é©±åŠ¨ï¼ˆevent-basedï¼‰å’Œ æ¶ˆæ¯é©±åŠ¨ï¼ˆmessage-basedï¼‰ï¼Œè¿™ä¸¤ç§éƒ½æ˜¯å…¸å‹çš„ç”Ÿäº§è€… - æ¶ˆè´¹è€…æ¨¡å‹ã€‚äº‹ä»¶é©±åŠ¨ä¸­ï¼Œç”Ÿäº§è€…æŠŠä¿¡æ¯æ”¾åˆ°ä¸€ä¸ªé˜Ÿåˆ—ä¸­å»ï¼Œæ¶ˆè´¹è€…ä¸æ–­å¾—è½®è¯¢ä»é˜Ÿåˆ—ä¸­æ¶ˆè´¹ã€‚æ¶ˆæ¯é©±åŠ¨ä¸­ï¼Œç”Ÿäº§è€…ä¼šäº‹å…ˆçŸ¥é“æ¶ˆè´¹è€…çš„åœ°å€ï¼Œç›´æ¥æŠŠæ¶ˆæ¯ä¼ é€’ç»™æ¶ˆè´¹è€…ã€‚ä¼˜åŠ¿åœ¨äºï¼Œè¿™æ ·ä½¿å¾—æ¯ä¸ªæ¶ˆè´¹è€…å¯èƒ½æœ‰åºä¸”å¹¶å‘åœ°æ¶ˆè´¹ï¼ŒåŒæ—¶ç”±äºè¿™ç§å¼•ç”¨é€æ˜æ€§ï¼Œåƒ Akka çš„ Actor å¯ä»¥åšåˆ°äº’ç›¸ä¹‹é—´é€šè¿‡ç½‘ç»œè°ƒç”¨æ¥å®ç°é€šä¿¡ã€‚å…³äºå¼‚æ­¥æ¶ˆæ¯å¦‚ä½•è¢«ä¿è¯é€è¾¾ï¼Œé€šå¸¸æœ‰ä¸‰ä¸ªæ¨¡å¼ï¼š1. è‡³å¤šä¸€æ¬¡ï¼ˆat-most-onceï¼‰2. è‡³å°‘ä¸€æ¬¡ï¼ˆat-least-onceï¼‰3. ç¡®åˆ‡ä¸€æ¬¡ï¼ˆexactly-onceï¼‰è¿™ä¸‰ä¸ªæ¨¡å¼è¢«ç°åœ¨æµè¡Œçš„æ¶ˆæ¯é˜Ÿåˆ—æ¯”å¦‚ Kafkaï¼ŒRabiitMQ é‡‡ç”¨ã€‚ æ¶ˆæ¯é©±åŠ¨æœ‰ä¸ªå‰æå°±æ˜¯ç³»ç»Ÿè¢«æ‹†åˆ†æˆäº†å¯ä»¥ç‹¬ç«‹éƒ¨ç½²çš„ç»„ä»¶ã€‚å¦‚ä½•æ‹†åˆ†ä¸€ç›´å°±æ˜¯ä¸ªéå¸¸é‡è¦çš„é—®é¢˜ã€‚ DRYï¼Œå¦‚æœè¯´æ¯ä¸ªç»„ä»¶éƒ½å†™äº†ä¸€å¥—ç›¸åŒäº†ä¸šåŠ¡é€»è¾‘è‚¯å®šæ˜¯æœ‰é—®é¢˜çš„ã€‚ TDD, åƒä¸‡ä¸è¦è®¤ä¸ºå¯ä»¥æ— è„‘ test-driven-developmentï¼Œè¿™é‡ŒæŒ‡çš„æ˜¯è®¾è®¡å®¹æ˜“æµ‹è¯•çš„ç»“æ„ testability-driven-designã€‚ è®¾ç½®ç›‘ç£å±‚çº§ã€‚ç±»ä¼¼äºæ“ä½œç³»ç»Ÿä¸­çš„è¿›ç¨‹å±‚çº§ï¼Œé€šå¸¸ç”¨æ›´é‡è¦çš„ç›‘ç£æ¬¡é‡è¦çš„ æœ‰ç•Œä¸€è‡´æ€§ã€‚æœ‰æ—¶å€™åˆ†å¸ƒå¼åœºæ™¯ä¸‹å®ç°æ•°æ®å¼ºä¸€è‡´éå¸¸å›°éš¾ï¼Œä½†ä»ç”¨æˆ·çš„è§†è§’å»è§‚å¯Ÿæœ‰æ—¶å€™å¹¶éœ€è¦å¼ºä¸€è‡´ï¼Œè¿™ä¸ªæ—¶å€™éœ€è¦åšçš„æ˜¯æ ¹æ®äº‹åŠ¡è¾¹ç•Œå¯¹æ•°æ®å’Œè¡Œä¸ºè¿›è¡Œåˆ†ç»„ï¼Œè¿™ä¸ªæŠ€æœ¯åˆä¼šåœ¨ DDD ï¼ˆé¢†åŸŸé©±åŠ¨è®¾è®¡ï¼‰çš„æ–‡çŒ®ä¸­åˆè¯¦ç»†çš„è®¨è®ºã€‚ Part 3æœ¬ç« è¯¦ç»†åˆ—ä¸¾äº†å„ç§ååº”å¼ç³»ç»Ÿæ‰€éœ€è¦ç”¨åˆ°çš„è®¾è®¡æ¨¡å¼ ç®€å•ç»„ä»¶æ¨¡å¼ ä¸€ä¸ªç»„ä»¶åªåšä¸€ä»¶äº‹ï¼Œå¹¶ä¸”å®Œæ•´åšå®Œï¼ˆå’Œ unix ç¼–ç¨‹å“²å­¦ä¸€æ ·å˜›ï¼‰ é”™è¯¯å†…æ ¸æ¨¡å¼ åœ¨ç›‘ç£å±‚çº§ä¸­ï¼Œå°†é‡è¦çš„åº”ç”¨ç¨‹åºæˆ–çŠ¶æ€åŠŸèƒ½å­˜åœ¨æ ¹éƒ¨é™„è¿‘ï¼Œå°†æœ‰é£é™©çš„æ“ä½œæ”¾åˆ°å¶å­èŠ‚ç‚¹ æ”¾ä»»å´©æºƒæ¨¡å¼ å‘ç”Ÿå¼‚å¸¸æˆ–è€…å´©æºƒçš„æ—¶å€™ï¼Œä¼˜å…ˆè€ƒè™‘å¤‡ä»½ä¸Šä¸‹æ–‡ç„¶åé‡å¯è¿™ä¸ªçº¿ç¨‹ã€ç»„ä»¶ã€Actor æ–­è·¯å™¨æ¨¡å¼ åœ¨å¤±è´¥æ—¶é—´é•¿çš„æ—¶å€™ï¼Œæ–­å¼€ä¸ç”¨æˆ·ä¹‹é—´çš„è¿æ¥æ¥ä¿æŠ¤æ•´ä¸ªæœåŠ¡ ä¸»åŠ¨ - è¢«åŠ¨å¤åˆ¶æ¨¡å¼ ä¿æŒæœåŠ¡çš„å¤šä¸ªå‰¯æœ¬è¿è¡Œåœ¨ä¸åŒçš„ä½ç½®ï¼Œä½†æ˜¯åœ¨ä»»ä½•æ—¶åˆ»ï¼Œåªæ¥å—å¯¹äºå…¶ä¸­ä¸€ä¸ªä½ç½®çš„ä¿®æ”¹ å¤šä¸»å¤åˆ¶æ¨¡å¼ åœ¨ä¸åŒä½ç½®ä¸Šä¿æŒæœåŠ¡çš„å¤šä¸ªå‰¯æœ¬ï¼Œæ¯å¤„éƒ½æ¥å—ä¿®æ”¹ï¼Œå¹¶åœ¨å„ä¸ªå‰¯æœ¬ä¹‹é—´ä¼ æ’­ ä¸»åŠ¨ - ä¸»åŠ¨å¤åˆ¶æ¨¡å¼ åœ¨ä¸åŒåœ°æ–¹ä¿æŒå¤šä¸ªå‰¯æœ¬ï¼Œæ‰€æœ‰å‰¯æœ¬éƒ½æ¥å—ä¿®æ”¹æ“ä½œ èµ„æºå°è£…æ¨¡å¼ èµ„æºä»¥å…¶ç”Ÿå‘½å‘¨æœŸéƒ½å¿…é¡»ç”±ä¸€ä¸ªç»„ä»¶è´Ÿè´£ èµ„æºå€Ÿè´·æ¨¡å¼ åœ¨ä¸è½¬è®©æ‰€æœ‰æƒçš„æƒ…å†µä¸‹ï¼Œç»™äºˆå®¢æˆ·ç«¯å¯¹ç¨€ç¼ºèµ„æºç‹¬å çš„ä¸´æ—¶è®¿é—®æƒ å¤æ‚å‘½ä»¤æ¨¡å¼ å‘èµ„æºå‘é€å¤åˆæŒ‡ä»¤ä»¥é¿å…è¿‡åº¦ä½¿ç”¨ç½‘ç»œ èµ„æºæ± æ¨¡å¼ åœ¨èµ„æºæ‰€æœ‰è€…åé¢éšè—ä¸€ä¸ªå¼¹æ€§çš„èµ„æºæ±  æ‰˜ç®¡é˜»å¡æ¨¡å¼ é˜»å¡èµ„æºéœ€è¦æ…é‡è€ƒè™‘å¹¶æ˜ç¡®æ‰€æœ‰æƒ è¯·æ±‚å“åº”æ¨¡å¼ æ¶ˆæ¯ä¸­åŒ…å«ä¸€ä¸ªå›ä¿¡åœ°å€ **æ¶ˆæ¯è‡ªåŒ…å«æ¨¡å¼ æ¯ä¸ªæ¶ˆæ¯éƒ½åŒ…å«å¤„ç†è¯·æ±‚ä»¥åŠç†è§£å…¶å“åº”éœ€è¦çš„å…¨éƒ¨ä¿¡æ¯ è¯¢é—®æ¨¡å¼ å°†äº§ç”Ÿå“åº”çš„è¿‡ç¨‹å§”æ‰˜ç»™ä¸“ç”¨çš„ä¸´æ—¶ç»„ä»¶ è½¬å‘æµæ¨¡å¼ è®©ä¿¡æ¯å’Œæ¶ˆæ¯å°½å¯èƒ½åœ°ç›´æ¥æµå‘ç›®çš„åœ° èšåˆå™¨æ¨¡å¼ å¦‚æœéœ€è¦å¤šä¸ªæœåŠ¡å“åº”æ¥è®¡ç®—æœåŠ¡çš„è°ƒç”¨ç»“æœï¼Œå¯ä»¥ä¸“é—¨åˆ›å»ºä¸€ä¸ªä¸´æ—¶ç»„ä»¶ äº‹åŠ¡åºåˆ—æ¨¡å¼ å°†è€—æ—¶é•¿çš„åˆ†å¸ƒå¼äº‹åŠ¡åˆ‡æ¢æˆå¿«é€Ÿçš„æœ¬åœ°äº‹åŠ¡ï¼Œå¹¶é€šè¿‡è¡¥å¿æ¥æ¢å¤ã€‚æ¢è¨€ä¹‹ï¼šåˆ›å»ºä¸€ä¸ªä¸´æ—¶ç»„ä»¶ç”¨æ¥ä¸“é—¨ç®¡ç†åˆ†å¸ƒåœ¨å¤šä¸ªç»„ä»¶ä¸­çš„ä¸€ç³»åˆ—åŠ¨ä½œçš„æ‰§è¡Œè¿‡ç¨‹ã€‚ å¯é æŠ•é€’æ¨¡å¼ ä½¿ç”¨ ack æ¥ç¡®ä¿æ¶ˆæ¯å¤„ç†æ‰ æ‹‰å–æ¨¡å¼ æ¶ˆè´¹è€…å‘ç”Ÿäº§è€…å¯¹æ•°æ®çš„æ‰¹é‡å¤§å°æå‡ºè¦æ±‚ æ‰˜ç®¡é˜Ÿåˆ—æ¨¡å¼ ç®¡ç†ä¸€ä¸ªæ˜¾å¼çš„è¾“å…¥é˜Ÿåˆ—ï¼Œå¹¶å¯¹å…¶å¡«å……çº§åˆ«äºˆä»¥ååº” ä¸¢å¼ƒæ¨¡å¼ ä¸¢å¼ƒè¯·æ±‚ï¼Œæ¯”ä¸å—æ§åˆ¶åœ°å¤±è´¥æ›´å¯å– é™æµæ¨¡å¼ æ ¹æ®ä¸å…¶ä»–æœåŠ¡ä¹‹é—´çš„çº¦æŸæ¥çº¦å®šé™åˆ¶è‡ªå·±çš„è¾“å‡ºé€Ÿç‡ é¢†åŸŸå¯¹è±¡æ¨¡å¼ å°†ä¸šåŠ¡é¢†åŸŸé€»è¾‘ä¸é€šä¿¡ï¼ŒçŠ¶æ€ç®¡ç†åˆ†ç¦» åˆ†ç‰‡æ¨¡å¼ ç»™äºˆå„ç±»ç‹¬ä¸€æ— äºŒå¹¶ä¸”ç¨³å®šçš„å¯¹è±¡å±æ€§ï¼Œç›¸åº”åœ°å°†å¤§é‡é¢†åŸŸå¯¹è±¡è¿›è¡Œåˆ†ç»„åˆ†ç‰‡ï¼Œä»è€Œæ°´å¹³æ‰©å±• äº‹ä»¶æº¯æºæ¨¡å¼ ä»…é€šè¿‡åº”ç”¨äº‹ä»¶æ¥æ‰§è¡ŒçŠ¶æ€å˜æ›´ï¼Œå¹¶é€šè¿‡å°†äº‹ä»¶å­˜å‚¨åœ¨æ—¥å¿—ä¸­æ¥æŒä¹…åŒ–çŠ¶æ€å˜æ›´","categories":[],"tags":[{"name":"è¯»ä¹¦","slug":"è¯»ä¹¦","permalink":"https://razertory.me/tags/è¯»ä¹¦/"}]},{"title":"é‡å»ºäºŒå‰æ ‘","slug":"rebuild-tree","date":"2019-07-20T12:29:49.000Z","updated":"2020-03-28T13:02:10.007Z","comments":true,"path":"2019/07/20/rebuild-tree/","link":"","permalink":"https://razertory.me/2019/07/20/rebuild-tree/","excerpt":"","text":"ç”¨å‰åºå’Œä¸­åºéå†åºåˆ—æ„å»ºè¾“å…¥ 12pre: [1,2,4,7,3,5,6,8]in: [4,7,2,1,5,3,8,6] ç”± pre å¾—çŸ¥ root èŠ‚ç‚¹æ˜¯ 1ï¼Œä»è€Œåœ¨ in ä¸­æ‰¾åˆ° 1ï¼Œé‚£ä¹ˆæ­¤æ—¶è¿™æ£µæ ‘çš„ root å°±æ˜¯ 1ã€‚å¹¶å¾—å‡ºè¿™ä¸ªäºŒå‰æ ‘å·¦å­æ ‘ç”± [4, 7, 2] æ„æˆï¼Œå³å­æ ‘ç”± [5, 3, 8, 6] æ„æˆã€‚ä»è€Œç¡®å®šå·¦å­æ ‘çš„ pre æ˜¯ [2, 4, 7], in æ˜¯ [4, 7, 2]ã€‚å³å­æ ‘ pre æ˜¯ [3, 5, 6, 8]ï¼Œin æ˜¯ [5, 3, 8, 6]ã€‚å¯¹å·¦å³å­æ ‘é€’å½’åœ°ç”¨è¿™ä¸ªæ–¹æ³•è¿›è¡Œæ„å»ºï¼Œæœ€ç»ˆå½“å·¦å³å­æ ‘éƒ½ä¸ºç©ºçš„æ—¶å€™é€’å½’ç»“æŸã€‚ æ‰¾åˆ° in çš„ root ä¹‹åï¼Œæ ¹æ® root åˆ° å¼€å§‹èŠ‚ç‚¹ä¸­é—´çš„èŠ‚ç‚¹ä¸ªæ•°å¯ä»¥å¯¹åº”åœ°ï¼Œç¡®å®š pre çš„å·¦å­æ ‘å’Œå³å­æ ‘ã€‚ 12345678910111213141516171819202122 // https://leetcode.com/problems/construct-binary-tree-from-preorder-and-inorder-traversal class Solution &#123; public TreeNode buildTree(int[] preorder, int[] inorder) &#123; if (preorder == null || inorder == null) return null; Map&lt;Integer, Integer&gt; map = new HashMap&lt;&gt;(); for (int i = 0; i &lt; inorder.length; i++) &#123; map.put(inorder[i], i); &#125; return build(preorder, 0, preorder.length - 1, 0, map); &#125; private TreeNode build(int[] pre, int preStart, int preEnd, int inStart, Map&lt;Integer, Integer&gt; inPos) &#123; if (preStart &gt; preEnd) return null; int rootVal = pre[preStart]; TreeNode root = new TreeNode(rootVal); int rootIndex = inPos.get(rootVal); int leftLen = rootIndex - inStart; root.left = build(pre, preStart + 1, preStart + leftLen, inStart, inPos); root.right = build(pre, preStart + leftLen + 1, preEnd, rootIndex + 1, inPos); return root; &#125;&#125; ç”¨ä¸­åºå’Œååºéå†åºåˆ—æ„å»º","categories":[],"tags":[]},{"title":"ä½è¿ç®—å®é™…é—®é¢˜","slug":"bit-operation","date":"2019-07-18T13:47:13.000Z","updated":"2020-03-28T13:02:10.006Z","comments":true,"path":"2019/07/18/bit-operation/","link":"","permalink":"https://razertory.me/2019/07/18/bit-operation/","excerpt":"","text":"ä¸€åˆ‡è¦ä»ä¸€ç“¶æœ‰æ¯’çš„æ°´å’Œä¸€ç¾¤å¯æ€œçš„è€é¼ è¯´èµ· æœ‰ 1000 ä¸ªä¸€æ¨¡ä¸€æ ·çš„ç“¶å­ï¼Œå…¶ä¸­æœ‰ 999 ç“¶æ˜¯æ™®é€šçš„æ°´ï¼Œæœ‰ä¸€ç“¶æ˜¯æ¯’è¯ã€‚ä»»ä½•å–ä¸‹æ¯’è¯çš„ç”Ÿç‰©éƒ½ä¼šåœ¨ä¸€æ˜ŸæœŸä¹‹åæ­»äº¡ã€‚ç°åœ¨ï¼Œä½ åªæœ‰ 10 åªå°ç™½é¼ å’Œä¸€æ˜ŸæœŸçš„æ—¶é—´ï¼Œå¦‚ä½•æ£€éªŒå‡ºå“ªä¸ªç“¶å­é‡Œæœ‰æ¯’è¯ï¼Ÿ(hint: æœ‰æ¯’çš„æ— è®ºæ€ä¹ˆç¨€é‡Šéƒ½æœ‰æ¯’å“¦) é¦–å…ˆç»™ç“¶å­ç¼–å·ï¼Œé»˜è®¤ 1 - 1000ï¼Œè€ƒè™‘åˆ°è€é¼ å–äº†æ°´ä¹‹åå°±æ˜¯æ­»æˆ–è€…ä¸æ­»çš„çŠ¶æ€ã€‚å› ä¸ºè€é¼ çš„ä¸ªæ•°æ˜¯æœ‰é™çš„ï¼Œæ‰€ä»¥è‚¯å®šæ˜¯è¦æƒ³åŠæ³•é€šè¿‡æ··åˆçš„æ–¹æ³•ã€‚å…·ä½“æ€ä¹ˆæ··åˆå‘¢ï¼Ÿæƒ³è±¡ä¸€ä¸‹ï¼Œ10 åªè€é¼ æŒ‰ç…§æ­»å’Œä¸æ­»çš„çŠ¶æ€è€Œè¨€ï¼Œèƒ½å¤Ÿè¡¨ç¤ºå‡º Pow(2, 10) = 1024 ç§ä¿¡æ¯ã€‚ç°åœ¨çš„æƒ…å†µæ˜¯ 1000 ä¸ªç“¶å­ï¼Œå¦‚æœè¯´ç”¨äºŒè¿›åˆ¶è¡¨ç¤ºå°±æ˜¯ 1234567891 12 103 114 1105 1116 1110...999 11111001111000 1111101000 æœ€å¤§çš„ 1000 ç”¨äºŒè¿›åˆ¶è¡¨ç¤ºæ˜¯ 1111101000 æ€»è®¡ 10 ä½ã€‚å¦‚æœæŠŠ 1 åˆ° 1000 çš„æ¯ä¸ªæ•°éƒ½ç”¨ n = 1..10 ä½äºŒè¿›åˆ¶è¡¨ç¤ºå°±ä¸éš¾å‘ç°åªè¦æŠŠç¬¬ n ä½ä¸º 1 çš„æ•°æ‰¾å‡ºæ¥ï¼Œæ··åœ¨ä¸€èµ·ç»™ç¼–å·ä¹Ÿä¸º n çš„å°è€é¼ å–ã€‚é‚£ä¹ˆå°è€é¼ å¦‚æœæ­»äº†å°±è¯´æ˜æ¯’è¯è‚¯å®šåœ¨ç¬¬ n ä½ä¸º 1 çš„ç“¶å­ä¸­ã€‚æœ€åå†ç¡®å®šä¸€ä¸ª 10 ä½äºŒè¿›åˆ¶æ•°è½¬æ¢ä¸º 10 è¿›åˆ¶å°±æ‰¾åˆ°äº†ã€‚åŒç†ï¼Œå¦‚æœè¿™ä¸ªé¢˜ç›®å‘Šè¯‰æˆ‘ä»¬æœ‰ä¸¤ç“¶æ¯’è¯å°±æŠŠè¿™ 1000 ç“¶æŒ‰ç…§ä¸¤ä¸¤ç»„åˆæœ€åå¾—åˆ° C(1000,2) = 499500 ä¸ªç»„åˆã€‚å†è½¬æ¢æˆä¸Šä¸€ç§é—®é¢˜å³å¯ã€‚ ä¸ç”¨ä¸­é—´æ•°äº¤æ¢ä¸¤ä¸ªæ•°æ˜¯çš„æ²¡é”™ï¼Œåƒä¸‡ä¸èƒ½å†™æˆ 123int temp = a;a = b;b = temp; è¿™æ ·åšå°±å¤§é”™ç‰¹é”™äº†ã€‚æ‰€ä»¥æ€ä¹ˆå†™å‘¢ï¼Ÿå½“ç„¶æ˜¯ä½è¿ç®—! 1234a = a ^ b;b = a ^ b;a = a ^ b;` æ¡ˆä¾‹ä¸€ä¸ªæ•´æ•°æ•°ç»„ï¼Œé‡Œé¢çš„æ•°å­—éƒ½å‡ºç°ä¸¤æ¬¡ï¼Œåªæœ‰ä¸€ä¸ªæ•°å­—å‡ºç°äº†ä¸€æ¬¡ï¼Œæˆ‘ä»¬ç®¡å®ƒå«å•èº«æ•°å­—ï¼Œä½ è¦å†™ä»£ç æ‰¾åˆ°è¿™ä¸ªå•èº«æ•°å­—ã€‚æˆ‘ä»¬çŸ¥é“ç›¸åŒæ•°å­—å¼‚æˆ–å¾—åˆ° 0ï¼Œ0 å’Œä»»ä½•æ•°å­—å¼‚æˆ–éƒ½æ˜¯é‚£ä¸ªæ•°å­—ã€‚è¯´æ˜åªéœ€è¦æŠŠæ•°ç»„ä¸­æ‰€æœ‰æ•°å¼‚æˆ–å³å¯ã€‚ 12345public int findSingleNumber(int[] nums) &#123; int result = 0; for (int num: nums) result ^= num; return result; &#125;","categories":[],"tags":[]},{"title":"ä¼ªå…±äº«","slug":"false-share","date":"2019-07-13T12:41:36.000Z","updated":"2020-03-28T13:02:10.006Z","comments":true,"path":"2019/07/13/false-share/","link":"","permalink":"https://razertory.me/2019/07/13/false-share/","excerpt":"","text":"æ•°ç»„å’Œé“¾è¡¨è°å¿«ï¼Ÿä¼—æ‰€å‘¨çŸ¥æ•°ç»„å’Œé“¾è¡¨æœ‰ä¸ªåŒºåˆ«åœ¨äºæ•°ç»„æ˜¯ä¸€æ®µè¿ç»­çš„å†…å­˜ç©ºé—´ã€‚é‚£ä¹ˆå¦‚æœè¯´å­˜æ”¾çš„å€¼ä¸€æ ·ï¼Œé•¿åº¦ä¸€æ ·çš„æ•°ç»„å’Œé“¾è¡¨éƒ½åšç®€å•çš„éå†è°ä¼šæ›´å¿«å‘¢ï¼Ÿæ¯”å¦‚ 123456789101112public class CPUCache1 &#123; // éå†æ•°ç»„ void traverseArray(int[] arr) &#123; for (int i : arr) &#123; &#125; &#125; // éå†é“¾è¡¨ void traverseListNode(ListNode head) &#123; while (head != null) head = head.next; &#125;&#125; æµ‹è¯•ä»£ç  12345678910111213141516171819202122232425public class CPUCache1Test &#123; private int quantity = 1024 * 1024 * 10; @Test public void traverseArray() &#123; int[] arr = new int[quantity]; long now = System.currentTimeMillis(); new CPUCache1().traverseArray(arr); System.out.println(System.currentTimeMillis() - now); &#125; @Test public void traverseListNode() &#123; ListNode head = new ListNode(0); ListNode tail = head; for (int i = 1; i &lt; quantity; i++) &#123; tail.next = new ListNode(0); tail = tail.next; &#125; long now = System.currentTimeMillis(); new CPUCache1().traverseListNode(head); System.out.println(System.currentTimeMillis() - now); &#125;&#125; åœ¨æˆ‘è¿™å°çš„ MBP ä¸Š traverseArray è€—è´¹ 5 æ¯«ç§’ï¼ŒtraverseListNode è€—è´¹ 26 æ¯«ç§’ã€‚ï¼ˆå¤šæ¬¡æµ‹è¯•ç¨³å®šåœ¨è¿™ä¸ªæ•°å€¼ï¼‰ CPU ç¼“å­˜ä¸Šè¿°çš„æ¡ˆä¾‹ä¸­ï¼Œéå†æ•°ç»„è®¡ç®—æœºåˆ©ç”¨åˆ°äº† CPU ç¼“å­˜ä»è€ŒåŠ å¿«äº†é€Ÿåº¦ã€‚ è®¡ç®—æœºç³»ç»Ÿä¸­ï¼ŒCPU ç¼“å­˜ï¼Œå†…å­˜ï¼Œç£ç›˜æœ‰ç€åºå¤§çš„å­˜å–é€Ÿåº¦å·®å¼‚ï¼Œæ‰€ä»¥å¾€å¾€ä¼šåœ¨è¿™ä¸‰è€…çš„åä½œä¹‹é—´é€šè¿‡è®¾è®¡ç¼“å­˜æ¥è¾¾åˆ°æ›´å¿«çš„é€Ÿåº¦ã€‚ å¤šæ ¸å¿ƒ CPU ä¸­çš„ç¼“å­˜æ˜¯åˆ†å±‚çš„ï¼Œæ¯ä¸ªæ ¸å¿ƒç‹¬æœ‰ç¼“å­˜æ¨¡å—ï¼Œä¸è¿‡ L3 æ˜¯å¤šæ ¸å¿ƒå…±äº«ã€‚å½“è®¡ç®—æœºæ”¶åˆ°æ‰¾å¯»å˜é‡çš„æŒ‡ä»¤çš„æ—¶å€™å°±ä¼šæŒ‰ç…§ L1ï¼ŒL2ï¼ŒL3 ï¼ŒRAM è¿™æ ·çš„é¡ºåºå¯»æ‰¾ã€‚Java è¯­è¨€ä¸­çš„æ•°ç»„å…¶å®å°±æ˜¯åœ¨ä¸€å®šç¨‹åº¦ä¸Šéƒ¨åˆ†å­˜åˆ°äº†ç¼“å­˜å½“ä¸­ã€‚è¿™é‡Œäº§ç”Ÿäº†ä¸€ä¸ªå«åšç¼“å­˜è¡Œçš„ä¸œè¥¿ï¼Œå®ƒæ˜¯ CPU ç¼“å­˜ä¸­çš„æœ€å°å•å…ƒï¼Œå  64 å­—èŠ‚ï¼ˆæ—©æœŸçš„ CPU æ˜¯ 32 å­—èŠ‚ï¼‰ã€‚Java ä¸­çš„ä¸€ä¸ª int å  4 å­—èŠ‚ï¼Œæ„å‘³ç€ä¸€ä¸ªç¼“å­˜è¡Œå¯ä»¥å­˜ä¸‹ 16 ä¸ª int ç±»å‹çš„å˜é‡ã€‚åœ¨éå†çš„æ—¶å€™å°±èƒ½åˆ©ç”¨åˆ°ä»è€ŒåŠ å¿«é€Ÿåº¦ã€‚é“¾è¡¨å°±æ²¡æœ‰è¿™ä¸ªç¦åˆ©äº†ã€‚ å¹¶å‘åœºæ™¯çš„ CPU ç¼“å­˜é‚£ä¹ˆåœ¨å¹¶å‘çš„åœºæ™¯ä¸­ï¼Œåˆè¯¥å¦‚ä½•åˆ©ç”¨ CPU ç¼“å­˜å‘¢ï¼Ÿæ¯”å¦‚è¯´è¿™æ®µä»£ç  false_sharing.c åœ¨æˆ‘çš„ Mac ä¸Šæ‰“å°å‡ºäº† 12341) 8.85049 4.8528e+08 ips2) 22.4329 3.82917e+08 ips3) 30.1988 4.26669e+08 ips4) 35.8548 4.79151e+08 ips åŸæœ¬è®¤ä¸ºï¼Œåœ¨æ¯æ¬¡å¢åŠ çº¿ç¨‹çš„æ—¶å€™æ–°çš„çº¿ç¨‹æœ‰ç€ç‹¬ç«‹çš„å†…å­˜ç©ºé—´ã€‚è¿™ä¸ªä¸å‡ï¼Œä½†æ˜¯å†…å­˜ä¸­çš„ä¸€äº›æ•°æ®ä¼šå­˜å…¥ CPU ç¼“å­˜å½“ä¸­ã€‚åœ¨å¤šæ ¸ CPU ä¸­ï¼Œæ¯ä¸ªæ ¸éƒ½ä¼šæœ‰è‡ªèº«ç‹¬ç«‹çš„ç¼“å­˜åŒºã€‚å½“åªæœ‰å…¶ä¸­ä¸€ä¸ªæ ¸çš„å†…å®¹å‘ç”Ÿå…ˆå˜æ›´çš„æ—¶å€™ï¼Œç”±äºå†…æ ¸å‘ç°å†…å­˜ä¸­çš„å˜é‡å’Œå¦ä¸€ä¸ªæœªå‘ç”Ÿå˜æ›´çš„å†…å®¹ä¸ä¸€è‡´ï¼Œè¿™ä¸ªæ—¶å€™å°±ä¼šèŠ±ä¸€å®šçš„æ—¶é—´å»åŒæ­¥å¦ä¸€ä¸ªæ ¸çš„å†…å®¹ã€‚è¿™ä¸ªç°è±¡å°±ç§°ä¸ºä¼ªå…±äº«ï¼ˆfalse sharingï¼‰ã€‚ç»´åŸºç™¾ç§‘ä¸­ä¼ªå…±äº«çš„å®šä¹‰æœ‰è¿™ä¹ˆä¸€æ®µ False sharing is an inherent artifact of automatically synchronized cache protocols and can also exist in environments such as distributed file systems or databases, but current prevalence is limited to RAM caches. å¤§æ„ä¸ºä¼ªå…±äº«ç›®å‰æ˜¯è‡ªåŠ¨åŒæ­¥ç¼“å­˜åè®®ä¸­å›ºæœ‰çš„æœºåˆ¶ã€‚ æ‰€ä»¥ï¼Œç°ä»£ç¼–ç¨‹è¯­è¨€å¦‚ä½•è§£å†³è¿™ä¸ªé—®é¢˜çš„å‘¢ï¼Ÿ ä»¥ Rubyã€Python ä¸ºä»£è¡¨çš„åŠ¨æ€è¯­è¨€ï¼Œå¤©ç”Ÿæœ‰å…¨å±€è§£é‡Šé”ï¼ˆGILï¼‰è¿™ä¹ˆä¸ªä¸œè¥¿ï¼Œä»»ä½•ä¸€ä¸ªæ—¶åˆ»æœ¬è´¨ä¸Šåªæœ‰ä¸€ä¸ªçº¿ç¨‹åœ¨è·‘ï¼Œä¹Ÿå°±ä¸éœ€è¦è€ƒè™‘è¿™ä¸ªé—®é¢˜ã€‚ ä»¥ Javaï¼ŒC++ï¼ŒGolang ä¸ºä»£è¡¨çš„é™æ€è¯­è¨€é‡‡ç”¨è¡¥é½ï¼ˆPaddingï¼‰çš„æ–¹å¼ã€‚æ¯”æ–¹è¯´ï¼šJava å¯¹è±¡å¤´å  8 ä¸ªå­—èŠ‚ï¼Œå¦‚æœå®šä¹‰çš„ç±»æ‰€å«çš„å˜é‡åŠ èµ·æ¥ä¹Ÿä½äº 64 ä¸ªå­—èŠ‚ï¼Œé‚£ä¹ˆå°±å£°æ˜å‡ ä¸ªä¸ç”¨çš„å˜é‡è®©ä¸€ä¸ªå¯¹è±¡çš„å®é™…å†…å­˜å¤§äº 64 å­—èŠ‚ä»è€Œé¿å…é€šè¿‡ CPU ç¼“å­˜è¯»å†™ã€‚åœ¨ Java 8 ä¸­ï¼Œå¯ä»¥ç›´æ¥å¯¹ä¸€ä¸ªå¯¹è±¡åŠ ä¸Š @sun.misc.Contended å¹¶ä¸”å¼€å¯ jvm é€‰é¡¹ -XX:-RestrictContendedã€‚","categories":[],"tags":[{"name":"æ“ä½œç³»ç»Ÿ","slug":"æ“ä½œç³»ç»Ÿ","permalink":"https://razertory.me/tags/æ“ä½œç³»ç»Ÿ/"}]},{"title":"åˆ†äº«äº”ä¸ªä½ åº”è¯¥äº†è§£çš„å®£è¨€","slug":"5-manifestos","date":"2019-06-19T16:00:00.000Z","updated":"2020-03-28T13:02:10.005Z","comments":true,"path":"2019/06/20/5-manifestos/","link":"","permalink":"https://razertory.me/2019/06/20/5-manifestos/","excerpt":"","text":"å®£è¨€æ˜¯æŒ‡å›½å®¶ã€æ”¿åºœã€å›¢ä½“ã€ç»„ç»‡æˆ–ä¸ªäººä¸ºè¡¨æ˜å·±æ–¹çš„æ„æ„¿ã€ä¸»æ—¨ã€ä¸»å¼ è€Œå‘å…¬å…±å‘å¸ƒçš„ä¹¦é¢å£°æ˜ã€‚ GUN å®£è¨€: è½¯ä»¶è‡ªç”±æ˜¯é€šå¾€å¯Œè¶³ä¸–ç•Œçš„ä¸€å°æ­¥ã€‚ Mozilla å®£è¨€:äº’è”ç½‘æ˜¯å…¨çƒå…¬å…±èµ„æºï¼Œå¿…é¡»ä¿è¯å¼€æ”¾æ€§å’Œå¯ç”¨æ€§ä»è€Œå»ºç«‹æ›´å¥½çš„äº’è”ç½‘ã€‚ ååº”å¼å®£è¨€:ååº”å¼ç³»ç»Ÿéœ€è¦å…·å¤‡: å“åº”æ€§ï¼ˆResponsiveï¼‰ï¼Œå›å¼¹æ€§ï¼ˆResilienï¼‰ï¼Œå¼¹æ€§ï¼ˆElasticï¼‰å’Œ æ¶ˆæ¯é©±åŠ¨ï¼ˆMessage Drivenï¼‰ã€‚ æ•æ·å®£è¨€:å¯å·¥ä½œçš„è½¯ä»¶æ˜¯è¿›åº¦çš„é¦–è¦åº¦é‡æ ‡å‡†å¹¶å€¡å¯¼å¯æŒç»­å¼€å‘ã€‚ è½¯ä»¶å®šä¹‰äº¤ä»˜å®£è¨€:ä»£ç æ˜¯æŒ‡å®šç²¾ç¡®æ“ä½œçš„æœ€ä½³æ–¹å¼ã€‚","categories":[],"tags":[{"name":"æ€è€ƒ","slug":"æ€è€ƒ","permalink":"https://razertory.me/tags/æ€è€ƒ/"}]},{"title":"å„ç§å±‚åºéå†äºŒå‰æ ‘","slug":"tree-level-order","date":"2019-06-17T04:48:27.000Z","updated":"2020-03-28T13:02:10.006Z","comments":true,"path":"2019/06/17/tree-level-order/","link":"","permalink":"https://razertory.me/2019/06/17/tree-level-order/","excerpt":"","text":"BFSBFS æˆ‘è§‰å¾—å¯ä»¥ä»ä¸¤ä¸ªæ–¹å‘ç†è§£ã€‚ç¬¬ä¸€ç§ï¼Œå¯¹æŸä¸ªæ ‘æˆ–è€…å›¾çš„æ•°æ®ç»“æ„è€Œè¨€ï¼Œå°±æ˜¯æŸä¸ªèŠ‚ç‚¹ç›¸è¿æ¥çš„èŠ‚ç‚¹éƒ½éå†ï¼Œå†ä¸æ–­å¯¹åˆšéå†çš„èŠ‚ç‚¹åšåŒæ ·çš„æ“ä½œç›´åˆ°æœ€åéå†å®Œæ‰€æœ‰èŠ‚ç‚¹ã€‚ç¬¬äºŒç§ï¼Œå½“æ•°æ®ç»“æ„æ˜¯æ ‘å½¢çš„æ—¶å€™è¿™ä¸ªè§„å¾‹å¯ä»¥è¡ç”Ÿä¸ºæŒ‰ç…§å±‚æ¥éå†ã€‚æŒ‰ç…§å½“å‰çš„ç†è§£ï¼ŒBFS ä¸€èˆ¬å¯ä»¥ç”¨ä¸€ä¸ªé˜Ÿåˆ—æ¥å®ç°ï¼Œè¿™æ˜¯å› ä¸ºæŒ‰ç…§ FIFO çš„ç‰¹æ€§ã€‚å¯¹äºèŠ‚ç‚¹ç›¸è¿æ¥çš„èŠ‚ç‚¹éƒ½éå†çš„æ—¶å€™ï¼Œéå†ç»“æŸäº†ä¹‹åéœ€è¦ä»æœ€ç¬¬ä¸€ä¸ªéå†çš„èŠ‚ç‚¹å¼€å§‹ã€‚ è¾“å‡ºï¼š 1, 2, 3, 4, 5, 6, 7, 8 1234567891011121314151617public class Tree &#123; private ArrayList&lt;Integer&gt; order = new ArrayList&lt;&gt;(); // T:O(n) T:O(n) ArrayList bfsSearch(TreeNode root) &#123; Queue&lt;TreeNode&gt; queue = new LinkedList&lt;&gt;(); queue.offer(root); while(!queue.isEmpty()) &#123; TreeNode node = queue.poll(); if (node != null) &#123; order.add(node.value); queue.offer(node.left); queue.offer(node.right); &#125; &#125; return order; &#125;&#125; å±‚åºéå†äºŒå‰æ ‘åœ¨ BFS çš„åŸºç¡€ä¸Šï¼ŒæœŸå¾…ä¸Šé¢çš„éå†ç»“æœèƒ½å·²åˆ†å±‚çš„å½¢å¼è¾“å‡ºï¼š1 2 34 5 67 8è¿™ä¸ªé—®é¢˜åœ¨ã€Šç¼–ç¨‹ä¹‹ç¾ã€‹å’Œã€Šå‰‘æŒ‡ Offerã€‹ä¸Šé¢éƒ½å‡ºç°è¿‡ã€‚ å…¶å®åªè¦æ¨¡æ‹Ÿä¸€ä¸‹é˜Ÿåˆ—çš„å‡ºå…¥è¿‡ç¨‹å°±èƒ½å‘ç°ï¼ŒBFS è¿‡ç¨‹ä¸­ç»´æŠ¤çš„é˜Ÿåˆ—æ€»æ˜¯åœ¨ä¸æ–­çš„ offer å’Œ pollã€‚å½“ç¬¬ 1 å±‚çš„ #1 poll çš„æ—¶å€™ï¼Œç¬¬ 2 å±‚çš„ #2ï¼Œ#3 offerâ€¦, ç¬¬ 2 å±‚ #2 poll çš„æ—¶å€™ï¼Œç¬¬ 3 å±‚çš„ #4, #5 offerï¼Œç¬¬äºŒå±‚çš„ #3 poll çš„æ—¶å€™ã€‚.. ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœèƒ½çŸ¥é“ç¬¬äºŒå±‚å±‚ç»“æŸäº†é‚£ä¹ˆå°±æœ‰åŠæ³•äº†ã€‚ å›è¿‡å¤´å†çœ‹ï¼Œç¬¬ä¸€å±‚çš„ #1 ä¸¤ä¸ªå­èŠ‚ç‚¹ offer ä¹‹åã€‚é˜Ÿåˆ—çš„ size å˜æˆäº† 2ã€‚å¦‚æœç»´æŒä¸€ä¸ªè®¡æ•°å™¨è¡¨ç¤ºå½“è®¡æ•°å™¨çš„å€¼ä»åœ¨ [0, size] ä¹‹é—´çš„æ—¶å€™è¡¨ç¤ºç¬¬äºŒå±‚æ­£åœ¨ poll, ç¬¬ä¸‰å±‚æ­£åœ¨ offerï¼Œé‚£ä¹ˆå°±èƒ½è¡¨ç¤ºå±‚çº§çš„å˜åŒ–ã€‚ 1234567891011121314151617181920212223public class Solution &#123; // T:O(n) T:O(n) ArrayList&lt;ArrayList&lt;Integer&gt;&gt; Print(TreeNode pRoot) &#123; ArrayList&lt;ArrayList&lt;Integer&gt;&gt; ret = new ArrayList&lt;&gt;(); if (pRoot == null) return ret; Queue&lt;TreeNode&gt; queue = new LinkedList&lt;&gt;(); queue.offer(pRoot); while(!queue.isEmpty()) &#123; ArrayList&lt;Integer&gt; thisLevel = new ArrayList&lt;&gt;(); int low = 0, high = queue.size(); for (int i = low; i &lt; high; i++) &#123; TreeNode node = queue.poll(); thisLevel.add(node.val); if (node.left != null) queue.offer(node.left); if (node.right != null) queue.offer(node.right); &#125; ret.add(thisLevel); &#125; return ret; &#125;&#125;","categories":[],"tags":[]},{"title":"æŠ€æœ¯äººçš„åˆ»æ„ç»ƒä¹ ","slug":"deliberate-practice-of-tech","date":"2019-06-07T01:02:14.000Z","updated":"2020-03-28T13:02:10.004Z","comments":true,"path":"2019/06/07/deliberate-practice-of-tech/","link":"","permalink":"https://razertory.me/2019/06/07/deliberate-practice-of-tech/","excerpt":"","text":"åˆ»æ„ç»ƒä¹ è¿™ä¸ªè¯æ˜¯æˆ‘å¾ˆæ—©ä¹‹å‰åœ¨çŸ¥ä¹ä¸Šçœ‹åˆ°çš„ï¼Œæ˜¯æˆ‘ä¸€ç›´å¿½ç•¥çš„ä¸œè¥¿ã€‚ ä»ä¸Šå¤§å­¦èµ·æˆ‘å°±åœ¨æƒ³ç¨‹åºå‘˜æ˜¯ä¸€ä¸ªä»€ä¹ˆæ ·çš„èŒä¸šã€‚æˆ‘æ‹¿å»å’Œå¾ˆå¤šèŒä¸šåšäº†å¯¹æ¯” åŒ äººï¼Œæ¯”å¦‚è¯´é‚£ç§é“¸å‰‘å¸ˆã€‚å¼€å‡¿çŸ¿å²©ï¼Œå†¶ç‚¼é“çŸ¿ï¼Œåˆ¶ä½œèƒšå­ï¼Œæœ€åå†·èƒï¼Œæ‰“ç£¨æŠ›å…‰ æ­¦å£«ã€‚ç»ƒä¹ ä½“åŠ›ï¼Œæ„å¿—åŠ›ï¼Œå¿ƒç†ç´ è´¨ï¼Œæˆ˜æ–—æŠ€å·§ï¼Œä¸æ–­å’Œäººæˆ˜æ–— éŸ³ä¹å®¶ï¼Œæ¯”å¦‚è¯´å‰ä»–æ‰‹ã€‚å­¦ä¹ éŸ³ä¹åŸºç¡€ï¼ŒæŒ‡æ³•ï¼Œè¯†è°±ï¼Œæ¼”å¥ åœ¨æˆ‘å¿ƒé‡Œï¼Œåšè¿™äº›çš„å·¥ä½œçš„äººä»¬åº”è¯¥æ˜¯å¯¹è‡ªå·±çš„äº‹æƒ…æ€€æœ‰è‡ªæˆ‘é©±åŠ¨çš„æ„æ„¿ä¾¿ä¼šåå¹´å¦‚ä¸€æ—¥åœ°åšä¸‹å»ã€‚æˆ‘è§‰å¾—åšç¨‹åºå‘˜ä¹Ÿåº”è¯¥æ˜¯è¿™æ ·çš„ã€‚åšä¸€è¡Œå–œæ¬¢ä¸€è¡Œã€‚ å‰ä¸ä¹…æˆ‘åœ¨ä¸€ä¸ª OJ ä¸Šåˆçœ‹åˆ°äº†è¿™ä¸ªè¯ã€‚è¿™è®©æˆ‘é‡æ–°æ‰¾åˆ°äº†ä¹‹å‰çœ‹è¿‡çš„é‚£ç¯‡æ–‡ç« å¹¶å¼€å§‹é‡æ–°æ€è€ƒè‡ªå·±å…³äºæŠ€æœ¯çš„ç†è§£ã€‚ åˆ»æ„ç»ƒä¹ æ„å‘³ç€å¯¹äºä½ æ‰€å…³æ³¨çš„äº‹æƒ…çš„æ€åº¦åƒæ˜¯æˆ‘ä¸Šé¢æåˆ°çš„å‡ ç§èŒä¸šäººå¯¹äºè‡ªå·±å·¥ä½œæ‰€æŒæœ‰çš„æ€åº¦ å¼ºçƒˆçš„åŠ¨æœº æŒç»­çš„ç»ƒä¹  åŠ¨æœºï¼Œæ¯”å¦‚ï¼šå–œæ¬¢ä¸€ä¸ªäº‹ç‰©æœ¬èº«ï¼ˆæˆ‘å–œæ¬¢å‰ä»–çš„å£°éŸ³æ‰€ä»¥ç»ƒä¹ å‰ä»–ï¼‰ï¼Œå–œæ¬¢ä¸€ä¸ªäº‹ç‰©å¸¦æ¥çš„åé¦ˆï¼Œæ¯”å¦‚æŠ€æœ¯ä¸Šçš„æå‡è®©åšæŠ€æœ¯äººçš„èŒä¸šç”Ÿæ¶¯èµ°å¾—æ›´é«˜ï¼Œè·å¾—æ›´å¤šçš„åˆ©ç›Šã€‚ä¸è®ºå‡ºäºä»€ä¹ˆæ ·çš„åŠ¨æœºï¼Œç”šè‡³æ˜¯å¾ˆå¯¹åŠ¨æœºç»„åˆåœ¨ä¸€èµ·çš„å¤åˆçš„åŠ¨æœºï¼Œæœ€ç»ˆå¸¦ç»™äººçš„æ˜¯ motivation ç›¸å¯¹äºåŠ¨æœºçš„æµ…æ˜¾æ˜“æ‡‚ï¼ŒæŒç»­çš„ç»ƒä¹ æˆä¸ºäº†é˜»ç¢å¤§éƒ¨åˆ†äººçš„å±éšœã€‚ å› ä¸ºå¤©èµ‹ï¼Œç²¾ç¥çŠ¶æ€ï¼Œç»ƒä¹ æ•°é‡ï¼Œç»ƒä¹ æ˜¯å¦ç§‘å­¦è¿™äº›éƒ½æ˜¯å†³å®šä¸€ä¸ªäººèµ°æ˜¯å¦èƒ½å‘æ›´æ·±å±‚æ¬¡çš„å› ç´ ã€‚ å¤©èµ‹å› äººè€Œå¼‚ï¼Œä½†å› ä¸ºä»–æ˜¯ç›¸å¯¹çš„å¹¶ä¸”æ˜¯ä½æ¦‚ç‡çš„æ‰€ä»¥åœ¨ä¸€äº›éæç«¯çš„åœºæ™¯ä¸‹éƒ½ä¸ä¼šå‡¸æ˜¾å‡ºæ¥ã€‚ä¸€äº›æç«¯åœºæ™¯æ¯”å¦‚å„ç±»ç«æŠ€ï¼ŒLOL æ¸¸æˆä¸­çš„ fakerï¼Œæ¸¸æ³³æ¯”èµ›ä¸­çš„è²å°”æ™®æ–¯ï¼ŒNBA é‡Œé¢çš„å„ç§æ€ªå…½â€¦ ä»–ä»¬éƒ½ä¸ºè‡ªå·±çš„å·¥ä½œä»˜å‡ºäº†å¤§é‡ç§‘å­¦çš„ç»ƒä¹ ã€‚ä»¥è‡³äºå’Œå¯¹æ‰‹ä¹‹é—´çš„æ¯”è¯•å¾ˆå¤§ç¨‹åº¦ä¸Šçš„ç¡®æ˜¯åœ¨â€”æ‹¼å¤©èµ‹ã€‚ è€Œå¯¹äºç»å¤§å¤šæ•°äººï¼Œæˆ‘è®¤ä¸ºæ›´é‡è¦çš„æ˜¯è¦æ‹¥æœ‰è‰¯å¥½çš„ç²¾ç¥çŠ¶æ€ï¼ŒåŠ ä¸Šç§‘å­¦çš„ç»ƒä¹ æ–¹å¼ä»¥åŠæŒç»­çš„ç»ƒä¹ ä¼šæ˜¯é«˜æ¦‚ç‡èµ°å‘é¢†åŸŸæ·±å±‚æ¬¡çš„å¿…è¦æ¡ä»¶ã€‚ è‰¯å¥½çš„ç²¾ç¥çŠ¶æ€æ¥æºäºå¯¹è‡ªå·±èº«ä½“å’Œå¿ƒç†å¥åº·çš„ç®¡ç†ã€‚è™½ç„¶è¿™æ˜¯æµ…æ˜¾æ˜“æ‡‚çš„é“ç†ï¼Œå¯æ˜¯ä¾æ—§æœ‰å¾ˆå¤šäººè¾“åœ¨äº†è¿™ä¸€å±‚ã€‚ä»–ä»¬å¾€å¾€æ— æ³•ä¸“æ³¨ï¼Œæ—¶ä¸æ—¶èº«ä½“å‡ºç°å¼‚å¸¸ï¼Œæ€»æ˜¯è¢«ç”Ÿç†ä¸Šçš„é—®é¢˜å›°æ‰°ã€‚ è¶³å¤Ÿçš„ç»ƒä¹ æ•°é‡æ˜¯åœ¨æ•°å­—ä¸Šè¡¡é‡ä¸€ä¸ªäººæŠ€è‰ºæ°´å¹³çš„æ–¹å¼ï¼Œè¿™å¾ˆç®€å•ä¹Ÿå¾ˆç›´è§‰ã€‚æ¯”å¦‚è¯´æˆ‘ä»¬ç”Ÿç—…äº†å–œæ¬¢æ‰¾çœ‹èµ·æ¥å¹´é¾„è¾ƒå¤§å¯Œæœ‰ç»éªŒçš„åŒ»ç”Ÿï¼Œé«˜çº§ç¨‹åºå‘˜çš„æ‹›è˜ JD ä¸Šæ€»æ˜¯ä¹ æƒ¯æ€§çš„å‡ºç°è¦æ±‚ 3 - 5 å¹´æˆ–è€…æ›´å¤šã€‚ ä½†æˆ‘æƒ³è¯´çš„æ˜¯ï¼Œå¾ˆå¤šæ— æ„ä¹‰çš„ä»˜å‡ºçš„ç¡®æ˜¯æ²¡æœ‰å›æŠ¥çš„ã€‚ ç§‘å­¦çš„ç»ƒä¹ æ–¹æ³•æ˜¯æŠ€æœ¯äººä¸€å®šè¦å­¦ä¼šæŒæ¡çš„æŠ€èƒ½ã€‚å¦‚æœä½ æ˜¯èº«è¾¹æœ‰ä¸€ç¾¤æ›´ä¼˜ç§€çš„äººï¼Œé‚£ä¹ˆä½ çš„è¡Œä¸ºå®¹æ˜“å¾—åˆ°çº æ­£å¼çš„åé¦ˆï¼ŒåŒæ—¶è§‚å¯Ÿåˆ°ä»–äººçš„ç»ƒä¹ æ–¹æ³•è‡ªèº«ä¹Ÿå¯ä»¥å­¦åˆ°æ›´å¤šã€‚å¦‚æœæ²¡æœ‰è¿™æ ·çš„æ¡ä»¶ï¼Œé‚£ä¹ˆä¹Ÿæˆ–è®¸å¯ä»¥æ ¹æ®æˆ‘æ€»ç»“çš„ä¸‹é¢å››ç‚¹æ‰¾åˆ°å±äºè‡ªå·±æœ€ç§‘å­¦çš„ç»ƒä¹ æ–¹æ³•ã€‚ è®¾å®šç²¾ç¡®çš„ç›®æ ‡è®¡åˆ’ çŸ­æœŸå†…çš„ï¼Œæ¯”å¦‚ä¸€å‘¨æˆ–è€…ä¸¤å‘¨å°†è¦åšçš„äº‹æƒ…ã€‚è¿™äº›äº‹æƒ…ä¸€å®šæ˜¯ç»è¿‡äº†ä»”ç»†è¯„ä¼°çš„ ä¿æŒä¸“æ³¨ è¿™æ˜¯é«˜æ•ˆç»ƒä¹ çš„åŸå§‹åŠ¨åŠ› æœ‰æ•ˆåé¦ˆ èƒ½ç§¯æå¿«é€Ÿè®¤è¯†åˆ°è‡ªå·±è¿™æ ·ç»ƒä¹ æ–¹å¼æ˜¯å¦æ­£ç¡® åœ¨èˆ’é€‚åŒºé¢å‰ä¿æŒç†æ€§ ä¸æ–­ç»ƒä¹ ä¸æ–­äº§ç”Ÿæˆå°±æ„Ÿï¼Œä¸æ–­å‰²èˆæ‰æˆå°±æ„Ÿå¾€ä¸‹ä¸€ä¸ªç›®æ ‡èµ°å» ä»¥ä¸Šï¼Œä¾¿æ˜¯æˆ‘è®¤ä¸ºçš„æŠ€æœ¯äººçš„åˆ»æ„ç»ƒä¹ ã€‚","categories":[],"tags":[{"name":"æ€è€ƒ","slug":"æ€è€ƒ","permalink":"https://razertory.me/tags/æ€è€ƒ/"}]},{"title":"MySQL Top Tips","slug":"100-tips-of-mysql","date":"2019-05-31T05:37:02.000Z","updated":"2020-03-28T13:02:10.004Z","comments":true,"path":"2019/05/31/100-tips-of-mysql/","link":"","permalink":"https://razertory.me/2019/05/31/100-tips-of-mysql/","excerpt":"","text":"MySQL é€šè¿‡ /mysql/bin/mysqld å¯åŠ¨ uft8 ä½œä¸º unicode çš„å­é›†ï¼Œåœ¨ MySQL çš„ä¸–ç•Œé‡Œå°±æ˜¯ uft8mb3ï¼Œå½“ç„¶ emoji éœ€è¦ uft8mb4 MySQL ä¼šç¼“å­˜æŸ¥è¯¢ï¼Œä¸è¿‡ä¸ä¼šç¼“å­˜ä¸€äº›ç³»ç»Ÿå‡½æ•°ä»¥åŠç³»ç»Ÿè¡¨ ï¼ˆæ¯”å¦‚ï¼šmysql ã€information_schemaã€ performance_schema) çš„æŸ¥è¯¢ç»“æœ MySQL 5.7.20 å¼€å§‹ä¸å†æ¨èä½¿ç”¨ç¼“å­˜ï¼Œå¹¶åœ¨ MySQL 8.0 åˆ é™¤ å¦‚æœä½ å‘ç°å¾ˆéš¾æƒè¡¡ç”¨ä»€ä¹ˆå­˜å‚¨å¼•æ“ï¼Œæˆ–è€…å¯¹å­˜å‚¨å¼•æ“æ²¡æœ‰å¤ªå¤šäº†è§£ï¼Œé‚£ä¹ˆç›´æ¥ç”¨é»˜è®¤çš„ InnoDB å§ InnoDB åœ¨ MySQL 5.6 ä»¥åŠä»¥åçš„ç‰ˆæœ¬ä¸­ï¼Œå¤§å¤šæ•°çš„ DDL è¯­å¥éƒ½ä¸ä¼šé”è¡¨äº†ã€‚ç›¸å¯¹çš„ï¼Œå¦‚æœç”¨çš„ä¹‹å‰çš„ç‰ˆæœ¬ï¼Œéƒ½æ˜¯ä¼šé”çš„ InnoDB æ˜¯è¡Œå­˜å‚¨çš„ ï¼ˆé»˜è®¤ Compact è¡Œæ ¼å¼ï¼‰ï¼Œå­˜ä¸‹çš„æ˜¯æ¯ä¸€è¡Œçš„åŸå§‹æ•°æ®å’Œé¢å¤–ä¿¡æ¯ï¼Œæ¯”å¦‚ï¼šVARCHAR è¿™ç§å˜é•¿å­—æ®µå®é™…ç”¨çš„é•¿åº¦ï¼Œnull å€¼åˆ—è¡¨ï¼ˆå¦‚æœæ²¡æœ‰ null å€¼ä¹Ÿå°±æ²¡æœ‰è¿™ä¸ªåˆ—è¡¨ï¼‰ï¼Œtrx_id äº‹åŠ¡ id InnoDB é»˜è®¤ä¼šç»™ä¸»é”®åˆ›å»ºä¸€ä¸ª B+ æ ‘ä½œä¸ºèšç°‡ç´¢å¼•ï¼Œå…¶ä¸­ï¼Œèšç°‡ç´¢å¼•çš„å¶å­èŠ‚ç‚¹åŒ…å«äº†æ‰€æœ‰çš„ç”¨æˆ·æ•°æ® InnoDB å¯¹éä¸»é”®åˆ›å»ºçš„ B+ æ ‘ç´¢å¼•çš„å¶å­èŠ‚ç‚¹åŒ…å«ä¸»é”®å’Œç´¢å¼•åˆ—ï¼Œè¿™ç§ç´¢å¼•ç§°ä¸ºäºŒçº§ç´¢å¼•ã€‚å…¶ä¸­ä¸€ä¸ªäºŒçº§ç´¢å¼•åªæœ‰ä¸€ä¸ª B+ æ ‘ï¼Œå³ä½¿æ˜¯è”åˆç´¢å¼• InnoDB å½“ where æ¡ä»¶åªä¸ºä¸€ä¸ªäºŒçº§ç´¢å¼•åˆ—çš„æ—¶å€™ï¼Œä¼šåœ¨ç´¢å¼•å¶å­èŠ‚ç‚¹æ‰¾åˆ°ä¸»é”®ï¼Œç„¶åé€šè¿‡ä¸»é”®çš„èšç°‡ç´¢å¼•æ‰¾åˆ°çœŸå®è®°å½•ï¼Œè¿™ä¸ªè¿‡ç¨‹ç§°ä¸ºå›è¡¨ InnoDB å¯¹éä¸»é”®çš„è”åˆç´¢å¼•é‡‡å–æŒ‰ç…§è”åˆç´¢å¼•å‰è¾¹çš„åˆ—æ’åºï¼Œå¦‚æœå‘½ä¸­ï¼Œåˆ™æŒ‰ç…§è¿™ä¸ªé¡ºåºå¾€åã€‚æ¯”å¦‚ï¼šé’ˆå¯¹ä¸€ä¸ªè¡¨ user_posts (id, user_id, post_id) çš„è”åˆç´¢å¼• index_on_user_id_post_idã€‚è¿™é‡Œæˆ‘ä»¬ç§°ä¸ºå‰ç¼€åŒ¹é…è§„åˆ™ æ›´å¤šè¯¦æƒ…è§ å®˜æ–¹æ–‡æ¡£ 12345678#æœ‰æ•ˆselect * from user_posts where user_id = 343 and post_id = 121#æœ‰æ•ˆselect * from user_posts where user_id = 343#æ— æ•ˆselect * from user_posts where post_id = 121#æ— æ•ˆselect * from user_posts where user_id = 343 or post_id = 121 InnoDB åˆ›å»ºçš„è”åˆç´¢å¼•æ—¶ï¼Œå°½é‡è®©åŒºåˆ†åº¦é«˜çš„åˆ—åœ¨å·¦è¾¹ åœ¨ä¸šåŠ¡ä¸Šæœ‰å”¯ä¸€ä¿è¯çš„åˆ—æˆ–è€…è”åˆåˆ—æ—¶ï¼Œä¸€å®šç”¨å”¯ä¸€ç´¢å¼•ï¼Œæœç»è„æ•°æ®çš„äº§ç”Ÿ ä¸€ä¸ªè¡¨ä¸Šç´¢å¼•å»ºçš„è¶Šå¤šï¼Œå°±ä¼šå ç”¨è¶Šå¤šçš„å­˜å‚¨ç©ºé—´ï¼Œåœ¨å¢åˆ æ”¹è®°å½•çš„æ—¶å€™æ€§èƒ½å°±è¶Šå·® InnoDB å¯¹äºå«æœ‰ç´¢å¼•åˆ—çš„æ¨¡ç³ŠåŒ¹é…ï¼Œåªä¼šåœ¨å‰ç¼€ç¡®è®¤çš„æƒ…å†µä¸‹æ‰ä¼šç”Ÿæ•ˆ InnoDB å¯¹äº order by å«æœ‰ç´¢å¼•åˆ—çš„æŸ¥è¯¢æ˜¯èƒ½å¤Ÿé€šè¿‡ç´¢å¼•æ’åºçš„ï¼Œä¸è¿‡è¿™ä¸åŒ…å«ï¼š1. æ··ç”¨ ASC ä¸ DESC çš„æ—¶å€™ 2. å«æœ‰éç´¢å¼•åˆ—çš„æ—¶å€™ 3. è”åˆç´¢å¼•é¡ºåºä¸éµå¾ªåˆ™å‰ç¼€åŒ¹é…è§„åˆ™çš„ InnoDB å¯¹äºä¸€ä¸ªä½¿ç”¨åˆ°ç´¢å¼•çš„æœç´¢æ¡ä»¶å’Œæ²¡æœ‰ä½¿ç”¨è¯¥ç´¢å¼•çš„æœç´¢æ¡ä»¶ä½¿ç”¨ OR è¿æ¥èµ·æ¥åæ˜¯æ— æ³•ä½¿ç”¨è¯¥ç´¢å¼•çš„ InnoDB å¯¹äºå«æœ‰å¤šä¸ªå¼•åˆ—ï¼Œå¹¶ä¸”æ¯ä¸ªåˆ—éƒ½æœ‰äºŒçº§ç´¢å¼•çš„æŸ¥è¯¢ï¼Œä¸€èˆ¬çš„åšæ³•æ˜¯ä¸æ–­é€šè¿‡äºŒçº§ç´¢å¼•æ‰¾åˆ° B+ æ ‘çš„å¶å­èŠ‚ç‚¹ä¹‹åè¿›è¡Œå¤šæ¬¡å›è¡¨æ“ä½œã€‚æŸäº›ç‰¹æ®Šæƒ…å†µä¸‹ä¼šå…ˆåˆå¹¶ç´¢å¼•ï¼Œåªè¿›è¡Œä¸€æ¬¡å›è¡¨æ“æå‡æ€§èƒ½ã€‚ä¸è¿‡ï¼Œæ—¢ç„¶éƒ½ç”¨åˆ°å¤šä¸ªåˆ—äº†ï¼Œé‚£ä¹ˆç›´æ¥ç”¨è”åˆç´¢å¼•å°±å¥½äº† MySQL inner join çš„ on è¯­å¥ï¼Œæœ¬è´¨ä¸Šå’Œ where æ˜¯ä¸€æ ·çš„ã€‚ä¹Ÿå°±æ˜¯è¯´å¯ä»¥æŠŠä¸€ä¸ª inner join æ¢æˆ where çš„å†™æ³• MySQL çš„ join ä½¿ç”¨çš„æ˜¯ åµŒå¥—å¾ªç¯è¿æ¥ ç®—æ³•ï¼Œåœ¨è¿™ä¸ªç®—æ³•ä¸­ï¼Œè¢« join çš„è¡¨ ï¼ˆè¢«é©±åŠ¨è¡¨ï¼‰ å¦‚æœæ•°ç›®å¤§ä¸”æ²¡æœ‰ç´¢å¼•ï¼Œæ€§èƒ½ä¼šæ€¥å‰§ä¸‹é™ã€‚è¿™ç§æƒ…å†µå¦‚æœå®åœ¨æ— æ³•é¿å…ï¼Œå¯ä»¥è¯•ç€æŠŠ join buffer å‚æ•°è°ƒå¤§ï¼ŒåŒæ—¶é¿å…ä½¿ç”¨ select * ä½¿ä¸å¿…è¦çš„æ•°æ®å ç”¨ç©ºé—´ å°½é‡è®©æ‰€æœ‰çš„æŸ¥è¯¢éƒ½èƒ½åšåˆ° explain ä¸‹æ¥è‡³å°‘ rangeï¼Œæœ€å¥½æ˜¯ ref ç”šè‡³ consts InnoDB å¯¹ä»»ä½•ä¸€æ¡è®°å½•è¿›è¡Œå†™çš„æ”¹åŠ¨çš„æ—¶å€™ï¼Œä¼šåŒæ—¶æŠŠå½“å‰çš„ trx_id ä¹Ÿå†™å…¥ MySQL é»˜è®¤å¼€å¯ REPEATABLE READ äº‹åŠ¡éš”ç¦»çº§åˆ«ï¼Œè¿™ç§æ–¹å¼åŸæœ¬æ˜¯ä¼šæœ‰å¹»è¯»é—®é¢˜çš„ã€‚å¿«ç…§è¯»é€šè¿‡ undo log è§£å†³ï¼Œå½“å‰è¯»é€šè¿‡ gap lock è§£å†³ã€‚ MySQL MVCC ä¸­è¯»æ“ä½œåˆ†ä¸ºå¿«ç…§è¯»å’Œå½“å‰è¯» å¿«ç…§è¯»ï¼šè¯»åˆ°çš„æ˜¯å·²ç»æäº¤äº†çš„äº‹åŠ¡ã€‚æ¯”å¦‚ select .. where å½“å‰è¯»ï¼šè¯»åˆ°çš„æ°¸è¿œæ˜¯æœ€æ–°çš„å†…å®¹ï¼Œæ¯”å¦‚æœ‰ä¸€ä¸ªäº‹åŠ¡ä¿®æ”¹äº†ä¸€ä¸ªè®°å½•ä¸”æ²¡æœ‰æäº¤ã€‚æ¯”å¦‚ update .. where RC å’Œ RR æœ€æœ¬è´¨çš„åŒºåˆ«åœ¨äºç”Ÿæˆ ReadView çš„æ—¶æœºä¸åŒ","categories":[],"tags":[{"name":"åŸºç¡€ç»„ä»¶","slug":"åŸºç¡€ç»„ä»¶","permalink":"https://razertory.me/tags/åŸºç¡€ç»„ä»¶/"}]},{"title":"ã€ŒLinux å†…æ ¸ã€ã€ä»£ç åˆ†æ select, poll, epoll","slug":"async_io_epoll_poll_select","date":"2019-05-09T13:28:23.000Z","updated":"2020-04-12T08:06:28.183Z","comments":true,"path":"2019/05/09/async_io_epoll_poll_select/","link":"","permalink":"https://razertory.me/2019/05/09/async_io_epoll_poll_select/","excerpt":"","text":"ç°åœ¨æœ‰å¾ˆå¤šè®²è¿™ä¸‰ä¸ª system call çš„æ–‡ç« ï¼Œè¿™é‡Œæˆ‘ä»ä»£ç å±‚é¢å»åˆ†æå’Œç†è§£ã€‚ é¦–å…ˆï¼Œä»–ä»¬åˆ†åˆ«æ¥è‡ªäº &lt;sys/select.h&gt;ï¼Œ&lt;sys/poll.h&gt;ï¼Œ&lt;sys/epoll.h&gt;ã€‚å¦‚æœæ˜¯ Mac OSï¼Œæ˜¯æ²¡æœ‰ç¬¬ä¸‰ä¸ªçš„ï¼Œå…¶ä¸­å‰ä¸¤ä¸ªéƒ½åœ¨ /usr/include/sysã€‚ å½“ä¸€ä¸ªå®¢æˆ·ç«¯è¯·æ±‚æœåŠ¡ç«¯çš„æ—¶å€™ï¼ŒæœåŠ¡ç«¯ä¼šè°ƒç”¨ accept() äº§ç”Ÿä¸€ä¸ª socketï¼Œè¿™ä¸ª socket ç›¸å½“äºä¸€ä¸ªçŠ¶æ€æœºï¼Œæœ€åŸºæœ¬çš„åŒ…æ‹¬æ˜¯å¦å¯è¯»ï¼Œæ˜¯å¦å¯å†™ï¼ŒæœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯åœ¨è¿›è¡Œæ•°æ®ä¼ è¾“çš„è¿‡ç¨‹ä¸­ï¼Œè¿™ä¸ª socket çš„çŠ¶æ€å°±ä¼šä¸æ–­å‘ç”Ÿå˜åŒ–ã€‚è¿™åªæ˜¯ä¸€ä¸ªå®¢æˆ·ç«¯çš„æƒ…å†µï¼Œå®é™…ä¸Šè‚¯å®šæ˜¯æœ‰å¾ˆå¤šçš„ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼ŒæœåŠ¡ç«¯éœ€è¦åŒæ—¶æ§åˆ¶è®¸å¤šçš„ socket çš„è¯»å†™ã€‚å¹¶ä¸”æ€»æ˜¯éœ€è¦ä»¥æœ€å¿«çš„æ—¶é—´ï¼Œæœ€å°çš„ç³»ç»Ÿå¼€é”€æ¥å‘ socket è¯»æˆ–è€…å†™æ•°æ®ã€‚åº†å¹¸çš„æ˜¯ï¼Œè¿™äº›äº‹æƒ…éƒ½ç”±å¼€å‘æ“ä½œç³»ç»Ÿå†…æ ¸çš„å·¥ç¨‹å¸ˆä»¬æå®šäº†ã€‚ fd: ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦; fds: ä¸€ç»„æ–‡ä»¶æè¿°ç¬¦ select fd_set ï¼š&lt;sys/select.h&gt; æä¾›çš„æ–‡ä»¶æè¿°ç¬¦é›†åˆï¼Œæ˜¯ä¸€ä¸ªèƒ½å­˜æ”¾æœ€å¤š 1024 ä¸ªå…ƒç´ çš„æ•°ç»„ã€‚ select éœ€è¦ä¼ å…¥ fd_set çš„åœ°å€ï¼Œç„¶åå°†å®ƒä»¬ä¿®æ”¹æˆåªåŒ…å«å°±ç»ªå¹¶ç”¨æ¥è¯»å†™ã€‚è¿™ä¸ªæ–¹æ³•çš„ç­¾åä¸º 123// æŒ‰ç…§é¡ºåºï¼Œå‚æ•°çš„æ„æ€åˆ†åˆ«æ˜¯// fd_set çš„ æœ€å¤§ç¼–å·ï¼Œå‡†å¤‡å°±ç»ªè¯»çš„ï¼Œå‡†å¤‡å°±ç»ªå†™çš„ï¼Œå¼‚å¸¸çš„ï¼Œä»¥åŠè¶…æ—¶æ—¶é—´int select(int nfds, fd_set *readfds, fd_set *writefds, fd_set *exceptfds, struct timeval *timeout); ç®€å•ç‚¹ï¼Œæ¯”å¦‚è¯´ä½ æœ‰ fdsï¼Œç¼–å· 1 åˆ° 5 å¹¶ä¸”åªæƒ³è®©å†…æ ¸å‘Šè¯‰ä½ å“ªäº› fd å¯è¯»ã€‚é‚£ä¹ˆåªéœ€è¦è°ƒç”¨ select(5, fds, NULL, NULL, NULL) å°±å¥½äº†ã€‚æœåŠ¡ç«¯ä¼šä¸æ–­åœ°å¾ªç¯è°ƒç”¨è¿™ä¸ªæ–¹æ³•æ¥åšæ•°æ®çš„è¯»å†™ã€‚ æŒ‰ç…§ select çš„åšæ³•ï¼Œå‡è®¾æœ€å¤§ä¸º 600 çš„äº”ä¸ª fd ä¼ å…¥ï¼Œé‚£ä¹ˆ select ä¼šä» 0 å¼€å§‹éå†åˆ° 600ï¼Œè¿™æ ·åšä¼šæµªè´¹æ‰å¤§é‡çš„ CPU èµ„æºã€‚ pollpoll ä¸ select ç›¸æ¯”è¾ƒï¼Œæœ€å¤§çš„åŒºåˆ«åœ¨äºä¸å†ä½¿ç”¨ fd_set è¿™æ ·çš„æ•°æ®ç»“æ„ã€‚è€Œæ˜¯ä¸ºæ¯ä¸€ä¸ª fd éƒ½å°è£…äº†ä¸€ä¸ª pollfd 12345struct pollfd &#123; int fd; // å¯¹åº”çš„ fd short events; short revents;&#125;; åªéœ€è¦ç»™ poll() æ–¹æ³•ä¼ å…¥å·²ç»æ‰“å¼€çš„ fdsï¼Œæ–¹æ³•ç­¾åä¸º 1int poll (struct pollfd *fds, unsigned int nfds, int timeout); åœ¨ä¸Šè¿° select çš„æ¡ˆä¾‹ä¸­ï¼ŒåŒæ ·æœ€å¤§ 600 çš„äº”ä¸ª fd ä¼ å…¥ï¼Œpoll åªéœ€è¦ä¼ å…¥è¿™ä¸ª 5 ä¸ª fds å³å¯ã€‚åœ¨è°ƒç”¨äº† poll() ä¹‹åï¼Œ å°±ç»ªçš„ pollfd ä¸­çš„ revents å°±ä¼šè¢«ä¿®æ”¹ï¼Œä¹Ÿå°±èƒ½ç¡®è®¤å“ªäº› fds å°±ç»ªã€‚ epollepoll åŒ…å«äº†å¤šä¸ªæ–¹æ³•ï¼Œä½¿ç”¨èµ·æ¥å®é™…ä¸Šä¼šåˆ†æˆå‡ ä¸ªæ­¥éª¤ åˆå§‹åŒ– epoll äº‹ä»¶é©±åŠ¨æ‰€ç”¨åˆ°çš„æ•°æ®ç»“æ„ epoll_event epoll_create() åˆå§‹åŒ–å½“å‰çš„ context åˆå§‹åŒ– epoll_event ä¸­çš„ data.fd å…³è”åˆ°å½“å‰ç³»ç»Ÿçš„ fds ä¾ç…§ epoll_event çš„å†…å®¹ï¼Œè°ƒç”¨ epoll_ctl() æ¥å¯¹å½“å‰çš„ context è¿›è¡Œæ§åˆ¶ï¼Œé€šå¸¸æ˜¯ç»™ context å†™å…¥æˆ–è€…åˆ é™¤ fds epoll_wait() åªè¿”å›å°±ç»ªçš„ fds ç”±äºæ²¡æœ‰æ— æ•ˆçš„éå†ï¼Œepoll çš„ç†è®ºæ—¶é—´å¤æ‚åº¦æ˜¯ O(1)ã€‚ select å’Œ poll çš„å¤æ‚åº¦æ˜¯ O(n)ã€‚ æºç  å‚è€ƒhttps://devarea.com/linux-io-multiplexing-select-vs-poll-vs-epoll/#.XNOXutMzYQE https://jvns.ca/blog/2017/06/03/async-io-on-linux--select--poll--and-epoll/ ã€ŠLinux/Unix ç³»ç»Ÿç¼–ç¨‹æ‰‹å†Œã€‹","categories":[],"tags":[{"name":"æ“ä½œç³»ç»Ÿ","slug":"æ“ä½œç³»ç»Ÿ","permalink":"https://razertory.me/tags/æ“ä½œç³»ç»Ÿ/"}]},{"title":"æ±‰è¯ºå¡”é—®é¢˜","slug":"hanoi-tower","date":"2019-03-15T12:44:06.000Z","updated":"2020-03-28T13:02:10.005Z","comments":true,"path":"2019/03/15/hanoi-tower/","link":"","permalink":"https://razertory.me/2019/03/15/hanoi-tower/","excerpt":"","text":"æè¿°ä¸€ä¸‹é—®é¢˜ï¼Œå‡è®¾æœ‰ Aï¼ŒBï¼ŒC ä¸‰ä¸ªæŸ±å­ã€‚A æŸ±å­ä¸Šæœ‰ä¸€å®šæ•°ç›®ä»é«˜åˆ°ä½æ˜¯å°åˆ°å¤§é¡ºåºçš„ç›˜å­å èµ·æ¥ï¼Œæ¯æ¬¡å¯ä»¥ç§»åŠ¨ä¸€ä¸ªæŸ±å­ä¸Šçš„ 1 ä¸ªç›˜å­ã€‚å¹¶ä¸”ä»»ä½•æ—¶å€™å°ç›˜å­æ°¸è¿œåœ¨å¤§ç›˜å­ä¸Šã€‚ç°åœ¨çš„é—®é¢˜æ˜¯å¦‚ä½•æŠŠ A çš„ N ä¸ªç›˜å­ç§»åŠ¨åˆ° Cã€‚åœ¨çº¿æ¸¸æˆ 1.N = 1 ï¼ŒA ç§»åŠ¨åˆ° C å°±å¥½ã€‚ 2.N = 2ï¼Œå…ˆç§»åŠ¨ç¬¬ä¸€ä¸ªåˆ° Bï¼Œå†æŠŠç¬¬äºŒä¸ªç§»åŠ¨åˆ° Cï¼Œå†æŠŠ B çš„ç§»åŠ¨åˆ° C å°±å¥½ã€‚ 3.N = 3 â€¦ ä¹Ÿè®¸åˆšæ‹¿åˆ°çš„æ—¶å€™ä¼šä¸æ–­å°è¯•ã€‚ä»”ç»†åˆ†æ 2 çš„æœ€åä¸€æ­¥ï¼Œä¼šå‘ç°è¿™ä¸ªæ—¶å€™ A æ²¡æœ‰ç›˜å­ï¼ŒB æœ‰ä¸€ä¸ªå°çš„ï¼ŒC æœ‰ä¸€ä¸ªå¤§çš„ã€‚å¦‚æœæŠŠè¿™ä¸ªæƒ…å†µå¼•å…¥åˆ° 3ï¼Œå°±æ˜¯ A æ²¡æœ‰ç›˜å­ï¼ŒC æœ‰ä¸€ä¸ªæœ€å¤§çš„ï¼ŒB æœ‰ä¸¤ä¸ªè¾ƒå°çš„ï¼ŒæŠŠ B çš„ä¸¤ä¸ªç§»åŠ¨åˆ° C å°±è¡Œäº†ã€‚å¦‚ä½•æŠŠ B çš„ä¸¤ä¸ªç§»åŠ¨åˆ° C å‚çœ‹ 2 çš„è§£ç­”å³å¯ã€‚åŒæ ·ï¼Œå¦‚ä½•æŠŠä¸¤ä¸ªè¾ƒå°çš„ç›˜å­ç§»åŠ¨åˆ° B å‘¢ï¼Œä¹Ÿå¯ä»¥å‚çœ‹ 2 çš„è§£ç­”ã€‚ é‚£ä¹ˆå½“ N æ›´å¤§çš„æ—¶å€™å‘¢ï¼Ÿ è¿™ä¸ªæ—¶å€™è‚¯å®šæ˜¯éœ€è¦å¯»æ‰¾è§„å¾‹çš„ã€‚ä» N = 3 çš„æƒ…å†µå¯ä»¥çœ‹å‡ºä¼¼ä¹ 2 çš„è§£æ³•å¯ä»¥ç”¨åœ¨äº† 3 ä¸Šï¼Œå¹¶ä¸”å¯ä»¥å‘ç° N ä¸ªç›˜å­åœ¨ç§»åŠ¨åˆ° C ä¹‹å‰ä¸€å®šæ˜¯è¦è®© N - 1 ä¸ªç›˜å­è½åœ¨ B å¹¶ä¸”ç¬¬ 1 å¤§çš„è½åœ¨ Cï¼Œå¹¶ä¸”ï¼Œ è®© N - 1 è½åœ¨ B å°±ä¸€å®šè¦è®© N - 2 è½åœ¨ Cï¼Œå¹¶ä¸”ï¼Œ è®© N - 2 è½åœ¨ C å°±ä¸€å®šè¦è®© N - 3 è½åœ¨ Bï¼Œå¹¶ä¸”ï¼Œ è®© N - 3 è½åœ¨ B å°±ä¸€å®šè¦è®© N - 4 è½åœ¨ Cï¼Œå¹¶ä¸”ï¼Œ â€¦ æœ€åçš„ç»“è®ºå°±æ˜¯æ¢è®¨ç¬¬ N å¤§çš„ç›˜å­è½åœ¨ B è¿˜æ˜¯ C ä¸Šã€‚å¦‚æœæ˜¯ä»æ•°å­¦çš„è§’åº¦çœ‹ï¼Œåªè¦é€šè¿‡å¥‡å¶æ¥åˆ¤æ–­æ˜¯å¾€ B è¿˜æ˜¯å¾€ C å³å¯ã€‚é‚£ä¹ˆå¦‚ä½•ç”¨è®¡ç®—æœºæ¥è§£ç­”å‘¢ï¼Ÿ å‡è®¾å‡½æ•°ç­¾åæ˜¯ hanoi(n, a, b, c)ã€‚å‰ä¸‰ä¸ªè¾“å…¥ä»¥åŠè¾“å‡ºåˆ†åˆ«ä¸º 12345678910111213141516&gt; hanoi(1, \"A\", \"B\", \"C\")A â€”-&gt; C&gt; hanoi(2, \"A\", \"B\", \"C\")A â€”-&gt; BA â€”-&gt; CB â€”-&gt; C&gt; hanoi(3, \"A\", \"B\", \"C\")A â€”-&gt; CA â€”-&gt; BC â€”-&gt; BA â€”-&gt; CB â€”-&gt; AB â€”-&gt; CA â€”-&gt; C ä»æœ€ç®€å•çš„æƒ…å†µå¯ä»¥å†™å‡º 1234567def hanoi(n, a, b, c) if n == 1 puts \"#&#123;a&#125; --&gt; #&#123;c&#125;\" else # æ‰€ä»¥å½“ n &gt; 1 çš„æ—¶å€™å‘¢ï¼Ÿ endend å›é¡¾ä¸Šé¢çš„æ¨å¯¼ä¸éš¾å‘ç°å®é™…ä¸Šå¦‚æœè¦æŠŠ N ä¸ªç›˜å­ä» A ç§»åŠ¨åˆ° Cã€‚éœ€è¦åšçš„å°±æ˜¯ä¸‰æ­¥ ç§»åŠ¨ A çš„ N - 1 ä¸ªåˆ° B ç§»åŠ¨ç¬¬ A çš„ N ä¸ª åˆ° C ç§»åŠ¨ B çš„ N - 1 ä¸ªåˆ° C è¿™å…¶ä¸­ Aï¼ŒBï¼ŒC æŸ±å­ä¸ºäº†ä¾¿äºç†è§£å¯ä»¥è®¤ä¸ºæ˜¯èµ·å§‹æŸ±ï¼Œè¾…åŠ©æŸ±å’Œç›®æ ‡æŸ±ã€‚è¿™ä¹Ÿå‡½æ•° hanoi(n, a, b, c) ä¸­åä¸‰ä¸ªå‚æ•°çš„æ„æ€å°±æ˜¯ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå†æ·±å…¥ç†è§£ä¸º ç§»åŠ¨èµ·å§‹æŸ±çš„ N - 1 ä¸ªåˆ°è¾…åŠ©æŸ± ç§»åŠ¨èµ·å§‹æŸ±çš„ N ä¸ª åˆ°ç›®æ ‡æŸ± ç§»åŠ¨è¾…åŠ©æŸ±çš„ N - 1 ä¸ªåˆ°ç›®æ ‡æŸ± å®Œå–„ä¸€ä¸‹ä»£ç å°±æ˜¯ 123456789def hanoi(n, a, b, c) if n == 1 puts \"#&#123;a&#125; --&gt; #&#123;c&#125;\" else hanoi(n - 1, a, c, b) hanoi(1, a, b, c) hanoi(n - 1, b, a, c) endend","categories":[],"tags":[]},{"title":"N çš‡åé—®é¢˜","slug":"n-queens-puzzle","date":"2019-03-09T01:23:09.000Z","updated":"2020-03-28T13:02:10.004Z","comments":true,"path":"2019/03/09/n-queens-puzzle/","link":"","permalink":"https://razertory.me/2019/03/09/n-queens-puzzle/","excerpt":"","text":"N çš‡åé—®é¢˜æ˜¯æœ€æ—©ä¸€ä½æ£‹æ‰‹æå‡ºäº†å…«çš‡åé—®é¢˜ä¹‹åï¼Œæ¨æ¼”è€Œæ¥çš„ã€‚å…«çš‡åé—®é¢˜çš„è§„åˆ™æ˜¯ï¼š åœ¨ 8 * 8 çš„ç›˜ä¸­æ”¾ç½® 8 ä¸ªçš‡å ä»»ä½•ä¸€ä¸ªçš‡åçš„æ¨ªï¼Œç«–ï¼Œæ–œå¯¹è§’éƒ½ä¸èƒ½åˆ«çš„çš‡å æˆ‘ä»¬è¦ä»ä¸­æ‰¾åˆ°å°½å¯èƒ½å¤šçš„æ‘†æ”¾æ–¹æ³•ã€‚ä¸‹å›¾æ˜¯è§£æ³•ä¹‹ä¸€ å…«çš‡åé—®é¢˜ éšåï¼Œè¿™ä¸ªé—®é¢˜è¢«æ¨æ¼”æˆä¸ºäº† N çš‡åé—®é¢˜ã€‚ä¹Ÿå°±æ˜¯å½“æ£‹ç›˜å¤§å°ä¸º Nï¼ˆN &gt; 0ï¼‰ï¼Œçš‡åä¸ªæ•°ä¸º N çš„æ—¶å€™ï¼Œæœ‰å¤šå°‘ç§æ‘†æ”¾æ–¹æ³•ã€‚ç›®å‰å‰ 10 ä¸ªåˆ†åˆ«æ˜¯ 1234567N =&gt; [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]U =&gt; [1, 0, 0, 1, 2, 1, 6, 12, 46, 92]D =&gt; [1, 0, 0, 2, 10, 4, 40, 92, 352, 724]# N æ£‹ç›˜å¤§å°# U ä¸åŒ…æ‹¬å¯¹ç§°çš„è§£# D åŒ…æ‹¬äº†å¯¹ç§°çš„è§£ æ³¨æ„åˆ°å…­çš‡åé—®é¢˜çš„è§£çš„ä¸ªæ•°æ¯”äº”çš‡åé—®é¢˜çš„è§£çš„ä¸ªæ•°è¦å°‘ã€‚ç°åœ¨è¿˜æ²¡æœ‰å·²çŸ¥å…¬å¼å¯ä»¥å¯¹ n è®¡ç®— n çš‡åé—®é¢˜çš„è§£çš„ä¸ªæ•°ï¼Œä¹Ÿå°±æ˜¯è¯´è¿™ä¸ªé—®é¢˜ç°åœ¨è¿˜åªèƒ½ç”±ç¨‹åºæ¥è§£ç­”ã€‚ æ ¸å¿ƒçš„æ€è·¯æ˜¯ï¼šç»™æ£‹ç›˜å®šä¹‰åæ ‡ï¼Œæ¯”å¦‚å·¦ä¸Šæ˜¯ï¼ˆ0ï¼Œ0ï¼‰æ¨ªè½´ä¸º x ç«–è½´ ä¸º yã€‚å¦‚æœæŠ½è±¡æˆä¸ºä¸€ä¸ªäºŒç»´æ•°ç»„ï¼Œx å’Œ y å°±æ˜¯æ•°ç»„å…ƒç´ çš„ indexã€‚å½“ä¸€ä¸ªçš‡åè½å­ä¹‹åï¼Œé‚£ä¹ˆç›¸å¯¹åº”çš„æ‰€æœ‰ x å’Œ y ä»¥åŠå¯¹è§’çº¿å°±éƒ½ä¸èƒ½ä¸‹è¿™é‡Œè¢«ç§°ä¸ºæ§åˆ¶åŒºåŸŸã€‚ä¹Ÿå°±æ˜¯å½“ä¸€ä¸ªçš‡åï¼ˆåæ ‡ä¸º xï¼Œyï¼‰è½å­ä¹‹åé‚£ä¹ˆæ£‹ç›˜çš„ colomns[x] å’Œ rows[y] ä»¥åŠå¯¹è§’çº¿å°±éƒ½è¢«æ§åˆ¶ã€‚ è¿™é‡Œæœ€å…ˆæƒ³åˆ°çš„æ˜¯æ¯ä¸ªä½ç½®éå†ï¼Œæ€»å…±è®°å½• n^2 ä¸ªä½ç½®ã€‚ä¸è¿‡è¿™ä¸€æ­¥å¯ä»¥ç²¾ç®€ä¸ºè®°å½•å†è¡Œï¼Œå› ä¸ºæˆ‘ä»¬çŸ¥é“ä¸€è¡Œå¦‚æœè½å­äº†å°±ä¸åœ¨è€ƒè™‘è¿™ä¸€è¡Œã€‚ä¹Ÿå°±æ˜¯è¯´å¦‚æœä» 0 å¼€å§‹å¾€æ£‹ç›˜çš„ä¸‹æ–¹éå†ï¼Œé‚£ä¹ˆè½å­ä¹‹ååªéœ€è¦è®°å½•è¿™ä¸€åˆ—æ˜¯å¦ä¸‹è¿‡å³å¯ã€‚ç”¨ colomns[x] æ¥è¡¨ç¤ºè¿™ä¸€åˆ—ã€‚ å¯¹äºå¯¹è§’çº¿ï¼Œä¸€ä¸ª 8 * 8 çš„æ£‹ç›˜ä¸­å¯¹è§’çº¿çš„ä¸ªæ•°æ˜¯ 15 ä¸ª / + 15 ä¸ª \\ã€‚è¿™ä¸ªå¾ˆå®¹æ˜“æ¨ç®—ï¼Œå¯¹äºä¸€ä¸ªæ ‡å‡†çš„ n * n æ£‹ç›˜ï¼Œå•ä¸ªæ–¹å‘çš„å¯¹è§’çº¿ä¸ªæ•° diag = 2 * n - 1 ä¹Ÿå³æ˜¯è¯´å¯¹è§’çº¿æ˜¯å¦è¢«æ§åˆ¶å¯ä»¥ç”¨å¯¹è§’çº¿çš„æ•°ç»„è¡¨ç¤ºã€‚å‡è®¾ / æ˜¯ diag1ï¼Œ \\ æ˜¯ diag2ã€‚ é‚£ä¹ˆåˆæœ‰ä¸€ä¸ªé—®é¢˜äº†ï¼Œä¸€ä¸ªè½å­æ‰€æ§åˆ¶çš„å¯¹è§’çº¿èƒ½å¦è¢«æ‰¾åˆ°å‘¢ã€‚æ¯”å¦‚è¯´è½åœ¨ (x, y) å¤„åœ¨ï¼Œé‚£ä¹ˆæ˜¯å¦èƒ½æ‰¾åˆ°å¯¹åº”çš„ diag1 å’Œ diag2 å‘¢ï¼Ÿç­”æ¡ˆæ˜¯å¯ä»¥çš„ã€‚ è‡³äºå¦‚ä½•æ¨ç®—çš„ï¼Œç”»ä¸€ä¸‹å›¾å°±çŸ¥é“å•¦ã€‚ å¯¹äº /ï¼Œå¯¹åº”çš„æ˜¯ diag1[x + y] å¯¹äº \\ï¼Œå¯¹åº”çš„æ˜¯ diag1[x - y + n - 1] è‡³æ­¤ï¼Œè½å­ä¹‹åæ§åˆ¶åŒºåŸŸå¦‚ä½•è¡¨ç¤ºå°±æ²¡æœ‰é—®é¢˜äº†ã€‚ æ¥ä¸‹æ¥å°±æ˜¯æ¢ç©¶æ€ä¹ˆæ‰¾åˆ°æ‰€æœ‰çš„è½å­ã€‚æœ¬è´¨ä¸Šè¿™æ˜¯ä¸€ä¸ªå…¸å‹çš„å›æº¯æ³•ã€‚ ä½œä¸ºå›æº¯ç®—æ³•çš„ä¸€ç§ï¼Œè‡ªç„¶æ˜¯ç”¨æ ‘å½¢ç©ºé—´æ¥è¡¨ç¤ºé€’å½’ã€‚ä¾‹å¦‚å½“ n = 4 çš„æ—¶å€™ï¼Œæœç´¢ç©ºé—´å¯ä»¥ç”¨ä¸€é¢— 4 å‰æ ‘æ¥è¡¨ç¤º é¦–å…ˆä» 0 å¼€å§‹éå†æ£‹ç›˜çš„ x è½´ã€‚å¹¶åœ¨æ­¤åŸºç¡€ä¸Šï¼Œé€’å½’åœ°å¯»æ‰¾åé¢çš„ä½ç½®ã€‚é€’å½’æœŸé—´å¯ä»¥è½å­ï¼Œé‚£ä¹ˆå°±æ”¾å…¥æ£‹ç›˜ï¼ŒåŒæ—¶æ›´æ–°æ§åˆ¶çš„åŒºåŸŸï¼Œç»§ç»­é€’å½’ã€‚å½“å‘ç°é€’å½’åˆ°æ ‘çš„åº•å±‚ï¼Œæˆ–è€…è¯´åé¢çš„èŠ‚ç‚¹å…¨éƒ½ä¸èƒ½éå†çš„æ—¶å€™å›æº¯ã€‚åä¹‹ï¼Œå°±ç»§ç»­éå†ã€‚ è¿™ç§çš„å…¸å‹çš„å¤šæ’æ ‘æœç´¢å¾ˆå¤§ç¨‹åº¦åŸºæœ¬çš„é€’å½’ç»“æ„æ˜¯ 1234# ä¼ªä»£ç def recur() for i in range recur() æ ‘çš„èŠ‚ç‚¹ä¸ªæ•°é€šå¸¸æ˜¯ range çš„å¤§å°ï¼Œ recur çš„æ·±åº¦æ˜¯æ ‘çš„æ·±åº¦ã€‚ é‚£ä¹ˆè‡³æ­¤å¯ä»¥å¼€å§‹è®¾è®¡è¿™ä¸ª leetcode ä¸Šéš¾åº¦ä¸º hard çš„é¢˜ç›® ã€‚ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849public class Solution &#123; private List&lt;String&gt; board; private boolean[] cols; private boolean[] diag1; private boolean[] diag2; private List&lt;List&lt;String&gt;&gt; solution; public List&lt;List&lt;String&gt;&gt; solveNQueens(int n) &#123; solution = new ArrayList&lt;&gt;(); board = new ArrayList&lt;&gt;(); char[] charArray = new char[n]; Arrays.fill(charArray, '.'); for (int i = 0; i &lt; n; i++) &#123; board.add(new String(charArray)); &#125; cols = new boolean[n]; diag1 = new boolean[2 * n - 1]; diag2 = new boolean[2 * n - 1]; nQueens(n, 0); return solution; &#125; private void nQueens(int n, int y) &#123; if (y == n) &#123; solution.add(new ArrayList&lt;&gt;(board)); return; &#125; for (int x = 0; x &lt; n; x++) &#123; if (!available(x, y, n)) continue; updateBoard(x, y, n, true); nQueens(n, y + 1); updateBoard(x, y, n, false); &#125; &#125; private boolean available(int x, int y, int n) &#123; return !cols[x] &amp;&amp; !diag1[x + y] &amp;&amp; !diag2[x - y + n - 1]; &#125; private void updateBoard(int x, int y, int n, boolean put) &#123; cols[x] = put; diag1[x + y] = put; diag2[x - y + n - 1] = put; char[] columns = board.get(y).toCharArray(); columns[x] = put ? 'Q' : '.'; board.set(y, new String(columns)); &#125;&#125; é™„: å®Œæ•´çš„ä»£ç &amp;æµ‹è¯•ç”¨ä¾‹","categories":[],"tags":[]},{"title":"æ— é‡å¤æ•°ç»„çš„å…¨æ’åˆ—","slug":"permutation-and-combination","date":"2019-03-07T08:49:40.000Z","updated":"2020-03-28T13:02:10.004Z","comments":true,"path":"2019/03/07/permutation-and-combination/","link":"","permalink":"https://razertory.me/2019/03/07/permutation-and-combination/","excerpt":"","text":"æ’åˆ—ç»„åˆæ’åˆ— permutationï¼ˆarrangementï¼‰ å’Œç»„åˆ combination çº¯ç²¹çš„æ•°å­¦ä¸Šçš„æ’åˆ—ç»„åˆçš„å®šä¹‰æ˜¯ æ’åˆ— å°±æ˜¯æŒ‡ä»ç»™å®š n ä¸ªæ•°çš„å…ƒç´ ä¸­å–å‡ºæŒ‡å®š r ä¸ªæ•°çš„å…ƒç´ ï¼Œè¿›è¡Œæ’åº ç»„åˆ ä»ç»™å®š n ä¸ªæ•°çš„å…ƒç´ ä¸­ä»…ä»…å–å‡ºæŒ‡å®š r ä¸ªæ•°çš„å…ƒç´ ï¼Œä¸è€ƒè™‘æ’åº æ’åˆ—ä¸ç»„åˆå”¯ä¸€çš„åŒºåˆ«åœ¨äºæ“ä½œå…ƒç´ çš„é¡ºåºæ˜¯å¦å½±å“äº†ç»Ÿè®¡çš„ç»“æœã€‚ æ•°å­¦ä¸­å¸¸ç”¨åˆ°çš„æ’åˆ—ç»„åˆçš„å…¬å¼ä¸»è¦ç”¨æ¥ç»Ÿè®¡ç›®æ ‡ä¸ªæ•°ã€‚ å›æº¯æ³•åœ¨ä¸€äº›å¸¸è§çš„ç®—æ³•é—®é¢˜ä¸­ï¼Œæœ‰æ—¶å€™æ˜¯éœ€è¦è¾“å‡ºæœŸæœ›çš„å­é›†åˆã€‚è¿™ä¸ªæ—¶å€™å°±éœ€è¦é‡‡ç”¨å›æº¯çš„æ–¹å¼æ¥è§£å†³ã€‚ ç»´åŸºç™¾ç§‘çš„å®šä¹‰æ˜¯ å›æº¯æ³•ï¼ˆè‹±è¯­ï¼šbacktrackingï¼‰æ˜¯æš´åŠ›æœç´¢æ³•ä¸­çš„ä¸€ç§ã€‚å¯¹äºæŸäº›è®¡ç®—é—®é¢˜è€Œè¨€ï¼Œå›æº¯æ³•æ˜¯ä¸€ç§å¯ä»¥æ‰¾å‡ºæ‰€æœ‰ï¼ˆæˆ–ä¸€éƒ¨åˆ†ï¼‰è§£çš„ä¸€èˆ¬æ€§ç®—æ³•ï¼Œå°¤å…¶é€‚ç”¨äºçº¦æŸæ»¡è¶³é—®é¢˜ï¼ˆåœ¨è§£å†³çº¦æŸæ»¡è¶³é—®é¢˜æ—¶ï¼Œæˆ‘ä»¬é€æ­¥æ„é€ æ›´å¤šçš„å€™é€‰è§£ï¼Œå¹¶ä¸”åœ¨ç¡®å®šæŸä¸€éƒ¨åˆ†å€™é€‰è§£ä¸å¯èƒ½è¡¥å…¨æˆæ­£ç¡®è§£ä¹‹åæ”¾å¼ƒç»§ç»­æœç´¢è¿™ä¸ªéƒ¨åˆ†å€™é€‰è§£æœ¬èº«åŠå…¶å¯ä»¥æ‹“å±•å‡ºçš„å­å€™é€‰è§£ï¼Œè½¬è€Œæµ‹è¯•å…¶ä»–çš„éƒ¨åˆ†å€™é€‰è§£ï¼‰ ç»™å®šä¸€ä¸ªæ²¡æœ‰é‡å¤æ•°å­—çš„åºåˆ—ï¼Œè¿”å›å…¶æ‰€æœ‰å¯èƒ½çš„å…¨æ’åˆ—ï¼ˆåŸé¢˜ï¼‰ã€‚å¦‚ 123456789101112Input: nums = [1,2,3]Output:[ [3], [1], [2], [1,2,3], [1,3], [2,3], [1,2], []] åœ¨æœ‰ 3 ä¸ªå…ƒç´ çš„åºåˆ—ä¸­ï¼Œå­åºåˆ—çš„ä¸ªæ•°å¯ä»¥åˆ†åˆ«ä¸º 0ï¼Œ1ï¼Œ2ï¼Œ3 å››ç§ã€‚æœ¬è´¨ä¸Šå›æº¯æ³•æ˜¯ DFSï¼Œè¿™ä¸ªé—®é¢˜ä¹Ÿå°±æ¼”å˜æˆäº†ä¸€ä¸ªéå†æ ‘çš„æ€è·¯ã€‚ 12345678 void backtrack(List&lt;List&lt;Integer&gt;&gt; list , List&lt;Integer &gt; tempList, int [] nums, int start)&#123; list.add(new ArrayList&lt;&gt;(tempList)); for(int i = start; i &lt; nums.length; i++)&#123; tempList.add(nums[i]); backtrack(list, tempList, nums, i + 1); tempList.remove(tempList.size() - 1); // æ³¨æ„å›æº¯çš„æ—¶å€™éœ€è¦åˆ æ‰æœ€åä¸€ä¸ªï¼Œä¿è¯ç”¨ä¸‹ä¸€ä¸ªå…ƒç´ å–æ›¿æ¢å¹¶ç»§ç»­é€’å½’ &#125;&#125; å®Œæ•´ä»£ç 123456789101112131415public List&lt;List&lt;Integer&gt;&gt; subsets(int[] nums) &#123; List&lt;List&lt;Integer&gt;&gt; list = new ArrayList(); Arrays.sort(nums); backTrack(list, new ArrayList(), nums, 0); return list; &#125;private void backTrack(List&lt;List&lt;Integer&gt;&gt; list, List&lt;Integer&gt; tempList, int[] nums, int start) &#123; list.add(new ArrayList(tempList)); for (int i = start; i &lt; nums.length; i++) &#123; tempList.add(nums[i]); backTrack(list, tempList, nums, i + 1); tempList.remove(tempList.size() - 1); &#125;&#125;","categories":[],"tags":[]},{"title":"ã€Œè¯»ä¹¦ã€ä¸ƒå‘¨ä¸ƒè¯­è¨€","slug":"seven-weeks-seven-languages","date":"2019-03-01T12:57:15.000Z","updated":"2020-03-28T13:02:10.004Z","comments":true,"path":"2019/03/01/seven-weeks-seven-languages/","link":"","permalink":"https://razertory.me/2019/03/01/seven-weeks-seven-languages/","excerpt":"","text":"ç¨‹åºå‘˜å¯¹äºç¼–ç¨‹è¯­è¨€çš„äº‰è®ºï¼Œæ˜¯ä¸€åœºæ°¸è¿œéƒ½ä¸ä¼šåœæ­¢çš„æˆ˜äº‰ã€‚ä½†ç¤¾ä¼šåœ¨è¿›æ­¥ï¼Œç§‘æŠ€åœ¨è¿›æ­¥ï¼Œé‚£ä¹ˆå°±è®©å¤§å®¶ç»§ç»­åµä¸‹å»å§ :) è¿™æ˜¯ä¸€æœ¬è®²è¿°ä¸ƒç§ä¸åŒç±»å‹ç¼–ç¨‹è¯­è¨€ï¼šRubyï¼ŒIoï¼ŒPrologï¼ŒScalaï¼ŒErlang Clorjure å’Œ Haskell ä»£è¡¨çš„ç°ä»£ç¼–ç¨‹è¯­è¨€çš„é‡è¦ç‰¹æ€§å’Œç¼–ç¨‹èŒƒå¼çš„ä¹¦ã€‚è¿™é‡Œé¢çš„è¯­è¨€å¤šå¤šå°‘å°‘è¢«å¤§å®¶å¬è¿‡æˆ–è€…ç”¨è¿‡ã€‚ä»–ä»¬åˆ†åˆ«ä½œä¸ºæŸä¸ªé¢†åŸŸçš„ä»£è¡¨è€Œæ±‡é›†åˆ°ä¸€æœ¬ä¹¦é‡Œã€‚ Rubyè¿™é—¨è¯­è¨€æ˜¯æˆ‘ç›®å‰å·¥ä½œä¸­çš„ä¸»è¯­è¨€ï¼ŒåŒ…æ‹¬å¯¹åº”çš„ç”Ÿæ€ã€‚è¯­æ³•ç®€å•ä½†åˆçµæ´»ï¼Œè¶…å¼ºçš„ DSL èƒ½åŠ›å’Œä¸°å¯Œçš„ç¤¾åŒºèµ„æºç»™æˆ‘çš„å·¥ä½œæä¾›äº†å·¨å¤§çš„ä¾¿æ·å’Œæ•ˆç‡ã€‚ Ruby æˆ–è€… Ruby on Rails æ˜¯ä¸€ç§åœ¨å¼€å‘è¿‡ç¨‹å½“ä¸­ï¼Œç¨‹åºå‘˜èƒ½å¤ŸæŒ‰ç…§è‡ªç„¶è¯­è¨€çš„æ€ç»´å¹¶ä¸”å¾ˆå®¹æ˜“å†™å‡ºç¬¦åˆé¢„æœŸé€»è¾‘çš„ç¨‹åºã€‚è¿™è®©é¡¹ç›®çš„è¿­ä»£é€Ÿåº¦ä¸ä¼šæ‰“æŠ˜æ‰£ã€‚ å½“æ•°æ®é‡å˜å¤§ä¹‹åï¼Œå®ƒçš„å†…å­˜ç®¡ç†å’Œæ‰§è¡Œæ•ˆç‡çš„åŠ£åŠ¿å°±æ…¢æ…¢å±•éœ²å‡ºæ¥ã€‚éšä¹‹è€Œæ¥çš„è¿˜æœ‰â€ è¿‡äºçµæ´» â€œçš„è¯­æ³•ç‰¹æ€§å¯¼è‡´äº†ä¸€æ—¦ Code Review æ²¡æœ‰åšåˆ°ä½å¹¶ä¸”ä»£ç é£æ ¼ä¸å›¢é˜Ÿæˆå‘˜å·®å¼‚å·¨å¤§çš„æƒ…å†µå‡ºç°æ—¶ï¼Œç»´æŠ¤é¡¹ç›®é˜…è¯»ä»£ç å°±å˜å¾—å¾ˆç³Ÿç³•ã€‚æˆ‘ä»¬æ›¾ç»å¸¸å‡ºç°æœåŠ¡å™¨å†…å­˜ä¸è¶³çš„æŠ¥è­¦æ¶ˆæ¯ï¼Œä¹Ÿå¶å°”å› ä¸ºéš¾ä»¥ç»´æŠ¤éƒ¨åˆ†æ—§æœ‰çš„ç³Ÿç³•ä»£ç è€Œä¸å¾—ä¸è¿›è¡Œé‡æ„ã€‚å¯ä»¥è¯´ â€”â€” åŠ¨æ€è¯­è¨€ä¸€æ—¶çˆ½ï¼Œé‡æ„ç°åœºç«è‘¬åœºï¼ˆé€ƒ Ioè¿™ä¸€é—¨åŸå‹è¯­è¨€ã€‚ä»€ä¹ˆæ˜¯åŸå‹è¯­è¨€ï¼Ÿ åœ¨ä¼ ç»Ÿçš„é¢å‘å¯¹è±¡è¯­è¨€ä¸­ï¼Œæ¯”å¦‚ Javaã€Rubyã€C++ã€Pythonï¼Œæˆ‘ä»¬é€šå¸¸éœ€è¦å®šä¹‰ä¸€ä¸ªç§°ä¸º class çš„ä¸œè¥¿ï¼Œç„¶åå†åŸºäºè¿™ä¸ª class åˆ›å»ºå¯¹è±¡ã€‚è€Œ Io è¿™é—¨è¯­è¨€æ˜¯åªæ“ä½œå¯¹è±¡çš„ï¼Œç®€å•è¯´å°±æ˜¯ Io æœ‰ä¸€ä¸ªå«åšæ ¹å¯¹è±¡ Object çš„ä¸œè¥¿ï¼Œæˆ‘ä»¬éœ€è¦å®šä¹‰ä¸€ä¸ªå¯¹è±¡ç›´æ¥ Car := Object clone å³å¯ã€‚åœ¨ Io è¿™æœ¬è¯­è¨€çš„ä¸Šä¸‹æ–‡ä¸­ï¼Œä¸€åˆ‡éƒ½æ˜¯ç”±å¯¹è±¡å’Œæ¶ˆæ¯ç»„æˆã€‚è¿™ä¸€ç‚¹å¾ˆåƒ Ruby ä¸­çš„å…ƒç¼–ç¨‹ï¼Œç”šè‡³æˆ‘ä¸ªäººä¼šè®¤ä¸ºå…ƒç¼–ç¨‹å­¦ä¹ äº† Ioã€‚åŒæ ·ï¼Œè¿™é—¨åŸºäºæ¶ˆæ¯çš„ç¼–ç¨‹è¯­è¨€åœ¨å®ç° actor ä½œä¸ºå¹¶å‘æ¨¡å‹å°±å˜å¾—è½»è€Œæ˜“ä¸¾ã€‚æˆ‘ä»¬ä¼šåœ¨ Scalaã€Erlang å’Œ Haskell ä»¥åŠä»Šåä¼—å¤šæµè¡Œç¼–ç¨‹è¯­è¨€ä¸­å†è§åˆ° actorã€‚Io çš„è¯­æ³•å¾ˆç®€å•ï¼Œå‡ ä¹æ²¡æœ‰å¯ä»¥è¢«å«åšè¯­æ³•ç³–çš„ä¸œè¥¿ï¼Œç”šè‡³å…³é”®å­—ä¹Ÿå°‘çš„å¯æ€œã€‚è¿™é—¨è¯­è¨€è®©æˆ‘æƒ³åˆ°äº†å½“ä»Šå›½å†…ç®—æ˜¯ç«çƒ­çš„ Go è¯­è¨€ï¼Œç®€å•é«˜æ•ˆå´ç»™äººå¼ºå¤§çš„å°è±¡ã€‚ Prologè¿™æ˜¯ä¸€é—¨é€»è¾‘ç¼–ç¨‹è¯­è¨€ã€‚å’Œ SQL ä¸€æ ·ï¼ŒProlog åŸº äºæ•°æ®åº“ï¼Œä½†æ˜¯å…¶æ•°æ®ç”±é€»è¾‘è§„åˆ™å’Œå…³ç³»ç»„æˆ; å’Œ SQL ä¸€æ ·ï¼ŒProlog åŒ…å«ä¸¤ä¸ªéƒ¨åˆ†: ä¸€éƒ¨åˆ†ç”¨äº æè¿°æ•°æ®ï¼Œè€Œå¦ä¸€éƒ¨åˆ†åˆ™ç”¨äºæŸ¥è¯¢æ•°æ®ã€‚åœ¨ Prolog ä¸­ï¼Œæ•°æ®ä»¥é€»è¾‘è§„åˆ™çš„å½¢å¼å­˜åœ¨ã€‚è¿™ä¸ªæ˜¯å¾ˆæœ‰æ„æ€çš„ä¸€ä»¶äº‹æƒ…ï¼Œå¦‚æœè¯»è€…çœ‹è¿‡ ä¼Šæ›¼åŠªå°” Â· åº·å¾· æ‰€è‘—çš„ã€Šçº¯ç²¹ç†æ€§æ‰¹åˆ¤ã€‹ä¼šæ›´åŠ ä½“ä¼šåˆ°è¿™é—¨è¯­è¨€çš„ç¼–ç¨‹å“²å­¦ã€‚æ¯”å¦‚è¯´ï¼Œåœ¨ Prolog ä¸­ï¼Œæ•°æ®çš„æ ‡å‡†å­˜æ”¾æ ¼å¼å¦‚ä¸‹ï¼š ã€Œäº‹å® ã€å…³äºçœŸå®ä¸–ç•Œçš„åŸºæœ¬æ–­è¨€ï¼ˆå¯¹æ²¡é”™ï¼Œå°±æ˜¯ä½ æµ‹è¯•ä»£ç ä¸­çš„ assertï¼‰â€”â€” Babe æ˜¯ä¸€å¤´çŒªï¼ŒçŒªå–œæ¬¢ç©æ³¥å·´ ã€Œè§„åˆ™ã€çœŸå®ä¸–ç•Œçš„æ¨è®ºï¼ˆif thenï¼‰â€”â€” å¦‚æœä½ æ˜¯ä¸€å¤´çŒªï¼Œé‚£ä¹ˆä½ å–œæ¬¢ç©æ³¥å·´ ã€ŒæŸ¥è¯¢ã€å‘çœŸå®ä¸–ç•Œå¯»æ±‚ä¸€ä¸ªé—®é¢˜ï¼ˆå¸ƒå°”è¡¨è¾¾å¼ï¼‰â€”â€” Babe å–œæ¬¢ç©æ³¥å·´å—ï¼Ÿ æŒ‰ç…§å¤§å¤šæ•°è¯­è¨€é€šå¸¸çš„ Coding Patternï¼Œåº”è¯¥æ˜¯è¿™æ · æ”¶é›†å’Œæ•´ç†é€»è¾‘ ç”¨ç¨‹åºè¡¨è¾¾é€»è¾‘ æ‰¾å‡ºæ‰€æœ‰å¯èƒ½çš„è§£å†³æ–¹æ³• é€šè¿‡ç¨‹åºéªŒè¯è¿™äº›å¯èƒ½çš„è§£å†³æ–¹æ³• è¿™æ˜¯æ ‡å‡†çš„åšæ³•ï¼Œç»™å¤§å®¶æ¸…æ™°çš„è„‰ç»œï¼Œå¹¶ä¸”ä¹Ÿå®¹æ˜“ç»´æŠ¤ã€‚ ç„¶è€Œï¼ŒProlog ä¼šç»™äººä¸€ç§ç¥ä¹å…¶æŠ€çš„æ„Ÿè§‰ã€‚å¯¹çš„ï¼Œå¤§å¤šæ•°è¯­è¨€å†™ä»£ç éƒ½æ˜¯ how éœ€è¦æˆ‘ä»¬è‡ªä¸»é˜è¿°é€»è¾‘ï¼Œç„¶è€Œ Prolog æ˜¯ä¸€ç§ whatï¼Œå½“æˆ‘ä»¬äººä¸ºå®šä¹‰å¥½é—®é¢˜ä¹‹åï¼Œè®©è®¡ç®—æœºæ¥è§£å†³ã€‚ä¹¦ä¸­çš„ã€Œåœ°å›¾ç€è‰²é—®é¢˜ã€ã€ã€Œæ•°ç‹¬é—®é¢˜ã€æœ‰è¯¦ç»†è§£é‡Šã€‚ æ›¾å‡ ä½•æ—¶ï¼ŒåŸºäºè§„åˆ™çš„ AI å’Œ NLP é¢†åŸŸè®©è¿™é—¨è¯­è¨€å¤§æ”¾å¼‚å½©ã€‚éšç€åæ¥æ·±åº¦å­¦ä¹ ï¼ŒåŸºäºç»Ÿè®¡ç®—æ³•çš„å…´èµ·ï¼Œä»¥å‰è¿™ç§ï¼Œå‘µå‘µã€‚ã€‚ Scalaæ˜¯ä¸€æŠŠåè´µçš„ç‘å£«å†›åˆ€ï¼Œå› ä¸ºå®ƒä»€ä¹ˆéƒ½æœ‰ã€‚è¿è¡Œåœ¨å®‡å®™æœ€å¼ºè™šæ‹Ÿæœº JVM ä¸Šï¼Œèåˆäº†é¢å‘å¯¹è±¡å’Œå‡½æ•°å¼ç¼–ç¨‹ã€‚è¯­æ³•ç»™æˆ‘çš„æ„Ÿè§‰æ˜¯å¸æ”¶äº† Java/Ruby/Haskellã€‚æœ€è¿‘åˆšå¥½åœ¨å†™ Scala è¿˜æœ‰å­¦ Akkaï¼ŒåæœŸä¼šä¸“é—¨è¡¥å……ã€‚ Erlangå›åˆ°ä¸€ä¸ªåŸå§‹çš„åŸåˆ™ï¼Œåœ¨æŠ€æœ¯é€‰å‹ä¸Šæˆ‘å§‹ç»ˆè®¤ä¸ºå·¥ç¨‹å¸ˆéœ€è¦è€ƒè™‘æ‰€ç”¨æŠ€æœ¯çš„ä¸‰ä¸ªæŒ‡æ ‡ï¼šå¼€å‘æ•ˆç‡ï¼Œæ‰§è¡Œæ•ˆç‡å’Œå¯ç»´æŠ¤æ€§ã€‚åœ¨ Erlang ä¸­ï¼Œä»¥ä¸‹çš„ç‰¹è´¨éƒ½ç»™äºˆäº† Erlang ä¸é”™çš„ä¸Šè¿°æŒ‡æ ‡ pattern matching æ¯”å¦‚è¯´æœ‰ä¸¤ä¸ª kv æ•°æ®ç»“æ„ï¼Œå¦‚ä½•æœ€æ–¹ä¾¿æ¯”è¾ƒç»“æ„æ˜¯å¦ä¸€è‡´ã€‚å¾ˆå¤§ç¨‹åº¦ä¸Šé¿å…å¤§é‡çš„ if-else å‡½æ•° é€šè¿‡ export æ–¹å¼è®©å‡½æ•°ç»™å¤–éƒ¨æ¨¡å—è°ƒç”¨ï¼ŒåŠ ä¸Š pattern matching å¯ä»¥éå¸¸æ–¹ä¾¿å†™æµ‹è¯•ä»£ç  æ¶ˆæ¯ä¼ é€’ ä¸åŒçš„ erlang è¿›ç¨‹å¯ä»¥é€šè¿‡æ¶ˆæ¯ä¼ é€’çš„æ–¹å¼å…±äº«å˜é‡ çƒ­æ›´æ–° ä¿®æ”¹äº†ä»£ç å¯ä»¥ä¸é‡å¯æœåŠ¡å™¨ç”Ÿæ•ˆ parse_transform é€šè¿‡å‘é€å’Œæ¥å— AST æ¥ä½¿ç”¨æ¨¡å— spawn ä¸€ä¸ª erlang è¿›ç¨‹åªæ˜¯åœ¨ erlang è™šæ‹Ÿæœºä¸­çš„è¿›ç¨‹å¹¶ä¸”åªå ç”¨æå°‘çš„æ“ä½œç³»ç»Ÿèµ„æºï¼Œé«˜å¹¶å‘çš„æƒ…å†µä¸‹è¡¨ç°ä¼˜å¼‚ã€‚ å¦‚ä»Šåœ¨å¤©æœå—éƒ¨æ²¿æµ·æŸåŸå¸‚ï¼Œå¾ˆå¤šåŸºäº OTP æ¡†æ¶çš„æ¸¸æˆå…¬å¸ä¾ç„¶æ˜¯ Erlang çš„å¿ å®ç”¨æˆ·ã€‚ Clorjureå¦‚æœæœ‰çœ‹è¿‡ SICP é‚£æœ¬ä¹¦ï¼Œå°±ä¸€å®šçŸ¥é“ Lisp çš„å¨åŠ›ï¼Œå½“ç„¶æœ‰ä¸å°‘å¤§ V éƒ½å†™è¿‡èµèª‰å®ƒçš„æ–‡ç« æ¯”å¦‚ï¼šé˜®ä¸€å³°åšå®¢ä¸­çš„è¯‘æ–‡ã€Œä¸ºä»€ä¹ˆ Lisp è¯­è¨€å¦‚æ­¤å…ˆè¿›ï¼Ÿã€ http://www.ruanyifeng.com/blog/2010/10/why_lisp_is_superior.html è¿˜æœ‰é™ˆçš“çš„ã€ŒLisp çš„æ°¸æ’ä¹‹é“ã€https://coolshell.cn/articles/7526.html éƒ½éå¸¸è®¤å¯ Lisp çš„å¾ˆå¤šç†å¿µä»¥åŠè¿™é—¨è¯­è¨€å¸¦ç»™ç°ä»£ç¼–ç¨‹ç•Œçš„å½±å“ã€‚ æ‰€ä»¥ï¼Œå½“è¿™é—¨è¯­è¨€è·‘åˆ°äº† JVM ä¸Šä¹‹åï¼Œåˆä¼šäº§ç”Ÿä»€ä¹ˆæ ·çš„æ•ˆæœå‘¢ï¼Ÿ å·¥ç¨‹åŒ–çš„ç¯å¢ƒã€‚ç”±äº JVM å¹³å°çš„çš„æ¨åŠ›ï¼Œclorjure æœç€ä¸€ç§å·¥ä¸šåŒ–çš„é€šç”¨çš„æ–¹å‘å‘å±•å¹¶ä¸”ç®€åŒ–äº† Lisp ä¸­çš„æ‹¬å·å†™æ³•ã€‚åœ¨ Java ä¸­å¸¸å¸¸ä¼šæœ‰è®¾è®¡æ¥å£æ¥åšå·¥ç¨‹åŒ–çš„æŠ½è±¡ï¼Œclorjure ä¸­æœ‰ã€Œåè®®ã€çš„æ¦‚å¿µã€‚å¦‚æœéœ€è¦è°ƒç”¨ Java è‡ªå¸¦çš„æ–¹æ³•ï¼Œæ¯”å¦‚ Object.toString()ï¼Œå¯ä»¥ç›´æ¥è¿™æ · Object(toString [this] (str â€œ[â€œ (your object) â€œ]â€))å°±å¯ä»¥ç›´æ¥è°ƒç”¨äº†ã€‚è¿™ç›¸å½“äºæ‰©å±•äº† Javaï¼ˆé™„å¸¦äº† Lisp çš„å‡½æ•°å¼å’Œå®ï¼‰ï¼Œä¹Ÿå¯ä»¥è®¤ä¸ºæ‰©å±•äº† Lispï¼ˆç»“åˆäº†é¢å‘å¯¹è±¡ï¼‰ã€‚æ‰€ä»¥æˆ‘å†³å®šå­¦ Scalaï¼ŒğŸ˜‚ clorjure ä¸­è¿˜æœ‰åŸå­å’Œä»£ç†æ¥ä¿è¯å¹¶å‘å®‰å…¨ï¼ŒåŸå­å’Œå¤§å¤šæ•°è¯­è¨€çš„ atom ç±»ä¼¼ï¼Œä»£ç†æ˜¯è¯´å½“æŸä¸ªå¯¹è±¡è¢«ä»£ç†ä¹‹åï¼Œä½¿ç”¨è€…å¯ä»¥å¼‚æ­¥ä¿®æ”¹ä»£ç†å¯¹è±¡çš„å€¼ï¼Œæ›´æ–°å‘ç”Ÿåœ¨å¦å¤–çš„çº¿ç¨‹ï¼Œå¹¶ä¸”æ¯æ¬¡åªæœ‰ä¸€ä¸ªå‡½æ•°å¯ä»¥ä¿®æ”¹ä»£ç†çš„çŠ¶æ€ã€‚ Haskellæˆ‘è®¤ä¸º Haskell ä¸€å®šæ˜¯é«˜çº¯åº¦çš„å‡½æ•°å¼è¯­è¨€ã€‚ æ¨¡å¼åŒ¹é…æ‹’ç»å¤§é‡çš„ if-elseï¼Œå°¾é€’å½’ä¼˜åŒ–è®©é€’å½’æ›´é«˜æ•ˆï¼Œå…ƒç»„åˆ™è®©å‡½æ•°å†™å¾—æ›´åŠ ç®€æ´ä¸”å¯Œæœ‰è¡¨è¾¾åŠ› ğŸ•¶ï¸ã€‚ä¸€ä¸ªåˆ—è¡¨è¢«å®šä¹‰ä¸º head å’Œ tail ä¸¤ä¸ªéƒ¨åˆ†ï¼Œé‚£ä¹ˆåˆ—è¡¨çš„å®šä¹‰å°±æ˜¯ head å’Œ tail çš„æ¨¡å¼åŒ¹é…ï¼Œç‰¹åˆ«æ˜¯åˆ—è¡¨æ¨å¯¼ç¼–ç¨‹ï¼Œä¸¥è°¨è€Œä¸”èªæ˜ã€‚æƒ°æ€§æ±‚å€¼ï¼Œé«˜é˜¶å‡½æ•°ï¼Œmonadï¼ˆä¸€ä¸ªè‡ªå‡½å­èŒƒç•´ä¸Šçš„å¹ºåŠç¾¤ï¼‰ï¼ŒæŸ¯é‡ŒåŒ–â€¦ Haskell åœ¨ä½œè€…çš„è§‚ç‚¹é‡Œæ˜¯æœ¬ä¹¦ä¸­æœ€éš¾å­¦çš„è¯­è¨€ï¼Œä½†ä¹Ÿæ˜¯æœ€å¼•äººæ·±æ€å’Œå¯å‘çš„è¯­è¨€ã€‚åœ¨ç¬”è€…ä¸ Scala å‰è¾ˆçš„äº¤æµä¸­å¬åˆ°é‡Œè®¸å¤šå…³äº Haskell çš„èµèª‰ã€‚ å›åˆ°ä¸€ä¸ªåå“²å­¦æ„ä¹‰çš„é—®é¢˜ï¼šå¦‚æœç¼–ç¨‹æ˜¯åœ¨ç»™è¾“å…¥çš„é—®é¢˜æ‰¾åˆ°ä¸€ä¸ªè§£ï¼Œé‚£ä¹ˆï¼Œæ˜¯å¦å­˜åœ¨ä»»ä½•æƒ…å†µä¸‹åªè¦æˆ‘ä»¬è¾“å…¥å‡ºé—®é¢˜çš„å®šä¹‰ï¼Œå°±èƒ½è®©è®¡ç®—æœºè¿”å›è§£çš„åœºæ™¯ï¼Ÿ å¸Œæœ›ä½ ä¹Ÿå–œæ¬¢è¿™æœ¬ä¹¦ã€‚ğŸ˜Š","categories":[],"tags":[{"name":"è¯»ä¹¦","slug":"è¯»ä¹¦","permalink":"https://razertory.me/tags/è¯»ä¹¦/"}]},{"title":"ã€Œè¯»ä¹¦ã€æ•°æ®å¯†é›†å‹åº”ç”¨ç³»ç»Ÿè®¾è®¡","slug":"ddia","date":"2019-02-01T13:26:55.000Z","updated":"2020-03-28T13:02:10.003Z","comments":true,"path":"2019/02/01/ddia/","link":"","permalink":"https://razertory.me/2019/02/01/ddia/","excerpt":"","text":"è¿™æ˜¯ä¸€æœ¬è®²è¿°ç°ä»£äº’è”ç½‘åº”ç”¨ä¸­ï¼Œå¼€å‘è€…ä»¬å¦‚ä½•è¿›è¡Œæ­£ç¡®çš„å­˜å‚¨å’Œå¤„ç†æ•°æ®çš„ä¹¦ã€‚ å½“ä»Šçš„äº’è”ç½‘åº”ç”¨å¤§å¤šæ˜¯æ•°æ®å¯†é›†å‹çš„ã€‚ä¸ä¹‹ç›¸å¯¹çš„æ˜¯ CPU å¯†é›†å‹ã€‚ ä»€ä¹ˆæ˜¯æ•°æ®å¯†é›†å‹ï¼Ÿ å½“æ•°æ®çš„æ•°é‡ï¼Œå¤æ‚åº¦å’Œæ•°æ®çš„æ›´æ–°é€Ÿåº¦å®¹æ˜“æˆä¸ºä¸€ä¸ªäº§å“åœ¨ç”¨æˆ·å¢é•¿ï¼ŒåŠŸèƒ½è¿­ä»£ï¼Œç”¨æˆ·ä½“éªŒåº¦æå‡çš„ç“¶é¢ˆçš„æ—¶å€™ï¼Œæˆ‘ä»¬å°±è®¤ä¸ºè¿™ç§åº”ç”¨æ˜¯æ•°æ®å¯†é›†å‹åº”ç”¨ã€‚ä¸Šè¿°çš„é—®é¢˜å¾€å¾€ä¼šç»™ç°åœ¨çš„å·¥ç¨‹å¸ˆå¸¦æ¥å„ç§æŒ‘æˆ˜ï¼Œæ¯”å¦‚ï¼šæ•°æ®åº“ CPU æŠ¥è­¦ï¼Œåº”ç”¨æœåŠ¡å™¨å†…å­˜æŠ¥è­¦ï¼Œå¼€å‘è¿­ä»£ç¼“æ…¢ï¼ŒAPI æ¥å£å“åº”è¿‡é•¿ç­‰ç­‰ã€‚ ä¸€ä¸ªäº’è”ç½‘åº”ç”¨çš„ç³»ç»Ÿï¼Œç»å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œéƒ½éœ€è¦æˆ‘ä»¬æ»¡è¶³ç¨³å®šæ€§ï¼Œå¯æ‰©å±•æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚ä¾‹å¦‚ï¼šå½“éƒ¨åˆ†ç¡¬ä»¶æ•…éšœæˆ–è€…æœ‰ä¸€äº›äººä¸º bug çš„æ—¶å€™ï¼Œç³»ç»Ÿå„é¡¹æŒ‡æ ‡èƒ½ä¿æŒåœ¨é¢„æœŸä¹‹ä¸Šï¼Œç”¨æˆ·ï¼æ•°æ®é‡çš„å¢é•¿çš„æ—¶å€™ï¼Œå·¥ç¨‹å¸ˆçŸ­æ—¶é—´å†…å°±èƒ½è‰¯å¥½åº”å¯¹ï¼Œæ–°äººçš„åˆ°æ¥çš„æ—¶å€™èƒ½å¤Ÿå¿«é€Ÿç†è§£ç³»ç»Ÿå¹¶åŠ å…¥åˆ°å¼€å‘ã€‚ ä¸ºäº†è®©ç³»ç»Ÿæœç€ä¸€ä¸ªæ­£ç¡®çš„æ–¹å‘æ¼”è¿›ï¼Œè¿™æœ¬ä¹¦ ã€ŠDesign Data Intensive Applicationsã€‹ ç¬¬ä¸€ç« è®²è¿°äº†æ•°æ®çš„æ¨¡å‹é€‰ç”¨ï¼Œå­˜å‚¨ä¸æ£€ç´¢çš„ä»¥åŠåºåˆ—åŒ–ï¼ååºåˆ—åŒ–ã€‚æˆ‘è§‰å¾—ç¬¬ä¸€ç« ç»™äºˆè¯»è€…çš„ï¼Œåˆšå¥½æ˜¯å‘Šè¯‰ä¸€ä¸ªé¡¹ç›®å¯åŠ¨çš„æ—¶å€™ï¼ŒçŸ¥é“å¦‚ä½•åšæ•°æ®æ¨¡å‹çš„é€‰å‹ï¼ŒåŒ…æ‹¬æ•°æ®åº“ï¼Œç¼“å­˜ï¼ŒæŸ¥è¯¢æ–¹å¼çš„é€‰æ‹©ç­‰ï¼Œé¿å…ç»™ä¸­åæœŸç•™ä¸‹è¿‡å¤šçš„å‘ã€‚ç¬¬äºŒç« éå¸¸ç›´ç™½åœ°è¯´æ˜äº†åˆ†å¸ƒå¼å­˜å‚¨çš„åº”ç”¨æ–¹å¼å’Œåœºæ™¯ï¼Œä¸»è¦è€ƒè™‘çš„æ˜¯å®¹é”™ï¼Œå®¹ç¾éš¾ï¼Œåˆ†å¸ƒå¼äº‹åŠ¡å’Œåˆ†å¸ƒå¼ä¸€è‡´æ€§ç­‰ã€‚è¿™å‡ ç‚¹ä¸ªäººéå¸¸æ„Ÿå…´è¶£ã€‚ç¬¬ä¸‰ç« ä¸»è¦è®²å¤§æ•°æ®çš„å¤„ç†ï¼Œæ¯”å¦‚ MapReduceï¼Œæ¶ˆæ¯é˜Ÿåˆ—ä»¥åŠä½œè€…å¯¹æœªæ¥ç³»ç»Ÿæ¶æ„çš„æ„æƒ³ï¼ŒåŒ…æ‹¬ï¼šLambda æ¶æ„ä¸å‡½æ•°å¼ç¼–ç¨‹å°†ä¼šå¤§æ”¾å¼‚å½©ï¼Œunix å“²å­¦å°†ä¸æ•°æ®åº“å“²å­¦ç›¸åº­æŠ—ç¤¼ï¼Œåˆ†å¸ƒå¼å­˜å‚¨ä¼šå˜å¾—æ™®éã€‚ ä¸€å—ç¡¬ç›˜çš„å¹³å‡æ— æ•…éšœæ—¶é—´æ˜¯ 10 åˆ° 50 å¹´ï¼Œå› æ­¤ä»æ•°å­¦æœŸæœ›ä¸Šè®²ï¼Œåœ¨æ‹¥æœ‰ 10_000 ä¸ªç¡¬ç›˜çš„å­˜å‚¨é›†ç¾¤ä¸Šï¼Œå¹³å‡æ¯å¤©ä¼šæœ‰ 1 ä¸ªç¡¬ç›˜å‘ç”Ÿæ•…éšœã€‚æœ‰ç»éªŒçš„è¿ç»´ä¼šé€‰ç”¨æ‰¹æ¬¡å·ä¸åŒçš„ç¡¬ç›˜æ¥é¿å…åŒä¸€æ—¶é—´å¤§èŒƒå›´çš„ç‰©ç†æ•…éšœã€‚å¯¹äºå·¥ç¨‹å¸ˆè€Œè¨€ï¼Œå‡ºç° bug çš„æ¦‚ç‡æˆ–å¤šæˆ–å°‘ã€‚ä¸€æ—¦é¡¹ç›®åºå¤§ï¼Œç”Ÿäº§ç¯å¢ƒï¼Œå‡º bug çš„æ•°å­¦æœŸæœ›åŒæ ·å¾ˆå®¹æ˜“è¾¾åˆ°ä¸€ä¸ªæ¯”è¾ƒé«˜çš„æƒ…å†µã€‚å½“ç„¶ï¼Œè¿™é‡Œå°±ä¸èµ˜è¿°ã€‚ æˆ‘ä»¬éœ€è¦è®¤å¯çš„ä¸€ä»¶äº‹æ˜¯ï¼Œä¸œè¥¿æ—©æ™šä¼šåæ‰çš„ã€‚ä½œè€…è®¤ä¸ºï¼šæ²¡æœ‰æ—ä¸¹å¦™è¯å¯ä»¥æ‹¯æ•‘ä¸Šè¿°çš„é—®é¢˜ã€‚æˆ‘ä»¬åº”å½“æ¥å—ï¼Œåœ¨è®¾è®¡ç³»ç»Ÿçš„æ—¶å€™ï¼Œåšå‡ºè‰¯å¥½çš„æŠ½è±¡ï¼Œè§£è€¦åˆï¼Œå……åˆ†çš„æµ‹è¯•ï¼Œæ˜ç¡®è¯¦ç»†çš„ç›‘æ§å’Œéšæ—¶å‡†å¤‡ä¸€ä¸ªæ¨¡æ‹Ÿç”Ÿäº§ç¯å¢ƒçš„æ²™ç›’å­ã€‚åªæœ‰ä¸æ–­çš„æŠŠæ¯ä¸ªç»†èŠ‚éƒ½åšå¥½ï¼Œä»æ•´ä½“åˆ°å±€éƒ¨ï¼Œç³»ç»Ÿæ‰ä¼šæœç€å¥åº·çš„æ–¹å‘å‘å±•ã€‚ é¡¹ç›®åˆæœŸçš„æ—¶å€™ï¼Œæ•°æ®æ¨¡å‹çš„é€‰å–é€šå¸¸å› ä¸ºé¡¹ç›®çš„å¤æ‚åº¦å¹¶ä¸ç®—é«˜è€Œå˜å¾—å¾ˆå«ç³Šã€‚å¼„æ¸…æ¥šä¸€äº›è¦ç‚¹ï¼Œä¼šè®©å·¥ä½œé¡ºåˆ©è®¸å¤šã€‚æ•°æ®çš„æŸ¥è¯¢é€šå¸¸ä¾èµ–ä¸¤ç§æ–¹å¼ï¼Œç´¢å¼•æˆ–è€…æœç´¢å¼•æ“ã€‚å¦‚ä»Šçš„å“ˆå¸Œç´¢å¼•ï¼ŒB/B+ æ ‘ï¼ŒLSM æ ‘åœ¨å·¥ä¸šåœºæ™¯ä¸‹éƒ½æœ‰éå¸¸å‰å®³çš„å®ç°ï¼Œæ¯”å¦‚ InnoDBï¼Œ MongoDBã€‚OLAP åœºæ™¯å’Œ OLTP åœºæ™¯åœ¨æŸäº›æƒ…å†µä¸‹å¾ˆéš¾åšåˆ°åŒæ—¶æ»¡è¶³ï¼Œéœ€è¦å·¥ç¨‹å¸ˆå»åš trade offã€‚è€ƒè™‘åˆ°å¯æ‰©å±•å’Œå¯ç»´æŠ¤ï¼Œéœ€è¦æŠŠåº”ç”¨æœåŠ¡å™¨ä¸å­˜å‚¨æœåŠ¡å™¨ä¹‹é—´åšå¥½ç»†è‡´çš„å·¥ä½œåˆ’åˆ†ã€‚å»ºç«‹ç§©åºï¼Œçœå´æœç´¢â€”â€”å¾·å›½è°šè¯­ æ•°æ®çš„ä¼ è¾“å¾€å¾€ç¦»ä¸å¼€ç½‘ç»œåè®®çš„æ•°æ®çš„åºåˆ—åŒ– / ååºåˆ—åŒ–ã€‚å½“ä»Šåœ¨å¤§å¤šæ•° REST æœåŠ¡ä¸­ï¼ŒJSON å æ®ç€ä¸»å¯¼åœ°ä½ï¼Œè¿™ä¸å‰ç«¯å·¥ç¨‹å¸ˆçš„ä»˜å‡ºå¯†åˆ‡ç›¸å…³ã€‚ä¹Ÿæ˜¯å› ä¸ºå¾®æœåŠ¡çš„æµè¡Œï¼Œå½“ä¸‹çš„ç³»ç»Ÿä¸­ï¼ŒæŸä¸ªæœåŠ¡ç«¯èŠ‚ç‚¹å¾ˆæœ‰å¯èƒ½æ˜¯åˆ«çš„æœåŠ¡ç«¯çš„å®¢æˆ·ç«¯ã€‚å½“ç„¶ï¼Œé™¤äº† JSONï¼Œå„ç§äºŒè¿›åˆ¶åè®®æ¯”å¦‚ Protocol Buffers æœ‰ç€æ›´å¥½çš„æ€§èƒ½ä¸ä¸é”™çš„å¯ç»´æŠ¤æ€§ã€‚ä½†é—®é¢˜æ˜¯è¿™äº›åè®®åœ¨æ•°æ®å¯è¯»ä¹‹å‰éœ€è¦è§£ç ã€‚ å¦‚ä»Šæ•°æ®çš„æ£€ç´¢å’Œå­˜å‚¨å·²ç»å¯ä»¥æœ‰å¤šå°æœºå™¨åŒæ—¶å‚ä¸ï¼Œåœ¨è¿™é‡Œå§‘ä¸”ç§°ä¹‹ä¸ºåˆ†å¸ƒå¼æ•°æ®å­˜å‚¨ã€‚å®ƒå¯ä»¥å¸¦æ¥æ›´å¤§çš„è´Ÿè½½èƒ½åŠ›ï¼Œæ¯”å¦‚ä¸€äº› OLAP åœºæ™¯å¯¹æ•°æ®åº“ CPU æœ‰æå¤§çš„æ¶ˆè€—ï¼Œè¿™ä¸ªæ—¶å€™å¯ä»¥åšæ¨ªå‘æ‰©å±•ã€‚åŒæ—¶åˆ†å¸ƒå¼å­˜å‚¨å¯ä»¥å¸¦æ¥æ›´ä¼˜è´¨çš„å®¹é”™èƒ½åŠ›ã€‚æˆ‘å¾ˆå–œæ¬¢ replication è¿™ä¸ªå•è¯ï¼Œæ­£å¦‚ä¹‹å‰æåˆ°çš„ï¼Œå½“æŸä¸ªç¡¬ç›˜æ•…éšœäº†ï¼Œæˆ‘ä»¬åˆéœ€è¦å¯¹è¿™ç¡¬ç›˜æ•°æ®è¿›è¡Œè¯»å†™ã€‚è¿™ä¸ªæ—¶å€™å°±è¦è€ƒè™‘å®ƒä¸€å®šéœ€è¦å‰¯æœ¬äº†ã€‚æˆ‘ä»¬å¯ä»¥ç†è§£ä¸ºå¤šä¸ªå­˜å‚¨å†…å®¹ç›¸åŒçš„ç¡¬ç›˜ï¼Œäº’ä¸ºå¯¹æ–¹çš„å‰¯æœ¬ã€‚è€Œå‰¯æœ¬çš„å­˜åœ¨åˆäº§ç”Ÿäº†ä¸€è‡´æ€§é—®é¢˜ç”šè‡³æ¨å¯¼å‡º CAP ç†è®ºã€‚åŸºæœ¬çš„ Master-Slave æ¶æ„ï¼Œåˆ° Paxos ï¼ŒRaft åˆ†å¸ƒå¼ä¸€è‡´æ€§ç®—æ³•éƒ½æ˜¯åœ¨è§£å†³å‰¯æœ¬ä¸€è‡´æ€§çš„é—®é¢˜ã€‚åˆ†å¸ƒå¼åœºæ™¯ä¸­ï¼Œè¿˜æœ‰ä¸€ä¸ªç»å…¸çš„é—®é¢˜â€”â€”åˆ†å¸ƒå¼äº‹åŠ¡ã€‚æˆ‘ä»¬éœ€è¦ç†è§£æ•°æ®åº“äº‹åŠ¡çš„ ACID ç‰¹æ€§å’Œç»å…¸çš„äºŒé˜¶æ®µæäº¤ç®—æ³•ã€‚çœŸå®ä¸–ç•Œä¸­ï¼ŒèŠ‚ç‚¹çš„å¤±æ•ˆæˆ–è€…æ•…éšœï¼Œç½‘ç»œé—®é¢˜æ¯”å¦‚ç¦»çº¿ï¼Œè¶…æ—¶ï¼Œé‡ä¼ ç­‰ï¼Œéƒ½ç»™åˆ†å¸ƒå¼ç³»ç»Ÿå¸¦æ¥æ— é™çš„æŒ‘æˆ˜ã€‚åœ¨è¿™é‡ŒçœŸä½©æœ etcdï¼ŒSpannerï¼ŒTiDB è¿™äº›ä¸ºäº†åˆ†å¸ƒå¼ç³»ç»Ÿè´¡çŒ®æ™ºæ…§çš„é¡¹ç›®ã€‚åˆ†å¸ƒå¼ç³»ç»Ÿè¿˜æœ‰ä¸€å¤§å †è¯´ä¸å®Œçš„æœ‰æ„æ€çš„ï¼Œæƒ³çŸ¥é“çš„åŒå­¦å¯ä»¥ä¹°ä¹¦äº†ï½ å¦‚ä»Šæ˜¯ä¸€ä¸ªå„ç§æ•°æ®ç³»ç»Ÿå¤§æ‚çƒ©çš„æ—¶ä»£ï¼ŒRedis å¯ä»¥ç”¨ä½œæ¶ˆæ¯é˜Ÿåˆ—ï¼ŒKafka å¯ä»¥æ‹¿æ¥æŒä¹…åŒ–æ•°æ®ã€‚ä¼ ç»Ÿçš„å…³ç³»å‹æ•°æ®åº“è¦æ±‚ç”¨æˆ·é‡‡ç”¨ç‰¹å®šçš„æ ¼å¼å­˜å‚¨æ•°æ®ï¼Œè€Œåˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿé‡Œé¢åªæ˜¯å­—èŠ‚åºåˆ—ï¼Œå¯ä»¥æ˜¯æ–‡æœ¬å›¾åƒï¼Œè§†é¢‘ï¼Œç‰¹å¾å‘é‡æˆ–è€…ä»»ä½•ç±»å‹çš„æ•°æ®ã€‚è¿™äº›æ•°æ®å­˜åˆ°åºå¤§çš„æ•°æ®ä¸­å¿ƒçš„ç³»ç»Ÿä¸­ï¼Œè¢«ä¸€äº›æ‰¹å¤„ç†ç³»ç»Ÿè¿›è¡Œæ•°æ®æ¸…æ´—äº¤ç”±æ¶ˆè´¹æ–¹ä½¿ç”¨ã€‚è¿™é‡Œ unix ç¼–ç¨‹å“²å­¦é‡æ–°å›åˆ°äº†æˆ‘ä»¬çš„çœ¼ä¸­ï¼šè¾“å…¥æ˜¯ä¸å¯å˜çš„ï¼Œè¾“å‡ºæ˜¯ä¸ºäº†ä½œä¸ºå¦ä¸€ä¸ªï¼ˆæœªçŸ¥çš„ï¼‰ç¨‹åºçš„è¾“å…¥ï¼Œè€Œå¤æ‚çš„é—®é¢˜æ˜¯é€šè¿‡ç¼–å†™ â€œåšå¥½ä¸€ä»¶äº‹â€ çš„å°å·¥å…·æ¥è§£å†³çš„ã€‚ ç›¸å¯¹çš„ï¼Œåœ¨æµå¼ç³»ç»Ÿä¸­ï¼Œè¾“å…¥æˆ‘ä»¬è®¤ä¸ºæ˜¯æ— é™çš„ï¼Œå¢é‡çš„ã€‚æ¯”å¦‚é‡‡ç”¨æ¶ˆæ¯é˜Ÿåˆ—æˆ‘ä»¬è®¤ä¸ºæ˜¯ä¸€ä¸ªä¸æ–­å‘å¸ƒæ¶ˆè´¹ï¼Œæ•°æ®ä¸æ–­å¢é•¿çš„è¿‡ç¨‹ã€‚è¿™é‡Œåˆä¸¤ç§æ¨¡å¼ï¼Œä¸€ç§æ˜¯åŸºäº FIFO æ¨¡å‹çš„ï¼Œå½“æ¶ˆæ¯ pop çš„æ—¶å€™å°±æ¶ˆå¤±äº†ï¼›è¿˜æœ‰ä¸€ç§æ˜¯åŸºäºæ—¥å¿—çš„ï¼Œå¤šä¸ªæ¶ˆè´¹è€…å¯ä»¥äº’ä¸å½±å“è¯»å–å†…å®¹ã€‚è¿™ä¸¤è€…å„æœ‰ä¼˜åŠ£ï¼Œéœ€è¦æƒè¡¡ã€‚æ¯”å¦‚å¯¹æ€§èƒ½ååé‡ï¼Œé¡ºåºè¦æ±‚é«˜çš„æƒ…å†µä¸‹ï¼Œé‡‡ç”¨æ—¥å¿—çš„ã€‚æ¶ˆæ¯å¤„ç†å¤§å¤šæ•°æƒ…å†µä¸‹éœ€è¦äººä¸ºå®ç°å¹‚ç­‰ã€‚åœ¨åŸºäºæ—¥å¿—çš„æµå¼ç³»ç»Ÿä¸­åº”ç”¨çŠ¶æ€æ˜¯äº‹ä»¶æµå¯¹äºæ—¶é—´ç§¯åˆ†çš„ç»“æœï¼Œæ‰€ä»¥ä»æ•°å­¦çš„è§’åº¦è€Œè¨€æˆ‘ä»¬çš„çš„ç¡®ç¡®å¯ä»¥æŠŠè¿™ç§ç³»ç»Ÿå½“ä½œæŒä¹…åŒ–å­˜å‚¨å’ŒæŸ¥è¯¢çš„å·¥å…·ã€‚ åœ¨æœªæ¥ï¼Œæµå¼ç³»ç»Ÿå’Œåˆ†å¸ƒå¼ç³»ç»Ÿä¼šè¢«æ›´å¤šäººæ¥å—å’Œç†è§£ã€‚ä¸è¿‡ä¸ºäº†ä¿è¯ç°å®ä¸–ç•Œçš„å› å…³ç³»ï¼Œæ¯”å¦‚ï¼šä¸¤ä¸ªäººåœ¨å¯¹æ–¹å¥½å‹åˆ—è¡¨é‡Œé¢äº’ç›¸åˆ é™¤ä¹‹åï¼Œå°±ä¸ä¼šå†çœ‹åˆ°å¯¹æ–¹çš„åŠ¨æ€ï¼Œå¯æ˜¯åœ¨å®ç°åˆ†å¸ƒå¼å­˜å‚¨ä¹‹åï¼Œå¦‚æœæŠ€æœ¯ä¸Šæ²¡æœ‰å¤„ç†å¥½ï¼Œå°±ä¼šå‘ç°ä¾ç„¶å¯ä»¥äº’åˆ·åŠ¨æ€ã€‚å†æ¯”å¦‚ï¼šé“¶è¡Œè½¬è´¦ A æ‰£é’±ï¼ŒB è·å¾—é’±ï¼Œç»“æœä¸¤è€…æ²¡æœ‰æ»¡è¶³è½¬è´¦åçš„æ•°ç›®ã€‚å…¨å±€æœ‰åºå’Œåˆ†å¸ƒå¼äº‹åŠ¡æ˜¯ä¸€å®šè¦å¦¥å¦¥å®ç°çš„ã€‚æ•°æ®åº“çš„æ‹†åˆ†å°†ä¼šå˜å¾—ä½æˆæœ¬ï¼Œæˆ–è€…ç›´æ¥ä¸Šåˆ†å¸ƒå¼æ•°æ®åº“ã€‚å‡½æ•°å¼ç¼–ç¨‹ç”±äºè¶…å¼ºçš„ DSL èƒ½åŠ›ä¼šç»™äºˆæ•°æ®å¤„ç†åœºæ™¯ä¼˜è´¨çš„å·¥å…·é›†ã€‚ æœ¬ä¹¦åœ¨æ¯ä¸ªç« èŠ‚ä¹‹åï¼Œéƒ½é™„ä¸Šäº†å¤§é‡çš„å‚è€ƒæ–‡çŒ®ï¼Œå…¶ä¸­å¤šæ•°æ˜¯è¿‘å¹´çš„ç»å…¸è®ºæ–‡ã€‚å¾ˆæ¨èç»†ç»†è¯»ä¸€ä¸‹ï¼Œæ¯”å¦‚ Map Reduceï¼ŒBigTable è¿™ç§ã€‚å¯ä»¥å¾ˆæ˜æ˜¾ä½“ä¼šåˆ°ï¼Œä½œè€…å°†è¿™äº›è®ºæ–‡çš„å†…å®¹ï¼ŒåŸºäºè®¸å¤šå…¬å¸çš„ä¸šåŠ¡åœºæ™¯ï¼Œå¼€å‘å†ç¨‹æ•´ç†å‡ºäº†æ­¤ä¹¦ã€‚å¯¹äºå·¥ç¨‹å¸ˆï¼Œè¿™æœ¬ä¹¦å¯ä»¥ç»™äºˆå¤§å¤šæ•°äººä¸€ä¸ªå…³äºå½“ä»Šæ•°æ®ç³»ç»Ÿå¤§è€Œå…¨çš„è§†è§’ï¼Œåœ¨ç³»ç»Ÿè®¾è®¡è¿™ä¸ªå±‚æ¬¡æ”¶è·æ›´å¤šã€‚å¯¹äºå­¦ç”Ÿå¯èƒ½ä¸å¤ªé€‚åˆã€‚ æˆ‘è§‰å¾—æœåŠ¡ç«¯å·¥ç¨‹å¸ˆï¼Œåšçš„æœ€ä¸»è¦çš„äº‹æƒ…å°±æ˜¯å’Œæ•°æ®æ‰“äº¤é“ã€‚é€šè¿‡æ­£ç¡®çš„æ•°æ®åˆ†æä¸ç®—æ³•ä¼˜åŒ–ï¼Œå¯ä»¥è®©è®¸å¤šçš„ä¼ä¸šä¸ºæ­¤å°åˆ°ç”œå¤´ã€‚è¿™æœ¬ä¹¦çš„æœ€åæœ‰ä¸€å¥éå¸¸æœ‰æ„æ€çš„è¯ï¼šwe should stop regarding users as metrics to be optimized, and remember that they are humans who deserve respect, dignity and agencyã€‚æ‰‹æœºé‡Œçš„ APP ä¸ºæˆ‘ä»¬æä¾›äº†è¶³å¤Ÿçš„ä¾¿åˆ©ï¼ŒåŒæ—¶æˆ‘ä»¬çš„è¡Œä¸ºå–œå¥½æ•°æ®ä¹Ÿè¿›å…¥äº†è¿™äº› APP çš„åç«¯ã€‚è¿™äº›åº”ç”¨çš„åˆ›ä½œè€…å’Œè¿è¥è€…åº”å½“å°Šé‡ç”¨æˆ·çš„å–œå¥½ä¸éšç§ã€‚ å¸Œæœ›ä½ ä¹Ÿå–œæ¬¢è¿™æœ¬ä¹¦ã€‚ğŸ˜Š","categories":[],"tags":[{"name":"è¯»ä¹¦","slug":"è¯»ä¹¦","permalink":"https://razertory.me/tags/è¯»ä¹¦/"}]},{"title":"æœ€å¤§å­åºåˆ—","slug":"max-sub-array","date":"2018-12-16T14:14:05.000Z","updated":"2020-03-28T13:02:10.006Z","comments":true,"path":"2018/12/16/max-sub-array/","link":"","permalink":"https://razertory.me/2018/12/16/max-sub-array/","excerpt":"","text":"é¢˜ç›®ç»™å®šä¸€ä¸ªæ•´æ•°æ•°ç»„ nums ï¼Œæ‰¾åˆ°ä¸€ä¸ªå…·æœ‰æœ€å¤§å’Œçš„è¿ç»­å­æ•°ç»„ï¼ˆå­æ•°ç»„æœ€å°‘åŒ…å«ä¸€ä¸ªå…ƒç´ ï¼‰ï¼Œè¿”å›å…¶æœ€å¤§å’Œã€‚ç¤ºä¾‹ï¼š 123è¾“å…¥ï¼š[-2,1,-3,4,-1,2,1,-5,4],è¾“å‡ºï¼š6è§£é‡Šï¼šè¿ç»­å­æ•°ç»„ [4,-1,2,1] çš„å’Œæœ€å¤§ï¼Œä¸º 6ã€‚ æš´åŠ›æ³•æŠŠæ‰€æœ‰å­åºåˆ—éƒ½æ‰¾å‡ºæ¥å¹¶æ±‚å‡ºæœ€å¤§å’Œã€‚åˆ©ç”¨ä¸¤ä¸ªå¾ªç¯ï¼Œå¤–å¾ªç¯è®°å½•å¼€å§‹ä¸‹æ ‡ï¼Œå†…å¾ªç¯è®°å½•ç»“æŸä¸‹æ ‡ã€‚ä¸æ–­ç»´æŠ¤ä¸€ä¸ªæœ€å¤§ sumã€‚ 123456789101112131415class Solution &#123; // T:O(n^2) S:O(1) public int maxSubArray(int[] nums) &#123; if (nums == null || nums.length == 0) return 0; int max = nums[0]; for (int i = 0; i &lt; nums.length; i++) &#123; int cur = 0; for (int j = i; j &lt; nums.length; j++) &#123; cur += nums[j]; max = Math.max(max, cur); &#125; &#125; return max; &#125;&#125; åœ¨çº¿å¤„ç†æ³•åœ¨çº¿å¤„ç†æ„å‘³ç€åœ¨æ¯æ¬¡å¾ªç¯è¿‡ç¨‹ä¸­éƒ½è®¡ç®—å‡ºä¸€ä¸ªå½“å‰æœ€ç»ˆå€¼ã€‚éå†è¿‡ç¨‹ä¸­ç»´æŠ¤ä¸€ä¸ª cur ç”¨æ¥è¡¨ç¤ºå½“å‰çš„å€¼å·¦è¾¹çš„æœ€å¤§éè´Ÿæ•°çš„å’Œã€‚å¦‚æœ cur å°äº 0 æ„å‘³ç€èˆå¼ƒæ‰ï¼Œåä¹‹å°±å¸¦ä¸Šã€‚åœ¨åŠ ä¸Šäº†å½“å‰å€¼ä¹‹åï¼Œç”±äºå½“å‰å€¼çš„æ­£è´Ÿï¼Œæ‰€ä»¥è¿˜éœ€è¦ç»´æŠ¤ä¸€ä¸ª max ç”¨æ¥æ‰¾åˆ°æœ€å¤§å€¼ã€‚ 1234567891011class Solution &#123; // T:O(n) S:O(1) public int maxSubArray(int[] nums) &#123; int cur = 0, max = Integer.MIN_VALUE; for (int i = 0; i &lt; nums.length; i++) &#123; cur = cur &lt;= 0 ? nums[i] : (cur + nums[i]); max = Math.max(max, cur); &#125; return max; &#125;&#125; åŠ¨æ€è§„åˆ’æ³•å‡è®¾å‡½æ•° f(i) è¡¨ç¤ºä¸‹æ ‡ä» 0 åˆ° i çš„å­åºåˆ—æœ€å¤§å€¼ã€‚ å‡è®¾æ•°ç»„ä¸º [-2]ï¼Œf(0) = -2 å‡è®¾æ•°ç»„ä¸º [-2, 1]ï¼Œ f(1) = 1 å‡è®¾æ•°ç»„ä¸º [-2, 1, -3]ï¼Œ f(2) = 1 ä»ä¸Šè¿°å¯ä»¥å‘ç°ã€‚f(1) å¯ä»¥çœ‹æˆ f(0) + nums[1] ä¸ nums[1] æ¯”è¾ƒçš„è¾ƒå¤§å€¼ï¼›å¹¶ä¸” f(2) ä¹Ÿæ»¡è¶³è¿™ä¸ªæ¡ä»¶ã€‚ é‚£ä¹ˆå¯ä»¥å®¹æ˜“å¾—åˆ°çŠ¶æ€è½¬ç§»æ–¹ç¨‹ï¼šf(i) = max(f(i - 1) + nums[i], nums[i])ã€‚å†™å‡ºä»£ç å°±æ˜¯ 1234567891011121314class Solution &#123; // T:O(n) S:O(n) public int maxSubArray(int[] nums) &#123; if (nums == null || nums.length == 0) return 0; int[] dp = new int[nums.length]; int result = nums[0]; dp[0] = result; for (int i = 1; i &lt; nums.length; i++) &#123; dp[i] = Math.max(dp[i - 1] + nums[i], nums[i]); result = Math.max(dp[i], result); &#125; return result; &#125;&#125;","categories":[],"tags":[]},{"title":"NP é—®é¢˜","slug":"np-complete","date":"2018-12-05T14:11:28.000Z","updated":"2020-03-28T13:02:10.002Z","comments":true,"path":"2018/12/05/np-complete/","link":"","permalink":"https://razertory.me/2018/12/05/np-complete/","excerpt":"","text":"å¤šé¡¹å¼å¤æ‚åº¦NP é—®é¢˜ä¸­çš„ P æ„æ€æ˜¯ Polynomialï¼Œæ„ä¸ºå¤šé¡¹å¼å¤æ‚åº¦ã€‚å…¶ä¸­ï¼ŒO(1), O(log(n)), O(n), O(nlog(n)), O(n^2), â€¦ O(n^a) è¿™ä¸€ç±»çš„å¤æ‚åº¦ï¼ˆä»å°åˆ°å¤§é¡ºåºï¼‰çš„é—®é¢˜æ˜¯å¤šé¡¹å¼å¤æ‚åº¦çš„ã€‚ä»–ä»¬çš„ç‰¹ç‚¹æ˜¯ï¼Œé—®é¢˜çš„å¤æ‚åº¦ä¸ä¼šå› ä¸º n çš„å¢å¤§è€Œå¢å¤§ã€‚ç›¸åï¼ŒO(a^n) å’Œ O(n!) è¿™ç±»é—®é¢˜å› ä¸ºé—®é¢˜çš„å¤æ‚åº¦ä¼šå› ä¸º n å¢å¤§è€Œå¢å¤§ï¼Œæ‰€ä»¥è®¤ä¸ºä¸æ˜¯å¤šé¡¹å¼çš„ã€‚ä¸¾ 2 ä¸ªä¾‹å­ï¼Œ P é—®é¢˜1234567891011æ‰¾ä¸­ä½æ•°é—®é¢˜åœ¨ä¸€ä¸ªæ•°ç»„ arr = [13, 8, 1, 2, 4, 6, 11] ä¸­ï¼Œæˆ‘ä»¬è¦æ‰¾åˆ°æ•°ç»„çš„ä¸­ä½æ•°ã€‚è§£ç­”éœ€è¦å¯¹è¿™ä¸ªæ•°ç»„æ’åºï¼Œç„¶åæ‰¾åˆ° [1, 2, 4, 6, 8, 11, 13] ä¸­ä¸‹æ ‡æ˜¯ (n + 1) / 2 çš„æ•°å­—ï¼Œä¹Ÿå°±æ˜¯ 6ã€‚æ‰€ä»¥è§£ç­”è¿™ä¸ªé—®é¢˜çš„å¤æ‚åº¦æ˜¯ O(nlog(n))ã€‚éªŒè¯å‡è®¾æœ‰ä¸€ä¸ªè§£ç­”æ˜¯ 3ï¼Œè¦åˆ¤æ–­è¿™ä¸ªæ•°æ˜¯å¦æ˜¯è¿™ä¸ªé—®é¢˜çš„ç­”æ¡ˆã€‚é‚£ä¹ˆåªéœ€è¦åˆ¤æ–­æ•°ç»„ä¸­å¤§äº 3 å’Œå°äº 3 çš„æ•°çš„ä¸ªæ•°æ˜¯å¦ç›¸ç­‰ã€‚æ‰€ä»¥éªŒè¯è¿™ä¸ªè§£ç­”æ˜¯å¦æ­£ç¡®çš„å¤æ‚åº¦æ˜¯ O(n)ã€‚ è¿™ç§è§£ç­”å¤æ‚åº¦å’ŒéªŒè¯å¤æ‚åº¦éƒ½æ˜¯ P çš„å°±è®¤ä¸ºæ˜¯ P ç±»é—®é¢˜ã€‚ NP Complete é—®é¢˜123456789101112133 - SAT é—®é¢˜å¦‚æœæœ‰ a, b, c, d, e, f éƒ½ä¸º boolean ç±»å‹çš„å˜é‡ã€‚æ˜¯å¦å­˜åœ¨è¿™æ ·çš„ä¸€ç»„ a, b, c, d, e, f æ»¡è¶³(a || b || c) &amp;&amp; (!a || b || f) &amp;&amp; (!e || d || f) == trueè§£ç­”å‡è®¾ 0 è¡¨ç¤º falseï¼Œ 1 è¡¨ç¤º true é‚£ä¹ˆå°±éœ€è¦æš´åŠ›é‡‡ç”¨æšä¸¾çš„æ–¹å¼å»æ‰¾åˆ°è¿™ç»„ç¬¦åˆæœ€ç»ˆç»“æœçš„å€¼ã€‚è¿™æ ·çš„å¤æ‚åº¦æ˜¯ 2^6ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå½“è¾“å…¥çš„å˜é‡ä¸ªæ•°ä¸º n çš„æ—¶å€™ï¼Œå¤æ‚åº¦å°±æ˜¯ 2^nã€‚æ‰€ä»¥è¿™ç§é—®é¢˜è§£å†³çš„å¤æ‚åº¦æ˜¯ O(a^n)ï¼Œè¿™æ ·çš„é—®é¢˜å°±æ˜¯ NP é—®é¢˜ã€‚éªŒè¯å‡è®¾æœ‰ä¸€ç»„è§£ç­”æ˜¯ 0, 1, 1, 1, 0, 1ã€‚è¦åˆ¤æ–­æ˜¯å¦æ˜¯è¿™ä¸ªé—®é¢˜çš„ç­”æ¡ˆï¼Œåªéœ€è¦å¸¦å…¥è¿›è¡Œè®¡ç®—å³å¯ã€‚ä»¥éªŒè¯è¿™ä¸ªè§£ç­”æ˜¯å¦æ­£ç¡®çš„å¤æ‚åº¦æ˜¯ O(1)ã€‚ï¼ˆæ»¡è¶³ Pï¼‰ è¿™ç§è§£ç­”å¤æ‚åº¦ä¸ºé P è€ŒéªŒè¯å¤æ‚åº¦ä¸º P çš„å°±è®¤ä¸ºæ˜¯ NP Complete é—®é¢˜ã€‚ N == NP ?å›è¿‡å¤´çœ‹ï¼Œ å½“éªŒè¯ä¸€ä¸ªè§£ç­”æ˜¯å¦æ˜¯è¿™ä¸ªé—®é¢˜çš„æ­£ç¡®ç­”æ¡ˆçš„å¤æ‚åº¦æ˜¯ P çš„æ—¶å€™ï¼Œè¿™ä¸ªé—®é¢˜æ˜¯ NP é—®é¢˜ åœ¨ 1 çš„åŸºç¡€ä¸Šï¼Œæˆ‘ä»¬å‘ç°å¦‚æœè§£å†³è¿™ä¸ªé—®é¢˜çš„å¤æ‚åº¦æ˜¯ P çš„æ—¶å€™ï¼Œè¿™ä¸ªé—®é¢˜æ˜¯ P é—®é¢˜ åœ¨ 1 çš„åŸºç¡€ä¸Šï¼Œæˆ‘ä»¬å‘ç°è§£å†³è¿™ä¸ªé—®é¢˜çš„å¤æ‚åº¦ä¸æ˜¯ P çš„æ—¶å€™ï¼Œè¿™ä¸ªé—®é¢˜æ˜¯ NP Complete é—®é¢˜ å½“æˆ‘ä»¬ç ”ç©¶è¿™ä¸ªä¸–ç•Œçš„é—®é¢˜çš„æ—¶å€™ï¼Œæœ‰äººè®¤ä¸ºæ‰€æœ‰çš„ NP é—®é¢˜éƒ½æ˜¯ P é—®é¢˜ï¼›æœ‰äººåˆ™è®¤ä¸ºä¸€å®šä¸æ˜¯æ‰€æœ‰çš„ NP é—®é¢˜éƒ½æ˜¯ P é—®é¢˜ã€‚åœ¨è®¡ç®—æœºç§‘å­¦çš„é¢ å³°ä¸Šï¼Œäººç±»çš„æ™ºæ…§ä¸€ç›´åœ¨ä¸ºè¯æ˜ N == NP åšå‡ºåŠªåŠ›ã€‚","categories":[],"tags":[]},{"title":"çº¿ç¨‹ã€è¿›ç¨‹å’Œåç¨‹ä»¥åŠ IO å¤šè·¯å¤ç”¨å®ç°å¹¶å‘","slug":"tread_and_process","date":"2018-11-19T05:55:48.000Z","updated":"2020-03-28T13:02:10.002Z","comments":true,"path":"2018/11/19/tread_and_process/","link":"","permalink":"https://razertory.me/2018/11/19/tread_and_process/","excerpt":"","text":"è®¡ç®—æœºå¹¶å‘å’Œå¹¶è¡Œçš„ä½“ç³» å¹¶å‘ï¼ˆConcurrencyï¼‰ï¼šå¦‚æœé€»è¾‘æµåœ¨æ—¶é—´ä¸Šé‡å ï¼Œé‚£ä¹ˆå®ƒä»¬å°±æ˜¯å¹¶å‘çš„ å¹¶è¡Œï¼ˆParallelï¼‰ï¼šå¦‚æœé€»è¾‘æµåœ¨æ—¶åˆ»ä¸Šé‡å ï¼Œé‚£ä¹ˆå®ƒä»¬å°±æ˜¯å¹¶è¡Œçš„ erlang ä¹‹çˆ¶ç”¨ä¸€å¼ å›¾æ¥æè¿°äº†å¹¶å‘å’Œå¹¶è¡Œçš„åŒºåˆ«ã€‚ Concurrent&Parallel ä¸€äº›æœ‰ GIL çš„è¯­è¨€ï¼Œå¹¶ä¸èƒ½å®ç°å¹¶è¡Œï¼Œå¯ä»¥å‚ç…§è–„è· CTO çš„ Ruby å®ä¾‹è¯´æ˜ Ruby å¤šçº¿ç¨‹çš„æ½œåŠ›å’Œå¼±ç‚¹ã€‚å®é™…ä¸Šï¼ŒæŒ‰ç…§ä¸Šè¿°å›¾ç‰‡çš„ä¾‹å­ï¼Œå’–å•¡æœºå°±åƒæ˜¯ CPU çš„æ ¸å¿ƒï¼Œéƒ¨åˆ†è¯­è¨€å³ä½¿åœ¨æœ‰å¤šå°å’–å•¡æœºçš„æƒ…å†µä¸‹ï¼Œä»»ä½•æ—¶åˆ»ä¹Ÿåªæœ‰ä¸€å°å’–å•¡æœºåœ¨å·¥ä½œã€‚ç°ä»£çš„äº’è”ç½‘äº§å“å¤§å¤šæ˜¯ IO å¯†é›†å‹ï¼Œè€Œ IO BLOCK è¿™ç§æ“ä½œä¸¥æ ¼æ„ä¹‰ä¸Šæ˜¯ä¸å ç”¨ CPU æ—¶é—´çš„ï¼Œè¿™é‡Œå¯ä»¥å‚ Java æ§åˆ¶ CPU å ç”¨ ä¸€æ–‡ã€‚æ‰€ä»¥ï¼Œå¹¶è¡Œæ˜¯å¹¶å‘çš„å­é›†ï¼Œé€šå¸¸æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ç ”ç©¶çš„æ˜¯å¹¶å‘ã€‚ è¿›ç¨‹çš„å¹¶å‘ç®€å•çš„è¯´ï¼Œå½“ä¸€ä¸ªç¨‹åºè¢«å®¢æˆ·ç«¯è¯·æ±‚çš„æ—¶å€™ï¼Œå°±åˆ›å»ºä¸€ä¸ªæ–°çš„è¿›ç¨‹æ¥æœåŠ¡å®¢æˆ·ç«¯ï¼Œè¿›ç¨‹å¯¹ CPU èµ„æºçš„è·å–ç”±å†…æ ¸è°ƒåº¦ã€‚è¯¦ç»†çš„å°±æ˜¯ï¼š çˆ¶è¿›ç¨‹ç›‘å¬ç€ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦ fd_aï¼Œå½“æ”¶åˆ°å®¢æˆ·ç«¯è¯·æ±‚çš„æ—¶å€™ï¼Œç«‹å³æ‰“å¼€å¹¶è¿”å›ä¸€ä¸ªæè¿°ç¬¦ fd_bï¼Œ çˆ¶è¿›ç¨‹æ´¾ç”Ÿä¸€ä¸ªå­è¿›ç¨‹ï¼Œå­è¿›ç¨‹è·å¾—ä¸€ä»½çˆ¶è¿›ç¨‹ç›‘å¬çš„æ–‡ä»¶æè¿°ç¬¦åˆ—è¡¨çš„å‰¯æœ¬ï¼Œ å­è¿›ç¨‹å…³é—­ fd_aï¼Œçˆ¶è¿›ç¨‹å…³é—­ fd_bï¼ˆä¸å…³é—­å¯èƒ½å¼•èµ·å†…å­˜æ³„æ¼ï¼‰ å­è¿›ç¨‹ä¸ºå®¢æˆ·ç«¯æœåŠ¡ å¤šè¿›ç¨‹çš„å¹¶å‘å¯ä»¥å®ç°å¯¹ CPU å¤šæ ¸å¿ƒçš„å……åˆ†åˆ©ç”¨ï¼ŒåŒæ—¶ç”±äºå¤šè¿›ç¨‹ä¹‹é—´å„è‡ªç»´æŠ¤è‡ªå·±çš„è™šæ‹Ÿç©ºé—´ï¼Œè¿™ä¹Ÿä¸å®¹æ˜“äº§ç”Ÿå¹¶å‘å®‰å…¨é—®é¢˜ï¼Œerlang çš„ Actor æ¨¡å‹å°±æ˜¯æˆåŠŸçš„æ¡ˆä¾‹ã€‚åå¤„æ˜¯å¦‚æœè¿™ä¸ªç¨‹åºå«æœ‰å¤šä¸ªè¿›ç¨‹ï¼ŒåŒæ—¶è¿™äº›è¿›ç¨‹ä¹‹é—´æœ‰é€šä¿¡çš„éœ€æ±‚ï¼Œéœ€è¦ä¸€äº›å¤–éƒ¨çš„è¿›ç¨‹é€šä¿¡æœºåˆ¶ã€‚ çº¿ç¨‹å’Œåç¨‹å½“ä»Šè®¸å¤šè¯­è¨€éƒ½æœ‰è¿™è‡ªèº«ç‹¬ç‰¹çš„çº¿ç¨‹æ¨¡å‹ã€‚åœ¨æ“ä½œç³»ç»ŸåŸç”Ÿçš„è®¾è®¡ä¸­ï¼Œçº¿ç¨‹æ˜¯è¿›ç¨‹çš„å®ä½“ï¼Œå…·æœ‰ä»¥ä¸‹ç‰¹ç‚¹ åŒä¸€ä¸ªè¿›ç¨‹ä¸­çš„çº¿ç¨‹å…±äº«äº†åŒä¸€å—è™šæ‹Ÿå†…å­˜ çº¿ç¨‹ç”±å†…æ ¸è°ƒåº¦ï¼Œæ‰€ä»¥ å†…æ ¸å¯ä»¥è®©çº¿ç¨‹å°½å¯èƒ½äº«ç”¨ CPU èµ„æº å¤šä¸ªçº¿ç¨‹ä¸€å®šæ˜¯åœ¨ç«äº‰ CPU èµ„æº å½“æŸä¸ªçº¿ç¨‹å‘ç”Ÿé˜»å¡çš„æ—¶å€™ï¼Œå†…æ ¸å°† CPU èµ„æºåˆ†é…ç»™åˆ«çš„çº¿ç¨‹ï¼Œè¿™é‡Œæ¶‰åŠåˆ°äº†ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œä¸æ¨¡å¼åˆ‡æ¢ä¸åŒï¼Œ å®é™…ä¸Š â€œæ“ä½œç³»ç»Ÿçš„è¿›ç¨‹åˆ‡æ¢å’Œ CPU çš„æ¨¡å¼åˆ‡æ¢å¹¶æ²¡æœ‰ä»€ä¹ˆå…³ç³»ï¼Œå‘ç”Ÿæ¨¡å¼åˆ‡æ¢å¯ä»¥ä¸æ”¹å˜æ­£å¤„äºè¿è¡Œæ€çš„è¿›ç¨‹çŠ¶æ€ï¼Œè¿™ç§æƒ…å†µä¸‹ï¼Œä¿å­˜ä¸Šä¸‹æ–‡ç¯å¢ƒå’Œä»¥åæ¢å¤ä¸Šä¸‹æ–‡ç¯å¢ƒåªéœ€è¦å¾ˆå°‘çš„å¼€é”€ã€‚ä½†æ˜¯ï¼Œå¦‚æœæ”¹å˜æ­£å¤„äºè¿è¡Œæ€çš„è¿›ç¨‹çŠ¶æ€åˆ°å¦ä¸€ä¸ªçŠ¶æ€ï¼ˆå°±ç»ªã€é˜»å¡ç­‰ï¼‰ï¼Œåˆ™æ“ä½œç³»ç»Ÿå¿…é¡»ä½¿å…¶ç¯å¢ƒäº§ç”Ÿå®è´¨æ€§çš„å˜åŒ–â€â€”â€”ã€Šæ“ä½œç³»ç»Ÿï¼šç²¾é«“ä¸è®¾è®¡åŸç†ã€‹ æœ‰æ—¶å€™ï¼Œç¼–ç¨‹è¯­è¨€ä¸­ï¼ŒCPU èµ„æºçš„åˆ†é…ç”¨æˆ·å¸Œæœ›æŠŠæ§åˆ¶æƒä»å†…æ ¸è½¬äº¤ç»™è‡ªèº«ï¼Œè¿™æ—¶å€™ï¼Œå¦ä¸€ä¸ªæ¦‚å¿µ â€“ åç¨‹ä¾¿äº§ç”Ÿäº†ã€‚é€šå¸¸æƒ…å†µä¸‹ï¼Œå¤šä¸ªåç¨‹å¯¹åº”ç€ä¸€ä¸ªæ“ä½œç³»ç»Ÿçº¿ç¨‹ã€‚åç¨‹çš„å­˜åœ¨è®©ç”¨æˆ·å¯ä»¥è‡ªå·±ç®¡ç†ç¨‹åºä¸­ä¸åŒé€»è¾‘æµçš„ CPU åˆ†é…ï¼Œç„¶è€Œï¼Œå½“å¯¹åº”çš„è¿™ä¸ªæ“ä½œç³»ç»Ÿçº¿ç¨‹é˜»å¡çš„æ—¶å€™ï¼Œæ‰€æœ‰çš„åç¨‹å°±å¯èƒ½ä¸€èµ·é˜»å¡ï¼›è¿™æ—¶å€™å°±éœ€è¦è¯­è¨€æœ‰å¯¹åº”çš„è°ƒåº¦å™¨æ¥æ§åˆ¶ã€‚ç°ä»£è¯­è¨€ä¸­çš„ Golang å°±åšå¾—å¾ˆå¥½ã€‚ IO å¤šè·¯å¤ç”¨è¿˜æ˜¯ç”±äºç°åœ¨çš„äº’è”ç½‘äº§å“å¤§å¤šæ•° IO å¯†é›†å‹ï¼Œæ‰€ä»¥å¾ˆå¤šåœºæ™¯ä¸Šï¼Œå•ä¸ªçº¿ç¨‹ / è¿›ç¨‹å°±å¯ä»¥å®ç°å¹¶å‘ã€‚å®é™…ä¸Šï¼Œæ“ä½œç³»ç»Ÿå·²ç»åšåˆ°äº†è¿™ä¸€ç‚¹ï¼Œåœ¨å¤šä¸ªå®¢æˆ·ç«¯éƒ½è¿æ¥ä¸ŠåŒä¸€ä¸ªæœåŠ¡å™¨çš„æ—¶å€™ï¼Œè¿™ä¸ªæœåŠ¡å™¨åŒæ—¶æ‰“å¼€äº†å¯¹åº”ä¸ªæ•° + çš„ fdï¼ŒæœåŠ¡ç«¯è¦åšçš„å°±æ˜¯å½“æŸä¸ªæˆ–è€…æŸäº›è¿æ¥è¢«å®¢æˆ·ç«¯ä¼ è¿‡æ¥çš„æ—¶å€™ï¼Œèƒ½å¤Ÿç«‹å³å¤„ç†å¹¶ä¸”ä¼ é€’ç»™ fdã€‚ç±»ä¼¼äº 123for x in open_connections: if has_new_input(x): process_input(x) è¿™æ ·åšçš„åå¤„æ˜¯ä¼šæµªè´¹å¤§é‡çš„ CPU æ—¶é—´ã€‚åº”ç”¨ç¨‹åºåªå…³å¿ƒå‘ç”Ÿå˜åŒ–çš„ fdï¼Œæ¯”å¦‚ï¼šæŸä¸ª df å˜ä¸ºå¯ä»¥è¯»æˆ–è€…å¯å†™ã€‚è€Œè¿™ä¸ªä»»åŠ¡ç°åœ¨åªéœ€è¦äº¤ç»™æ“ä½œç³»ç»Ÿï¼Œåœ¨ linux ä¸­ï¼Œselectã€poll å’Œ epoll éƒ½æ˜¯å®ç° IO å¤šè·¯æœç”¨çš„ system callã€‚å®ƒä»¬çš„ä¸»è¦ä½œç”¨å°±æ˜¯ åº”ç”¨ç¨‹åºæŠŠä¸€å †æ–‡ä»¶æè¿°ç¬¦ä¼ å…¥ï¼Œç„¶å ç­‰å¾…è¿”å›å‘Šè¯‰å“ªäº›æ–‡ä»¶æè¿°ç¬¦æ˜¯å¯è¯» / å¯å†™ Julia Evans çš„ Async IO on Linux: select, poll, and epoll æ¯”è¾ƒè¯¦ç»†è¯´æ˜äº†ä¸Šè¿°ä¸‰ç§æ–¹æ³•çš„å·¥ä½œæ–¹å¼ å¹¶å‘å®‰å…¨æˆ‘è®¤ä¸ºï¼Œå¹¶å‘å®‰å…¨å¯ä»¥ç”¨ä¸€ä¸ªæœ€ç®€å•çš„ä¾‹å­è§£é‡Šã€‚ æœ‰ N ä¸ªä»»åŠ¡éƒ½ä¼šå¯¹æ•°æ® a è¿›è¡Œ writeï¼ˆwrite çš„æ–¹å¼éœ€è¦å–å†³äº a çš„å€¼ï¼‰ï¼Œå¦‚æœè¿™ N ä¸ªä»»åŠ¡å¹¶è¡Œæ‰§è¡Œå®Œ a çš„å€¼å’Œä¸²è¡Œæ‰§è¡Œå®Œä¸ä¸€è‡´ï¼Œé‚£ä¹ˆè¿™ä¸ªå¹¶å‘å°±æ˜¯ä¸å®‰å…¨çš„ã€‚è¿™ä¸ªæ¦‚å¿µå’Œ æ•°æ®ç«æ€ ç±»ä¼¼ã€‚å¯ä»¥ä¾‹ä¸¾ä¸€äº›æœ‰å¹¶å‘å®‰å…¨é—®é¢˜çš„åœºæ™¯ æ•°æ®åº“ä¸­æŸ column x åœ¨ä¸šåŠ¡ä¸­ uniqueï¼Œç¨‹åºå‘˜é‡‡ç”¨ find x or insert n++ é—®é¢˜ ç«è½¦å”®ç¥¨é—®é¢˜ æ€»ç»“ä¸‹æ¥ï¼Œå½“å­˜åœ¨ n = f(n - 1) è¿™æ ·çš„åœºæ™¯æ—¶ï¼Œå¾ˆæœ‰å¯èƒ½å‡ºç°å¹¶å‘å®‰å…¨é—®é¢˜","categories":[],"tags":[{"name":"æ“ä½œç³»ç»Ÿ","slug":"æ“ä½œç³»ç»Ÿ","permalink":"https://razertory.me/tags/æ“ä½œç³»ç»Ÿ/"}]},{"title":"Java æ§åˆ¶ CPU å ç”¨","slug":"control-cpu-just-by-java-code","date":"2018-10-12T16:40:18.000Z","updated":"2020-03-28T13:02:10.002Z","comments":true,"path":"2018/10/13/control-cpu-just-by-java-code/","link":"","permalink":"https://razertory.me/2018/10/13/control-cpu-just-by-java-code/","excerpt":"","text":"é€‰è‡ªã€Šç¼–ç¨‹ä¹‹ç¾ã€‹ã€‚ åœ¨æ—¥å¸¸å·¥ä½œä¸­ï¼Œæˆ‘ä»¬æ—¶ä¸æ—¶ä¼šå»çœ‹æœåŠ¡å™¨çš„æ€§èƒ½ï¼Œæ¯”è¾ƒå…³é”®çš„ä¸€ä¸ªå°±æ˜¯ CPU å æœ‰ç‡ã€‚é‚£ä¹ˆ CPU å æœ‰ç‡åˆ°åº•æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿåœ¨æœ¬ä¹¦ä¸­å°±å¯ä»¥æ‰¾åˆ°ç­”æ¡ˆã€‚ç”¨ Java å¯ä»¥å®ç°ä¸€ä¸ªç®€å•çš„ç‰ˆæœ¬ç”¨äºæ›´æ·±å…¥ç†è§£ CPUã€‚ CPU å æœ‰ç‡ï¼š åœ¨ä»»åŠ¡ç®¡ç†å™¨çš„ä¸€ä¸ªåˆ·æ–°å‘¨æœŸå†…ï¼ŒCPU å¿™ï¼ˆæ‰§è¡Œåº”ç”¨ç¨‹åºï¼‰çš„æ—¶é—´å’Œåˆ·æ–°å‘¨æœŸæ€»æ—¶é—´çš„æ¯”ç‡ï¼Œ å°±æ˜¯ CPU çš„å ç”¨ç‡ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œä»»åŠ¡ç®¡ç†å™¨ä¸­æ˜¾ç¤ºçš„æ˜¯æ¯ä¸ªåˆ·æ–°å‘¨æœŸå†… CPU å ç”¨ç‡çš„ç»Ÿè®¡å¹³å‡å€¼ã€‚å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥å†™ä¸€ä¸ªç¨‹åºï¼Œè®©å®ƒåœ¨ä»»åŠ¡ç®¡ç†å™¨çš„åˆ·æ–°æœŸé—´å†…ä¸€ä¼šå„¿å¿™ï¼Œ ä¸€ä¼šå„¿é—²ï¼Œ ç„¶åé€šè¿‡è°ƒèŠ‚å¿™ï¼ é—²çš„æ¯”ä¾‹ï¼Œ å°±å¯ä»¥æ§åˆ¶ä»»åŠ¡ç®¡ç†å™¨ä¸­æ˜¾ç¤ºçš„ CPU å ç”¨ç‡ã€‚ å¯ä»¥åŒæ—¶å‚è€ƒæ“ä½œç³»ç»ŸåŸç†ä¸­ï¼Œæè¿°è¿›ç¨‹ç®¡ç†çš„æ—¶å€™è¯´é“ï¼šæ“ä½œç³»ç»Ÿåœ¨è¿è¡Œçš„æ—¶å€™æœ‰ä¸€ä¸ªä¸ªçš„è¿›ç¨‹ï¼Œè¿™äº›è¿›ç¨‹æˆ–å¿™ï¼Œæˆ–é—²ã€‚å¾ˆå¤šäººéƒ½åªå…³æ³¨äº†è¿›ç¨‹å¿™çš„æ—¶å€™åšäº†ä»€ä¹ˆè€Œå¿½ç•¥äº†è¿›ç¨‹é—²çš„æ‰‹åœ¨å¹²ä»€ä¹ˆã€‚å®é™…ä¸Šï¼Œè¿›ç¨‹é—²çš„æ—¶å€™é€šå¸¸æœ‰ä»¥ä¸‹çŠ¶æ€ï¼š ç­‰å¾…ç”¨æˆ·è¾“å…¥ ç›‘å¬äº‹ä»¶å‘ç”Ÿ å¤„äºä¼‘çœ çŠ¶æ€ ä¹Ÿå°±æ˜¯è¯´ï¼šå¯ä»¥é€šè¿‡å®ç°ä»¥ä¸Šä¸‰ç§çŠ¶æ€çš„ä»»æ„ä¸€ç§ï¼Œé€šè¿‡ä»£ç çº§åˆ«çš„æ§åˆ¶åœ¨å®ç°ã€‚ å ç”¨ cpu æœ€ç®€å•çš„æ–¹å¼å°±æ˜¯ä¸€ä¸ªå¾ªç¯ 1while(true)&#123;&#125; // è€ƒè™‘æ‰§è¡Œçš„æ—¶å€™ç¨‹åºåœ¨å ç”¨ CPU ä¸å ç”¨ cpu æœ€ç®€å•çš„æ–¹å¼å°±æ˜¯è®© CPU ä¼‘çœ  1Thread.sleep(TIME) æœ€ç»ˆéœ€è¦çš„æ˜¯ä¸€ä¼šå„¿å ç”¨ä¸€ä¼šå„¿ä¸å ç”¨ï¼ŒåŒæ—¶è¿™ä¸ªæ§åˆ¶æ˜¯äººä¸ºé€šè¿‡ç¨‹åºå¹²é¢„çš„ï¼Œå½“å‰æˆ‘ä»¬è€ƒè™‘åªæ˜¯å•æ ¸çš„æƒ…å†µã€‚ å®é™…ä¸Šï¼Œæ“ä½œç³»ç»Ÿç»Ÿè®¡ CPU å æœ‰ç‡å¾ˆç®€å•çš„ä¸€ä¸ªå®ç°å°±æ˜¯ï¼Œåœ¨å•ä½æ—¶é—´ T ä¸­ï¼ŒCPU å­˜åœ¨ç¹å¿™æ—¶é—´ Rï¼Œå’Œç©ºé—²æ—¶é—´ Iã€‚é€šå¸¸æƒ…å†µä¸‹ï¼Œå¯¹äºå•æ ¸ CPU è€Œè¨€ï¼Œ T = R + I CPU å æœ‰ç‡ = R/T å¦‚æœæœ‰å…´è¶£ï¼Œå¯ä»¥æŠŠä»£ç è´´ä¸‹æ¥è·‘ä¸€ä¸‹ã€‚ 1234567891011121314151617181920public class ControlCPU&#123; public static final double TIME = 1000; //TIME= å‘¨æœŸ private static void control(double rate) throws InterruptedException&#123; while (true)&#123; runCPU(rate * TIME); Thread.sleep((long) (TIME - rate * TIME)); &#125; &#125; private static void runCPU(double time) &#123; long startTime = System.currentTimeMillis(); while ((System.currentTimeMillis() - startTime) &lt; time) &#123; &#125; &#125; public static void main(String[] args) throws InterruptedException &#123; control(0.5); &#125;&#125; ä»¥ä¸Šåœ¨ MacOS 10 è¿è¡Œä¸­ï¼ŒCPU å æœ‰ç‡ç»´æŒåœ¨äº† 50% å·¦å³ã€‚ï¼ˆæ³¨æ„åªä¼šæœ‰ä¸€ä¸ª CPU æ ¸å¿ƒæ˜¯è¢«åˆ©ç”¨äº†ï¼‰ã€‚ä¹¦ä¸­è¿˜æœ‰å¾ˆå¤šé«˜çº§çš„åšæ³•ï¼Œæ¯”å¦‚å®ç°ä¸€æ¡ sin ä¸‰è§’å‡½æ•°æ›²çº¿ã€å¤šæ ¸å¿ƒä¸‹çš„å¤„ç†ã€‚å¦‚æœæœ‰å…´è¶£å¯ä»¥ä¸€èµ·åˆ†äº«ä¸€ä¸‹ã€‚","categories":[],"tags":[{"name":"æ“ä½œç³»ç»Ÿ","slug":"æ“ä½œç³»ç»Ÿ","permalink":"https://razertory.me/tags/æ“ä½œç³»ç»Ÿ/"}]},{"title":"å¼€æºé¡¹ç›®ä¹‹ Nginx","slug":"nginx-over-view","date":"2018-10-09T12:51:02.000Z","updated":"2020-05-04T07:14:43.177Z","comments":true,"path":"2018/10/09/nginx-over-view/","link":"","permalink":"https://razertory.me/2018/10/09/nginx-over-view/","excerpt":"","text":"æ­£æ–‡å¼€æºé¡¹ç›®ä¹‹ Nginxnginxï¼ˆè¯»ä½œ â€œengine xâ€ï¼‰æ˜¯ä¸€ä½åå« Igor Sysoev çš„ä¿„ç½—æ–¯è½¯ä»¶å·¥ç¨‹å¸ˆå¼€å‘çš„ã€‚è‡ª 2004 å¹´å‘å¸ƒä»¥æ¥ï¼Œnginx å°±ä¸€ç›´ä¸“æ³¨äºå®ç°é«˜æ€§èƒ½ï¼Œé«˜å¹¶å‘å’Œä½å†…å­˜å ç”¨ã€‚nginx çš„é¢å¤–åŠŸèƒ½ï¼Œæ¯”å¦‚ï¼šè´Ÿè½½å‡è¡¡ã€ç¼“å­˜å’Œæµé‡æ§åˆ¶ä»¥åŠé«˜æ•ˆé›†æˆåœ¨ Web æœåŠ¡ä¸Šçš„èƒ½åŠ›ï¼Œä½¿å¾—å®ƒæˆä¸ºäº†å½“ä»Šç½‘ç«™æ¶æ„çš„å¿…é€‰ã€‚å¦‚ä»Šï¼Œnginx å·²ç»æˆä¸ºäº’è”ç½‘ä¸­ç¬¬äºŒå—æ¬¢è¿çš„å¼€æº Web æœåŠ¡å™¨ã€‚ 14.1 é«˜å¹¶å‘ä¸ºä½•å¦‚æ­¤é‡è¦ï¼Ÿå¦‚ä»Šï¼Œäº’è”ç½‘æ—©å·²æ— å¤„ä¸åœ¨ï¼Œæˆ‘ä»¬å·²ç»å¾ˆéš¾æƒ³è±¡åå¹´å‰æ²¡æœ‰äº’è”ç½‘çš„æ ·å­ã€‚ç°åœ¨çš„äº’è”ç½‘å‘ç”Ÿäº†ç¿»å¤©è¦†åœ°çš„å˜åŒ–ï¼Œä»åŸºäº NSCA çš„å¯ä»¥ç‚¹å‡» HTML é¡µé¢å’ŒåŸºäº Apache çš„ Web æœåŠ¡ï¼Œåˆ°å¦‚ä»Šèƒ½å¤Ÿå®ç°è¶…è¿‡ 20 äº¿äººå®æ—¶çš„æ²Ÿé€šã€‚éšç€ PCã€æ‰‹æœºå’Œå¹³æ¿çš„çš„è”“å»¶ï¼Œäº’è”ç½‘å·²ç»å°†å…¨çƒç»æµæ•°å­—åŒ–ã€‚é¢å‘ä¿¡æ¯å’Œå¨±ä¹çš„åœ¨çº¿æœåŠ¡å˜å¾—æ›´åŠ ä¼˜è´¨ã€‚çº¿ä¸Šå•†ä¸šæ´»åŠ¨çš„å®‰å…¨æ–¹é¢ä¹Ÿå‘ç”Ÿäº†æ˜æ˜¾å˜åŒ–ã€‚å› æ­¤ï¼Œç½‘ç«™ä¹Ÿæ¯”ä»¥å‰æ›´åŠ çš„å¤æ‚å¹¶ä¸”éœ€è¦å¤§é‡çš„å·¥ç¨‹æŠ•å…¥æ¥ç¡®ä¿é²æ£’æ€§å’Œå¯æ‰©å±•æ€§ã€‚ å¹¶å‘æ€§æˆä¸ºäº†ç½‘ç«™æ¶æ„è®¾è®¡çš„æœ€å¤§æŒ‘æˆ˜ä¹‹ä¸€ã€‚è‡ªä» web æœåŠ¡å¼€å§‹çš„æ—¶å€™ï¼Œå¹¶å‘æ€§çš„ç­‰çº§å°±åœ¨æŒç»­ä¸Šå‡ã€‚å¯¹äºä¸€ä¸ªçƒ­é—¨ç½‘ç«™æ¥è¯´ï¼Œæ”¯æŒå‡ ç™¾ç”šè‡³æ˜¯å‡ ç™¾ä¸‡ç”¨æˆ·åŒæ—¶è®¿é—®æ¥è¯´ä¹Ÿä¸æ˜¯ä»€ä¹ˆç¨€ç½•äº‹æƒ…ã€‚20 å¹´å‰ï¼Œäº§ç”Ÿå¹¶å‘çš„åŸå› ä¸»è¦è¿˜æ˜¯å®¢æˆ·ç«¯çš„ ADSL æˆ–è€…æ‹¨å·ï¼ˆdial-upï¼‰è¿æ¥ã€‚å¦‚ä»Šï¼Œå¹¶å‘çš„äº§ç”Ÿæ¥æºäºæ‰‹æœºç«¯å’Œä»¥åŠæ–°å‹çš„åº”ç”¨æ¶æ„ï¼Œè¿™äº›æ¶æ„ä¸»è¦å¯ä»¥æ”¯æŒé•¿è¿æ¥æ¥æä¾›æ–°é—»ã€ä¿¡æ¯æµå‘å¸ƒå’Œæœ‹å‹é—´çš„ feed æµç­‰ç­‰ã€‚å¦ä¸€æ–¹é¢ï¼Œå¯¼è‡´é«˜å¹¶å‘è¿˜ç”±äºç°ä»£æµè§ˆå™¨çš„å·¥ä½œå‘ç”Ÿå˜åŒ–ï¼Œé€šå¸¸æ˜¯ä¸ºäº†æé«˜ç½‘é¡µåŠ è½½é€Ÿåº¦åŒæ—¶æ‰“å¼€ 4 åˆ° 6 ä¸ªè¿æ¥ã€‚ ä¸ºäº†è¡¨è¿°æ¸…æ¥šç¼“æ…¢è¿™ç§é—®é¢˜ï¼Œè®¾æƒ³ä¸€ä¸‹ï¼Œä¸€ä¸ªåŸºäº Apache çš„ï¼Œå¯ä»¥æä¾› 100KB å¤§å°å¸¦æœ‰æ–‡å­—æˆ–è€…å›¾ç‰‡çš„ç®€å• web æœåŠ¡å™¨ã€‚ç”Ÿæˆæˆ–è€…é‡æ–°äº§ç”Ÿè¿™ä¸ªç½‘é¡µåªéœ€è¦æå°‘ä¸åˆ°ä¸€ç§’çš„æ—¶é—´ã€‚ä½†æ˜¯åœ¨å¸¦å®½åªæœ‰ 80kps çš„æƒ…å†µä¸‹ï¼ˆä¸‹è½½é€Ÿåº¦ 10kb/sï¼‰ï¼Œä¼ è¾“æ•°æ®åˆ°å®¢æˆ·ç«¯å´ä¼šèŠ±æ‰ 10sã€‚æœ¬è´¨ä¸Šï¼ŒæœåŠ¡å™¨äº§ç”Ÿ 100kb æ•°æ®çš„é€Ÿåº¦æ˜¯ç›¸å¯¹è¾ƒå¿«çš„ï¼Œéšååœ¨ä¼ è¾“æ•°æ®åˆ°å®¢æˆ·ç«¯ç›´è‡³é‡Šæ”¾è¿æ¥çš„è¿‡ç¨‹å´æ˜¯ç›¸å¯¹è¾ƒæ…¢çš„ã€‚ç°åœ¨è®¾æƒ³ï¼Œä½ åŒæ—¶æœ‰ 1,000 ä¸ªç‹¬ç«‹çš„å®¢æˆ·ç«¯è¿åˆ°ä½ çš„æœåŠ¡å™¨å¹¶ä¸”è¯·æ±‚åŒæ ·çš„å†…å®¹ã€‚å¦‚æœå¯¹äºæ¯ä¸ªç‹¬ç«‹çš„è¿æ¥ï¼Œéƒ½ä¼šå ç”¨é¢å¤–çš„ 1MB å†…å­˜ï¼Œé‚£ä¹ˆå¯¹äº 1,000 ä¸ªè¿æ¥æ¥è¯´å°±å¯¹å¯¼è‡´å¤šå ç”¨ 1000 MBï¼ˆ1Gï¼‰çš„å†…å­˜ï¼Œè€Œè¿™äº›ä»…ä»…æ˜¯ä¸ºäº†ç»™ 1000 ä¸ªå®¢æˆ·ç«¯æä¾› 100kb çš„å†…å®¹ã€‚å®é™…ä¸Šï¼Œä¸€ä¸ªå…¸å‹çš„ Apache æœåŠ¡å™¨é€šå¸¸ä¼šä¸ºäº†ä¸€ä¸ªè¿æ¥å ç”¨è¶…è¿‡ 1MB çš„å†…å­˜ï¼Œé—æ†¾çš„æ˜¯å‡ å k çš„å¸¦å®½è¶³å¤Ÿè®©æ‰‹æœºä¹‹é—´é«˜æ•ˆé€šè®¯ã€‚å°½ç®¡ä»æŸç§ç¨‹åº¦è€Œè¨€ï¼Œå‘é€æ•°æ®ç»™å®¢æˆ·ç«¯æ˜¯æ…¢çš„ï¼Œæé«˜æ“ä½œç³»ç»Ÿå†…æ ¸çš„ socket ç¼“å†²å¤§å°æ˜¯å¯ä»¥çš„ï¼Œè¿™ä¸ªä¸æ˜¯ä¸€ä¸ªé€šå¸¸çš„è§£å†³æ–¹æ³•ï¼Œå¹¶ä¸”ä¼šæœ‰ä¸è‰¯å½±å“ã€‚ åœ¨æŒä¹…è¿æ¥ä¸­ï¼Œå¤„ç†å¹¶å‘ä¼šåšèµ·æ¥æ€»æ¯”è¯´èµ·æ¥æœ‰æ›´å¤šçš„é—®é¢˜ï¼Œå› ä¸ºè¦åœ¨æ–°å»º HTTP è¿æ¥çš„æ—¶å€™é¿å…å»¶è¿Ÿï¼Œè®©å®¢æˆ·ç«¯ä¿æŒè¿æ¥å¹¶ä¸”ç¡®ä¿å¯¹äºæ¯ä¸ªè¿æ¥æœåŠ¡ç«¯éƒ½èƒ½å¤Ÿä¿è¯æœ‰è¶³å¤Ÿå†…å­˜å¯ä¾›ä½¿ç”¨ã€‚ å› æ­¤ï¼Œä¸ºäº†èƒ½å¤Ÿå¤„ç†å› ä¸ºç”¨æˆ·é‡å¢é•¿äº§ç”Ÿé«˜å¹¶å‘ç”±æ­¤å¸¦æ¥çš„è´Ÿè½½ä¸Šå‡ï¼Œç½‘ç«™çš„å°±å¿…é¡»åŸºäºé€šè¿‡ä¸€å®šæ•°ç›®çš„é«˜æ•ˆæ¨¡å—æ¥æ¶è®¾ã€‚åŒæ—¶ï¼Œåœ¨ä»è·å¾—å®¢æˆ·ç«¯è¿æ¥è¯·æ±‚ï¼Œåˆ°å¤„ç†å®Œè¯·æ±‚æœŸé—´ï¼Œåƒç¡¬ä»¶ï¼ˆCPUï¼Œmemoryï¼Œdiskï¼‰ï¼Œç½‘ç»œå®¹é‡ä»¥åŠæ•°æ®å­˜å‚¨ä¹Ÿæ˜¯åŒæ ·é‡è¦çš„ã€‚å› æ­¤ï¼Œweb æœåŠ¡å™¨éœ€è¦èƒ½åœ¨åŒæ—¶è¯·æ±‚æ•°å’Œæ¯ç§’è¯·æ±‚é¢‘ç‡è¿™ä¸¤æ–¹é¢éƒ½æ‹¥æœ‰æ‰©å±•æ€§ã€‚ Apache ä¸åˆé€‚å—ï¼ŸApacheï¼Œå¼€å§‹äº 1990sï¼Œå¦‚ä»Šä¾æ—§ç»Ÿæ²»ç€äº’è”ç½‘ã€‚æœ€åˆå®ƒçš„æ¶æ„æ»¡è¶³äºå½“æ—¶çš„æ“ä½œç³»ç»Ÿå’Œç¡¬ä»¶ï¼ŒåŒæ—¶ä¹Ÿæ»¡è¶³äºå½“æ—¶çš„åªæœ‰ä¸€ä¸ªç‹¬ç«‹çš„ç‰©ç†æœºè¿è¡Œä¸€ä¸ª Apache æœåŠ¡å™¨çš„äº’è”ç½‘çŠ¶æ€ã€‚åœ¨ 2000 å¹´å§‹ï¼Œä¸€ä¸ªç‹¬ç«‹çš„æœåŠ¡å™¨éš¾ä»¥æ»¡è¶³å¢é•¿èµ·æ¥çš„ Web æœåŠ¡çš„æƒ…å†µè¶Šæ¥è¶Šæ˜æ˜¾ã€‚å°½ç®¡ Apache æä¾›äº†ä¸€ä¸ªå¯é çš„åŸºé‡‘ä¼šç”¨äºæœªæ¥å‘å±•ï¼Œç„¶è€Œï¼Œå®ƒè¿™ç§ä¸ºäº†æ¯ä¸ªæ–°è¿æ¥å¤åˆ¶è‡ªèº«çš„æ¶æ„ï¼Œå·²ç»ä¸å†é€‚ç”¨äºéçº¿æ€§çš„ç½‘ç«™æ‰©å¼ ã€‚æœ€ç»ˆï¼ŒApache æˆä¸ºäº†ä¸€ä¸ªæœ‰ç€è®¸å¤šä¸åŒç‰¹æ€§ï¼Œç¬¬ä¸‰æ–¹æ‰©å±•ï¼Œå’Œä¸€äº›æ™®éç”¨äº web åº”ç”¨å¼€å‘çš„åŠŸèƒ½çš„ web æœåŠ¡å™¨ã€‚ç„¶è€Œï¼Œæ²¡æœ‰ä»€ä¹ˆä¸œè¥¿æ˜¯åå…¨åç¾çš„ï¼ŒApache æœ‰è€…ä¸°å¯ŒåŠŸèƒ½çš„åŒæ—¶ï¼Œå¯¹äºæ¯ä¸ªè¿æ¥äº§ç”Ÿçš„ CPU å’Œå†…å­˜æ¶ˆè€—ä½¿å¾—å®ƒä¸èƒ½å¾ˆå¥½çš„æ‰©å±•ã€‚ å› æ­¤ï¼Œå½“æœåŠ¡å™¨çš„ç¡¬ä»¶ã€æ“ä½œç³»ç»Ÿå’Œç½‘ç»œæ¡ä»¶æˆä¸ºäº†ç½‘ç«™å¢é•¿çš„ç“¶é¢ˆæ—¶ï¼Œå…¨ä¸–ç•Œçš„ web å·¥ç¨‹å¸ˆå¼€å§‹å¯»æ‰¾ä¸€ç§æ›´åŠ é«˜æ•ˆçš„æ–¹æ³•ã€‚å¤§çº¦åå¹´å‰ï¼Œä¸€ä½åå« Daniel Kegel çš„æ°å‡ºå·¥ç¨‹å¸ˆå®£ç§°ï¼šâ€æ˜¯æ—¶å€™è®© web æœåŠ¡èƒ½å¤Ÿæ”¯æŒ 10k å¹¶å‘äº†ã€‚â€ åŒæ—¶ä»–è¿˜é¢„æµ‹äº†æˆ‘ä»¬ç°åœ¨ä¼šå«äº’è”ç½‘äº‘æœåŠ¡ã€‚c10k é—®é¢˜ä¸€äº§ç”Ÿï¼Œå°±å¼•æ¥äº†è®¸è®¸å¤šå¤šçš„è§£å†³æ–¹æ¡ˆç”¨ä»¥ä¼˜åŒ–å®æ—¶çš„é«˜å¹¶å‘ã€‚nginx æˆä¸ºäº†å…¶ä¸­æœ€å‡ºè‰²çš„è§£å†³æ–¹æ¡ˆä¹‹ä¸€ã€‚ ä¸ºäº†è§£å†³ C10k é—®é¢˜ä¸­çš„ 10,000 ä¸ªå®æ—¶çš„è¿æ¥ï¼Œnginx ç”¨äº†ä¸€ç§ä¸ä¼—ä¸åŒçš„æ¶æ„ï¼Œè¿™ç§æ¶æ„ä¼šæ›´é€‚åˆåœ¨åŒæ—¶å¤„ç†å¤§é‡çš„è¿æ¥å’Œä¸€ç§’é’Ÿå†…å®Œæˆå¤šæ¬¡è¯·æ±‚ç¯å¢ƒä¸­ï¼Œé—®é¢˜è§„æ¨¡çš„å¢é•¿æ˜¯éçº¿æ€§çš„ã€‚nginx æ˜¯äº‹ä»¶é©±åŠ¨çš„ï¼ˆevent-basedï¼Œæ‰€ä»¥å®ƒä¸ä¼šç”¨ Apache çš„é‚£ç§ä¸ºæ¯ä¸€ä¸ª web è¯·æ±‚éƒ½ç”³è¯·ä¸€ä¸ªè¿›ç¨‹æˆ–è€…çº¿ç¨‹ã€‚ç»“æœä¾¿æ˜¯ï¼Œå³ä½¿è´Ÿè½½å‡é«˜ï¼Œå†…å­˜å’Œ CPU éƒ½è¿˜æ˜¯å¤„äºæŒæ§ä¹‹ä¸­ã€‚nginx ç›®å‰å¯ä»¥åœ¨ä¸€å°æ™®é€šçš„æœºå™¨ä¸Šï¼ŒåŒæ—¶å¤„ç†ä¸Šä¸‡çš„å¹¶å‘ã€‚ nginx çš„ç¬¬ä¸€ä¸ªç‰ˆæœ¬ä¸»è¦æ˜¯å’Œ Apache æœåŠ¡å™¨ä¸€èµ·éƒ¨ç½²ï¼Œç”¨æ¥å•ç‹¬å¤„ç†åŸæœ¬æ˜¯ Apache å¤„ç†çš„ HTML, CSS, JavaScript å’Œå›¾ç‰‡è¿™æ ·çš„é™æ€èµ„æºã€‚åœ¨éšåçš„è¿­ä»£ä¸­ï¼Œnginx æ”¯æŒåƒ FastCGI, ï¼Œuswgi æˆ–è€… SCGI åè®®é›†æˆåˆ°åº”ç”¨å½“ä¸­éƒ¨ç½²ï¼Œå¹¶ä¸”å¯ä»¥åˆ©ç”¨åƒ memcached è¿™æ ·çš„åˆ†å¸ƒå¼ç¼“å­˜ç³»ç»Ÿã€‚åŒæ—¶åƒåå‘ä»£ç†ï¼Œè´Ÿè½½å‡è¡¡è¿™æ ·çš„ç‰¹æ€§ä¹Ÿéšä¹‹åŠ ä¸Šã€‚è¿™äº›é¢å¤–çš„ç‰¹ç‚¹è®© nginx æˆä¸ºäº†æ„å»ºå¯æ‰©å±•æ€§ web æœåŠ¡çš„é«˜æ•ˆçš„åŸºç¡€ç»„ä»¶çš„å·¥å…·ä¹‹ä¸€ã€‚ 2012 å¹´äºŒæœˆï¼ŒApache 2.4.x åˆ†æ”¯å‘å¸ƒã€‚å°½ç®¡ï¼Œè¿™ä¸ªæœ€æ–°ç‰ˆæœ¬çš„ Apache å¢åŠ äº†å¤šæ ¸å¤„ç†å™¨æ”¯æŒæ¨¡å—å’Œç”¨äºæå‡å¯æ‰©å±•æ€§å’Œå¹¶å‘çš„æ¨¡å—ï¼Œç„¶è€Œå®ƒçš„æ€§èƒ½ï¼Œå¹¶å‘èƒ½åŠ›ï¼Œä»¥åŠèµ„æºåˆ©ç”¨èƒ½åŠ›ä¸çº¯äº‹ä»¶é©±åŠ¨çš„ web æœåŠ¡å™¨æ¯”ï¼Œä¾æ—§éš¾ä»¥æœ›å…¶é¡¹èƒŒã€‚ å¾ˆä¹æ„çœ‹åˆ°æ–°ç‰ˆçš„ Apache æœåŠ¡å™¨æœ‰ç€æ›´å¥½çš„å¯æ‰©å±•æ€§ï¼Œå°½ç®¡è¿™æ ·å¯ä»¥å‡å°‘è‡ªèº«çš„ç“¶é¢ˆï¼Œç„¶è€Œåƒå…¸å‹çš„ nginx-plus-Apache é…ç½®ä¾æ—§ä¼šè¢«ä½¿ç”¨ã€‚ ä½¿ç”¨ nginx ä¼šæœ‰æ›´å¤šçš„ä¼˜åŠ¿å—ï¼Ÿèƒ½å¤Ÿé«˜æ€§èƒ½åœ°å¤„ç†é«˜å¹¶å‘ä¸€ç›´æ˜¯éƒ¨ç½²äº† nginx ä¹‹åè·å¾—çš„æœ€ä¸»è¦çš„å¥½å¤„ã€‚ç„¶è€Œï¼Œè¿˜æœ‰ä¸€äº›æ›´æœ‰è¶£çš„ä¸œè¥¿ã€‚ åœ¨è¿‡å»å‡ å¹´ä¸­ï¼Œç½‘ç«™æ¶æ„å°±ä¸€ç›´åœ¨æ‹¥æŠ±è§£è€¦å¹¶ä» web æœåŠ¡å™¨ä¸­æ‹†åˆ†å‡ºä¸€äº›åŸºç¡€ç»„ä»¶ã€‚ç„¶è€Œï¼Œé‚£äº›åŸæœ¬å­˜åœ¨äº LAMP-based çš„ç½‘ç«™ä¸­çš„åŸºç¡€ç»„ä»¶ï¼Œåœ¨ LEMP-basedï¼ˆE ä»£è¡¨ç€ Nginx çš„è¯»éŸ³ï¼‰ çš„ç½‘ç«™ä¸­ï¼Œå´èƒ½è®© web æœåŠ¡å™¨æˆä¸ºåŸºç¡€ç»„ä»¶ä»¥åŠç”¨ä¸€ç§ä¸åŒçš„æ–¹å¼å»é›†æˆç›¸åŒçš„æˆ–è€…æ”¹è¿›äº†çš„åº”ç”¨å’Œæ•°æ®åº“å·¥å…·ã€‚ nginx éå¸¸é€‚åˆåšè¿™ä¸ªï¼Œå› ä¸ºå®ƒå¯ä»¥æ–¹ä¾¿æä¾›ä¸€ä¸ªå¹¶å‘æ”¯æŒï¼Œå»¶è¿Ÿè¶…æ—¶å¤„ç†ï¼ŒSSL æ”¯æŒï¼Œé™æ€æ–‡ä»¶æ”¯æŒï¼Œå‹ç¼©å’Œç¼“å­˜ï¼Œç”šè‡³æ˜¯ http æµåª’ä½“çš„é«˜æ•ˆçš„å±‚çº§ï¼Œè€Œè¿™äº›åŠŸèƒ½åŸæœ¬å¤„äºåº”ç”¨å±‚ã€‚nginx ä¹Ÿå¯ä»¥ç›´æ¥é›†æˆä¸€äº›åƒ Redis/memcached è¿™æ ·çš„ NoSQL ç”¨ä»¥ä¼˜åŒ–å¤§ç”¨æˆ·é‡åœºæ™¯ã€‚ å½“è¿‘ä»£çš„å¼€å‘è¯­è¨€å’Œå·¥å…·æµè¡Œèµ·æ¥çš„æ—¶å€™ï¼Œè¶Šæ¥è¶Šå¤šçš„å…¬å¸æ­£åœ¨æ”¹å˜ä»–ä»¬çš„å¼€å‘å’Œéƒ¨ç½²æ–¹å¼ã€‚nginx æˆä¸ºäº†æ”¹å˜è¿‡ç¨‹ä¸­æœ€é‡è¦çš„éƒ¨åˆ†ï¼ŒåŒæ—¶ï¼Œnginx è®©å¾ˆå¤šå…¬å¸åœ¨æœ‰é™çš„é¢„ç®—ä¸­ï¼Œå¿«é€Ÿåœ°å¯åŠ¨å¼€å‘ä»–ä»¬çš„æœåŠ¡ã€‚ nginx æ˜¯ä» 2002 å¹´å¼€å§‹å¼€å‘ã€‚åˆ° 2004 å¹´ï¼Œå®ƒä»¥ two-clause BSD license å‘å¸ƒã€‚éšåï¼Œnginx ç”¨æˆ·é‡å¼€å§‹å¢é«˜ï¼Œä¿®æ”¹å»ºè®®ï¼Œbug æŠ¥å‘Šï¼Œè§‚å¯ŸæŠ¥å‘Šç­‰éƒ½åœ¨ç¤¾åŒºä¸­ä¸æ–­å®Œå–„ ngixã€‚ nginx æœ€åˆçš„æºç æ˜¯ç”¨ C å®Œæˆçš„ã€‚nginx å·²ç»å¯ä»¥éƒ¨ç½²åœ¨è®¸å¤šæ¶æ„å’Œæ“ä½œç³»ç»Ÿä¸­ï¼Œæ¯”å¦‚ Linux, FreeBSD, Solaris, Mac OS X, AIX and Microsoft Windowsã€‚nginx æ‹¥æœ‰è‡ªå·±çš„åº“å¹¶ä¸”å¹¶æ²¡æœ‰å¤§é‡ä½¿ç”¨ C æ ‡å‡†åº“ï¼Œä¸€äº›åƒ zlib, PCRE and OpenSSL è¿™ä¸€ç±»çš„åº“å› ä¸ºæœ‰è¯ä¹¦å†²çªè€Œæ²¡æœ‰è¢«é‡‡ç”¨ã€‚ åœ¨ Windows ä¸Šéƒ¨ç½² nginx æ›´åƒæ˜¯ä¸€ä¸ªå®ç° nginx çš„ç†è®ºè¯æ˜è€Œä¸æ˜¯ä¸€ä¸ªåŠŸèƒ½å®Œå–„çš„é¡¹ç›®ã€‚ç”±äºå†…æ ¸é™åˆ¶ï¼Œnginx çš„ä¸€äº›åŠŸèƒ½ç‰¹æ€§å¹¶ä¸èƒ½å‘æŒ¥å‡ºæ¥ã€‚åœ¨ windows ä¸Šçš„ nginx å¹¶å‘èƒ½åŠ›ã€æ€§èƒ½ä¼šæ›´ä½ï¼Œä¹Ÿæ²¡æœ‰ç¼“å­˜å’Œå¸¦å®½ç­–ç•¥ã€‚å°†æ¥ windows ä¸Šçš„ nginx ç‰ˆæœ¬ä¼šç»§ç»­å®Œå–„ã€‚ 14.2. nginx æ¶æ„æ€»è§ˆä¼ ç»Ÿçš„è§£å†³å¹¶å‘çš„æ–¹å¼æ˜¯æ¯ä¸ªå•ç‹¬çš„è¯·æ±‚ä¸€ä¸ªè¿›ç¨‹æˆ–è€…çº¿ç¨‹ï¼Œå¹¶ä¸”ç½‘ç»œå’Œ io æ“ä½œéƒ½æ˜¯é˜»å¡å¼çš„ã€‚åœ¨ä¼ ç»Ÿçš„åº”ç”¨å½“ä¸­ï¼Œè¿™ç§åšæ³•ä¼šç”±äº CPU å’Œå†…å­˜å¼€é”€å¯¼è‡´ä½æ•ˆã€‚å¼€å¯ä¸€ä¸ªç‹¬ç«‹çš„è¿›ç¨‹æˆ–è€…çº¿ç¨‹ä¼šéœ€è¦é¢„åŠ è½½ä¸€ä¸ªæ–°çš„è¿è¡Œæ—¶ç¯å¢ƒå’Œä¸Šä¸‹æ–‡ã€‚è¿™äº›ä¸œè¥¿ä¹Ÿä¼šå ç”¨ä¸€äº›é¢å¤–çš„ CPU æ—¶é—´ï¼Œçº¿ç¨‹é¢‘ç¹è½®æ¢å¯¼è‡´çš„ä¸Šä¸‹æ–‡åˆ‡æ¢å¸¦æ¥çš„å¼€é”€æœ€ç»ˆå¯¼è‡´äº†ä½æ€§èƒ½ã€‚è¿™äº›é—®é¢˜åœ¨ä¸€äº›æ—§çš„ web æœåŠ¡æ¶æ„ï¼Œæ¯”å¦‚ Apache ä¸­å¾—åˆ°äº†è¯å®ã€‚è¿™æ˜¯åœ¨æä¾›ä¸°å¯Œæ™®éç‰¹æ€§ä¸ä¼˜åŒ–æœåŠ¡å™¨å¼€é”€ä¹‹å‰çš„ä¸€ç§æƒè¡¡ã€‚ ä»æœ€æ—©å¼€å§‹ï¼Œnginx å°±è¢«è®¾å®šä¸ºåœ¨ç½‘ç«™ç”¨æˆ·åŠ¨æ€å¢é•¿æœŸé—´ï¼Œç”¨æ¥æé«˜ç½‘ç«™æ€§èƒ½å’ŒæœåŠ¡å™¨èµ„æºåˆ©ç”¨ç‡çš„å·¥å…·ï¼Œä»¥è‡³äºå®ƒæ‹¥æœ‰ä¸€ç§ä¸ä¼—ä¸åŒçš„æ¨¡å‹ã€‚è¿™æ˜¯å—ä¸€äº›æ“ä½œç³»ç»Ÿçš„äº‹ä»¶é©±åŠ¨æ¦‚å¿µå¯å‘ã€‚è¿™ä¹Ÿäº§ç”Ÿäº† nginx çš„æ ¸å¿ƒæ¶æ„ï¼šæ¨¡å—åŒ–ï¼Œäº‹ä»¶é©±åŠ¨ï¼Œå¼‚æ­¥ï¼Œå•çº¿ç¨‹ï¼Œéé˜»å¡ã€‚ nginx å¤§é‡é‡‡ç”¨å¤šè·¯å¤ç”¨ï¼ˆmultiplexï¼‰å’Œäº‹ä»¶é€šçŸ¥ï¼Œå¹¶å¯¹æ¯ä¸ª nginx è¿›ç¨‹åˆ†é…äº†ç‰¹å®šçš„ä»»åŠ¡ã€‚è¿æ¥è¢«æœ‰é™ä¸ªæ•°å•çº¿ç¨‹çš„ worker è¿›ç¨‹é«˜æ•ˆè½®è¯¢ï¼ˆrun-loopï¼‰å¤„ç†ã€‚ æ¯ä¸ª worker éƒ½å¯ä»¥åŒæ—¶å¤„ç†æ•°åƒä¸ªå¹¶å‘è¿æ¥å’Œæ¯ç§’è¯·æ±‚ã€‚ Code Structure ä»£ç ç»“æ„worker ä»£ç åŒ…å«äº†æ ¸å¿ƒå’ŒåŠŸèƒ½æ¨¡å—ã€‚nginx æ ¸å¿ƒè´Ÿè´£ç»´æŠ¤ä¸€ä¸ªç´§å‡‘çš„è½®è¯¢ï¼Œå¹¶åœ¨å¤„ç†è¯·æ±‚çš„æ¯ä¸ªé˜¶æ®µéƒ½æ‰§è¡Œæ¨¡å—ä¸­å¯¹åº”çš„éƒ¨åˆ†ã€‚æ¨¡å—æ„æˆäº†å¤§éƒ¨åˆ†è¡¨ç¤ºå±‚å’Œåº”ç”¨å±‚åŠŸèƒ½ã€‚æ¨¡å—ä»ç½‘ç»œå’Œå­˜å‚¨ä»‹è´¨ä¸­è¿›è¡Œæ•°æ®çš„è¯»å†™ï¼Œä¼ è¾“å†…å®¹ï¼Œè¿‡æ»¤å‡ºç«™å†…å®¹ï¼Œæ‰§è¡ŒæœåŠ¡ç«¯çš„åŠ¨ä½œå’Œå½“ä»£ç†åŠŸèƒ½è¢«æ‰“å¼€çš„æ—¶å€™ä¼ é€’è¯·æ±‚åˆ°è¢«ä»£ç†çš„ï¼ˆupstreamï¼‰æœåŠ¡å™¨ã€‚ nginx æ¨¡å—åŒ–çš„æ¶æ„å¯ä»¥è®©å¼€å‘è€…åœ¨ä¸ä¿®æ”¹æ ¸å¿ƒä»£ç çš„æƒ…å†µä¸‹åŠ å…¥ä¸€äº›è‡ªå®šä¹Ÿçš„æ‰©å±•ã€‚nginx æ¨¡å—ç¨å¾®æœ‰ç‚¹ä¸åŒï¼Œæ¯”å¦‚æ ¸å¿ƒæ¨¡å—ã€äº‹ä»¶æ¨¡å—ã€é˜¶æ®µå¤„ç†å™¨ã€åè®®ã€å˜é‡å¤„ç†å™¨ã€filterï¼Œupstream å’Œè´Ÿè½½å‡è¡¡ã€‚ç›®å‰ï¼Œnginx ä¸å†æ”¯æŒåŠ¨æ€åŠ è½½æ¨¡å—ã€‚æ¨¡å—åœ¨ nginx build é˜¶æ®µå°±ä¼šè¢«ç¼–è¯‘ã€‚ç„¶è€Œï¼Œåœ¨å°†æ¥ nginx ä¼šåœ¨ä¸»ç‰ˆæœ¬ä¸Šæä¾› loadable æ¨¡å—å’Œ ABIã€‚æ›´å¤šå…³äºä¸åŒæ¨¡å—çš„ä¿¡æ¯è¯¦è§ Section 14.4. åœ¨å¤„ç†ä¸€äº›å…³äºç½‘ç»œæ¥æ”¶ï¼Œå¤„ç†å’Œç®¡ç†ä»¥åŠå†…å®¹æ£€ç´¢çš„æ—¶å€™ï¼Œnginx ä½¿ç”¨äº†äº‹ä»¶é€šçŸ¥ï¼ˆevent notificationï¼‰æœºåˆ¶ä»¥åŠä¸€äº›æ“ä½œç³»ç»Ÿï¼ˆ Linux, Solaris and BSD-basedï¼‰çš„ç£ç›˜ IO ä¼˜åŒ–ï¼Œæ¯”å¦‚ï¼škqueue, epoll, and event portsã€‚ç›®çš„æ˜¯ä¸ºæ“ä½œç³»ç»Ÿæä¾›å°½å¯èƒ½å¤šçš„æç¤ºï¼Œä»¥ä¾¿ä¸ºå…¥ç«™å’Œå‡ºç«™æµé‡ã€ç£ç›˜æ“ä½œã€socket è¯»å†™ã€è¶…æ—¶ç­‰è·å–åŠæ—¶çš„å¼‚æ­¥åé¦ˆã€‚é’ˆå¯¹ nginx è¿è¡Œçš„æ¯ä¸ª unix-like çš„æ“ä½œç³»ç»Ÿï¼Œå¯¹å¤šè·¯å¤ç”¨å’Œé«˜çº§ I/O æ“ä½œä½¿ç”¨ä¸åŒçš„æ–¹æ³•è¿›è¡Œäº†å¤§é‡ä¼˜åŒ–ã€‚ æ›´å¤š nginx æ¶æ„é«˜çº§æ¦‚è¿°è¯¦è§ Figure 14.1. Figure 14.1: Diagram of nginxâ€™s architecture Workers çš„æ¨¡å‹æ­£å¦‚ä¹‹å‰æåˆ°çš„ï¼Œnginx å¹¶ä¸ä¸ºæ¯ä¸ªè¿æ¥å¼€ä¸€ä¸ªè¿›ç¨‹æˆ–è€…çº¿ç¨‹ã€‚ç›¸åï¼Œworker è¿›ç¨‹ä¸ºæ¯ä¸ªæ–°è¿æ¥éƒ½é‡‡ç”¨ä¸€ä¸ªå…±ç”¨çš„ç›‘å¬ socket å¹¶åœ¨è½®è¯¢ä¸­é«˜æ•ˆå¤„ç†ç€æ•°åƒä¸ªè¿æ¥ã€‚å¯¹äº nginx çš„ workerï¼Œæ²¡æœ‰é‡‡ç”¨ä¸€äº›ç‰¹åˆ«çš„è¿æ¥æœºåˆ¶ï¼Œéƒ½æ˜¯ç”±æ“ä½œç³»ç»Ÿå†…æ ¸æ¥å®Œæˆçš„ã€‚ä¸€æ—¦å¯åŠ¨ï¼Œä¸€äº›ç›‘å¬ socket å°±ä¼šè¢«åˆ›å»ºã€‚worker å°±ä¼šæŒç»­åœ°æ¥å—è¿æ¥ï¼Œå¤„ç† http è¯·æ±‚å’Œä»å¯¹åº”çš„è¿™äº› socket ä¸­è¯»å†™æ•°æ®ã€‚ è½®è¯¢æ˜¯ nginx ä»£ç ä¸­æœ€å¤æ‚çš„éƒ¨åˆ†ã€‚å®ƒåŒ…æ‹¬äº†ç»¼åˆï¼ˆcomprehensiveï¼‰çš„å†…éƒ¨è°ƒç”¨å’Œä¾èµ–å¤§é‡çš„å¼‚æ­¥ä»»åŠ¡å¤„ç†æ€æƒ³ã€‚å¼‚æ­¥æ“ä½œé€šè¿‡æ¨¡å—åŒ–ï¼Œäº‹ä»¶é€šçŸ¥ï¼Œå‡½æ•°å›è°ƒå’Œè®¡æ—¶å™¨å®ç°ã€‚æ€»ä½“ä¸Šï¼Œå…³é”®åœ¨äºå°½å¯èƒ½çš„éé˜»å¡ã€‚å”¯ä¸€è®© nginx worker é˜»å¡çš„åªæœ‰ç£ç›˜ä¸è¶³çš„æƒ…å†µã€‚ å› ä¸º nginx ä¸ä¼šä¸ºæ¯ä¸ªè¿æ¥æ–°å¼€è¿›ç¨‹æˆ–è€…çº¿ç¨‹ï¼Œå†…å­˜å ç”¨åœ¨å¾ˆå¤šåœºæ™¯ä¸‹éƒ½ä¸ä¼šé«˜ã€‚nginx èŠ‚çº¦äº† cpu å ç”¨ä¹Ÿæ˜¯å› ä¸ºæ²¡æœ‰è¿›ç¨‹çº¿ç¨‹çš„åˆ›å»ºå’Œé”€æ¯ã€‚nginx è¦åšçš„å°±æ˜¯æ£€æŸ¥ç½‘ç»œå’Œå­˜å‚¨ï¼Œåˆ›å»ºæ–°è¿æ¥ï¼ŒæŠŠæ–°è¿æ¥åŠ å…¥åˆ°è½®è¯¢ï¼Œå¹¶ä¸”åœ¨å®Œæˆä¹‹å‰éƒ½å¼‚æ­¥å¤„ç†ã€‚nginx è°¨æ…é‡‡ç”¨äº†ä¸€äº›ç³»ç»Ÿè°ƒç”¨æ¯”å¦‚èµ„æºæ± åŒ–å’Œå†…å­˜åˆ†é…ï¼Œä»¥è‡³äºåœ¨æç«¯çš„æƒ…å†µä¸‹ä¹Ÿä¸ä¼šæœ‰å¾ˆé«˜çš„ CPU å ç”¨ã€‚ ç”±äº nginx å¤„ç†è¿æ¥å°±å¼€äº†å‡ ä¸ª workerï¼Œåœ¨å¤šæ ¸æƒ…å†µä¸‹å¯ä»¥å¾ˆå¥½çš„æ‰©å±•ã€‚å¤§è‡´å°±æ˜¯ä¸€ä¸ªæ ¸å¿ƒä¸€ä¸ª workerï¼Œè¿™æ ·æ¯ä¸ª worker å……åˆ†åˆ©ç”¨ cpu æ ¸å¿ƒï¼Œé¿å…äº†çº¿ç¨‹åˆ‡æ¢å’Œé”ç­‰å¾…ã€‚ä¸ä¼šäº§ç”Ÿèµ„æºä¸è¶³å¹¶ä¸”æ¯ä¸ªå•çº¿ç¨‹çš„ worker è¿›ç¨‹ä¸­éƒ½å­˜åœ¨èµ„æºç®¡ç†ç­–ç•¥ã€‚è¿™ç§æ¨¡å‹å…è®¸åœ¨ä¸åŒå­˜å‚¨è®¾å¤‡ä¹‹é—´æœ‰æ›´å¥½çš„æ‰©å±•æ€§ï¼Œä¿ƒè¿›ç£ç›˜åˆ©ç”¨å¹¶ä¸”é¿å…äº†ç£ç›˜ IO é˜»å¡ã€‚æ€»çš„æ¥è¯´ï¼ŒæœåŠ¡å™¨èµ„æºåœ¨å¤šä¸ª worker å·¥ä½œçš„æƒ…å†µä¸‹è¢«æ›´é«˜æ•ˆä½¿åˆ©ç”¨äº†ã€‚ å¯¹äºæŸäº›ç£ç›˜ä½¿ç”¨å’Œ CPU è´Ÿè½½æ¨¡å¼ï¼Œåº”è¯¥è°ƒæ•´ nginx worker çš„æ•°é‡ã€‚è¿™äº›è§„åˆ™åœ¨è¿™é‡Œæœ‰ç‚¹åŸºç¡€ï¼Œç³»ç»Ÿç®¡ç†å‘˜åº”è¯¥åŸºäºä»–ä»¬çš„å·¥ä½œè´Ÿè½½å°è¯•ä¸€äº›é…ç½®ã€‚ä¸€èˆ¬å»ºè®®å¦‚ä¸‹ï¼šå¦‚æœè´Ÿè½½æ¨¡å¼æ˜¯ CPU å¯†é›†å‹çš„â€”ä¾‹å¦‚ï¼Œå¤„ç†å¤§é‡ TCP/IPã€æ‰§è¡Œ SSL æˆ–å‹ç¼©ï¼Œnginx worker çš„æ•°é‡åº”è¯¥ä¸ CPU æ ¸å¿ƒçš„æ•°é‡ç›¸åŒ¹é…ï¼›å¦‚æœè´Ÿè½½ä¸»è¦æ˜¯ç£ç›˜ I/O é™åˆ¶ã€‚ä¾‹å¦‚ï¼Œä»å­˜å‚¨ä¸­æä¾›ä¸åŒçš„å†…å®¹ï¼Œæˆ–è€…å¤§é‡çš„åå‘ä»£ç†ï¼Œworkers çš„æ•°é‡å¯èƒ½æ˜¯å†…æ ¸æ•°é‡çš„ 1.5 åˆ° 2 å€ã€‚æœ‰äº›å·¥ç¨‹å¸ˆæ ¹æ®å•ä¸ªå­˜å‚¨å•å…ƒï¼ˆç£ç›˜åˆ†åŒºï¼‰çš„æ•°é‡æ¥é€‰æ‹© workers çš„æ•°é‡ï¼Œè¿™ç§æ–¹æ³•çš„æ•ˆç‡å–å†³äºç£ç›˜å­˜å‚¨çš„ç±»å‹å’Œé…ç½®ã€‚ nginx å¼€å‘äººå‘˜åœ¨å³å°†å‘å¸ƒçš„ç‰ˆæœ¬ä¸­è¦è§£å†³çš„ä¸€ä¸ªä¸»è¦é—®é¢˜æ˜¯å¦‚ä½•é¿å…ç£ç›˜ I/O ä¸Šçš„å¤§éƒ¨åˆ†é˜»å¡ã€‚ç›®å‰ï¼Œå¦‚æœæ²¡æœ‰è¶³å¤Ÿçš„å­˜å‚¨æ€§èƒ½æ¥æœåŠ¡äºç”±ç‰¹å®šçš„ worker ç”Ÿæˆçš„ç£ç›˜æ“ä½œï¼Œé‚£ä¹ˆ worker ä»ç„¶å¯èƒ½é˜»å¡ä»ç£ç›˜è¯»å– / å†™å…¥ã€‚å­˜åœ¨è®¸å¤šæœºåˆ¶å’Œé…ç½®æ–‡ä»¶æŒ‡ä»¤æ¥å‡è½»æ­¤ç±»ç£ç›˜ I/O é˜»å¡åœºæ™¯ã€‚æœ€å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œsendfile å’Œ AIO ç­‰é€‰é¡¹çš„ç»„åˆé€šå¸¸ä¼šä¸ºç£ç›˜æ€§èƒ½å¸¦æ¥å¾ˆå¤§çš„ç©ºé—´ã€‚åº”è¯¥æ ¹æ®æ•°æ®å­˜å‚¨ã€å¯ç”¨çš„å†…å­˜å¤§å°å’Œåº•å±‚å­˜å‚¨ä½“ç³»ç»“æ„æ¥è®¡åˆ’ nginx çš„å®‰è£…ã€‚ ç°æœ‰ worker æ¨¡å‹çš„å¦ä¸€ä¸ªé—®é¢˜æ˜¯å…³äºå†…åµŒè„šæœ¬æ”¯æŒçš„é™åˆ¶ã€‚é¦–å…ˆï¼Œä½¿ç”¨æ ‡å‡†çš„ nginx å‘è¡Œç‰ˆï¼Œåªæ”¯æŒåµŒå…¥ Perl è„šæœ¬ã€‚å¯¹æ­¤æœ‰ä¸€ä¸ªç®€å•çš„è§£é‡Šï¼šå…³é”®é—®é¢˜æ˜¯å†…åµŒè„šæœ¬å¯èƒ½é˜»æ­¢ä»»ä½•æ“ä½œæˆ–æ„å¤–é€€å‡ºã€‚è¿™ä¸¤ç§ç±»å‹çš„è¡Œä¸ºéƒ½ä¼šç«‹å³å¯¼è‡´ worker è¢«æŒ‚èµ·ï¼ŒåŒæ—¶å½±å“æ•°åƒä¸ªè¿æ¥ã€‚éœ€è¦æ›´å¤šçš„å·¥ä½œæ¥è®© nginx çš„åµŒå…¥å¼è„šæœ¬æ›´ç®€å•ã€æ›´å¯é ã€é€‚åˆæ›´å¤šçš„åº”ç”¨ç¨‹åºã€‚ nginx è¿›ç¨‹è§’è‰²nginx åœ¨å†…å­˜ä¸­è¿è¡Œå‡ ä¸ªè¿›ç¨‹ï¼›æœ‰ä¸€ä¸ª master è¿›ç¨‹å’Œå‡ ä¸ª worker è¿›ç¨‹ã€‚è¿˜æœ‰ä¸€äº›ç‰¹æ®Šç”¨é€”çš„è¿›ç¨‹ï¼Œç‰¹åˆ«æ˜¯ç¼“å­˜åŠ è½½å™¨å’Œç¼“å­˜ç®¡ç†å™¨ã€‚ç‰ˆæœ¬ 1.x ä¸­çš„æ‰€æœ‰è¿›ç¨‹éƒ½æ˜¯å•çº¿ç¨‹çš„ã€‚æ‰€æœ‰è¿›ç¨‹ä¸»è¦ä½¿ç”¨å…±äº«å†…å­˜æœºåˆ¶è¿›è¡Œè¿›ç¨‹é—´é€šä¿¡ã€‚ä¸»è¿›ç¨‹ä½œä¸º root ç”¨æˆ·è¿è¡Œã€‚ç¼“å­˜åŠ è½½å™¨ã€ç¼“å­˜ç®¡ç†å™¨å’Œ worker ä½œä¸ºéç‰¹æƒç”¨æˆ·è¿è¡Œã€‚ master è¿›ç¨‹ä¸»è¦æœ‰ä»¥ä¸‹ä»»åŠ¡ è¯»å–å¹¶éªŒè¯é…ç½®æ–‡ä»¶ åˆ›å»ºã€ç»‘å®šå’Œå…³é—­ socket å¯åŠ¨ï¼Œç»ˆæ­¢å’Œç»´æŠ¤é…ç½®å¥½äº†ä¸ªæ•°çš„ worker è¿›ç¨‹ ä¸ä¸­æ–­æƒ…å†µä¸‹é‡æ–°åŠ è½½é…ç½® æ§åˆ¶çƒ­æ›´æ–°ï¼ˆä»äºŒè¿›åˆ¶æ–‡ä»¶å¯åŠ¨å’Œå¿…è¦æƒ…å†µä¸‹å›æ»šï¼‰ æ‰“å¼€æ—¥å¿—æ–‡ä»¶ ç¼–è¯‘å†…åµŒçš„ perl è„šæœ¬ worker è¿›ç¨‹æ¥å—å’Œå¤„ç†æ¥è‡ªå®¢æˆ·æœºçš„è¿æ¥ï¼Œæä¾›åå‘ä»£ç†å’Œè¿‡æ»¤åŠŸèƒ½ï¼Œå¹¶å®Œæˆ nginx èƒ½å¤Ÿåšçš„å‡ ä¹æ‰€æœ‰å…¶ä»–äº‹æƒ…ã€‚å…³äºç›‘è§† nginx å®ä¾‹çš„çŠ¶å†µï¼Œç³»ç»Ÿç®¡ç†å‘˜åº”è¯¥å…³æ³¨ worker è¿›ç¨‹ï¼Œå› ä¸ºä»–ä»¬æ˜¯åæ˜  web æœåŠ¡å™¨å®é™…æ—¥å¸¸æ“ä½œçš„è¿‡ç¨‹ã€‚ ç¼“å­˜åŠ è½½å™¨è¿›ç¨‹è´Ÿè´£æ£€æŸ¥ç£ç›˜ä¸Šçš„ç¼“å­˜é¡¹ï¼Œå¹¶ä½¿ç”¨ç¼“å­˜å…ƒæ•°æ®å¡«å…… nginx çš„å†…å­˜æ•°æ®åº“ã€‚å®é™…ä¸Šï¼Œç¼“å­˜åŠ è½½å™¨å‡†å¤‡ nginx å®ä¾‹æ¥å¤„ç†å·²ç»å­˜å‚¨åœ¨ç£ç›˜ä¸Šçš„æ–‡ä»¶ï¼Œè¿™äº›æ–‡ä»¶ä½äºä¸€ä¸ªç‰¹åˆ«åˆ†é…çš„ç›®å½•ç»“æ„ä¸­ã€‚å®ƒéå†ç›®å½•ï¼Œæ£€æŸ¥ç¼“å­˜å†…å®¹å…ƒæ•°æ®ï¼Œæ›´æ–°å…±äº«å†…å­˜ä¸­çš„ç›¸å…³æ¡ç›®ï¼Œç„¶ååœ¨ä¸€åˆ‡éƒ½å¹²å‡€ä¸”å¯ä»¥ä½¿ç”¨æ—¶é€€å‡ºã€‚ ç¼“å­˜ç®¡ç†å™¨ä¸»è¦è´Ÿè´£ç¼“å­˜è¿‡æœŸå’Œå¤±æ•ˆã€‚åœ¨æ­£å¸¸çš„ nginx æ“ä½œè¿‡ç¨‹ä¸­ï¼Œå®ƒä¿æŒåœ¨å†…å­˜ä¸­ï¼Œåœ¨å¤±è´¥çš„æƒ…å†µä¸‹ç”±ä¸»è¿›ç¨‹é‡æ–°å¯åŠ¨ã€‚ nginx ç¼“å­˜ç®€è§ˆnginx ä¸­çš„ç¼“å­˜æ˜¯ä»¥æ–‡ä»¶ç³»ç»Ÿä¸Šåˆ†å±‚æ•°æ®å­˜å‚¨çš„å½¢å¼å®ç°çš„ã€‚ç¼“å­˜ key æ˜¯å¯é…ç½®çš„ï¼Œå¯ä»¥ä½¿ç”¨ä¸åŒçš„ç‰¹å®šäºè¯·æ±‚çš„å‚æ•°æ¥æ§åˆ¶è¿›å…¥ç¼“å­˜çš„å†…å®¹ã€‚ç¼“å­˜ key å’Œç¼“å­˜å…ƒæ•°æ®å­˜å‚¨åœ¨å…±äº«å†…å­˜æ®µä¸­ï¼Œç¼“å­˜åŠ è½½å™¨ã€ç¼“å­˜ç®¡ç†å™¨å’Œ worker è¿›ç¨‹å¯ä»¥è®¿é—®å…±äº«å†…å­˜æ®µã€‚ç›®å‰ï¼Œé™¤äº†æ“ä½œç³»ç»Ÿçš„è™šæ‹Ÿæ–‡ä»¶ç³»ç»Ÿæœºåˆ¶äº§ç”Ÿçš„ä¼˜åŒ–ä¹‹å¤–ï¼Œæ²¡æœ‰ä»»ä½•æ–‡ä»¶çš„æ˜¯ç¼“å­˜åœ¨å†…å­˜å½“ä¸­ã€‚æ¯ä¸ªç¼“å­˜çš„è¯»å–éƒ½æ”¾åœ¨æ–‡ä»¶ç³»ç»Ÿä¸Šçš„ä¸åŒæ–‡ä»¶ä¸­ã€‚å±‚æ¬¡ç»“æ„ï¼ˆçº§åˆ«å’Œå‘½åç»†èŠ‚ï¼‰æ˜¯é€šè¿‡ nginx é…ç½®æŒ‡ä»¤æ§åˆ¶çš„ã€‚å½“å°†å“åº”å†™å…¥ç¼“å­˜ç›®å½•ç»“æ„æ—¶ï¼Œè·¯å¾„å’Œæ–‡ä»¶çš„åç§°æ¥è‡ªä»£ç† URL çš„ MD5 å€¼ã€‚ åœ¨ç¼“å­˜ä¸­æ”¾ç½®å†…å®¹çš„è¿‡ç¨‹å¦‚ä¸‹ï¼šå½“ nginx ä» upstream æœåŠ¡å™¨è¯»å–å“åº”æ—¶ï¼Œå†…å®¹é¦–å…ˆè¢«å†™å…¥ç¼“å­˜ç›®å½•ç»“æ„ä¹‹å¤–çš„ä¸´æ—¶æ–‡ä»¶ä¸­ã€‚å½“ nginx å®Œæˆå¯¹è¯·æ±‚çš„å¤„ç†åï¼Œå®ƒä¼šé‡å‘½åä¸´æ—¶æ–‡ä»¶å¹¶å°†å…¶ç§»åŠ¨åˆ°ç¼“å­˜ç›®å½•ä¸­ã€‚å¦‚æœç”¨äºä»£ç†çš„ä¸´æ—¶æ–‡ä»¶ç›®å½•ä½äºå¦ä¸€ä¸ªæ–‡ä»¶ç³»ç»Ÿä¸Šï¼Œåˆ™ä¼šå¤åˆ¶è¯¥æ–‡ä»¶ï¼Œå› æ­¤å»ºè®®å°†ä¸´æ—¶ç›®å½•å’Œç¼“å­˜ç›®å½•ä¿å­˜åœ¨åŒä¸€ä¸ªæ–‡ä»¶ç³»ç»Ÿä¸Šã€‚å½“éœ€è¦æ˜¾å¼æ¸…é™¤ç¼“å­˜ç›®å½•ç»“æ„ä¸­çš„æ–‡ä»¶æ—¶ï¼Œä»ç¼“å­˜ç›®å½•ç»“æ„ä¸­åˆ é™¤æ–‡ä»¶ä¹Ÿæ˜¯ç›¸å½“å®‰å…¨çš„ã€‚nginx æœ‰ç¬¬ä¸‰æ–¹çš„æ‰©å±•ï¼Œå¯ä»¥è¿œç¨‹æ§åˆ¶ç¼“å­˜çš„å†…å®¹ï¼Œå¹¶ä¸”è®¡åˆ’äº†æ›´å¤šçš„å·¥ä½œæ¥è®©è¿™ä¸ªåŠŸèƒ½å¯ä»¥é›†æˆåˆ°ä¸»å‘è¡Œç‰ˆä¸­ã€‚ 14.3. nginx é…ç½®nginx çš„é…ç½®ç³»ç»Ÿå—åˆ°äº† Igor Sysoev ä½¿ç”¨ Apache çš„ç»éªŒçš„å¯å‘ã€‚ä»–çš„ä¸»è¦è§‚ç‚¹æ˜¯ï¼Œå¯¹äº web æœåŠ¡å™¨æ¥è¯´ï¼Œå¯ä¼¸ç¼©çš„é…ç½®ç³»ç»Ÿæ˜¯å¿…ä¸å¯å°‘çš„ã€‚å½“ä½¿ç”¨å¤§é‡è™šæ‹ŸæœåŠ¡å™¨ã€ç›®å½•ã€ä½ç½®å’Œæ•°æ®é›†ç»´æŠ¤å¤§å‹å¤æ‚é…ç½®æ—¶ï¼Œä¼šé‡åˆ°æ‰©å±•é—®é¢˜ã€‚åœ¨ä¸€ä¸ªç›¸å¯¹è¾ƒå¤§çš„ web è®¾ç½®ä¸­ï¼Œå¦‚æœåœ¨åº”ç”¨ç¨‹åºå’Œç³»ç»Ÿå·¥ç¨‹å¸ˆéƒ½æ²¡æœ‰æ­£ç¡®åœ°å®Œæˆï¼Œé‚£ä¹ˆå®ƒå¯èƒ½æ˜¯ä¸€ä¸ªå™©æ¢¦ã€‚ å› æ­¤ï¼Œnginx é…ç½®çš„ç›®çš„æ˜¯ç®€åŒ–æ—¥å¸¸æ“ä½œï¼Œå¹¶æä¾›è¿›ä¸€æ­¥æ‰©å±• web æœåŠ¡å™¨é…ç½®çš„ç®€å•æ–¹æ³•ã€‚ nginx çš„é…ç½®ä¿å­˜åœ¨è®¸å¤šçº¯æ–‡æœ¬æ–‡ä»¶ä¸­ï¼Œè¿™äº›æ–‡ä»¶é€šå¸¸ä½äº /usr/local/etc/nginx æˆ– /etc/nginxã€‚ä¸»é…ç½®æ–‡ä»¶é€šå¸¸ç§°ä¸º nginx.confã€‚ä¸ºäº†ä¿æŒå®ƒçš„æ•´æ´ï¼Œéƒ¨åˆ†é…ç½®å¯ä»¥æ”¾åœ¨å•ç‹¬çš„æ–‡ä»¶ä¸­ï¼Œè¿™äº›æ–‡ä»¶å¯ä»¥è‡ªåŠ¨åŒ…å«åœ¨ä¸»æ–‡ä»¶ä¸­ã€‚ç„¶è€Œï¼Œè¿™é‡Œåº”è¯¥æ³¨æ„åˆ° nginx ç›®å‰ä¸æ”¯æŒ apache é£æ ¼çš„åˆ†å¸ƒå¼é…ç½®ï¼ˆå³â€ã€‚htaccess æ–‡ä»¶ï¼‰ã€‚æ‰€æœ‰ä¸ nginx web æœåŠ¡å™¨è¡Œä¸ºç›¸å…³çš„é…ç½®éƒ½åº”è¯¥é©»ç•™åœ¨ä¸€ç»„é›†ä¸­çš„é…ç½®æ–‡ä»¶ä¸­ã€‚ é…ç½®æ–‡ä»¶æœ€åˆç”± master è¿›ç¨‹è¯»å–å’ŒéªŒè¯ã€‚å½“ worker è¿›ç¨‹ä» master è¿›ç¨‹ fork æ—¶ï¼Œworker è¿›ç¨‹å¯ä»¥ä½¿ç”¨ç¼–è¯‘åçš„åªè¯»å½¢å¼ nginx é…ç½®ã€‚é…ç½®ç»“æ„ç”±é€šå¸¸çš„è™šæ‹Ÿå†…å­˜ç®¡ç†æœºåˆ¶è‡ªåŠ¨å…±äº«ã€‚ nginx é…ç½®æœ‰å‡ ä¸ªä¸åŒçš„å†…å®¹ï¼šmain, http, server, upstream, location ï¼ˆåŒæ—¶ mail ç›¸å½“äºé‚®ä»¶æœåŠ¡ä»£ç†ï¼‰ã€‚é…ç½®æ–‡ä»¶å†…å®¹ä¸é‡å ã€‚ä¾‹å¦‚ï¼Œåœ¨ main ä¸­ä¸å­˜åœ¨ locationã€‚æ­¤å¤–ï¼Œä¸ºäº†é¿å…ä¸å¿…è¦çš„æ­§ä¹‰ï¼Œæ²¡æœ‰ä»»ä½•ç±»ä¼¼äº â€œå…¨å±€ web æœåŠ¡å™¨â€ é…ç½®çš„ä¸œè¥¿ã€‚nginx çš„é…ç½®æ˜¯å¹²å‡€å’Œåˆä¹é€»è¾‘çš„ï¼Œå…è®¸ç”¨æˆ·ç»´æŠ¤åŒ…å«æ•°åƒä¸ªæŒ‡ä»¤çš„å¤æ‚é…ç½®æ–‡ä»¶ã€‚åœ¨ä¸€æ¬¡ç§äººè°ˆè¯ä¸­ï¼ŒSysoev è¯´ï¼Œâ€œå…¨å±€æœåŠ¡å™¨é…ç½®ä¸­çš„ locationã€directory å’Œå…¶ä»–å—æ˜¯æˆ‘åœ¨ Apache ä¸­ä¸å–œæ¬¢çš„ç‰¹æ€§ï¼Œæ‰€ä»¥è¿™å°±æ˜¯ä¸ºä»€ä¹ˆå®ƒä»¬ä»æœªåœ¨ nginx ä¸­å®ç°çš„åŸå› ã€‚â€ é…ç½®æ–‡ä»¶è¯­æ³•ã€æ ¼å¼å’Œå®šä¹‰éµå¾ªæ‰€è°“çš„ c é£æ ¼çº¦å®šã€‚è¿™ç§ç”Ÿæˆé…ç½®æ–‡ä»¶çš„ç‰¹æ®Šæ–¹æ³•å·²ç»è¢«å„ç§å¼€æºå’Œå•†ä¸šè½¯ä»¶åº”ç”¨ç¨‹åºæ‰€ä½¿ç”¨ã€‚ä»è®¾è®¡ä¸Šè®²ï¼Œc é£æ ¼çš„é…ç½®éå¸¸é€‚åˆåµŒå¥—æè¿°ï¼Œå…·æœ‰é€»è¾‘æ€§ï¼Œæ˜“äºåˆ›å»ºã€é˜…è¯»å’Œç»´æŠ¤ï¼Œå¹¶å—åˆ°è®¸å¤šå·¥ç¨‹å¸ˆçš„å–œçˆ±ã€‚nginx çš„ c é£æ ¼é…ç½®ä¹Ÿå¾ˆå®¹æ˜“è‡ªåŠ¨åŒ–ã€‚ è™½ç„¶ nginx çš„ä¸€äº›æŒ‡ä»¤ç±»ä¼¼äº Apache é…ç½®çš„æŸäº›éƒ¨åˆ†ï¼Œä½†æ˜¯è®¾ç½®ä¸€ä¸ª nginx å®ä¾‹å´æ˜¯å®Œå…¨ä¸åŒçš„ä½“éªŒã€‚ä¾‹å¦‚ï¼Œnginx æ”¯æŒé‡å†™è§„åˆ™ï¼Œå°½ç®¡éœ€è¦ç®¡ç†å‘˜æ‰‹åŠ¨ä¿®æ”¹é—ç•™çš„ Apache é‡å†™é…ç½®ä»¥åŒ¹é… nginx é£æ ¼ã€‚é‡å†™å¼•æ“çš„å®ç°ä¹Ÿä¸åŒã€‚ ä¸€èˆ¬æ¥è¯´ï¼Œnginx è®¾ç½®è¿˜æ”¯æŒä¸€äº›åŸå§‹æœºåˆ¶ï¼Œä½œä¸ºç²¾ç®€ web æœåŠ¡å™¨é…ç½®çš„ä¸€éƒ¨åˆ†éå¸¸æœ‰ç”¨ã€‚ç®€å•åœ°æåˆ°å˜é‡å’Œ try_files æŒ‡ä»¤æ˜¯æœ‰æ„ä¹‰çš„ï¼Œè¿™äº›æŒ‡ä»¤å¯¹äº nginx æ¥è¯´æ˜¯å”¯ä¸€çš„ã€‚nginx å˜é‡è¢«å¼€å‘å‡ºæ¥æ˜¯ä¸ºäº†æä¾›ä¸€ä¸ªæ›´å¼ºå¤§çš„æœºåˆ¶æ¥æ§åˆ¶ web æœåŠ¡å™¨çš„è¿è¡Œæ—¶é…ç½®ã€‚å˜é‡ç»è¿‡ä¼˜åŒ–ä»¥å¿«é€Ÿè§£æï¼Œå¹¶åœ¨å†…éƒ¨é¢„ç¼–è¯‘ä¸ºç´¢å¼•ã€‚æ ¹æ®éœ€è¦è¿›è¡Œè§£æï¼Œé€šå¸¸ï¼Œå˜é‡çš„å€¼åªè®¡ç®—ä¸€æ¬¡ï¼Œå¹¶åœ¨ç‰¹å®šè¯·æ±‚çš„ç”Ÿå‘½å‘¨æœŸå†…ç¼“å­˜ã€‚å˜é‡å¯ä»¥ä¸ä¸åŒçš„é…ç½®æŒ‡ä»¤ä¸€èµ·ä½¿ç”¨ï¼Œä¸ºæè¿°æ¡ä»¶è¯·æ±‚å¤„ç†è¡Œä¸ºæä¾›äº†é¢å¤–çš„çµæ´»æ€§ã€‚ â€œtry_filesâ€æŒ‡ä»¤æœ€åˆæ—¨åœ¨ä»¥æ›´åˆé€‚çš„æ–¹å¼é€æ­¥æ›¿æ¢æ¡ä»¶ â€œifâ€ é…ç½®è¯­å¥ï¼Œå®ƒçš„è®¾è®¡ç›®çš„æ˜¯å¿«é€Ÿæœ‰æ•ˆåœ°å°è¯• / åŒ¹é…ä¸åŒçš„ uri åˆ°å†…å®¹çš„æ˜ å°„ã€‚æ€»çš„æ¥è¯´ï¼Œtry_files æŒ‡ä»¤å·¥ä½œå¾—å¾ˆå¥½ï¼Œå¹¶ä¸”éå¸¸é«˜æ•ˆå’Œæœ‰ç”¨ã€‚æ›´å¤šè¯¦æƒ…æ¨èè¯»è€…å» try_files directive 14.4. nginx å†…éƒ¨å¦‚å‰æ‰€è¿°ï¼Œnginx ä»£ç åº“ç”±æ ¸å¿ƒå’Œè®¸å¤šæ¨¡å—ç»„æˆã€‚ nginx çš„æ ¸å¿ƒæ˜¯è´Ÿè´£æä¾› Web æœåŠ¡å™¨ï¼ŒWeb å’Œé‚®ä»¶åå‘ä»£ç†åŠŸèƒ½çš„åŸºç¡€ï¼›å®ƒæ”¯æŒä½¿ç”¨åº•å±‚ç½‘ç»œåè®®ï¼Œæ„å»ºå¿…è¦çš„è¿è¡Œæ—¶ç¯å¢ƒï¼Œå¹¶ç¡®ä¿ä¸åŒæ¨¡å—ä¹‹é—´çš„æ— ç¼äº¤äº’ã€‚ä½†æ˜¯ï¼Œå¤§å¤šæ•°åè®®å’Œç‰¹å®šçš„åº”ç”¨ç¨‹éƒ½æ˜¯ç”± nginx åŠŸèƒ½æ¨¡å—å®Œæˆçš„ï¼Œè€Œä¸æ˜¯æ ¸å¿ƒæ¨¡å—ã€‚ åœ¨å†…éƒ¨ï¼Œnginx é€šè¿‡ç”±æ¨¡å—ç»„æˆçš„çš„ç®¡é“æˆ–æ¨¡å—é“¾æ¥å¤„ç†è¿æ¥ã€‚æ¢å¥è¯è¯´ï¼Œå¯¹äºæ¯ä¸ªæ“ä½œï¼Œéƒ½æœ‰ä¸€ä¸ªæ­£åœ¨è¿›è¡Œç›¸å…³å·¥ä½œçš„æ¨¡å—ï¼›ä¾‹å¦‚ï¼Œå‹ç¼©ï¼Œä¿®æ”¹å†…å®¹ï¼Œæ‰§è¡ŒæœåŠ¡å™¨ç«¯ï¼Œé€šè¿‡ FastCGI æˆ– uwsgi åè®®ä¸ upstream åº”ç”¨æœåŠ¡å™¨é€šä¿¡ï¼Œæˆ–ä¸ memcached é€šä¿¡ã€‚ æœ‰å‡ ä¸ª nginx æ¨¡å—ä½äºæ ¸å¿ƒå’ŒçœŸæ­£çš„ â€œåŠŸèƒ½â€ æ¨¡å—ä¹‹é—´ã€‚è¿™äº›æ¨¡å—æ˜¯ http å’Œ mailã€‚è¿™ä¸¤ä¸ªæ¨¡å—åœ¨æ ¸å¿ƒå’Œè¾ƒä½çº§åˆ«ç»„ä»¶ä¹‹é—´æä¾›äº†é¢å¤–çš„æŠ½è±¡çº§åˆ«ã€‚åœ¨è¿™äº›æ¨¡å—ä¸­ï¼Œå®ç°äº†ä¸è¯¸å¦‚ HTTPï¼ŒSMTP æˆ– IMAP çš„ç›¸åº”åº”ç”¨å±‚åè®®ç›¸å…³è”çš„äº‹ä»¶åºåˆ—çš„å¤„ç†ã€‚ç»“åˆ nginx æ ¸å¿ƒï¼Œè¿™äº›ä¸Šå±‚æ¨¡å—è´Ÿè´£ç»´æŠ¤å¯¹å„ä¸ªåŠŸèƒ½æ¨¡å—çš„æ­£ç¡®è°ƒç”¨é¡ºåºã€‚è™½ç„¶ HTTP åè®®ç›®å‰æ˜¯ä½œä¸º http æ¨¡å—çš„ä¸€éƒ¨åˆ†å®ç°çš„ï¼Œä½†ç”±äºéœ€è¦æ”¯æŒ SPDY ç­‰å…¶ä»–åè®®ï¼Œå› æ­¤è®¡åˆ’å°†æ¥å°†å…¶åˆ†ç¦»ä¸ºåŠŸèƒ½æ¨¡å—ã€‚æ›´å¤š SPDY åè®®è¯¦è§ SPDY: An experimental protocol for a faster web åŠŸèƒ½æ¨¡å—å¯åˆ†ä¸ºäº‹ä»¶æ¨¡å—ï¼Œé˜¶æ®µå¤„ç†ç¨‹åºï¼Œè¾“å‡º filterï¼Œå˜é‡å¤„ç†ç¨‹åºï¼Œåè®®ï¼Œä¸Šæ¸¸å’Œè´Ÿè½½å¹³è¡¡å™¨ã€‚å¤§å¤šæ•°è¿™äº›æ¨¡å—è¡¥å……äº† nginx çš„ HTTP åŠŸèƒ½ï¼Œä½†äº‹ä»¶æ¨¡å—å’Œåè®®ä¹Ÿç”¨äº mailã€‚äº‹ä»¶æ¨¡å—æä¾›ç‰¹å®šçš„ OS ä¾èµ–äº‹ä»¶é€šçŸ¥æœºåˆ¶ï¼Œå¦‚ kqueue æˆ– epollã€‚ nginx ä½¿ç”¨çš„äº‹ä»¶æ¨¡å—å–å†³äºæ“ä½œç³»ç»ŸåŠŸèƒ½å’Œæ„å»ºé…ç½®ã€‚åè®®æ¨¡å—å…è®¸ nginx é€šè¿‡ HTTPSï¼ŒTLS / SSLï¼ŒSMTPï¼ŒPOP3 å’Œ IMAP è¿›è¡Œé€šä¿¡ã€‚ å…¸å‹çš„ HTTP è¯·æ±‚å¤„ç†å‘¨æœŸå¦‚ä¸‹æ‰€ç¤ºã€‚ å®¢æˆ·ç«¯å‘é€ http è¯·æ±‚ã€‚ nginx core ä¾æ®é…ç½®æ–‡ä»¶ä¸­çš„ location é€‰æ‹©åˆé€‚çš„é˜¶æ®µå¤„ç†å™¨ã€‚ å¦‚æœé…ç½®ç”Ÿæ•ˆï¼Œè´Ÿè½½å‡è¡¡å™¨å°±ä¼šé€‰æ‹©ä¸€ä¸ª upstream æœåŠ¡å™¨ä»£ç†ã€‚ é˜¶æ®µå¤„ç†å™¨æ‰§è¡Œä»»åŠ¡ï¼Œå¹¶æŠŠç¼“å†²åŒºçš„å†…å®¹ä¼ é€’ç»™ç¬¬ä¸€ä¸ª filterã€‚ ç¬¬ä¸€ä¸ª filter å°†å†…å®¹ä¼ é€’ç»™ç¬¬äºŒä¸ª filter ç¬¬äºŒä¸ª filter ä¼ é€’ç»™ç¬¬ä¸‰ä¸ªï¼ˆè¿­ä»£æ‰§è¡Œï¼‰ å°†æœ€åçš„ response å‘é€ç»™å®¢æˆ·ç«¯ã€‚ nginx æ¨¡å—è°ƒç”¨æ˜¯éå¸¸å¯å®šåˆ¶çš„ã€‚å®ƒä½¿ç”¨æŒ‡å‘å¯æ‰§è¡Œå‡½æ•°çš„æŒ‡é’ˆæ¥æ‰§è¡Œä¸€ç³»åˆ—å›è°ƒã€‚ç„¶è€Œï¼Œè¿™æ ·åšçš„ç¼ºç‚¹æ˜¯å®ƒå¯èƒ½ç»™æƒ³è¦ç¼–å†™è‡ªå·±çš„æ¨¡å—çš„ç¨‹åºå‘˜å¸¦æ¥å¾ˆå¤§çš„è´Ÿæ‹…ï¼Œå› ä¸ºä»–ä»¬å¿…é¡»å‡†ç¡®å®šä¹‰æ¨¡å—åº”è¯¥å¦‚ä½•ä»¥åŠä½•æ—¶è¿è¡Œã€‚ nginx API å’Œå¼€å‘äººå‘˜çš„æ–‡æ¡£éƒ½åœ¨ä¸æ–­æ”¹è¿›ï¼Œå¹¶ä¸”å¯ä»¥æ›´å¤šåœ°ç”¨æ¥ç¼“è§£è¿™ä¸ªé—®é¢˜ã€‚ ä¸‹é¢è¿™äº›åˆ—å­æ˜¯å¯ä»¥æ·»åŠ æ¨¡å—çš„ä½ç½®ï¼š åœ¨è¯»å’Œå¤„ç†é…ç½®æ–‡ä»¶ä¹‹å‰ åœ¨æ¯ä¸ªæœåŠ¡å™¨å‡ºç°ä»¥åŠé…ç½®æ–‡ä»¶æŒ‡å‘çš„åœ°æ–¹ å½“ ä¸»é…ç½® è¢«åˆå§‹åŒ–çš„æ—¶å€™ å½“æœåŠ¡å™¨è¢«åˆå§‹åŒ–çš„æ—¶å€™ å½“ server configuration è¢«åˆå¹¶åˆ° ä¸»é…ç½®çš„æ—¶å€™ å½“ location configuration åˆå§‹åŒ–æˆ–è€…åˆå¹¶åˆ° parent server configuraton çš„æ—¶å€™ å½“ master è¿›ç¨‹å¯åŠ¨æˆ–è€…å­˜åœ¨çš„æ—¶å€™ å½“ä¸€ä¸ªæ–°çš„ worker è¿›ç¨‹å¯åŠ¨æˆ–è€…å­˜åœ¨çš„æ—¶å€™ å½“å¤„ç†ä¸€ä¸ªè¯·æ±‚çš„æ—¶å€™ å½“è¿‡æ»¤è¯·æ±‚ header å’Œè¯·æ±‚ body çš„æ—¶å€™ å½“è¯·æ±‚è½¬å‘åˆ° upstream æœåŠ¡å™¨çš„æ—¶å€™ æœåŠ¡å™¨ä¸­çš„å“åº”çš„æ—¶å€™ å½“å®Œæˆä¸ä¸€ä¸ª upstream æœåŠ¡å™¨çš„äº¤äº’çš„æ—¶å€™ åœ¨ worker è¿›ç¨‹ä¸­ï¼Œå¯¼è‡´ç”Ÿæˆå“åº”çš„è¿è¡Œå¾ªç¯çš„ action åºåˆ—å¦‚ä¸‹æ‰€ç¤ºï¼š å¯åŠ¨ ngx_worker_process_cycle(). ä½¿ç”¨æ“ä½œç³»ç»Ÿç‰¹å®šçš„æœºåˆ¶æ¥å¤„ç†äº‹ä»¶ï¼ˆsuch as epoll or kqueueï¼‰ æ¥æ”¶äº‹ä»¶å¹¶ä¸”åˆ†å‘ç»™ç›¸å…³çš„ action å¤„ç† / ä»£ç†è¯·æ±‚ header å’Œ body äº§ç”Ÿå“åº”å†…å®¹ (header, body) å¹¶ä¼ é€’ç»™å®¢æˆ·ç«¯ ç»“æŸè¯·æ±‚ é‡å¯ timersï¼Œevents è½®è¯¢æœ¬èº«ï¼ˆæ­¥éª¤ 5 å’Œ 6ï¼‰ç¡®ä¿å¢é‡ç”Ÿæˆå“åº”å¹¶å°†å…¶æµå¼ä¼ è¾“åˆ°å®¢æˆ·ç«¯ã€‚ å¤„ç† HTTP è¯·æ±‚çš„æ›´è¯¦ç»†è¿‡ç¨‹å¯èƒ½å¦‚ä¸‹æ‰€ç¤º åˆå§‹åŒ–è¯·æ±‚å¤„ç† å¤„ç† header å¤„ç† body è°ƒç”¨ç›¸å…³çš„ nginx å¤„ç†å™¨ æ‰§è¡Œæ¯ä¸ªå¤„ç†é˜¶æ®µ è¿™å°†æˆ‘ä»¬å¸¦åˆ°äº†æ¯ä¸ªé˜¶æ®µã€‚å½“ nginx å¤„ç† HTTP è¯·æ±‚æ—¶ï¼Œå®ƒä¼šå°†å…¶ä¼ é€’ç»™è®¸å¤šå¤„ç†é˜¶æ®µã€‚åœ¨æ¯ä¸ªé˜¶æ®µéƒ½æœ‰å¤„ç†ç¨‹åºå¯ä»¥è°ƒç”¨ã€‚é€šå¸¸ï¼Œé˜¶æ®µå¤„ç†ç¨‹åºå¤„ç†è¯·æ±‚å¹¶ç”Ÿæˆç›¸å…³è¾“å‡ºã€‚é˜¶æ®µå¤„ç†ç¨‹åºè¢«é™„åŠ åˆ°é…ç½®æ–‡ä»¶ä¸­å®šä¹‰çš„ä½ç½®ã€‚ é˜¶æ®µå¤„ç†ç¨‹åºé€šå¸¸æ‰§è¡Œä»¥ä¸‹å››é¡¹æ“ä½œï¼šè·å–ä½ç½®é…ç½®ï¼Œç”Ÿæˆé€‚å½“çš„å“åº”ï¼Œå‘é€ header ä»¥åŠå‘é€ bodyã€‚å¤„ç†ç¨‹åºæœ‰ä¸€ä¸ªå‚æ•°ï¼šæè¿°è¯·æ±‚çš„ç‰¹å®šç»“æ„ã€‚è¯·æ±‚ç»“æ„æœ‰å¾ˆå¤šå…³äºå®¢æˆ·ç«¯è¯·æ±‚çš„æœ‰ç”¨ä¿¡æ¯ï¼Œä¾‹å¦‚è¯·æ±‚ methodï¼ŒURI å’Œ headerã€‚ è¯»å– HTTP è¯·æ±‚ header æ—¶ï¼Œnginx ä¼šæŸ¥æ‰¾å…³è”çš„è™šæ‹ŸæœåŠ¡å™¨é…ç½®ã€‚å¦‚æœæ‰¾åˆ°è™šæ‹ŸæœåŠ¡å™¨ï¼Œè¯·æ±‚å°†ç»å†å…­ä¸ªé˜¶æ®µï¼š æœåŠ¡å™¨é‡å†™é˜¶æ®µ location é˜¶æ®µ location é‡å†™é˜¶æ®µï¼ˆå°†è¯·æ±‚å¸¦å›åˆ°ä¸Šä¸€ä¸ªé˜¶æ®µï¼‰ è¿æ¥æ§åˆ¶é˜¶æ®µ try_files é˜¶æ®µ æ—¥å¿—é˜¶æ®µ ä¸ºäº†å“åº”è¯·æ±‚ç”Ÿæˆå¿…è¦çš„å†…å®¹ï¼Œnginx å°†è¯·æ±‚ä¼ é€’ç»™åˆé€‚çš„å†…å®¹å¤„ç†ç¨‹åºã€‚æ ¹æ®ç¡®åˆ‡çš„ä½ç½®é…ç½®ï¼Œnginx å¯èƒ½é¦–å…ˆå°è¯•æ‰€è°“çš„æ— æ¡ä»¶å¤„ç†ç¨‹åºï¼Œå¦‚ perlï¼Œproxy_passï¼Œflvï¼Œmp4 ç­‰ã€‚å¦‚æœè¯·æ±‚ä¸ä¸Šè¿°ä»»ä½•å†…å®¹å¤„ç†ç¨‹åºéƒ½ä¸åŒ¹é…ï¼Œåˆ™ç”±ä»¥ä¸‹å¤„ç†ç¨‹åºä¹‹ä¸€æŒ‰ç…§ä»¥ä¸‹é¡ºåºé€‰æ‹©ï¼šrandom indexï¼Œindexï¼Œautoindexï¼Œgzip_staticï¼Œstaticã€‚ ç´¢å¼•æ¨¡å—çš„è¯¦ç»†ä¿¡æ¯å¯ä»¥åœ¨ nginx æ–‡æ¡£ä¸­æ‰¾åˆ°ï¼Œä½†è¿™äº›æ˜¯ä½¿ç”¨å°¾éƒ¨æ–œæ å¤„ç†è¯·æ±‚çš„æ¨¡å—ã€‚å¦‚æœåƒ mp4 æˆ– autoindex è¿™æ ·çš„ä¸“ç”¨æ¨¡å—åˆ™ä¸åˆé€‚ï¼Œå†…å®¹è¢«è®¤ä¸ºåªæ˜¯ç£ç›˜ä¸Šçš„æ–‡ä»¶æˆ–ç›®å½•ï¼ˆå³é™æ€ï¼‰ï¼Œå¹¶ç”± static å†…å®¹å¤„ç†ç¨‹åºæä¾›æœåŠ¡ã€‚å¯¹äºç›®å½•ï¼Œå®ƒä¼šè‡ªåŠ¨é‡å†™ URIï¼Œä»¥ä¾¿å§‹ç»ˆå­˜åœ¨å°¾éƒ¨æ–œæ ï¼ˆç„¶åå‘å‡º HTTP é‡å®šå‘ï¼‰ã€‚ ç„¶åå°†å†…å®¹å¤„ç†ç¨‹åºçš„å†…å®¹ä¼ é€’ç»™ filterã€‚filter ä¹Ÿé™„åŠ åˆ° locationï¼Œå¹¶ä¸”å¯ä»¥ä¸º location é…ç½®å¤šä¸ª filterã€‚filter æ‰§è¡Œæ“ä½œå¤„ç†ç¨‹åºç”Ÿæˆçš„è¾“å‡ºçš„ä»»åŠ¡ã€‚å¯¹äºé¢„å…ˆå®šä¹‰çš„å¼€ç®±å³ç”¨ filterï¼Œæ‰§è¡Œçš„é¡ºåºåœ¨ç¼–è¯‘æ—¶å°±ç¡®å®šã€‚å¯¹äºç¬¬ä¸‰æ–¹ filterï¼Œå¯ä»¥åœ¨æ„å»ºé˜¶æ®µå¯¹å…¶è¿›è¡Œé…ç½®ã€‚åœ¨ç°æœ‰çš„ nginx å®ç°ä¸­ï¼Œfilter åªèƒ½è¿›è¡Œå‡ºç«™æ›´æ”¹ï¼Œå¹¶ä¸”ç›®å‰æ²¡æœ‰æœºåˆ¶æ¥ç¼–å†™å’Œé™„åŠ  filter æ¥è¿›è¡Œè¾“å…¥å†…å®¹è½¬æ¢ã€‚è¾“å…¥è¿‡æ»¤å°†å‡ºç°åœ¨ nginx çš„æœªæ¥ç‰ˆæœ¬ä¸­ã€‚ filter éµå¾ªç‰¹å®šçš„è®¾è®¡æ¨¡å¼ã€‚è°ƒç”¨ filterï¼Œå¼€å§‹å·¥ä½œï¼Œå¹¶è°ƒç”¨ä¸‹ä¸€ä¸ª filterï¼Œç›´åˆ°è°ƒç”¨é“¾ä¸­çš„æœ€ç»ˆ filterã€‚ä¹‹åï¼Œnginx å®Œæˆå“åº”ã€‚filter ä¸å¿…ç­‰å¾…å‰ä¸€ä¸ª filter å®Œæˆã€‚è°ƒç”¨é“¾ä¸­çš„ä¸‹ä¸€ä¸ª filter å¯ä»¥åœ¨ä¸Šä¸€ä¸ª filter çš„è¾“å…¥å¯ç”¨æ—¶ç«‹å³å¼€å§‹å·¥ä½œï¼ˆåŠŸèƒ½ä¸Šä¸ Unix ç®¡é“éå¸¸ç›¸ä¼¼ï¼‰ã€‚åè¿‡æ¥ï¼Œç”Ÿæˆçš„è¾“å‡ºå“åº”å¯ä»¥åœ¨æ¥æ”¶åˆ°æ¥è‡ªä¸Šæ¸¸æœåŠ¡å™¨çš„æ•´ä¸ªå“åº”ä¹‹å‰ä¼ é€’ç»™å®¢æˆ·ç«¯ã€‚ è¿˜æœ‰ header filter å’Œ body filterï¼›nginx ä¼šåˆ†åˆ«ç”¨ç›¸å…³çš„ filter æ¥ç»™ç›¸åº” header å’Œ body æ·»åŠ æ•°æ® header filter ä¸»è¦æœ‰ä¸‹é¢ä¸‰ä¸ªæ­¥éª¤ å†³å®šæ˜¯å¦å¯¹è¿™ä¸ªå“åº”è¿›è¡Œæ“ä½œ æ“ä½œè¿™ä¸ªå“åº” è°ƒç”¨ä¸‹ä¸€ä¸ª filter body filter ä¿®æ”¹ç”Ÿæˆçš„æ•°æ®ï¼Œä¸‹é¢æ˜¯ body filter çš„ä¸€äº›æ¡ˆä¾‹ æœåŠ¡ç«¯ includes XSLT è¿‡æ»¤ å›¾ç‰‡è¿‡æ»¤ï¼ˆæ¯”å¦‚ä¿®æ”¹å›¾ç‰‡å°ºå¯¸ï¼‰ ä¿®æ”¹ç¼–ç  gzip å‹ç¼© chunked encoding åœ¨ filter chain ä¹‹åï¼Œå“åº”å°†ä¼ é€’ç»™ writerã€‚é™¤äº† writer ä¹‹å¤–ï¼Œè¿˜æœ‰ä¸€äº›é¢å¤–ç‰¹æ®Šç”¨é€”çš„ filterï¼Œå³ copy å’Œ postponefilterã€‚ copyfilter è´Ÿè´£ä½¿ç”¨å¯èƒ½å­˜å‚¨åœ¨ä»£ç†ä¸´æ—¶ç›®å½•ä¸­çš„ç›¸å…³å“åº”å†…å®¹å¡«å……å†…å­˜ç¼“å†²åŒºã€‚ postponefilter ç”¨äºå­è¯·æ±‚ã€‚ å­è¯·æ±‚æ˜¯è¯·æ±‚ / å“åº”å¤„ç†çš„éå¸¸é‡è¦çš„æœºåˆ¶ã€‚å­è¯·æ±‚ä¹Ÿæ˜¯ nginx æœ€å¼ºå¤§çš„æ–¹é¢ä¹‹ä¸€ã€‚å¯¹äºå­è¯·æ±‚ï¼Œnginx å¯ä»¥ä»ä¸å®¢æˆ·ç«¯æœ€åˆè¯·æ±‚çš„ URL ä¸åŒçš„ URL è¿”å›ç»“æœã€‚ä¸€äº› Web æ¡†æ¶å°†æ­¤ç§°ä¸ºå†…éƒ¨é‡å®šå‘ã€‚ä½†æ˜¯ï¼Œnginx æ›´è¿›ä¸€æ­¥ - è¿‡æ»¤å™¨ä¸ä»…å¯ä»¥æ‰§è¡Œå¤šä¸ªå­è¯·æ±‚ï¼Œè€Œä¸”å¯ä»¥å°†è¾“å‡ºç»„åˆæˆå•ä¸ªå“åº”ï¼Œä½†å­è¯·æ±‚ä¹Ÿå¯ä»¥åµŒå¥—å’Œåˆ†å±‚ã€‚å­è¯·æ±‚å¯ä»¥æ‰§è¡Œå…¶è‡ªå·±çš„å­å­è¯·æ±‚ï¼Œå¹¶ä¸”å­å­è¯·æ±‚å¯ä»¥å‘èµ·å­å­å­è¯·æ±‚ã€‚å­è¯·æ±‚å¯ä»¥æ˜ å°„åˆ°ç¡¬ç›˜ï¼Œå…¶ä»–å¤„ç†ç¨‹åºæˆ–ä¸Šæ¸¸æœåŠ¡å™¨ä¸Šçš„æ–‡ä»¶ã€‚å­è¯·æ±‚å¯¹äºæ ¹æ®åŸå§‹å“åº”ä¸­çš„æ•°æ®æ’å…¥å…¶ä»–å†…å®¹éå¸¸æœ‰ç”¨ã€‚ä¾‹å¦‚ï¼ŒSSIï¼ˆæœåŠ¡å™¨ç«¯åŒ…å«ï¼‰æ¨¡å—ä½¿ç”¨è¿‡æ»¤å™¨æ¥è§£æè¿”å›æ–‡æ¡£çš„å†…å®¹ï¼Œç„¶åå°† â€œincludeâ€ æŒ‡ä»¤æ›¿æ¢ä¸ºæŒ‡å®š URL çš„å†…å®¹ã€‚æˆ–è€…ï¼Œå®ƒå¯ä»¥æ˜¯ä¸€ä¸ªè¿‡æ»¤å™¨ï¼Œå°†æ–‡æ¡£çš„æ•´ä¸ªå†…å®¹è§†ä¸ºè¦æ£€ç´¢çš„ URLï¼Œç„¶åå°†æ–°æ–‡æ¡£é™„åŠ åˆ° URL æœ¬èº« upstream å’Œè´Ÿè½½å‡è¡¡å™¨ä¹Ÿå€¼å¾—ç®€è¦æè¿°ã€‚upstream ç”¨äºå®ç°å¯ä»¥è¢«è¯†åˆ«ä¸ºåå‘ä»£ç†ï¼ˆproxy_pass å¤„ç†ç¨‹åºçš„å†…å®¹ã€‚upstream æ¨¡å—ä¸»è¦å‡†å¤‡å°†è¯·æ±‚å‘é€åˆ° upstream æœåŠ¡å™¨ï¼ˆæˆ– â€œåç«¯â€ï¼‰å¹¶æ¥æ”¶å“åº”ã€‚è¿™é‡Œæ²¡æœ‰è°ƒç”¨è¾“å‡º filterã€‚å½“ upstream æœåŠ¡å™¨å‡†å¤‡å¥½è¢«å†™å…¥å’Œè¯»å–æ—¶ï¼Œupstream æ¨¡å—ç¡®åˆ‡åœ°åšçš„æ˜¯è®¾ç½®è¦è°ƒç”¨çš„å›è°ƒã€‚å­˜åœ¨å®ç°ä»¥ä¸‹åŠŸèƒ½çš„å›è°ƒï¼š åˆ›å»ºçš„è¯·æ±‚ç¼“å†²è¢«å‘é€åˆ° upstream æœåŠ¡å™¨çš„ é‡æ–°è¿æ¥åˆ° upstream æœåŠ¡å™¨ï¼ˆåœ¨è¯·æ±‚äº§ç”Ÿä¹‹å‰ï¼‰ å¤„ç† upstream æœåŠ¡å™¨å“åº”çš„å†…å®¹å¹¶ä¸”å­˜å‚¨æŒ‡å‘ä» upstream æœåŠ¡å™¨å†…å®¹çš„æŒ‡é’ˆã€‚ æ”¾å¼ƒè¯·æ±‚ï¼ˆä¸»è¦æ˜¯å®¢æˆ·ç«¯è¿‡æ—©æ–­å¼€è¿æ¥ï¼‰ ä» upstream æœåŠ¡å™¨è¯»å®Œå†…å®¹ä¹‹åç»“æŸè¯·æ±‚ æ•´ç†å“åº” bodyï¼ˆæ¯”å¦‚åˆ é™¤ http å“åº” trailerï¼‰ è´Ÿè½½å‡è¡¡å™¨æ¨¡å—è¿æ¥åˆ° proxy_pass å¤„ç†ç¨‹åºï¼Œä»¥ä¾¿åœ¨å¤šä¸ª upstream æœåŠ¡å™¨ç¬¦åˆæ¡ä»¶æ—¶æä¾›é€‰æ‹©ä¸Šæ¸¸æœåŠ¡å™¨çš„åŠŸèƒ½ã€‚è´Ÿè½½å‡è¡¡å™¨æ³¨å†Œå¯ç”¨é…ç½®æ–‡ä»¶æŒ‡ä»¤ï¼Œæä¾›é¢å¤–çš„ä¸Šæ¸¸åˆå§‹åŒ–å‡½æ•°ï¼ˆä»¥è§£æ DNS ä¸­çš„ä¸Šæ¸¸åç§°ç­‰ï¼‰ï¼Œåˆå§‹åŒ–è¿æ¥ç»“æ„ï¼Œå†³å®šåœ¨ä½•å¤„è·¯ç”±è¯·æ±‚ä»¥åŠæ›´æ–°ç»Ÿè®¡ä¿¡æ¯ã€‚ç›®å‰ï¼Œnginx æ”¯æŒä¸¤ç§æ ‡å‡†è§„åˆ™ï¼Œç”¨äºå¯¹ upstream æœåŠ¡å™¨è¿›è¡Œè´Ÿè½½å‡è¡¡ï¼šå¾ªç¯å’Œ ip-hashã€‚ upstream å’Œè´Ÿè½½å‡è¡¡å¤„ç†æœºåˆ¶åŒ…æ‹¬ç”¨äºæ£€æµ‹å¤±è´¥çš„ä¸Šæ¸¸æœåŠ¡å™¨ä»¥åŠå°†æ–°è¯·æ±‚é‡æ–°è·¯ç”±åˆ°å…¶ä½™æœåŠ¡å™¨çš„ç®—æ³• - å°½ç®¡è®¡åˆ’è¿›è¡Œå¤§é‡é¢å¤–å·¥ä½œä»¥å¢å¼ºæ­¤åŠŸèƒ½ã€‚æ€»çš„æ¥è¯´ï¼Œnginx å¼€å‘å›¢é˜Ÿè®¡åˆ’å¯¹è´Ÿè½½å‡è¡¡å™¨è¿›è¡Œæ›´å¤šçš„å·¥ä½œï¼Œå¹¶ä¸”åœ¨ä¸‹ä¸€ç‰ˆæœ¬çš„ nginx ä¸­ï¼Œå°†å¤§å¤§æ”¹è¿›è·¨ä¸åŒä¸Šæ¸¸æœåŠ¡å™¨åˆ†é…è´Ÿè½½ä»¥åŠè¿è¡ŒçŠ¶å†µæ£€æŸ¥çš„æœºåˆ¶ã€‚ è¿˜æœ‰ä¸€äº›å…¶ä»–æœ‰è¶£çš„æ¨¡å—æä¾›äº†ä¸€ç»„é¢å¤–çš„å˜é‡ä¾›é…ç½®æ–‡ä»¶ä½¿ç”¨ã€‚è™½ç„¶ nginx ä¸­çš„å˜é‡æ˜¯åœ¨ä¸åŒçš„æ¨¡å—ä¸­åˆ›å»ºå’Œæ›´æ–°çš„ï¼Œä½†æœ‰ä¸¤ä¸ªæ¨¡å—å®Œå…¨ä¸“ç”¨äºå˜é‡ï¼šgeo å’Œ mapã€‚ geo æ¨¡å—ç”¨äºæ ¹æ®å®¢æˆ·ç«¯çš„ IP åœ°å€è¿›è¡Œè·Ÿè¸ªã€‚æ­¤æ¨¡å—å¯ä»¥åˆ›å»ºä¾èµ–äºå®¢æˆ·ç«¯ IP åœ°å€çš„ä»»æ„å˜é‡ã€‚å¦ä¸€ä¸ªæ¨¡å— map å…è®¸ä»å…¶ä»–å˜é‡åˆ›å»ºå˜é‡ï¼Œå®è´¨ä¸Šæä¾›äº†å¯¹ä¸»æœºåå’Œå…¶ä»–è¿è¡Œæ—¶å˜é‡è¿›è¡Œçµæ´»æ˜ å°„çš„èƒ½åŠ›ã€‚è¿™ç§æ¨¡å—å¯ä»¥ç§°ä¸ºå˜é‡å¤„ç†ç¨‹åºã€‚ åœ¨å•ä¸ª nginx worker ä¸­å®ç°çš„å†…å­˜åˆ†é…æœºåˆ¶åœ¨æŸç§ç¨‹åº¦ä¸Šå—åˆ°äº† Apache çš„å¯å‘ã€‚nginx å†…å­˜ç®¡ç†çš„é«˜åº¦æ¦‚è¿°å¦‚ä¸‹ï¼šå¯¹äºæ¯ä¸ªè¿æ¥ï¼Œå¿…è¦çš„å†…å­˜ç¼“å†²åŒºè¢«åŠ¨æ€åˆ†é…ï¼Œé“¾æ¥ï¼Œç”¨äºå­˜å‚¨å’Œæ“ä½œè¯·æ±‚å’Œå“åº”çš„å¤´éƒ¨å’Œä¸»ä½“ï¼Œç„¶ååœ¨è¿æ¥é‡Šæ”¾æ—¶é‡Šæ”¾ã€‚å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œnginx è¯•å›¾å°½å¯èƒ½é¿å…åœ¨å†…å­˜ä¸­å¤åˆ¶æ•°æ®ï¼Œå¹¶ä¸”å¤§å¤šæ•°æ•°æ®éƒ½æ˜¯é€šè¿‡æŒ‡é’ˆå€¼ä¼ é€’çš„ï¼Œè€Œä¸æ˜¯é€šè¿‡è°ƒç”¨ memcpyã€‚ æ›´æ·±å…¥ä¸€ç‚¹ï¼Œå½“æ¨¡å—ç”Ÿæˆå“åº”æ—¶ï¼Œå°†æ£€ç´¢åˆ°çš„å†…å®¹æ”¾å…¥å†…å­˜ç¼“å†²åŒºï¼Œç„¶åå°†å…¶æ·»åŠ åˆ°ç¼“å†²é“¾é“¾æ¥ä¸­ã€‚åç»­å¤„ç†ä¹Ÿé€‚ç”¨äºæ­¤ç¼“å†²é“¾é“¾æ¥ã€‚ç¼“å†²é“¾åœ¨ nginx ä¸­éå¸¸å¤æ‚ï¼Œå› ä¸ºæœ‰å‡ ç§å¤„ç†æ–¹æ¡ˆå› æ¨¡å—ç±»å‹è€Œå¼‚ã€‚ä¾‹å¦‚ï¼Œåœ¨å®ç° body filter æ¨¡å—æ—¶ç²¾ç¡®ç®¡ç†ç¼“å†²åŒºå¯èƒ½éå¸¸æ£˜æ‰‹ã€‚è¿™æ ·çš„æ¨¡å—ä¸€æ¬¡åªèƒ½åœ¨ä¸€ä¸ªç¼“å†²åŒºï¼ˆé“¾è·¯çš„é“¾è·¯ï¼‰ä¸Šè¿è¡Œï¼Œå®ƒå¿…é¡»å†³å®šæ˜¯å¦è¦†ç›–è¾“å…¥ç¼“å†²åŒºï¼Œç”¨æ–°åˆ†é…çš„ç¼“å†²åŒºæ›¿æ¢ç¼“å†²åŒºï¼Œæˆ–è€…åœ¨æœ‰é—®é¢˜çš„ç¼“å†²åŒºä¹‹å‰æˆ–ä¹‹åæ’å…¥æ–°çš„ç¼“å†²åŒºã€‚æ›´å¤æ‚çš„æ˜¯ï¼Œæœ‰æ—¶æ¨¡å—ä¼šæ”¶åˆ°å‡ ä¸ªç¼“å†²åŒºï¼Œå› æ­¤å®ƒå¿…é¡»æœ‰ä¸€ä¸ªä¸å®Œæ•´çš„ç¼“å†²åŒºé“¾ã€‚ä½†æ˜¯ï¼Œæ­¤æ—¶ nginx åªæä¾›äº†ä¸€ä¸ªç”¨äºæ“ä½œç¼“å†²åŒºé“¾çš„ä½çº§ APIï¼Œå› æ­¤åœ¨è¿›è¡Œä»»ä½•å®é™…å®ç°ä¹‹å‰ï¼Œç¬¬ä¸‰æ–¹æ¨¡å—å¼€å‘äººå‘˜åº”è¯¥èƒ½å¤Ÿç†Ÿç»ƒä½¿ç”¨ nginx è¿™ä¸ªç¥ç§˜çš„éƒ¨åˆ†ã€‚ å…³äºä¸Šè¿°æ–¹æ³•çš„æ³¨é‡Šæ˜¯åœ¨è¿æ¥çš„æ•´ä¸ªç”Ÿå‘½å‘¨æœŸä¸­åˆ†é…äº†å†…å­˜ç¼“å†²åŒºï¼Œå› æ­¤å¯¹äºé•¿æœŸè¿æ¥ï¼Œä¿ç•™äº†ä¸€äº›é¢å¤–çš„å†…å­˜ã€‚åŒæ—¶ï¼Œåœ¨ç©ºé—²çš„ keepalive è¿æ¥ä¸Šï¼Œnginx åªèŠ±è´¹ 550 ä¸ªå­—èŠ‚çš„å†…å­˜ã€‚å¯¹ nginx çš„æœªæ¥ç‰ˆæœ¬è¿›è¡Œå¯èƒ½çš„ä¼˜åŒ–å°†æ˜¯é‡ç”¨å’Œå…±äº«å†…å­˜ç¼“å†²åŒºä»¥å®ç°é•¿æœŸè¿æ¥ã€‚ ç®¡ç†å†…å­˜åˆ†é…çš„ä»»åŠ¡ç”± nginx æ± åˆ†é…å™¨å®Œæˆã€‚å…±äº«å†…å­˜åŒºåŸŸç”¨äºæ¥å—äº’æ–¥é”ï¼Œç¼“å­˜å…ƒæ•°æ®ï¼ŒSSL ä¼šè¯ç¼“å­˜ä»¥åŠä¸å¸¦å®½ç®¡åˆ¶å’Œç®¡ç†ï¼ˆé™åˆ¶ï¼‰ç›¸å…³çš„ä¿¡æ¯ã€‚åœ¨ nginx ä¸­å®ç°äº†ä¸€ä¸ª slab åˆ†é…å™¨æ¥ç®¡ç†å…±äº«å†…å­˜åˆ†é…ã€‚ä¸ºäº†åŒæ—¶å®‰å…¨åœ°ä½¿ç”¨å…±äº«å†…å­˜ï¼Œå¯ä»¥ä½¿ç”¨è®¸å¤šé”å®šæœºåˆ¶ï¼ˆäº’æ–¥é”å’Œä¿¡å·é‡ï¼‰ã€‚ä¸ºäº†ç»„ç»‡å¤æ‚çš„æ•°æ®ç»“æ„ï¼Œnginx è¿˜æä¾›äº†ä¸€ä¸ªçº¢é»‘æ ‘å®ç°ã€‚çº¢é»‘æ ‘ç”¨äºå°†ç¼“å­˜å…ƒæ•°æ®ä¿å­˜åœ¨å…±äº«å†…å­˜ä¸­ï¼Œè·Ÿè¸ªéæ­£åˆ™è¡¨è¾¾å¼ä½ç½®å®šä¹‰ä»¥åŠå…¶ä»–å‡ é¡¹ä»»åŠ¡ã€‚ é—æ†¾çš„æ˜¯ï¼Œä¸Šè¿°æ‰€æœ‰å†…å®¹ä»æœªä»¥ä¸€è‡´å’Œç®€å•çš„æ–¹å¼æè¿°ï¼Œå› æ­¤å¼€å‘ nginx çš„ç¬¬ä¸‰æ–¹æ‰©å±•çš„å·¥ä½œéå¸¸å¤æ‚ã€‚è™½ç„¶å­˜åœ¨å…³äº nginx å†…éƒ¨çš„ä¸€äº›å¥½çš„æ–‡æ¡£ - ä¾‹å¦‚ï¼Œç”± Evan Mille r ç”Ÿæˆçš„é‚£äº›æ–‡æ¡£ - éœ€è¦å¤§é‡çš„é€†å‘å·¥ç¨‹å·¥ä½œï¼Œå¹¶ä¸” nginx æ¨¡å—çš„å®ç°ä»ç„¶æ˜¯è®¸å¤šäººçš„é»‘ç§‘æŠ€ã€‚ å°½ç®¡ä¸ç¬¬ä¸‰æ–¹æ¨¡å—å¼€å‘ç›¸å…³çš„æŸäº›å›°éš¾ï¼Œnginx ç”¨æˆ·ç¤¾åŒºæœ€è¿‘çœ‹åˆ°äº†è®¸å¤šæœ‰ç”¨çš„ç¬¬ä¸‰æ–¹æ¨¡å—ã€‚ä¾‹å¦‚ï¼Œæœ‰ä¸€ä¸ªç”¨äº nginx çš„åµŒå…¥å¼ Lua è§£é‡Šå™¨æ¨¡å—ï¼Œç”¨äºè´Ÿè½½å‡è¡¡çš„é™„åŠ æ¨¡å—ï¼Œå®Œæ•´çš„ WebDAV æ”¯æŒï¼Œé«˜çº§ç¼“å­˜æ§åˆ¶ä»¥åŠæœ¬ç« ä½œè€…é¼“åŠ±å¹¶å°†åœ¨æœªæ¥æ”¯æŒçš„å…¶ä»–æœ‰è¶£çš„ç¬¬ä¸‰æ–¹å·¥ä½œã€‚ï¼ˆå‚è€ƒ Open Resty â€“ è¯‘è€…æ³¨ï¼‰ 14.5. æ”¶è·å½“ Igor Sysoev å¼€å§‹ç¼–å†™ nginx æ—¶ï¼Œå¤§å¤šæ•°ç»™äº’è”ç½‘èµ‹èƒ½çš„è½¯ä»¶å·²ç»å­˜åœ¨ï¼Œå¹¶ä¸”è¿™ç§è½¯ä»¶çš„ä½“ç³»ç»“æ„é€šå¸¸éµå¾ªä¼ ç»ŸæœåŠ¡å™¨å’Œç½‘ç»œç¡¬ä»¶ï¼Œæ“ä½œç³»ç»Ÿå’Œæ—§çš„äº’è”ç½‘ä½“ç³»ç»“æ„ã€‚ç„¶è€Œï¼Œè¿™å¹¶æ²¡æœ‰é˜»æ­¢ Igor è®¤ä¸ºä»–èƒ½å¤Ÿç»§ç»­æ”¹è¿› Web æœåŠ¡å™¨é¢†åŸŸçš„ä¸œè¥¿ã€‚æ‰€ä»¥ï¼Œè™½ç„¶ç¬¬ä¸€è¯¾å¯èƒ½çœ‹èµ·æ¥å¾ˆç®€å•ï¼Œä½†äº‹å®æ˜¯ï¼šæ€»æœ‰æ”¹è¿›çš„ä½™åœ°ã€‚ è€ƒè™‘åˆ°æ›´å¥½çš„ Web è½¯ä»¶çš„æƒ³æ³•ï¼ŒIgor èŠ±äº†å¾ˆå¤šæ—¶é—´å¼€å‘åˆå§‹ä»£ç ç»“æ„å¹¶ç ”ç©¶ä¸ºå„ç§æ“ä½œç³»ç»Ÿä¼˜åŒ–ä»£ç çš„ä¸åŒæ–¹æ³•ã€‚åå¹´åï¼Œå‚è€ƒåœ¨ç‰ˆæœ¬ 1 ä¸Šçš„å¤šå¹´ç§¯æå¼€å‘ï¼Œä»–å¦‚ä»Šæ­£åœ¨å¼€å‘ nginx ç‰ˆæœ¬ 2.0 çš„åŸå‹ã€‚å¾ˆæ˜æ˜¾ï¼Œä¸€ä¸ªè½¯ä»¶äº§å“çš„æ–°æ¶æ„çš„åˆå§‹åŸå‹å’Œåˆå§‹ä»£ç ç»“æ„å¯¹äºæœªæ¥çš„é‡è¦æ€§æ˜¯éå¸¸é‡è¦çš„ã€‚ å€¼å¾—ä¸€æçš„å¦ä¸€ç‚¹æ˜¯å‘å±•åº”è¯¥é›†ä¸­ã€‚Windows ç‰ˆæœ¬çš„ nginx å¯èƒ½æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„ä¾‹å­ï¼Œè¯´æ˜å¦‚ä½•é¿å…åœ¨æ—¢ä¸æ˜¯å¼€å‘äººå‘˜çš„æ ¸å¿ƒç«äº‰åŠ›æˆ–ç›®æ ‡åº”ç”¨ç¨‹åºçš„æƒ…å†µä¸‹ç¨€é‡Šå¼€å‘å·¥ä½œã€‚å®ƒåŒæ ·é€‚ç”¨äºé‡å†™å¼•æ“ï¼Œè¯¥å¼•æ“åœ¨å¤šæ¬¡å°è¯•å¢å¼º nginx æ—¶å‡ºç°ï¼Œå…·æœ‰æ›´å¤šåŠŸèƒ½ä»¥ä¾¿ä¸ç°æœ‰çš„æ—§è®¾ç½®å‘åå…¼å®¹ã€‚ ä½†å€¼å¾—ä¸€æçš„æ˜¯ï¼Œå°½ç®¡ nginx å¼€å‘è€…ç¤¾åŒºä¸æ˜¯å¾ˆå¤§ï¼Œä½† nginx çš„ç¬¬ä¸‰æ–¹æ¨¡å—å’Œæ‰©å±•ä¸€ç›´æ˜¯å…¶å—æ¬¢è¿ç¨‹åº¦çš„é‡è¦ç»„æˆéƒ¨åˆ†ã€‚ Evan Millerï¼ŒPiotr Sikoraï¼ŒValery Kholodkovï¼ŒZhang Yichunï¼ˆagentzh ä¸­æ–‡åï¼šç« äº¦æ˜¥ï¼‰ä»¥åŠå…¶ä»–æ‰åæ¨ªæº¢çš„è½¯ä»¶å·¥ç¨‹å¸ˆæ‰€åšçš„å·¥ä½œå¾—åˆ°äº† nginx ç”¨æˆ·ç¤¾åŒºåŠå…¶åŸå§‹å¼€å‘äººå‘˜çš„èµèµã€‚ å‚è€ƒæ–‡æ¡£ æ˜¥å“¥çš„ nginx æ•™ç¨‹ æ·˜å® Tengine å›¢é˜Ÿ","categories":[],"tags":[{"name":"åŸºç¡€ç»„ä»¶","slug":"åŸºç¡€ç»„ä»¶","permalink":"https://razertory.me/tags/åŸºç¡€ç»„ä»¶/"}]},{"title":"GraphQL ä¼˜åŒ–åˆ†äº«","slug":"opt-graphql-server","date":"2018-06-13T16:04:44.000Z","updated":"2020-03-28T13:02:10.001Z","comments":true,"path":"2018/06/14/opt-graphql-server/","link":"","permalink":"https://razertory.me/2018/06/14/opt-graphql-server/","excerpt":"","text":"ä¸Šå‘¨ç»™å…¬å¸çš„ç ”å‘åŒäº‹ä»¬åšäº†ä¸€æ¬¡æœåŠ¡ç«¯çš„ GraphQL ä¼˜åŒ–åˆ†äº«ï¼Œä¸»è¦æ˜¯åç«¯åŒäº‹ï¼Œè¿™é‡Œæ‰“ç®—å†™åšæ–‡çš„æ–¹å¼è®°ä¸‹æ¥ã€‚ ç¼“å­˜å…¶å®ç¼“å­˜è¿™ä¸ªè¯ï¼Œæˆ‘ä¸ªäººä¼šè§‰å¾—æ¯”è¾ƒå«ç³Šï¼Œæœ‰æ—¶å€™æˆ‘ä»¬ä¼šæŠŠ cache å’Œ buffer è¿™ä¸¤ä¸ªä¸œè¥¿å¼„æ··æ·† Cache ä¸ºäº†å¼¥è¡¥é«˜é€Ÿè®¾å¤‡å’Œä½é€Ÿè®¾å¤‡çš„é¸¿æ²Ÿè€Œå¼•å…¥çš„ä¸­é—´å±‚ï¼Œæœ€ç»ˆèµ·åˆ° â€œåŠ å¿«è®¿é—®é€Ÿåº¦â€ çš„ä½œç”¨ã€‚æ¯”å¦‚ï¼šCPU ç¼“å­˜ï¼ŒNoSQL ç¼“å­˜ Buffer ä¸»è¦ç›®çš„è¿›è¡Œæµé‡æ•´å½¢ï¼ŒæŠŠçªå‘çš„å¤§æ•°é‡è¾ƒå°è§„æ¨¡çš„ I/O æ•´ç†æˆå¹³ç¨³çš„å°æ•°é‡è¾ƒå¤§è§„æ¨¡çš„ I/Oï¼Œä»¥ â€œå‡å°‘å“åº”æ¬¡æ•°â€ï¼ˆæ¯”å¦‚ä»ç½‘ä¸Šä¸‹ç”µå½±ï¼Œä½ ä¸èƒ½ä¸‹ä¸€ç‚¹ç‚¹æ•°æ®å°±å†™ä¸€ä¸‹ç¡¬ç›˜ï¼Œè€Œæ˜¯ç§¯æ”’ä¸€å®šé‡çš„æ•°æ®ä»¥åä¸€æ•´å—ä¸€èµ·å†™ï¼Œä¸ç„¶ç¡¬ç›˜éƒ½è¦è¢«ä½ ç©åäº†ï¼Œæ¯”å¦‚ TCP åšæ•°æ®ä¼ é€’çš„æ—¶å€™ï¼Œå•ä½æ˜¯â€œå¸§â€ è€Œä¸æ˜¯ä¸€ä¸ªä¸ªçš„å­—èŠ‚ï¼‰ æµè§ˆå™¨ / APP -&gt; ç½‘ç»œè½¬å‘ -&gt; åº”ç”¨æœåŠ¡å™¨ -&gt; DB æ¯ä¸ªåœ°æ–¹éƒ½å¯ä»¥ç”¨ç¼“å­˜æ–¹å¼æ¥åšã€‚æ¯”å¦‚è¿™é‡Œçš„åˆ†äº«ä¸»è¦æ¥è‡ªäºåº”ç”¨æœåŠ¡å™¨ã€‚ Chattyå…¶å®åœ¨æˆ‘å¦ä¸€ç¯‡åšæ–‡é‡Œé¢æœ‰æåˆ°è¿™ä¸€æ–¹é¢çš„ä¼˜åŒ–ï¼Œè¿™é‡Œæˆ‘æ‰“ç®—è¯¦ç»†åˆ†æã€‚ â€œGraphQL æ˜¯ä¸€ç§å¯ä»¥è®©ç¨‹åºå‘˜ç¼–å†™ clean code çš„æ–¹æ³•ï¼Œæ¯ä¸ª type çš„ field éƒ½æœ‰ç€å•ä¸€çš„ç›®çš„ï¼ˆsingle-purposeï¼‰ã€‚ç„¶è€Œï¼Œå¦‚æœæˆ‘ä»¬ä¸å¤šåŠ è€ƒè™‘ï¼Œé‚£ä¹ˆæˆ‘ä»¬çš„ GraphQL æœåŠ¡ç«¯å°±ä¼šå˜å¾—éå¸¸â€™chattyâ€™ï¼Œæˆ–è€…è¯´ä¼šæ‰§è¡Œå¾ˆå¤šé‡å¤çš„æŸ¥è¯¢â€ â€“ https://graphql.org/learn/best-practices(ä¸ªäººç¿»è¯‘) æ¯”å¦‚æˆ‘å¸æœ‰ä¸€ä¸ªæœåŠ¡ç«¯æŸ¥è¯¢ï¼š 1234567891011121314query clazz($id: ID) &#123; clazz(id: $id) &#123; subjects&#123; id activities &#123; id teacher &#123; id name &#125; &#125; &#125; &#125;&#125; è¿™æ ·ä¸€ä¸ªæŸ¥è¯¢ï¼Œå¦‚æœä¸åšé€‚å½“çš„å¤„ç†ä¼šå˜å¾—å¾ˆæ…¢ã€‚è¿™é‡Œçš„æŸ¥è¯¢ä¼šéå†ä¸¤ä¸ªåˆ—è¡¨ subjects å’Œ activities ç”¨æ¥è·å– teacher æ•°æ®ï¼Œå¦‚æœåšä¸€ä¸‹å¤æ‚åº¦åˆ†æï¼Œå¯èƒ½å¾ˆå®¹æ˜“å¾—åˆ°ï¼Œæ‰§è¡Œ SQL çš„æ•°ç›®å°±æ˜¯ä¸¤ä¸ªåˆ—è¡¨çš„çŸ©é˜µæ•°ï¼Œä¹Ÿå°±æ˜¯ O(N * M)ã€‚è¿™æ ·å½“ç„¶ä¼šå¾ˆæ…¢ï¼Œæ‰€ä»¥ä¸å¾—ä¸ç”¨ä¸Šä¸€äº› batching æŠ€æœ¯ã€‚ 1gem 'graphql-batch' ç”¨ä¸Šè¿™ä¸ªæŠ€æœ¯ä¹‹åï¼Œæˆ‘ä¹‹å‰çš„è¿™ç§å¤§é‡ SQL çš„æŸ¥è¯¢ï¼Œå°±ä¼šè¢«æ•´å‹æˆå°‘é‡çš„ in æŸ¥è¯¢ã€‚è¿™é‡Œå…³äº N + 1 query çš„ä¸œè¥¿ä¸å†èµ˜è¿°ã€‚åšå¤æ‚åº¦åˆ†æçš„æ—¶å€™å°±ä¼šå‘ç° SQL æ‰§è¡Œæ•°ç›®åªå’Œæ•°æ®åµŒå¥—æ·±åº¦æœ‰å…³ã€‚ Promiseåœ¨åš GraphQL Server å¼€å‘çš„æ—¶å€™ï¼Œæˆ‘å¯¹ä¸€ä¸ªäº‹æƒ…ä¸€ç›´å¾ˆå¥½å¥‡ï¼Œå°±æ˜¯æ¯ä¸ª field è·å–æ˜¯ä¸æ˜¯å¼‚æ­¥çš„ï¼Ÿæ‰€ä»¥æˆ‘åšäº†ä»¥ä¸‹å®éªŒï¼š 1234567891011121314151617181920212223242526272829def blocking_query(id) p Thread.current.to_s sleep 3 idendfield :a, types.String do resolve -&gt; (o, args, c) &#123; blocking_query \"a\" &#125;endfield :b, types.String do resolve -&gt; (o, args, c) &#123; blocking_query \"b\" &#125;endfield :c, types.String do resolve -&gt; (o, args, c) &#123; blocking_query \"c\" &#125;endfield :d, types.String do resolve -&gt; (o, args, c) &#123; blocking_query \"d\" &#125;end ç»“æœéå¸¸ä¸ä¹è§‚ 123456#&lt;Thread:0x007fe15e1887fb0&gt;#&lt;Thread:0x007fe15e1887fb0&gt;#&lt;Thread:0x007fe15e1887fb0&gt;#&lt;Thread:0x007fe15e1887fb0&gt;Completed 200 OK in 12641ms å¯ä»¥å‘ç°æˆ‘æ¯ä¸ª field çš„è€—æ—¶è¢«å åŠ èµ·æ¥äº†ã€‚åŒæ—¶å‘ç°æ¯ä¸ª field çš„è·å–æ‰“å°çº¿ç¨‹éƒ½æ˜¯ä¸€æ ·çš„å†…å®¹ã€‚ è¿™æ—¶å€™å¯ä»¥åŠ ä¸Šå¼‚æ­¥ä¼˜åŒ–æ¥å¤„ç†ï¼Œå®Œæˆä¸€ä¸ª Promiseï¼Œæ¥è‡ª issue 1234567891011121314151617181920212223242526272829303132require 'promise'module ConcurrentPromise def self.execute promise = Promise.new promise.source = Source.new(promise) &#123; yield &#125; promise end class Source def initialize(promise) @promise = promise # Promise isn't thread-safe, so the thread needs to store the result # on a separate object @thread_result = Promise.new @thread = Thread.new(@thread_result) do |result| begin result.fulfill(yield) rescue =&gt; err result.reject(err) end end end def wait @thread.join @promise.fulfill(@thread_result) end end private_constant :Sourceend åŒæ—¶ä¼˜åŒ–æˆ‘çš„æŸ¥è¯¢æ–¹æ³• 1234567def blocking_query(id) ConcurrentPromise.execute do p Thread.current.to_s sleep 3 id endend æ‰§è¡Œç»“æœ 123456#&lt;Thread:0x007fe15e18897d0&gt;#&lt;Thread:0x007fe15e1888f60&gt;#&lt;Thread:0x007fe15e1884g30&gt;#&lt;Thread:0x007fe15e1887g60&gt;Completed 200 OK in 3577ms å¯ä»¥å‘ç°æ‰“å°çš„çº¿ç¨‹å †æ ˆæ˜¯ä¸åŒçš„å†…å®¹ï¼ŒåŒæ—¶æ¥å£é€Ÿåº¦æ¥è¿‘äºå•ä¸ª field çš„æ‰§è¡Œé€Ÿåº¦ã€‚ åœ¨é˜…è¯» graphql-batch æºç ä¸­æˆ‘ä¹Ÿå‘ç°äº†è¿™æ ·å­ç±»ä¼¼çš„ä¸€æ®µ 123456def load(key) cache[cache_key(key)] ||= begin queue &lt;&lt; key ::Promise.new.tap &#123;|promise| promise.source = self&#125; endend åŸºäº Promise æ¥å’Œç¼“å­˜ key çš„æ–¹å¼æ¥å®Œæˆã€‚ åè®°ç¼“å­˜ï¼Œå¼‚æ­¥ï¼Œè¿™ä¸€ç±»çš„è¯çœ¼åœ¨ç°ä»£çš„ç ”å‘ä½“ç³»ä¸­æ€»æ˜¯å¾ˆå¸¸è§ï¼ŒGraphQL çš„ ruby ç”Ÿæ€è¿˜éœ€æ¨è¿›ã€‚","categories":[],"tags":[{"name":"ç³»ç»Ÿè®¾è®¡","slug":"ç³»ç»Ÿè®¾è®¡","permalink":"https://razertory.me/tags/ç³»ç»Ÿè®¾è®¡/"}]},{"title":"æˆ‘çš„ã€Œjava-code-labã€","slug":"start-my-coding-project","date":"2018-06-01T05:23:53.000Z","updated":"2020-03-28T13:02:10.001Z","comments":true,"path":"2018/06/01/start-my-coding-project/","link":"","permalink":"https://razertory.me/2018/06/01/start-my-coding-project/","excerpt":"","text":"åœ¨å¿µä¹¦æœŸé—´ï¼Œå­¦ä¹ æ•°æ®ç»“æ„è¯¾ç¨‹çš„æ—¶å€™ï¼Œæˆ‘å‘ç°äº†ä¸€ä¸ªè´¨é‡å¾ˆå¥½çš„ Java æ•°æ®ç»“æ„ é¡¹ç›®ï¼Œå½“æ—¶ä¹Ÿæ˜¯å—ç›ŠåŒªæµ…ã€‚åæ¥çš„å‡ å¹´ä½œè€…æ²¡æœ‰å†ç»´æŠ¤ï¼Œä½†æˆ‘è®¤ä¸ºè¿™ä¼šæ˜¯ä¸€ä¸ªéå¸¸å¥½çš„æ¨¡å¼ã€‚ è®°å¾—åœ¨ OJ ä¸Šåš ACM æ—¶ï¼Œæˆ‘æ€»ä¼šå»æ€è€ƒè¿™ä¸ªä»£ç ä¼šå¦‚ä½•å»é€šè¿‡æµ‹è¯•ç”¨ä¾‹ï¼Œè¾¾åˆ° Accepted çŠ¶æ€ï¼Œè®°å¾—å½“æ—¶çš„åŒå­¦ã€å­¦é•¿è¯´æ˜¯åå°æœ‰ä¸€ä¸ªè·‘æµ‹è¯•ç”¨ä¾‹çš„æœåŠ¡ã€‚é€šè¿‡è¿™ä¸ªæœåŠ¡å¯ä»¥æ£€æŸ¥ä½ ä»£ç çš„è¯­æ³•æ­£ç¡®æ€§ã€ç»“æœæ­£ç¡®æ€§ä»¥åŠæ—¶é—´ç©ºé—´å¤æ‚åº¦ã€‚ åæ¥åœ¨å·¥ä½œä¸­æˆ‘æ¥è§¦åˆ°äº† TDD å¼€å‘æ¨¡å¼ï¼Œæˆ–è€…è¯´ä»£ç å¼€å§‹æœ‰å•å…ƒæµ‹è¯•ï¼Œæ‰€ä»¥å°±ä¼šæƒ³èµ·äº†è¿™ä¸ªé¡¹ç›®ï¼Œæ‰“ç®—é‡åšä¸€ä¸ªã€‚ä¸€æ¥è‡ªæˆ‘å­¦ä¹ ï¼Œå½“ç¨‹åºã€æ•°æ®ç»“æ„ã€ç®—æ³•ä¸æˆ‘æœ‰æ›´æ·±çš„ç†è§£ï¼›äºŒæ˜¯éªŒè¯è¿™ç§æ¨¡å¼å¯¹äºä»–äººçš„ç›Šå¤„æ˜¯å¦æœ‰æˆ‘æƒ³è±¡çš„é‚£æ ·å¤šã€‚ å†…å®¹åŸºç¡€çš„æ•°æ®ç»“æ„å’Œç®—æ³•å¿…ä¸å¯å°‘ï¼Œé‚£ä¹ˆåŸºç¡€çš„ç¨‹åº¦æˆ‘æƒ³å…ˆä»¥çº¢çš®ä¹¦ã€Šç®—æ³•ã€‹ä¸ºä¸»ã€‚ç¡®ä¿åœ¨è¿™ä¸ªç‚¹ä¸Šï¼Œæˆ‘èƒ½åšåˆ°æœ€å¥½ã€‚éšåï¼Œæˆ‘ä¼šåŠ å…¥ã€Šç®—æ³•å¯¼è®ºã€‹çš„å†…å®¹å’Œæ¡ˆä¾‹ã€‚å‡ ä¸ªå¥½å¤„ï¼šç¬¬ä¸€ï¼Œã€Šç®—æ³•å¯¼è®ºã€‹æåˆ°çš„æ¡ˆä¾‹ä»¥åŠå®ç°éƒ½æ˜¯å·¥ä¸šçº§çš„ï¼Œæ¯”å¦‚åˆ‡å‰²é’¢æ¡ï¼ŒDNA æœ€é•¿å…¬å…±åºåˆ—ï¼Œè‚¡ç¥¨æ¶¨å¹…ç­‰ã€‚ç¬¬äºŒï¼Œã€Šç®—æ³•å¯¼è®ºã€‹é‡Œé¢ç»™å‡ºäº†å¤§é‡çš„æ•°å­¦æ¨å¯¼å’Œè®ºè¯ã€‚æ‰€ä»¥åœ¨åæœŸåšæ€§èƒ½æµ‹è¯•çš„æ—¶å€™ï¼Œå¦‚æœæˆ‘çš„æµ‹è¯•ç»“æœå’Œé¢„æƒ³çš„æœ‰åå·®ï¼Œæˆ‘å¯ä»¥æ‰¾åˆ°ç†è®ºä¾æ®æˆ–è€…çš„ç¡®æ˜¯è‡ªå·±å‡º bug çš„åœ°æ–¹ã€‚å†è€…ï¼Œå¹¶å‘ç¼–ç¨‹ï¼ŒIOï¼Œç½‘ç»œç¼–ç¨‹ï¼Œè®¾è®¡æ¨¡å¼ä»¥åŠä¸€äº›ç³»ç»Ÿè®¾è®¡çš„å†…å®¹åŒæ ·æ˜¯è¿™ä¸ªé¡¹ç›®ä¼šæ¶‰åŠçš„ã€‚é™¤äº†åŸºç¡€çš„ç®—æ³•æˆ–è€…æ•°æ®ç»“æ„æˆ‘åº”è¯¥å»å®ç°ï¼ŒåŒæ—¶æˆ‘ä¹Ÿä¼šä» Leetcodeï¼ŒLintcodeï¼Œå‰‘æŒ‡ Offer ä¸Šå»å¯»æ‰¾ä¸€äº›ç›¸å…³çš„é¢˜ç›®çš„è§£ç­”å’Œæµ‹è¯•ç”¨ä¾‹ã€‚ä¸¾ä¸ªä¾‹å­å°±æ˜¯æˆ‘ä»¬å®ç° Kth Bigest è¿™ç§é—®é¢˜çš„æ—¶å€™ï¼Œæœ‰ä¸€ç§å°±æ˜¯å¿«æ’çš„åšæ³•ï¼Œå¯ä»¥å‘ç°åªè¦å¯¹å¿«æ’åšå°‘è®¸çš„ä¿®æ”¹å°±å¯ä»¥å®ç°ï¼›å½“ç„¶ï¼Œç”¨å †ä¹Ÿæ˜¯ä¸ªå¾ˆå¥½çš„é€‰æ‹©ã€‚ è¿™ä¸ªé¡¹ç›®é™¤äº†æ•°æ®ç»“æ„å’Œç®—æ³•ï¼Œè¿˜æœ‰åŒ…æ‹¬ä½†ä¸é™äºè®¾è®¡æ¨¡å¼ï¼Œç½‘ç»œ IOï¼Œå¹¶å‘ç¼–ç¨‹ç­‰è®¡ç®—æœºé¢†åŸŸè¾ƒä¸ºåŸºç¡€çš„æ¡ˆä¾‹å®ç°ä¸æµ‹è¯•ã€‚ æµ‹è¯•åœ¨å®é™…çš„é¡¹ç›®å¼€å‘ä¸­ï¼Œç¼–å†™æµ‹è¯•ä»£ç æ˜¯å¾ˆå¤šå…¬å¸ä¸ºäº†ä¿è¯è½¯ä»¶è´¨é‡çš„æ¨èæ–¹æ³•ã€‚ä½†æ˜¯åœ¨è¿™ä¸ªé¡¹ç›®é‡Œé¢ï¼Œé™¤äº†è¯æ˜ç®—æ³•çš„æ­£ç¡®æ€§ã€‚æ›´å¤šçš„æ˜¯åœ¨äºèƒ½å¤Ÿè®©ä½¿ç”¨è€…åœ¨ç ”ç©¶æŸä¸ªä»£ç çš„æ—¶å€™ï¼Œèƒ½å¤Ÿæ–¹ä¾¿ã€æ¸…æ™°å‘ç°ç¨‹åºæ˜¯æ€ä¹ˆè·‘çš„ã€‚è¿™ä¸€ç‚¹å¾ˆé‡è¦ï¼Œç›¸æ¯”äºåªç»™å‡ºä»£ç å’Œä»£ç çš„å›¾æ–‡è®²è§£ï¼Œæˆ‘è®¤ä¸ºï¼šæ¯ä¸ªäººçš„ç†è§£èƒ½åŠ›å’Œç†è§£æ–¹å¼éƒ½æ˜¯ä¸åŒçš„ï¼Œä½†åšç¼–ç å·¥ä½œçš„äººï¼Œå¤§é‡çš„è®¤çŸ¥å’Œç†è®ºéƒ½ä¼š\bå®ç°åˆ°ä»£ç ä¸Šã€‚æ‰€ä»¥ï¼Œåªæœ‰å¾ˆæ¸…æ¥šè‡ªå·±è¦å†™ä»€ä¹ˆæ ·çš„ä»£ç çš„æ—¶å€™ï¼Œæ‰èƒ½çœŸæ­£æŒ‰ç…§æ„å›¾å†™å‡ºæ¥ã€‚è¿™ä¸€ç‚¹ï¼Œæˆ‘è®¤ä¸ºé€šè¿‡æµ‹è¯•ç”¨ä¾‹çš„æ–¹å¼æ˜¯æœ€å¥½ã€‚å½“æˆ‘æƒ³ç†è§£ä¸€æ®µä»£ç çš„æ—¶å€™ï¼Œæˆ‘å¯ä»¥ debugï¼Œå¯ä»¥è¯•åšä¿®æ”¹é€šè¿‡è·‘æµ‹è¯•çš„æ–¹å¼æ¥è¯æ˜è‡ªå·±çš„æ€è·¯æ˜¯æ²¡æœ‰é—®é¢˜çš„ã€‚ åœ¨ç¼–å†™æµ‹è¯•ä»£ç çš„æ—¶å€™ï¼Œæˆ‘å¸¸å¸¸é‡åˆ°äº†ä¸€äº›é—®é¢˜ï¼Œæ¯”å¦‚ç»™å®šä¸€ä¸ªæ•°ç»„ç”Ÿæˆæœ€ä½äºŒå‰æœç´¢æ ‘ï¼Œæˆ‘è¯¥å¦‚ä½•è¯æ˜ç”Ÿæˆçš„äºŒå‰æœç´¢æ ‘æ˜¯æœ€ä½çš„ã€‚åœ¨æˆ‘å†™å•ä¾‹æ¨¡å¼çš„æµ‹è¯•ä»£ç çš„æ—¶å€™ï¼Œæˆ‘å‘ç°æˆ‘éœ€è¦æ¨¡æ‹Ÿå¹¶å‘çš„æƒ…æ™¯æ¥è¯æ˜ä¸€äº›çº¿ç¨‹å®‰å…¨é—®é¢˜ã€‚è¿™ä¸ªè¿‡ç¨‹å……æ»¡äº†æŒ‘æˆ˜å’Œä¹è¶£ã€‚ å¯¹äºå­¦ä¹ è€…æˆ‘è®¤ä¸ºä¸ç®¡æ˜¯å®ç°ä¸€ä¸ªç»å…¸çš„ç®—æ³•ï¼Œè¿˜æ˜¯ finish a problemï¼Œæœ€é‡è¦çš„æ˜¯è¦å­¦ä¼šå¦‚ä½•è§£å†³é—®é¢˜ã€‚æ‰€è°“çš„é—®é¢˜æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿåœ¨è¿™ä¸ªé¡¹ç›®é‡Œï¼Œé—®é¢˜å°±æ˜¯æµ‹è¯•ä»£ç é‡Œé¢çš„å†…å®¹ã€‚ç¨‹åºè¦å®ç°çš„ï¼Œå°±æ˜¯ä»¥æŸç§æ–¹å¼é€šè¿‡æµ‹è¯•ç”¨ä¾‹ã€‚è¿™äº›æˆ‘å’Œä¸€äº› contributors çš„å®ç°å¯¹äºæ¯ä¸€ä¸ªå­¦ä¹ è€…æ¥è¯´åªæ˜¯ä¸€ä¸ªå‚è€ƒå’Œå€¼å¾—è´¨ç–‘çš„ï¼ˆè´¨ç–‘ç¨‹åºçš„æ€§èƒ½å’Œæ­£ç¡®æ€§ï¼›åŒ…æ‹¬æµ‹è¯•ä»£ç æ˜¯å¦åˆä¹é€»è¾‘ï¼‰ã€‚æˆ‘è®¤ä¸ºï¼Œå½“æ‹¿åˆ°ä¸€ä¸ªæ–°çš„ç®—æ³•æ—¶ï¼Œæœ€å¥½å…ˆå»è‡ªå·±å®ç°ä¸€éï¼Œç„¶åå»å¯¹åº”çš„ unit test è·‘ä¸€éï¼Œå½“å…¶ä¸­æœ‰ç–‘éš¾çš„æ—¶å€™ï¼Œè®°å¾— debugã€‚åªæœ‰åœ¨æºç  + debug çš„æŠ•å°„ä¸‹ï¼Œæ‰€æœ‰çš„ç–‘æƒ‘éƒ½ä¼šè¢«æ•£å»ï¼Œé‚£äº›çœ‹èµ·æ¥å«ç³Šä¸æ¸…çš„é€»è¾‘ä¹Ÿä¼šå˜å¾—æ¸…æ™°ã€‚ åœ°å€ Talk is cheap. Show me the test!","categories":[],"tags":[{"name":"æ€è€ƒ","slug":"æ€è€ƒ","permalink":"https://razertory.me/tags/æ€è€ƒ/"}]},{"title":"å°† Rails é¡¹ç›®æ‹†åˆ†æˆå¾®æœåŠ¡æ¶æ„","slug":"æŠŠrailsé¡¹ç›®æ‹†åˆ†ä¸ºå¾®æœåŠ¡","date":"2018-03-07T07:21:50.000Z","updated":"2020-03-28T13:02:10.001Z","comments":true,"path":"2018/03/07/æŠŠrailsé¡¹ç›®æ‹†åˆ†ä¸ºå¾®æœåŠ¡/","link":"","permalink":"https://razertory.me/2018/03/07/æŠŠrailsé¡¹ç›®æ‹†åˆ†ä¸ºå¾®æœåŠ¡/","excerpt":"","text":"åŸæ–‡é“¾æ¥ï¼š* https://dev.to/iriskatastic/split-your-rails-app-using-microservices-ckl ğŸ“šæ­£æ–‡å½“ä½ çš„é¡¹ç›®å˜å¾—åºå¤§çš„æ—¶å€™ï¼Œé¡¹ç›®çš„å¤æ‚åº¦å°±ä¼šä»¥æŒ‡æ•°çº§å¢é•¿ã€‚ç¬”è€…æ›¾å‘è¡¨è¿‡å¦ä¸€ç¯‡æ–‡ç« ï¼Œç”¨ä»¥å¸®åŠ©åˆ«äººç†è§£ æœç€å¾®æœåŠ¡æ¼”è¿›çš„å¿…è¦æ€§ã€‚è¿™æ¬¡ï¼Œç¬”è€…ä¼šè¯¦ç»†è¯´æ˜ä¸ºä»€ä¹ˆå¾®æœåŒ–æ˜¯ä¸€ç§å·²ç»è¢«è¯å®è¿‡çš„ï¼Œå¹¶ä¸”å¯ä»¥è®©é¡¹ç›®æ›´å®¹æ˜“è®©äººç†è§£å’Œæ‰©å±•çš„è§£å†³æ–¹æ¡ˆã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æ¥æ¢ç©¶å¦‚ä½•æŠŠ Rails ç”¨å¾®æœåŠ¡çš„æ–¹å¼æ‹†åˆ†ã€‚ è¿™ç¯‡æ–‡ç« çš„æ ¸å¿ƒæ€æƒ³æ˜¯å¦‚ä½•å°†ä½ çš„ Rails é¡¹ç›®æ‹†åˆ†æˆå¾®æœåŠ¡æ¶æ„ã€‚ å¦‚æœä½ æœ‰ä¸€ä¸ªåºå¤§çš„ Rails é¡¹ç›®ï¼Œå¹¶ä¸”ä½ å¾ˆæ¸…æ¥šè¿™ä¸ªé¡¹ç›®éœ€è¦å˜å¾—ç®€å•å®¹æ˜“æ‰©å±•ã€‚é‚£ä¹ˆæœ¬æ–‡å°†å‘Šè¯‰ä½ æ„å»ºå‡º Ruby on Rails å¾®æœåŠ¡çš„ä¸»è¦ç†ç”±å’Œå¿…è¦æ¡ä»¶ã€‚ è™½ç„¶å°†ä¸€ä¸ªé¡¹ç›®æ¼”å˜æˆå¾®æœåŠ¡å»ºæœ‰å¥½æœ‰åï¼Œä½†å½“ä½ çš„é¡¹ç›®å˜å¾—åºå¤§å¹¶ä¸”éš¾ä»¥æ‰©å±•çš„æ—¶å€™ï¼Œä½ ä»ç„¶éœ€è¦æƒ³åŠæ³•å°†å®ƒæ‹†åˆ†ã€‚ å¾®æœåŠ¡æ¶æ„çš„ç¬¬ä¸€ä¸ªå…³é”®ç‚¹åœ¨äºï¼Œä½ çš„æœåŠ¡ç”±å„ä¸ªéƒ¨åˆ†ç»„æˆï¼Œä»–ä»¬ä¹‹é—´äº’ä¸è€¦åˆï¼Œå¹¶ä¸”æ¯ä¸ªéƒ¨åˆ†éƒ½å¯ä»¥ç‹¬ç«‹æˆä¸€ä¸ªé¡¹ç›®ã€‚å„ä¸ªéƒ¨åˆ†ä¹‹é—´çš„é€šä¿¡ä¾é å„è‡ªæš´éœ²çš„ APIï¼Œè¿™æ ·ä½¿å¾—æ¯ä¸ªå¼€å‘å›¢é˜Ÿå¯ä»¥ç‹¬ç«‹å¼€å‘ç»´æŠ¤è‡ªå·±çš„éƒ¨åˆ†ï¼Œé¿å…äº†ä¸åŒå›¢é˜Ÿä¹‹é—´å¯èƒ½ä¼šæ±¡æŸ“åˆ°å¯¹æ–¹çš„ä»£ç ã€‚ ä»€ä¹ˆæƒ…å†µä¸‹ä½ éœ€è¦æ‹†åˆ†äº†ï¼Ÿ ä½ çš„æµ‹è¯•ä»£ç ä¼šè·‘ 20min ä»¥ä¸Š models çš„æ•°é‡å¥½å‡ ç™¾ç”šè‡³ä¸Šåƒ é¡¹ç›®ä¸­æœ‰å®Œå…¨ç‹¬ç«‹çš„åŠŸèƒ½æ¨¡å— å¼€å‘äººå‘˜ä¸èƒ½å¤Ÿç‹¬ç«‹å¼€å‘ &amp; éƒ¨ç½²ä»–ä»¬è‡ªå·±çš„åŠŸèƒ½æ¨¡å—äº† æˆ–è®¸è¿˜æœ‰æ›´å¤šçš„åŸå› ï¼Œä½†ä¸Šè¿°çš„æ¡ä»¶æ˜¯ä½ ä¸€å®šä¸èƒ½å¿½è§†çš„ã€‚ å½“ç„¶ï¼Œä¸ç”¨å¾®æœåŠ¡æ¶æ„çš„è¯ï¼Œä½ ä¹Ÿå¯ä»¥å¤šéƒ¨ç½²ä¸€äº›æœåŠ¡å™¨ï¼Œæˆ–è€…å®ç°ä¸€äº›æ‰§è¡Œæ•ˆç‡æ›´é«˜çš„æŠ€æœ¯ã€‚ä½†æ˜¯å¯ä»¥æƒ³ä¸€ä¸‹ï¼Œ ä¸ºä»€ä¹ˆä¼šä½¿ç”¨å¾®æœåŠ¡æ–¹å¼æ‹†åˆ†é¡¹ç›®ï¼Ÿmicroservice-based é¡¹ç›®ç”±ä¸€ä¸ªä¸ªç‹¬ç«‹çš„åŠŸèƒ½æ¨¡å—ç»„æˆï¼Œæ¯ä¸ªåŠŸèƒ½æ¨¡å—æœ‰è‡ªå·±ç‹¬ç«‹çš„èŒè´£ã€‚è¿™ä¹Ÿå…è®¸äº†å¼€å‘å›¢é˜Ÿå¯ä»¥å„è‡ªç‹¬ç«‹å¼€å‘è‡ªå·±çš„åŠŸèƒ½æ¨¡å—ï¼Œè¿™ç§æœ¬èº«çš„ä½è€¦åˆç‰¹æ€§å¯ä»¥è®©æ¯ä¸ªåŠŸèƒ½æ¨¡å—å˜å¾—æ›´å°ï¼Œæ›´ç®€å•ï¼Œæ›´å®¹æ˜“ç†è§£ï¼Œä¹Ÿå¯è®©æ–°äººæ›´å¿«åœ°å‚åŠ é¡¹ç›®å¼€å‘ã€‚æœ€ç»ˆï¼Œå½“é¡¹ç›®è¢«å®Œå…¨è§£è€¦æ‹†åˆ†åï¼ŒåŠŸèƒ½è¿­ä»£çš„æˆæœ¬ä»£ä»·ä¹Ÿå°†æ›´å°ã€‚æ–°æŠ€æœ¯çš„å¼•å…¥å¯¼è‡´çš„æœåŠ¡é‡å†™ä¹Ÿå°†ä¼šå˜å¾—å¯è¡Œã€‚åŒæ ·çš„ï¼Œé‡‡ç”¨äº†å¾®æœåŠ¡çš„è·¨è¯­è¨€ç‰¹æ€§å¯ä»¥è®©ä½ çš„é¡¹ç›®ç”±ä¸åŒè¯­è¨€ï¼ŒæŠ€æœ¯æ¡†æ¶æ¥å®Œæˆã€‚å› æ­¤ï¼Œ ** é‡‡ç”¨å¾®æœåŠ¡çš„ä¼˜åŠ¿åœ¨äº ** åŠŸèƒ½æ¨¡å—å¯ä»¥è¢«å¤ç”¨ åŠŸèƒ½æ¨¡å—å¯ä»¥ç‹¬ç«‹äºæ•´ä¸ªé¡¹ç›®å¹³ç¨³å¿«é€Ÿéƒ¨ç½² æ›´åŠ å®¹æ˜“åŠ å…¥æ–°åŠŸèƒ½ å‡å°‘æµ‹è¯•æ—¶é—´æˆæœ¬ï¼Œä¸»è¦æ˜¯å¯ä»¥åœ¨ä¸€ä¸ªç‹¬ç«‹æ¨¡å—é‡Œæµ‹è¯•è€Œä¸æ˜¯åœ¨å¤§é¡¹ç›®ä¸­ å°é¡¹ç›®ä¸€å®šæ¯”å¤§é¡¹ç›®æ›´å®¹æ˜“ç»´æŠ¤ ç‹¬ç«‹çš„åŠŸèƒ½æ¨¡å—è®©å¼€å‘äººå‘˜å¯ä»¥ä¸“æ³¨äºè‡ªå·±çš„é‚£ä¸ªç‚¹ æ›´ä¸å®¹æ˜“æ”¹åŠ¨åˆ°æ— å…³çš„åŠŸèƒ½æ¨¡å— æ›´å¥½çš„å¯é æ€§å’Œå®¹é”™æ€§ æ›´å®¹æ˜“è¿ç§»å’Œå‡çº§ å…è®¸æŠ€æœ¯å¤šæ ·æ€§ï¼ˆ* è¯­è¨€æ ˆä¸ç»Ÿä¸€ä¸ä¸€å®šå¥½ â€“ è¯‘è€…æ³¨ *ï¼‰ ä»»ä½•ä¸€ä¸ªæœåŠ¡æŒ‚æ‰äº†ï¼Œéƒ½ä¸ä¼šå¯¼è‡´æ•´ä¸ªé¡¹ç›®æŒ‚æ‰ æ–°äººæ›´å®¹æ˜“ç†Ÿæ‚‰ä»£ç  ç„¶è€Œï¼Œåªæœ‰ä½ çš„é¡¹ç›®æ»¡è¶³äº†ä¸‹é¢çš„æ¡ä»¶çš„æ—¶å€™ï¼Œä½ æ‰å¯ä»¥ä½“ä¼šåˆ°è¿™äº›ä¼˜åŠ¿ Ruby on Rails é¡¹ç›®æ‹†åˆ†æˆä¸ºå¾®æœåŠ¡æ¶æ„çš„å¿…è¦å‰ç½®æ¡ä»¶ ä½ çš„é¡¹ç›®ä»£ç ä¸€å®šæ˜¯ Clean Code å› ä¸ºä½ çš„é¡¹ç›®æ‹†åˆ†æˆäº†å¾®æœåŠ¡æ¶æ„ä¹‹åï¼Œä»ä¸šåŠ¡å±‚é¢çœ‹é¡¹ç›®æœ¬èº«çš„æ˜¯å’Œä¹‹å‰ä¸€æ ·ã€‚ä½†å¦‚æœä½ çš„ä»£ç å†™å¾—å¾ˆç³Ÿç³•ï¼Œé¡¹ç›®è·‘åœ¨äº†å¾ˆç³Ÿç³•çš„ä»£ç ä¸Šã€‚ä½ çš„é¡¹ç›®å°†å¾ˆéš¾æŒ‰ç…§é¢„æœŸå»è¿­ä»£ã€‚ ä½ çš„é¡¹ç›®åº”è¯¥åˆç†åœ°æŒ‰ç…§æ­£ç¡®çš„åŠŸèƒ½è¾¹ç•Œå»æ‹†åˆ† å½“ä½ å¼€å§‹æ„å»ºå¾®æœåŠ¡æ¶æ„çš„æ—¶å€™ï¼Œä½ çš„é¡¹ç›®ä¸€å®šä¼šåŒ…å«äº†è®¸å¤š â€œå¾®æœåŠ¡â€ ç»„ä»¶ï¼Œæ¯ä¸ªç»„ä»¶çš„è¿è¡Œåº”è¯¥æ˜¯ç•…é€šæ— é˜»çš„ï¼Œå¹¶ä¸”ä»–ä»¬ä¹‹é—´çš„è¿è¡Œä¸ä¼šäº’ç›¸å¹²æ‰°ã€‚åªè¦èƒ½æŒ‰ç…§å‡†ç¡®ã€è‰¯å¥½çš„å®šä¹‰å»æ‹†åˆ†å‡ºæ¥ï¼Œä½ å°±èƒ½åšåˆ°è¿™ä¸€ç‚¹ã€‚è§„åˆ’å¥½ç»„ä»¶çš„æ¯ä¸ªä»»åŠ¡å’Œä¸è¯¥ä»»åŠ¡ç›¸å…³çš„å·¥ä½œï¼Œä»¥è·å¾—æœ€ä½³ç»“æœã€‚ç¡®ä¿ä½ æ‹†åˆ†å‡ºæ¥çš„æ¯ä¸ªç»„ä»¶éƒ½å„è‡ªç‹¬ç«‹ã€‚ ä½ çš„é¡¹ç›®åº”è¯¥æœ‰å¤‡ä»½ åœ¨ä½ çš„å¾®æœåŠ¡é¡¹ç›®ä¸­ï¼Œæ— è®ºä½•æ—¶ï¼Œå…¶ä¸­çš„ç»„ä»¶éƒ½æœ‰å¯èƒ½ä¼šæŒ‚æ‰ï¼Œä½†ä½ çš„æ•´ä¸ªé¡¹ç›®å´è¿˜æ˜¯å¯ä»¥ä¸€ç›´è·‘ã€‚æ•´ä¸ªé¡¹ç›®ä¸­ï¼ŒæŸä¸ªï¼ˆå¤šä¸ªï¼‰åŠŸèƒ½ç»„ä»¶æŒ‚æ‰äº†å¯èƒ½ä¼šç»™ä½ å¸¦æ¥ä¸€ç³»åˆ—é—®é¢˜ã€‚ ä½ éœ€è¦ç»™ä½ çš„é¡¹ç›®åœ¨è¿™ä¸ªæ–¹é¢åšå¥½è§„åˆ’ä»¥ä¿è¯æŒ‚çš„æ—¶é—´å¯ä»¥æœ€å°ã€‚è¿™å½“ç„¶å°±éœ€è¦ä½ èƒ½å¤Ÿåšå¥½å¯¹åº”çš„ç›‘æ§ï¼Œå½“æœ‰å¼‚å¸¸äº§ç”Ÿçš„æ—¶å€™å¯ä»¥åŠæ—¶åº”å¯¹ã€‚è¿™ç§ç­–ç•¥å¯ä»¥è®©å·¥ç¨‹å¸ˆä»¬åœ¨ç”¨æˆ·æ„ŸçŸ¥åˆ°æœåŠ¡æŒ‚æ‰ä¹‹å‰å¤„ç†å¥½ã€‚ å½“ä½ çš„åšå¥½è¿™äº›å‡†å¤‡çš„æ—¶å€™ï¼Œå°±å¯ä»¥å¼€å§‹æ‹†äº†ã€‚ å¦‚ä½•æŠŠä½ çš„ Rails é¡¹ç›®æ‹†æ‰å‘¢ï¼Ÿæ­£å¸¸æƒ…å†µä¸‹ï¼Œä¸€ä¸ª Rails é¡¹ç›®ä¼šè¢«åˆ†å±‚ï¼Œé€šå¸¸æ˜¯ï¼šè¡¨ç¤ºå±‚ (presentation), ä¸šåŠ¡é€»è¾‘å±‚ (business logic), æ•°æ®è¿æ¥å±‚ (data access)ã€‚ä¼ä¸šçº§é¡¹ç›®é€šå¸¸ä¹Ÿå°±è¢«åˆ†ä¸ºä¸Šè¿°ä¸‰å±‚ã€‚ä½ çš„å¾®æœåŠ¡ç»„ä»¶ä¹Ÿå°±åˆ†æˆäº†è¿™ä¸‰ç±»ã€‚ Presentation Layer å“åº” Http è¯·æ±‚å’Œå®ç°ï¼ˆRESTï¼‰API æˆ–è€… Web UIã€‚åœ¨é¡¹ç›®ä¸­é€šå¸¸ä¼šæœ‰å¤æ‚çš„ç”¨æˆ·äº¤äº’æ¥å£ã€‚ Business logic layer å®ç°ä¸šåŠ¡é€»è¾‘çš„ç»„ä»¶ Data-access layer åŸºç¡€è¿æ¥çš„ç»„ä»¶ï¼Œé€šå¸¸æ˜¯è¿æ¥æ•°æ®åº“æˆ–è€…æ¶ˆæ¯ä¸­é—´ä»¶ã€‚ åŒæ ·ï¼Œç¬”è€…ä¹Ÿæ¨èé˜…è¯» Syndicode çš„ Rails å¾®æœåŠ¡ã€‚","categories":[],"tags":[{"name":"ç³»ç»Ÿè®¾è®¡","slug":"ç³»ç»Ÿè®¾è®¡","permalink":"https://razertory.me/tags/ç³»ç»Ÿè®¾è®¡/"}]},{"title":"å‘ GraphQL è¿ç§»","slug":"graphql-in-ruby","date":"2018-01-19T16:21:00.000Z","updated":"2020-03-28T13:02:10.001Z","comments":true,"path":"2018/01/20/graphql-in-ruby/","link":"","permalink":"https://razertory.me/2018/01/20/graphql-in-ruby/","excerpt":"","text":"æ—¶é—´å¤§æ¦‚æ˜¯ 17 å¹´ä¹æœˆï¼Œæˆ‘å¸çš„æ–° App å¼€å·¥ã€‚åœ¨æŠ€æœ¯é€‰å‹ä¸Šï¼Œæˆ‘ä»¬å¾ˆæ¿€è¿›åœ°é€‰æ‹©äº† graphql instead of restfulã€‚å½“æ—¶æƒ³åˆ°çš„ç†ç”±æ˜¯å¾ˆç®€å•ï¼Œä½†æ˜¯ä¹Ÿæ— å¯åšéçš„ï¼šæˆ‘ä»¬çš„ App å’ŒåæœŸå°†è¦åšçš„æ–° Web åœ¨ä¸šåŠ¡ä¸Šæœ‰å¾ˆå¤§çš„ç›¸é€šæ€§ï¼Œå¹¶ä¸”åŠŸèƒ½æ¨¡å—æœ‰ä¸å°‘ç±»ä¼¼çš„åœ°æ–¹ï¼Œæ‰€ä»¥ç”¨ graphql è¿™æ ·çš„æŠ€æœ¯æ¥åš API å±‚å¤ç”¨æ€§ä¼šå¾ˆé«˜ã€‚åæœŸåœ¨åšä¸€äº›ç®¡ç†åå°çš„æ—¶å€™ï¼Œ\bæ•ˆç‡ä¹Ÿä¼šé«˜ä¸å°‘ã€‚ å¾ˆæœ‰å¹¸çš„æ˜¯ï¼Œè‡ªå·±æˆäº†ç ”å‘å›¢é˜Ÿä¸­è¿™ä¸ªæŠ€æœ¯çš„ä¸»è¦æ¨è¿›è€…ã€‚æˆ‘ä»¬çš„æœåŠ¡ç«¯ä¸»è¯­è¨€æ˜¯ Rubyï¼Œæ‰€ä»¥åƒ githubï¼ŒShopify è¿™æ ·çš„ GraphQL + Ruby çš„é¢†å…ˆè€…å¯¹æˆ‘ä»¬è€Œè¨€å¦‚åŒæ•™ç§‘ä¹¦ä¸€èˆ¬ã€‚æˆ‘ç ”ç©¶äº†å‡ ä¹æ¯ä¸ª Github çš„ Query å’Œ Mutationï¼Œæ‰€ä»¥å¾ˆå¤§ç¨‹åº¦ä¸Šä¹Ÿå—äºä»–ä»¬ä¼˜è´¨çš„æ€è·¯ï¼Œå’Œå®¢æˆ·ç«¯åŒå­¦ä»¬è¸©äº†ä¸€äº›å‘ï¼Œä½†æœ€åä¹Ÿéƒ½å¾—å‡ºäº†è¿™ä¸ªåœ¨å¼€å‘è¿‡ç¨‹ä¸­ï¼Œå¾ˆå¤šæ–¹é¢éƒ½ä¼šä¼˜äº rest çš„ç»“è®ºã€‚å…·ä½“çš„ä¼˜åŠ¿ï¼Œå’Œå®˜æ–¹è¯´çš„å·®ä¸å¤šï¼Œæˆ‘ä¹Ÿä¸æ„¿å†èµ˜è¿°ã€‚è¿™ç¯‡åšå®¢ï¼Œæ›´å¤šçš„æ˜¯å…³äºæŠ€æœ¯çš„æ„Ÿæ‚Ÿå’Œä¸€äº›æ¶æ„ä¸Šçš„ç†å¿µã€‚å¹æ¶æ„å¯èƒ½æœ‰ç‚¹æ‚¬ä¹ã€‚å¥½å§ï¼Œå°±å†æŠ½è±¡ä¸€ç‚¹ï¼Œåº”è¯¥æ˜¯åšå·¥ç¨‹çš„ä¸€äº›æ€»ç»“ï¼›å½“ç„¶ GraphQL çš„å¹²è´§å†…å®¹ä¹Ÿä¸ä¼šå°‘çš„ã€‚ å¼€å‘æ¨¡å¼ç”¨ graphql å¾ˆå¤§ç¨‹åº¦ä¸Šï¼Œçœå»äº†ä¸€äº›ä¸å¿…è¦çš„æ²Ÿé€šæˆæœ¬ã€‚å½“ä½ å—å¤Ÿäº†ç”¨ rest è¦å»æ„å»º API æ–‡æ¡£ä¹‹åï¼Œgraphql è¿™ç§å¤©ç„¶çš„ ä»£ç å³æ–‡æ¡£ çš„ä¾¿æ·æ€§è®©å›¢é˜Ÿå—ç›ŠåŒªæµ…ã€‚æœåŠ¡ç«¯åªéœ€è¦åœ¨ç¼–ç æœŸé—´ï¼ŒæŒ‰ç…§æ ‡å‡†çš„å†™æ³•ï¼ŒåŠ ä¸Šå¯¹åº”çš„ desc æ–¹æ³•ï¼Œå°±å¯ä»¥æ— ç¼ç”Ÿæˆå¯¹åº”çš„æ–‡æ¡£ã€‚ 12345678GuardianType = GraphQL::ObjectType.define do name 'Guardian' description 'A guardian has his/her children' field :id, types.ID field :name, types.String field :children, types[ChildType]end ä¹Ÿè®¸å¾ˆå¤šäººä¼šé—®ï¼Œè¿™æ ·åšï¼ŒæœåŠ¡ç«¯çš„ä¸šåŠ¡é€»è¾‘ä¸ä¹…ä¼šåˆ†æ•£ä¸€éƒ¨åˆ†åˆ°å®¢æˆ·ç«¯ä¸Šäº†ï¼Ÿå®¢æˆ·ç«¯çš„å·¥ä½œé‡ä¸å°±æå‡äº†ï¼Ÿ ä½†å®é™…ä¸Šï¼Œgraphql çš„è‡ªåŠ¨åŒ– + å¼ºç±»å‹ + â€˜å¼ºç»“æ„â€™è®©å®¢æˆ·ç«¯çš„å·¥ä½œé‡åè€Œä¸‹é™äº†ã€‚é¦–å…ˆï¼Œå®¢æˆ·ç«¯çš„çš„ç¡®æ˜¯è¦å†™æŸ¥è¯¢ä»£ç ï¼Œå°±åƒæ˜¯æœåŠ¡ç«¯å†™ SQL ä¸€æ ·ã€‚ä½†æ˜¯ graph çš„æŸ¥è¯¢è¦æ¯” SQL ç®€å•äº†ä¸çŸ¥é“å¤šå°‘å€ï¼Œæ›´å‡†ç¡®çš„ï¼Œæˆ‘å¯ä»¥ç§°ä¹‹ä¸º æè¿° 1234567891011query guardian&#123; guardain(id: 9527)&#123; id name children&#123; id name avatar &#125; &#125;&#125; åœ¨ä¼ ç»Ÿçš„ rest å¼€å‘æ¨¡å¼ä¸­ï¼Œå®¢æˆ·ç«¯å¹¶ä¸çŸ¥é“ä¸€ä¸ªè¯·æ±‚æœåŠ¡ç«¯ä¼šè¿”å›ä»€ä¹ˆç»“æœã€‚é™¤éæœ‰å‡†ç¡®ï¼Œå‡†æ—¶ï¼Œè¯¦å°½çš„æ–‡æ¡£ã€‚å®¢æˆ·ç«¯ä¼šææƒ§ï¼ŒæœåŠ¡ç«¯æŸä¸ªè¿”å›ç»“æœæ•°æ®ç»“æ„ä¸å¯¹è‡ªå·± crash äº†ã€‚æ‰€ä»¥åè€Œä¼šåœ¨è¿™ä¸€å±‚ä¸Šï¼Œæ€è€ƒå¾ˆå¤šã€‚ï¼ˆæˆ‘ä»¬è¯„ä»·ä¸€ä¸ªæŠ€æœ¯ä½“ç³»çš„å·¥ä½œæˆæœ¬ï¼Œé™¤äº†å®é™…çš„ç¼–ç äº§å‡ºï¼Œè¿˜åº”è¯¥è¯„ä¼°æ€è€ƒï¼Œæƒè¡¡æ‰€å¸¦æ¥çš„å¼€é”€ï¼‰ç»´æŠ¤æœªçŸ¥å“åº”ç»“æœçš„å¼€é”€ï¼Œæ€»æ˜¯ä¼šå¤§äºè‡ªå·±å†³å®šå“åº”ç»“æœçš„å¼€é”€ã€‚ æŠ€æœ¯ä¸Šçš„ææƒ§æ„Ÿï¼Œå¾€å¾€æ¥æºäºæœªçŸ¥ã€‚æ²¡æœ‰æµ‹è¯•ï¼Œä¸çŸ¥é“åŸç†ï¼Œæ²¡æœ‰çº¦å®šï¼Œæ²¡æœ‰è§„èŒƒï¼Œéƒ½æ˜¯ä¼šå¸¦æ¥æœªçŸ¥ã€‚ \bæŸ¥è¯¢æ€§èƒ½è§£å†³ N+1 query å’ŒæŸ¥è¯¢ç¯å‡ ä¹æ˜¯ graphql æœåŠ¡ç«¯ä½¿ç”¨è€…é‡åˆ°çš„ç¬¬ä¸€ä¸ªé—®é¢˜ã€‚ æˆ‘è®°å¾—åœ¨é‡åˆ°è¿™ä¸ªé—®é¢˜çš„æ—¶å€™ï¼Œæˆ‘çœ‹åˆ°äº† Facebook å®˜æ–¹å‡ºçš„ dataloader æ¥è§£å†³ã€‚æ‰€ä»¥åƒæˆ‘ä»¬è¿™ç§ Ruby æ ˆçš„å›¢é˜Ÿï¼Œè‡ªç„¶å°±é€‰ç”¨äº† Shopify å›¢é˜Ÿçš„ graphql-batchï¼Œç°åœ¨å›å¿†èµ·æ¥ä¾æ—§è®°å¾—å½“æ—¶çš„å…´å¥‹æ„Ÿã€‚å¥½å§ï¼Œè¿˜æ˜¯è´´ä¸¤å¼ å›¾ï¼Œå¯¹æ¯”ä¸€ä¸‹ã€‚ before1234567891011121314INFO -- : (0.019141s) DESCRIBE `activities`INFO -- : (0.018571s) SELECT * FROM `activities` WHERE (`subject_id` = 26)INFO -- : (0.017604s) SELECT * FROM `activities` WHERE (`subject_id` = 32)INFO -- : (0.015813s) SELECT * FROM `activities` WHERE (`subject_id` = 25)INFO -- : (0.016458s) SELECT * FROM `activities` WHERE (`subject_id` = 28)INFO -- : (0.016015s) SELECT * FROM `activities` WHERE (`subject_id` = 29)INFO -- : (0.016588s) SELECT * FROM `activities` WHERE (`subject_id` = 27)INFO -- : (0.019075s) SELECT * FROM `activities` WHERE (`subject_id` = 33)INFO -- : (0.014484s) SELECT * FROM `activities` WHERE (`subject_id` = 31)INFO -- : (0.017730s) SELECT * FROM `activities` WHERE (`subject_id` = 35)INFO -- : (0.017332s) SELECT * FROM `activities` WHERE (`subject_id` = 34)INFO -- : (0.015393s) SELECT * FROM `activities` WHERE (`subject_id` = 36)INFO -- : (0.016545s) SELECT * FROM `activities` WHERE (`subject_id` = 39)INFO -- : (0.014443s) SELECT * FROM `activities` WHERE (`subject_id` = 40) after123INFO -- : (0.022229s) SELECT * FROM `subjects` WHERE ((`clazz_id` = 1) AND (`grade_id` = 1)) ORDER BY `ordering`INFO -- : (0.018933s) DESCRIBE `activities`INFO -- : (0.105159s) SELECT * FROM `activities` WHERE (`subject_id` IN (26, 32, 25, 28, 29, 27, 33, 31, 35, 34, 36, 39, 40)) ä½œä¸ºä¸€ä¸ªéä¸»æµå…¥é—¨çš„ Ruby ç”¨æˆ·ï¼ˆæˆ‘ç¬¬ä¸€ä¸ªå¼€å§‹åšçš„ Ruby é¡¹ç›®æ˜¯ç”¨ Grape + ActiveRecord æ­å»ºçš„ï¼‰ï¼Œrails å…¶å®ä¹Ÿæ˜¯æœ€è¿‘æ‰å¼€å§‹çœŸæ­£ç”¨ä¸Šçš„ã€‚å½“é‡åˆ°ç¬¬ä¸€ä¸ªè®©äººå…´å¥‹çš„ä¸œè¥¿æ—¶ï¼Œè‡ªç„¶å¾—å»è¯»ä»–çš„æºç ã€‚ä¸è¿‡è¯»ä¹‹å‰ï¼Œå½“å‘ç°äº†è¿™ä¸ªç¥å¥‡çš„ä¸€å¹•æ—¶ï¼Œæˆ‘çš„ç¬¬ä¸€ç›´è§‰å‘Šè¯‰æˆ‘æ˜¯ä¸æ˜¯å’Œ JDBC è§„èŒƒä¸­çš„ prepared statement ä¸€æ ·ï¼Ÿè®©ç›¸åŒè¯­æ³•çš„ sql ä¸å†å¤šæ‰§è¡Œï¼Œåªè¦æ¢ sql çš„å‚æ•°å°±è¡Œã€‚è¿™æ · MySQl ç¼–è¯‘å¼€é”€å°±å°äº†å¾ˆå¤šã€‚åæ­£ç¼“å­˜æ— å¤„ä¸åœ¨ã€‚ä¸ï¼Œéš¾é“æ˜¯åŠ¨æ€è§„åˆ’ï¼Ÿã€‚å¥½å§ï¼Œéƒ½æ˜¯çŒœçš„ã€‚æ—¢ç„¶è¿™ä¸ªç©æ„å„¿è§£å†³äº†ä¸€ä¸ªé‡è¦ç“¶é¢ˆé—®é¢˜ï¼Œé‚£ä¹ˆä¸ç®¡å‡ºäºå…´è¶£å±‚é¢ï¼Œè¿˜æ˜¯ä¸šåŠ¡å±‚é¢ï¼Œå°½å¯èƒ½å»ç†Ÿæ‚‰å®ƒä¸€å®šæ˜¯å¾ˆå¥½çš„æƒ³æ³•ã€‚ é¦–å…ˆï¼Œè¿™ä¸ªç©æ„å„¿æ˜¯å­¦ä¹ äº† Facebook å®˜æ–¹çš„ dataloader åšçš„ã€‚å¦‚æœæœ‰å»äº†è§£ï¼Œè‡ªç„¶çŒœåˆ°ï¼Œè¿™ä¸ªé¡¹ç›®ç”¨äº† promise.rbã€‚å¯ä»¥åœ¨æºç é‡Œé¢çœ‹åˆ°è¿™æ ·çš„è°ƒç”¨ï¼Œå¹¶ä¸”ä½œè€…çš„ sample é‡Œé¢ä¹Ÿå¾ˆæ¸…æ™°åœ°è¯´æ˜äº†è¿™ä¸ªç©æ„å„¿çš„è¾“å‡ºå¼€å§‹å°±æ˜¯ä¸ª Promise å¯¹è±¡ã€‚æ‰€ä»¥å¯¹äº graphql ruby çš„ 1resolve -&gt; (obj, arg, ctx) &#123;&#125; è¿™æ ·çš„ do block å—å°±åº”è¯¥å’Œæ™®é€šçš„ http api æ¡†æ¶ä¸ä¸€æ ·ã€‚å¯ä»¥ç†è§£çš„æ˜¯ï¼Œä¸€æ¬¡ graph è¯·æ±‚çš„ï¼Œæ‰€éœ€è¦çš„æ¯ä¸ª field å¯¹äºæœåŠ¡ç«¯æ¥è¯´ï¼Œæ˜¯å¹¶å‘è·å–çš„ã€‚è¿™é‡Œå¹¶å‘ï¼Œè‚¯å®šç”¨äº†ä»–è‡ªå·±çš„ä¸€å¥—ç­–ç•¥ã€‚å¯ä»¥çŒœæµ‹çš„æ˜¯ï¼Œå°±æ˜¯ç”¨çš„å¼‚æ­¥ I/O\u001bçš„æ–¹å¼ã€‚æ‰€ä»¥ä»è¿™ä¸€ç‚¹æ¥è¯´ï¼Œè¿™ä¸ªåº“æœ¬è´¨ä¸Šå’Œ graphql ruby æ˜¯å®Œå…¨å¥‘åˆçš„ã€‚ æ¶æ„Ruby åœ¨ç¼–ç¨‹è¡¨è¾¾èƒ½åŠ›ä¸Šï¼Œå‡ ä¹æ˜¯æˆ‘è§è¿‡çš„æ‰€æœ‰æœåŠ¡ç«¯è¯­è¨€ä¸­æœ€å¼ºçš„ã€‚å…ƒç¼–ç¨‹ + Rails + å„ç§åº“ï¼Œå‡ ä¹ç®—å¾—ä¸Šæ˜¯äº’è”ç½‘åˆ›ä¸šå…¬å¸çš„ç¥å…µåˆ©å™¨ã€‚å½“ç„¶ï¼Œè¯­è¨€è¿™ç§ä¸œè¥¿ï¼Œå¥½åå¾—çœ‹ä¸Šä¸‹æ–‡çš„ï¼Œä¸åŒçš„è¯åœ¨ä¸åŒçš„è¯­å¢ƒä¸­æ•ˆæœè¿˜æ˜¯ä¸ä¸€æ ·çš„ã€‚è‡³å°‘å¯¹äºæˆ‘å¸çš„ä¸šåŠ¡å’Œäººå‘˜ç¼–åˆ¶ï¼ŒåŠ ä¸Šå¯¹äºå¾€åçš„é¢„ä¼°ï¼Œåœ¨å¤§é‡çš„è®ºè¯ä¸‹ï¼Œå¤§å®¶éƒ½å¯¹æŠ€æœ¯é€‰å‹è¾¾æˆäº†ä¸€è‡´ã€‚æˆ‘ä»¬éœ€è¦æŠ€æœ¯å›¢é˜Ÿæœ‰å¼ºå¤§çš„ä¸šåŠ¡æ¨è¿›èƒ½åŠ›ï¼Œå¹¶ä¸”èƒ½åšå‡ºé«˜æ•ˆç¨³å®šçš„æœåŠ¡ã€‚ ç°åœ¨çœ‹æ¥ï¼Œè¿™æ ·çš„é€‰æ‹©æ²¡æœ‰é”™ã€‚è¿™é‡Œå¯ä»¥å¤§è‡´å±•ç¤ºï¼ˆå…¬å¸æ²¡é’±ï¼ŒæœåŠ¡å™¨é‡Šæ”¾æ‰äº† â€“): http://rc.kid17.com:10000 éšç€äº§å“çš„é‡æ„å’Œä¸šåŠ¡çš„è¿ç§»ï¼Œæˆ‘ä»¬çš„æµé‡å¼€å§‹é€æ­¥è½¬å‘ graphql æœåŠ¡ï¼Œå„ä¸ªè§„èŒƒä¹Ÿå»ºç«‹èµ·æ¥ã€‚éšç€ä¸šåŠ¡æ¨¡å—çš„å¤æ‚åº¦å¢é«˜ï¼Œç”¨æˆ·æ•°é‡çš„å¢åŠ å’Œæ•°æ®é‡çš„å¢å¤§ï¼Œæ–°ä¸€è½®çš„æŒ‘æˆ˜å³å°†å¼€å§‹ã€‚é¦–å…ˆå°±æ˜¯è¦æŠŠè¿™ä¸ªå·¨å¤§å¤æ‚çš„ Rails + GraphQL é¡¹ç›®æ‹†æ‰ï¼Œç¬¬äºŒä¸ªå°±æ˜¯ç¡®å®šæ–°çš„æ¶æ„ï¼Œç¬¬ä¸‰ç‚¹å°±æ˜¯æ‹¥æŠ±å˜åŒ–ï¼Œè®©è¿™ä¸ªé¡¹ç›®æœ¬èº«å˜å¾—å¯ä»¥ç»´æŠ¤ï¼Œæ‰©å±•å’Œæ”¹è¿›ã€‚ æˆ‘å¸çš„çš„äº§å“ä¸­ï¼Œæœ‰ä¸¤å¥—ç”¨æˆ·ä½“ç³»ï¼Œå°±åƒæ˜¯ç¾å›¢çš„å•†å®¶ç‰ˆå’Œå®¢æˆ·ç‰ˆï¼Œæ‹‰é’©ã€Boss çš„æ±‚èŒç‰ˆå’Œä¼ä¸šç‰ˆã€‚ä¸¤ç§ä¸åŒçš„èº«ä»½çš„è§’è‰²å‚ä¸åˆ°æ•´ä¸ªä¸šåŠ¡ã€‚æˆ‘ä»¬æœ‰ feed æµï¼Œç”µå•†ï¼Œç”µå­ä¹¦ï¼Œç”¨æˆ·ç®¡ç†ï¼Œæ•™å­¦ç®¡ç†ç­‰ä¸šåŠ¡æ¨¡å—ã€‚æˆ‘\bç›®å‰çš„æƒ³æ³•æ˜¯è®© graphql å»ä»£ç†è¿™äº›æœåŠ¡ç»™å®¢æˆ·ç«¯è°ƒç”¨ã€‚æœ€å¤–å±‚ç”¨ Kong\b å»å®Œæˆç”¨æˆ·\bé‰´æƒå’Œ ngixn çš„ä¸€äº›åŸºæœ¬\båŠŸèƒ½ã€‚ ä»¥ä¸Šæ‹™è§ï¼Œéƒ½æ¥è‡ªäºå„ç§è¸©å‘ä¹‹åçš„æ„Ÿæ‚Ÿã€‚ ps: å¾ˆæœŸå¾…å¯ä»¥è®¤è¯†åŒæ ·åœ¨ç”¨\bgraphql çš„å›¢é˜Ÿæˆ–ä¸ªäººï¼Œæ¬¢è¿æ‰“æ‰° \bwechat: chendalichun","categories":[],"tags":[{"name":"ç³»ç»Ÿè®¾è®¡","slug":"ç³»ç»Ÿè®¾è®¡","permalink":"https://razertory.me/tags/ç³»ç»Ÿè®¾è®¡/"}]},{"title":"ç”¨ Netty çš„ä¸€æ¬¡ bug è·Ÿè¸ª","slug":"ä½¿ç”¨nettyè¸©è¿‡çš„å‘","date":"2017-11-19T16:21:00.000Z","updated":"2020-03-28T13:02:10.000Z","comments":true,"path":"2017/11/20/ä½¿ç”¨nettyè¸©è¿‡çš„å‘/","link":"","permalink":"https://razertory.me/2017/11/20/ä½¿ç”¨nettyè¸©è¿‡çš„å‘/","excerpt":"","text":"é—®é¢˜åœ¨ç»™æˆ‘å¸æ—§ç³»ç»Ÿè§£å†³æ€§èƒ½é—®é¢˜çš„æ—¶å€™ï¼Œæœ‰ä¸€ä¸ªè®©æˆ‘å°è±¡æ·±åˆ»çš„äº‹ä»¶ã€‚æˆ‘ä»¬æœ‰ä¸ªå†å²é¡¹ç›®ï¼Œæ˜¯ç”¨ Netty åšçš„ Http æœåŠ¡å™¨ï¼Œè¿™ä¸ªé¡¹ç›®åœ¨è¿è¡Œä¸€æ®µæ—¶é—´ä¹‹åï¼Œå‡ ä¹æ‰€æœ‰çš„æ¥å£éƒ½ä¼šå˜å¾—å¾ˆæ…¢ã€‚é€šè¿‡ä¸€ç³»åˆ—çš„è§‚å¯Ÿï¼Œå¯ä»¥å‘ç°çš„æ˜¯ï¼Œæ¯æ¬¡é‡å¯æœåŠ¡å™¨ï¼Œæ¥å£å°±ä¼šå˜å¾—å¾ˆå¿«ï¼Œç„¶ååªè¦è¿‡äº†ä¸€å‘¨ï¼Œå³ä½¿åœ¨å¹¶å‘é‡åŠä½çš„æƒ…å†µä¸‹ï¼Œæ¥å£ä¾ç„¶å¾ˆæ…¢ã€‚æˆ‘æœ€ç»ˆå®šä½åˆ°äº†ç“¶é¢ˆå‡ºç°åœ¨äº†ä¸€ä¸ªç‚¹ä¸Šï¼šé€šè¿‡ lsof -i è¿™ä¸ªå‘½ä»¤ï¼Œå¯ä»¥çœ‹åˆ°é¡¹ç›®æ‰€ç»‘å®šçš„ 8080 ç«¯å£ä¸Šï¼Œæœ‰ç€å¤§é‡çš„ CLOSE_WAIT çš„ tcp socket fdã€‚å…·ä½“çš„è¡¨å¾å°±æ˜¯ #æœ¬åœ°å¤ç° 12345678966387 springchan 435u IPv6 0x978a4f8b9aa9a147 0t0 TCP localhost:http-alt-&gt;localhost:56126 (CLOSE_WAIT)java 66387 springchan 436u IPv6 0x978a4f8b9aa9b847 0t0 TCP localhost:http-alt-&gt;localhost:56127 (CLOSE_WAIT)java 66387 springchan 437u IPv6 0x978a4f8bacc17987 0t0 TCP localhost:http-alt-&gt;localhost:56319 (CLOSE_WAIT)java 66387 springchan 438u IPv6 0x978a4f8b9a8d4287 0t0 TCP localhost:http-alt-&gt;localhost:56129 (CLOSE_WAIT)java 66387 springchan 439u IPv6 0x978a4f8b9a8d53c7 0t0 TCP localhost:http-alt-&gt;localhost:56130 (CLOSE_WAIT)java 66387 springchan 440u IPv6 0x978a4f8b9a8d3707 0t0 TCP localhost:http-alt-&gt;localhost:56131 (CLOSE_WAIT)java 66387 springchan 441u IPv6 0x978a4f8b9a8d3147 0t0 TCP localhost:http-alt-&gt;localhost:56132 (CLOSE_WAIT)java 66387 springchan 442u IPv6 0x978a4f8bae270707 0t0 TCP localhost:http-alt-&gt;localhost:56350 (CLOSE_WAIT)java 66387 springchan 443u IPv6 0x978a4f8b9a8d4e07 0t0 TCP localhost:http-alt-&gt;localhost:56134 (CLOSE_WAIT) ä¹Ÿå°±æ˜¯è¯´ï¼Œæœ‰ç€å¤§é‡çš„ tcp socket èµ„æºåœ¨å¹¶å‘é‡å¾ˆä½çš„æƒ…å†µä¸‹ä¾æ—§å¤„äº CLOSE_WAIT çš„çŠ¶æ€ã€‚å¯ä»¥è‚¯å®šçš„æ˜¯ï¼Œè¿™ç§ç°è±¡ä¸€å®šæ˜¯ä¸å¥åº·çš„ã€‚CLOSE_WAIT å¤„äº TCP å››æ¬¡åˆ†æ‰‹è¿‡ç¨‹ä¸­ï¼Œå®¢æˆ·ç«¯é¦–å…ˆç»™æœåŠ¡ç«¯å‘é€äº† fin æŠ¥ï¼ŒæœåŠ¡ç«¯æ¥å—ä¹‹åå°±ä¼šå›åº”ä¸€ä¸ª ack æŠ¥ç»™å¯¹æ–¹ï¼ŒåŒæ—¶çŠ¶æ€åˆ‡æ¢ä¸º CLOSE_WAITã€‚æ¥ä¸‹æ¥å‘¢ï¼ŒæœåŠ¡ç«¯çœŸæ­£éœ€è¦è€ƒè™‘çš„äº‹æƒ…æ˜¯å¯Ÿçœ‹æ˜¯å¦è¿˜æœ‰æ•°æ®å‘é€ç»™å¯¹æ–¹ ï¼Œå¦‚æœæ²¡æœ‰çš„è¯ï¼Œé‚£ä¹ˆå°±å¯ä»¥ close è¿™ä¸ª SOCKETï¼Œå‘é€ FIN æŠ¥æ–‡ç»™å¯¹æ–¹ï¼Œä¹Ÿå³å…³é—­è¿æ¥ã€‚æ‰€ä»¥ä½ åœ¨ CLOSE_WAIT çŠ¶æ€ä¸‹ï¼Œéœ€è¦å®Œæˆçš„äº‹æƒ…æ˜¯ç­‰å¾…ä½ å»å…³é—­è¿æ¥ã€‚è¿™ä¸ªæ—¶å€™ï¼Œè¿™ä¸¤ä¸ªè¿‡ç¨‹æ˜¯å¯ä»¥æ§åˆ¶çš„ï¼Œç¬¬ä¸€ç§ï¼ŒæœåŠ¡ç«¯ä¸å†å‘é€æŠ¥æ–‡ç»™å®¢æˆ·ç«¯ï¼Œç›´æ¥ closeã€‚ç¬¬äºŒç§ï¼ŒæœåŠ¡ç«¯å‘é€ fin æŠ¥ç»™å®¢æˆ·ç«¯ï¼ŒåŒæ—¶è‡ªå·±å¤„äº LAST_ACK çŠ¶æ€ã€‚æ‰€ä»¥æˆ‘æ¯”è¾ƒç¡®å®šçš„æ˜¯ï¼ŒæœåŠ¡ç«¯åœ¨ç®¡ç† TCP è¿æ¥çš„é˜¶æ®µå‡ºäº†é—®é¢˜ã€‚ å¤ç°ç¬¬ä¸€æ­¥ï¼Œæˆ‘ç”¨ ab test å¤ç°è¿™ä¸ªæƒ…å†µï¼Œè¿™ä¸ªè¿˜æ˜¯æ¯”è¾ƒå®¹æ˜“çš„ã€‚åœ¨æœ¬åœ°ï¼Œæˆ‘å¯¹ä»»ä½•ä¸€ä¸ªæ¥å£å¹¶å‘è¯·æ±‚ï¼Œè¿™ä¸ªæ—¶å€™å¯ä»¥çœ‹åˆ°æœåŠ¡ç«¯æœ‰å¤§é‡çš„ ESTABLISHED çŠ¶æ€çš„ socketã€‚ç¬¬äºŒæ­¥ï¼Œæˆ‘å¼ºè¡Œè®©è¯·æ±‚ç«¯å‘é€ fin æŠ¥ï¼Œå…¶å®å¾ˆç®€å•ï¼šctr + cã€‚è¿™ä¸ªæ—¶å€™å¦‚æˆ‘æ‰€æ–™ï¼Œè¿™äº› socket éƒ½å˜æˆ CLOSE_WAIT çŠ¶æ€ã€‚ åˆ†æ &amp; è§£å†³è¿™ä¸ªè€é¡¹ç›®æœ¬èº«å°±æ˜¯ä¸ªå•ä½“åº”ç”¨ï¼Œæ‰€ä»¥å¯ä»¥å¾ˆç¡®è®¤é—®é¢˜æ˜¯å‡ºåœ¨äº†é¡¹ç›®ä»£ç è¿™ä¸€å—ã€‚å¯ä»¥çŒœæµ‹çš„æ˜¯ï¼Œæ˜¯ä½¿ç”¨ Netty çš„æ–¹å¼ä¸å¯¹ã€‚æ‰€ä»¥æˆ‘ç¬¬ä¸€æ­¥ï¼Œå»ç ”ç©¶äº† Netty çš„åŸºæœ¬åŸç†ã€‚ ç›´æ¥å‘ç°é—®é¢˜å‡ºç°åœ¨äº† channelRead() è¿™ä¸ªæ–¹æ³•é‡Œé¢ã€‚æŒ‰ç…§å®˜æ–¹çš„è¯´æ˜ï¼Œä½¿ç”¨è€…çš„æœåŠ¡é‡Œé¢ä¸åº”è¯¥æœ‰é˜»å¡è°ƒç”¨ã€‚è¿™ä¼šä¸¥é‡è€—è´¹ç³»ç»Ÿèµ„æºã€‚å¦‚æœæœ‰é˜»å¡è°ƒç”¨ï¼Œå¸Œæœ›æ”¾åœ¨çº¿ç¨‹æ± é‡Œã€‚æ‰€ä»¥æˆ‘å°†é¡¹ç›®ä¸­çš„é˜»å¡è°ƒç”¨å±‚ï¼Œç»Ÿä¸€ç”¨äº†çº¿ç¨‹æ± æ¥ç®¡ç†ã€‚ 12345678910111213141516171819 public class HttpServerInboundHandler extends ChannelInboundHandlerAdapter&#123; @Override public void channelRead(ChannelHandlerContext ctx, Object msg)&#123; new Route(ctx, msg).init(); &#125; @Override public void channelReadComplete(ChannelHandlerContext ctx) throws Exception &#123; ctx.flush(); &#125; @Override public void exceptionCaught(ChannelHandlerContext ctx, Throwable cause) &#123; ctx.flush(); ctx.channel().close(); ctx.close(); &#125;&#125; ä¿®æ”¹ä¹‹å 12345678910111213141516171819202122public class HttpServerInboundHandler extends ChannelInboundHandlerAdapter&#123; ExecutorService executor =Executors.newCachedThreadPool(); @Override public void channelRead(ChannelHandlerContext ctx, Object msg)&#123; executor.execute(new Route(ctx, msg)); &#125; @Override public void channelReadComplete(ChannelHandlerContext ctx) throws Exception &#123; ctx.flush(); &#125; @Override public void exceptionCaught(ChannelHandlerContext ctx, Throwable cause) &#123; ctx.flush(); ctx.channel().close(); ctx.close(); &#125;&#125; è¿™é‡Œè®©çº¿ç¨‹æ± æ¥å¤„ç†é˜»å¡è°ƒç”¨å±‚çš„ä¸šåŠ¡ã€‚ç»è¿‡ ab æµ‹è¯•å‘ç°ä¸ä¼šå†æœ‰ç±»ä¼¼çš„é—®é¢˜å‡ºç°ã€‚ Netty æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªçº¯å¼‚æ­¥çš„æ¡†æ¶ï¼Œç”¨æ¥åšä¸€äº›å¹¶å‘é«˜ï¼Œå®æ—¶æ€§å¼ºçš„ç³»ç»Ÿï¼Œæ¯”å¦‚é€šä¿¡ï¼Œæ¸¸æˆç­‰ã€‚ä½†å¯¹äºæ™®é€šçš„äº’è”ç½‘æœåŠ¡ï¼Œæ¯”å¦‚ç”± tomcatï¼Œjetty æ„å»ºçš„ä¸€äº›æœåŠ¡è€Œè¨€ï¼Œnetty å¯èƒ½å¹¶ä¸é€‚åˆã€‚Netty è®¾è®¡ä¹‹åˆæ„åœ¨é«˜æ€§èƒ½é€šä¿¡ï¼Œç”¨æœ‰é™çš„èµ„æºäº§å‡ºæœ€å¤§çš„å¹¶å‘é‡çº§ã€‚æ‰€ä»¥ä½¿ç”¨è€…ä¸å¾—ä¸å¾ˆæ¸…æ¥š socket ç¼–ç¨‹ï¼Œselectï¼Œpoll æ¨¡å‹ç­‰ã€‚è¿™å¯¹äºå•çº¯çš„éå®æ—¶é«˜å¹¶å‘åº”ç”¨å¼€å‘è€…æ¥è¯´ï¼Œå¢åŠ äº†ä¸å°‘å¤æ‚åº¦ã€‚å¦‚æœæ˜¯ Java ç”Ÿæ€çš„ï¼Œå¹¶ä¸”éœ€è¦è‡ªå·±å®ç°ä¸€äº›æœåŠ¡æ²»ç†åŠŸèƒ½çš„ï¼ŒåŸºäº Netty å¼€å‘æ˜¯ä¸ªæ˜æ™ºçš„é€‰æ‹©ã€‚","categories":[],"tags":[{"name":"Java","slug":"Java","permalink":"https://razertory.me/tags/Java/"}]},{"title":"C å®ç° http æœåŠ¡å™¨","slug":"tiny-http","date":"2017-11-10T16:00:00.000Z","updated":"2020-03-28T13:02:10.000Z","comments":true,"path":"2017/11/11/tiny-http/","link":"","permalink":"https://razertory.me/2017/11/11/tiny-http/","excerpt":"","text":"ç¬¬ä¸€æ¬¡æ¥è§¦åˆ°æœåŠ¡ç«¯å¼€å‘ï¼Œåº”è¯¥æ˜¯å­¦ Java çš„æ—¶å€™ï¼Œäº†è§£åˆ°äº† servlet è¿™ä¹ˆä¸€ä¸ªä¸œè¥¿ã€‚åœ¨åš Java çš„æ—¶å€™ä¸€ç›´ä»¥æ¥éƒ½æ˜¯å’Œ Tomcat, Jetty è¿™æ ·çš„ Web å®¹å™¨æ‰“äº¤é“ã€‚è®°å¾—é‚£æ®µæ—¶é—´æ‰¾åˆ°ä¸€æœ¬ä¹¦ã€ŠHow Tomcat worksã€‹, æˆ‘èŠ±äº†ä¸¤å‘¨æ—¶é—´é˜…è¯»ï¼Œæ„Ÿè§¦è‰¯å¤šã€‚åæ¥åˆé™†é™†ç»­ç»­æ¥è§¦åˆ°äº† Netty ä¹‹ç±»çš„ã€‚ æˆ‘å¼€å§‹é—®è‡ªå·±ï¼Œå®ç°ä¸€ä¸ª http æœåŠ¡å™¨ï¼Œåˆ°åº•éœ€è¦åšä»€ä¹ˆ? æ‰€ä»¥ï¼Œç›´æ¥ä¸Š C å§ã€‚å‚ç…§æŸä¸ªç»å…¸çš„æ¡ˆä¾‹ã€‚ é¦–å…ˆåœ¨è¯»æºç ä¹‹å‰ï¼Œå¯ä»¥å†æ¸©ä¹ ä¸€ä¸‹åŸºäº TCP çš„åè®®æ˜¯å¦‚ä½•é€šä¿¡çš„ã€‚ TCP ç»“åˆè¿™ä¸ªå›¾ï¼Œä»æºç çš„è§’åº¦ä¸€æ­¥ä¸€æ­¥åˆ†æã€‚æºç åœ°å€ https://github.com/razertory/tinyhttpd ä¸»æµç¨‹ æœåŠ¡ç«¯åˆå§‹åŒ– ç­‰å¾…å®¢æˆ·ç«¯ è¿æ¥ï¼Œé€šä¿¡ï¼Œç»“æŸé€šä¿¡ï¼Œç»“æŸè¿æ¥ 1234567891011121314151617181920212223242526int main(void)&#123; int server_sock = -1; u_short port = 0; int client_sock = -1; struct sockaddr_in client_name; int client_name_len = sizeof(client_name); server_sock = startup(&amp;port);// ä¸‹é¢çš„ starup å‡½æ•° printf(\"httpd running on port %d\\n\", port); while (1) &#123; client_sock = accept(server_sock, (struct sockaddr *)&amp;client_name, &amp;client_name_len);// ä¸Šå›¾çš„ accept å‡½æ•° if (client_sock == -1) error_die(\"accept\"); accept_request(client_sock); &#125; close(server_sock); return(0);&#125; å¯åŠ¨ä¸€ä¸ª http server è°ƒç”¨åº“ socket() å‡½æ•°äº§ç”Ÿ httpd è°ƒç”¨ bind() å‡½æ•°è®© socket ç»‘å®šç»™æŸä¸ªç«¯å£ (ç»‘å®šè¿‡ç¨‹æ¯”æƒ³è±¡å¤æ‚) è°ƒç”¨ listen() å‡½æ•°ç›‘å¬ç«¯å£ 12345678910111213141516171819202122232425262728293031323334353637383940int startup(u_short *port)&#123; int httpd = 0; //sockaddr_in æ˜¯ IPV4 çš„å¥—æ¥å­—åœ°å€ç»“æ„ã€‚å®šä¹‰åœ¨ &lt;netinet/in.h&gt;, å‚è¯»ã€ŠTLPIã€‹P1202 struct sockaddr_in name; httpd = socket(PF_INET, SOCK_STREAM, 0);// ä¸Šå›¾çš„ socket å‡½æ•° if (httpd == -1) error_die(\"socket\"); memset(&amp;name, 0, sizeof(name)); name.sin_family = AF_INET; //htons()ï¼Œntohs() å’Œ htonl() åŒ…å«äº &lt; arpa/inet.h&gt;, å‚è¯»ã€ŠTLPIã€‹P1199 // å°† * port è½¬æ¢æˆä»¥ç½‘ç»œå­—èŠ‚åºè¡¨ç¤ºçš„ 16 ä½æ•´æ•° name.sin_port = htons(*port); //INADDR_ANY æ˜¯ä¸€ä¸ª IPV4 é€šé…åœ°å€çš„å¸¸é‡ï¼ŒåŒ…å«äº &lt;netinet/in.h&gt; // å¤§å¤šå®ç°éƒ½å°†å…¶å®šä¹‰æˆäº† 0.0.0.0 å‚è¯»ã€ŠTLPIã€‹P1187 name.sin_addr.s_addr = htonl(INADDR_ANY); //bind() ç”¨äºç»‘å®šåœ°å€ä¸ socketã€‚å‚è¯»ã€ŠTLPIã€‹P1153 // å¦‚æœä¼ è¿›å»çš„ sockaddr ç»“æ„ä¸­çš„ sin_port æŒ‡å®šä¸º 0ï¼Œè¿™æ—¶ç³»ç»Ÿä¼šé€‰æ‹©ä¸€ä¸ªä¸´æ—¶çš„ç«¯å£å· if (bind(httpd, (struct sockaddr *)&amp;name, sizeof(name)) &lt; 0)// ä¸Šå›¾çš„ bind å‡½æ•° error_die(\"bind\"); // å¦‚æœè°ƒç”¨ bind åç«¯å£å·ä»ç„¶æ˜¯ 0ï¼Œåˆ™æ‰‹åŠ¨è°ƒç”¨ getsockname() è·å–ç«¯å£å· if (*port == 0) /* if dynamically allocating a port */ &#123; int namelen = sizeof(name); //getsockname() åŒ…å«äº &lt; sys/socker.h&gt; ä¸­ï¼Œå‚è¯»ã€ŠTLPIã€‹P1263 // è°ƒç”¨ getsockname() è·å–ç³»ç»Ÿç»™ httpd è¿™ä¸ª socket éšæœºåˆ†é…çš„ç«¯å£å· if (getsockname(httpd, (struct sockaddr *)&amp;name, &amp;namelen) == -1) error_die(\"getsockname\"); *port = ntohs(name.sin_port); &#125; // æœ€åˆçš„ BSD socket å®ç°ä¸­ï¼Œbacklog çš„ä¸Šé™æ˜¯ 5. å‚è¯»ã€ŠTLPIã€‹P1156 if (listen(httpd, 5) &lt; 0) error_die(\"listen\"); return(httpd);&#125; æ¥å— &amp; è§£æè¯·æ±‚123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110void accept_request(int client)&#123; char buf[1024]; int numchars; char method[255]; char url[255]; char path[512]; size_t i, j; struct stat st; int cgi = 0; /* becomes true if server decides this is a CGI * program */ char *query_string = NULL; // è¯» http è¯·æ±‚çš„ç¬¬ä¸€è¡Œæ•°æ®ï¼ˆrequest lineï¼‰ï¼ŒæŠŠè¯·æ±‚æ–¹æ³•å­˜è¿› method ä¸­ numchars = get_line(client, buf, sizeof(buf)); i = 0; j = 0; while (!ISspace(buf[j]) &amp;&amp; (i &lt; sizeof(method) - 1)) &#123; method[i] = buf[j]; i++; j++; &#125; method[i] = '\\0'; // å¦‚æœè¯·æ±‚çš„æ–¹æ³•ä¸æ˜¯ GET æˆ– POST ä»»æ„ä¸€ä¸ªçš„è¯å°±ç›´æ¥å‘é€ response å‘Šè¯‰å®¢æˆ·ç«¯æ²¡å®ç°è¯¥æ–¹æ³• if (strcasecmp(method, \"GET\") &amp;&amp; strcasecmp(method, \"POST\")) &#123; unimplemented(client); return; &#125; // å¦‚æœæ˜¯ POST æ–¹æ³•å°±å°† cgi æ ‡å¿—å˜é‡ç½®ä¸€ (true) if (strcasecmp(method, \"POST\") == 0) cgi = 1; i = 0; // è·³è¿‡æ‰€æœ‰çš„ç©ºç™½å­—ç¬¦ (ç©ºæ ¼) while (ISspace(buf[j]) &amp;&amp; (j &lt; sizeof(buf))) j++; // ç„¶åæŠŠ URL è¯»å‡ºæ¥æ”¾åˆ° url æ•°ç»„ä¸­ while (!ISspace(buf[j]) &amp;&amp; (i &lt; sizeof(url) - 1) &amp;&amp; (j &lt; sizeof(buf))) &#123; url[i] = buf[j]; i++; j++; &#125; url[i] = '\\0'; // å¦‚æœè¿™ä¸ªè¯·æ±‚æ˜¯ä¸€ä¸ª GET æ–¹æ³•çš„è¯ if (strcasecmp(method, \"GET\") == 0) &#123; // ç”¨ä¸€ä¸ªæŒ‡é’ˆæŒ‡å‘ url query_string = url; // å»éå†è¿™ä¸ª urlï¼Œè·³è¿‡å­—ç¬¦ ï¼Ÿå‰é¢çš„æ‰€æœ‰å­—ç¬¦ï¼Œå¦‚æœéå†å®Œæ¯•ä¹Ÿæ²¡æ‰¾åˆ°å­—ç¬¦ ï¼Ÿåˆ™é€€å‡ºå¾ªç¯ while ((*query_string != '?') &amp;&amp; (*query_string != '\\0')) query_string++; // é€€å‡ºå¾ªç¯åæ£€æŸ¥å½“å‰çš„å­—ç¬¦æ˜¯ ï¼Ÿè¿˜æ˜¯å­—ç¬¦ä¸² (url) çš„ç»“å°¾ if (*query_string == '?') &#123; // å¦‚æœæ˜¯ ï¼Ÿ çš„è¯ï¼Œè¯æ˜è¿™ä¸ªè¯·æ±‚éœ€è¦è°ƒç”¨ cgiï¼Œå°† cgi æ ‡å¿—å˜é‡ç½®ä¸€ (true) cgi = 1; // ä»å­—ç¬¦ ï¼Ÿ å¤„æŠŠå­—ç¬¦ä¸² url ç»™åˆ†éš”ä¼šä¸¤ä»½ *query_string = '\\0'; // ä½¿æŒ‡é’ˆæŒ‡å‘å­—ç¬¦ ï¼Ÿåé¢çš„é‚£ä¸ªå­—ç¬¦ query_string++; &#125; &#125; // å°†å‰é¢åˆ†éš”ä¸¤ä»½çš„å‰é¢é‚£ä»½å­—ç¬¦ä¸²ï¼Œæ‹¼æ¥åœ¨å­—ç¬¦ä¸² htdocs çš„åé¢ä¹‹åå°±è¾“å‡ºå­˜å‚¨åˆ°æ•°ç»„ path ä¸­ã€‚ç›¸å½“äºç°åœ¨ path ä¸­å­˜å‚¨ç€ä¸€ä¸ªå­—ç¬¦ä¸² sprintf(path, \"htdocs%s\", url); // å¦‚æœ path æ•°ç»„ä¸­çš„è¿™ä¸ªå­—ç¬¦ä¸²çš„æœ€åä¸€ä¸ªå­—ç¬¦æ˜¯ä»¥å­—ç¬¦ / ç»“å°¾çš„è¯ï¼Œå°±æ‹¼æ¥ä¸Šä¸€ä¸ª \"index.html\" çš„å­—ç¬¦ä¸²ã€‚é¦–é¡µçš„æ„æ€ if (path[strlen(path) - 1] == '/') strcat(path, \"index.html\"); // åœ¨ç³»ç»Ÿä¸Šå»æŸ¥è¯¢è¯¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨ if (stat(path, &amp;st) == -1) &#123; // å¦‚æœä¸å­˜åœ¨ï¼Œé‚£æŠŠè¿™æ¬¡ http çš„è¯·æ±‚åç»­çš„å†…å®¹ (head å’Œ body) å…¨éƒ¨è¯»å®Œå¹¶å¿½ç•¥ while ((numchars&gt; 0) &amp;&amp; strcmp(\"\\n\", buf)) /* read &amp; discard headers */ numchars = get_line(client, buf, sizeof(buf)); // ç„¶åè¿”å›ä¸€ä¸ªæ‰¾ä¸åˆ°æ–‡ä»¶çš„ response ç»™å®¢æˆ·ç«¯ not_found(client); &#125; else &#123; // æ–‡ä»¶å­˜åœ¨ï¼Œé‚£å»è·Ÿå¸¸é‡ S_IFMT ç›¸ä¸ï¼Œç›¸ä¸ä¹‹åçš„å€¼å¯ä»¥ç”¨æ¥åˆ¤æ–­è¯¥æ–‡ä»¶æ˜¯ä»€ä¹ˆç±»å‹çš„ //S_IFMT å‚è¯»ã€ŠTLPIã€‹P281ï¼Œä¸ä¸‹é¢çš„ä¸‰ä¸ªå¸¸é‡ä¸€æ ·æ˜¯åŒ…å«åœ¨ &lt;sys/stat.h&gt; if ((st.st_mode &amp; S_IFMT) == S_IFDIR) // å¦‚æœè¿™ä¸ªæ–‡ä»¶æ˜¯ä¸ªç›®å½•ï¼Œé‚£å°±éœ€è¦å†åœ¨ path åé¢æ‹¼æ¥ä¸€ä¸ª \"/index.html\" çš„å­—ç¬¦ä¸² strcat(path, \"/index.html\"); //S_IXUSR, S_IXGRP, S_IXOTH ä¸‰è€…å¯ä»¥å‚è¯»ã€ŠTLPIã€‹P295 if ((st.st_mode &amp; S_IXUSR) || (st.st_mode &amp; S_IXGRP) || (st.st_mode &amp; S_IXOTH) ) // å¦‚æœè¿™ä¸ªæ–‡ä»¶æ˜¯ä¸€ä¸ªå¯æ‰§è¡Œæ–‡ä»¶ï¼Œä¸è®ºæ˜¯å±äºç”¨æˆ· / ç»„ / å…¶ä»–è¿™ä¸‰è€…ç±»å‹çš„ï¼Œå°±å°† cgi æ ‡å¿—å˜é‡ç½®ä¸€ cgi = 1; // æ„é€ å“åº” if (!cgi) // å¦‚æœä¸éœ€è¦ cgi æœºåˆ¶çš„è¯ï¼Œ serve_file(client, path); else // å¦‚æœéœ€è¦åˆ™è°ƒç”¨ execute_cgi(client, path, method, query_string); &#125; close(client);&#125; ä¸éœ€è¦ cgi æœºåˆ¶çš„ response1234567891011121314151617181920212223242526void serve_file(int client, const char *filename)&#123; FILE *resource = NULL; int numchars = 1; char buf[1024]; // ç¡®ä¿ buf é‡Œé¢æœ‰ä¸œè¥¿ï¼Œèƒ½è¿›å…¥ä¸‹é¢çš„ while å¾ªç¯ buf[0] = 'A'; buf[1] = '\\0'; // å¾ªç¯ä½œç”¨æ˜¯è¯»å–å¹¶å¿½ç•¥æ‰è¿™ä¸ª http è¯·æ±‚åé¢çš„æ‰€æœ‰å†…å®¹ while ((numchars&gt; 0) &amp;&amp; strcmp(\"\\n\", buf)) /* read &amp; discard headers */ numchars = get_line(client, buf, sizeof(buf)); // æ‰“å¼€è¿™ä¸ªä¼ è¿›æ¥çš„è¿™ä¸ªè·¯å¾„æ‰€æŒ‡çš„æ–‡ä»¶ resource = fopen(filename, \"r\"); if (resource == NULL) not_found(client); else &#123; // æ‰“å¼€æˆåŠŸåï¼Œå°†è¿™ä¸ªæ–‡ä»¶çš„åŸºæœ¬ä¿¡æ¯å°è£…æˆ response çš„å¤´éƒ¨ (header) å¹¶è¿”å› headers(client, filename); // æ¥ç€æŠŠè¿™ä¸ªæ–‡ä»¶çš„å†…å®¹è¯»å‡ºæ¥ä½œä¸º response çš„ body å‘é€åˆ°å®¢æˆ·ç«¯ cat(client, resource); &#125; fclose(resource);&#125; éœ€è¦ CGI æœºåˆ¶çš„ response123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119void execute_cgi(int client, const char *path, const char *method, const char *query_string)&#123; char buf[1024]; int cgi_output[2]; int cgi_input[2]; pid_t pid; int status; int i; char c; int numchars = 1; int content_length = -1; // å¾€ buf ä¸­å¡«ä¸œè¥¿ä»¥ä¿è¯èƒ½è¿›å…¥ä¸‹é¢çš„ while buf[0] = 'A'; buf[1] = '\\0'; // å¦‚æœæ˜¯ http è¯·æ±‚æ˜¯ GET æ–¹æ³•çš„è¯è¯»å–å¹¶å¿½ç•¥è¯·æ±‚å‰©ä¸‹çš„å†…å®¹ if (strcasecmp(method, \"GET\") == 0) while ((numchars&gt; 0) &amp;&amp; strcmp(\"\\n\", buf)) /* read &amp; discard headers */ numchars = get_line(client, buf, sizeof(buf)); else /* POST */ &#123; // åªæœ‰ POST æ–¹æ³•æ‰ç»§ç»­è¯»å†…å®¹ numchars = get_line(client, buf, sizeof(buf)); // è¿™ä¸ªå¾ªç¯çš„ç›®çš„æ˜¯è¯»å‡ºæŒ‡ç¤º body é•¿åº¦å¤§å°çš„å‚æ•°ï¼Œå¹¶è®°å½• body çš„é•¿åº¦å¤§å°ã€‚å…¶ä½™çš„ header é‡Œé¢çš„å‚æ•°ä¸€å¾‹å¿½ç•¥ // æ³¨æ„è¿™é‡Œåªè¯»å®Œ header çš„å†…å®¹ï¼Œbody çš„å†…å®¹æ²¡æœ‰è¯» while ((numchars&gt; 0) &amp;&amp; strcmp(\"\\n\", buf)) &#123; buf[15] = '\\0'; if (strcasecmp(buf, \"Content-Length:\") == 0) content_length = atoi(&amp;(buf[16])); // è®°å½• body çš„é•¿åº¦å¤§å° numchars = get_line(client, buf, sizeof(buf)); &#125; // å¦‚æœ http è¯·æ±‚çš„ header æ²¡æœ‰æŒ‡ç¤º body é•¿åº¦å¤§å°çš„å‚æ•°ï¼Œåˆ™æŠ¥é”™è¿”å› if (content_length == -1) &#123; bad_request(client); return; &#125; &#125; sprintf(buf, \"HTTP/1.0 200 OK\\r\\n\"); send(client, buf, strlen(buf), 0); // ä¸‹é¢è¿™é‡Œåˆ›å»ºä¸¤ä¸ªç®¡é“ï¼Œç”¨äºä¸¤ä¸ªè¿›ç¨‹é—´é€šä¿¡ if (pipe(cgi_output) &lt; 0) &#123; cannot_execute(client); return; &#125; if (pipe(cgi_input) &lt; 0) &#123; cannot_execute(client); return; &#125; // åˆ›å»ºä¸€ä¸ªå­è¿›ç¨‹ if ((pid = fork()) &lt; 0 ) &#123; cannot_execute(client); return; &#125; // å­è¿›ç¨‹ç”¨æ¥æ‰§è¡Œ cgi è„šæœ¬ if (pid == 0) /* child: CGI script */ &#123; char meth_env[255]; char query_env[255]; char length_env[255]; //dup2() åŒ…å« &lt; unistd.h&gt; ä¸­ï¼Œå‚è¯»ã€ŠTLPIã€‹P97 // å°†å­è¿›ç¨‹çš„è¾“å‡ºç”±æ ‡å‡†è¾“å‡ºé‡å®šå‘åˆ° cgi_ouput çš„ç®¡é“å†™ç«¯ä¸Š dup2(cgi_output[1], 1); // å°†å­è¿›ç¨‹çš„è¾“å‡ºç”±æ ‡å‡†è¾“å…¥é‡å®šå‘åˆ° cgi_ouput çš„ç®¡é“è¯»ç«¯ä¸Š dup2(cgi_input[0], 0); // å…³é—­ cgi_ouput ç®¡é“çš„è¯»ç«¯ä¸ cgi_input ç®¡é“çš„å†™ç«¯ close(cgi_output[0]); close(cgi_input[1]); // æ„é€ ä¸€ä¸ªç¯å¢ƒå˜é‡ sprintf(meth_env, \"REQUEST_METHOD=%s\", method); //putenv() åŒ…å«äº &lt; stdlib.h&gt; ä¸­ï¼Œå‚è¯»ã€ŠTLPIã€‹P128 // å°†è¿™ä¸ªç¯å¢ƒå˜é‡åŠ è¿›å­è¿›ç¨‹çš„è¿è¡Œç¯å¢ƒä¸­ putenv(meth_env); // æ ¹æ® http è¯·æ±‚çš„ä¸åŒæ–¹æ³•ï¼Œæ„é€ å¹¶å­˜å‚¨ä¸åŒçš„ç¯å¢ƒå˜é‡ if (strcasecmp(method, \"GET\") == 0) &#123; sprintf(query_env, \"QUERY_STRING=%s\", query_string); putenv(query_env); &#125; else &#123; /* POST */ sprintf(length_env, \"CONTENT_LENGTH=%d\", content_length); putenv(length_env); &#125; //execl() åŒ…å«äº &lt; unistd.h&gt; ä¸­ï¼Œå‚è¯»ã€ŠTLPIã€‹P567 // æœ€åå°†å­è¿›ç¨‹æ›¿æ¢æˆå¦ä¸€ä¸ªè¿›ç¨‹å¹¶æ‰§è¡Œ cgi è„šæœ¬ execl(path, path, NULL); exit(0); &#125; else &#123; /* parent */ // çˆ¶è¿›ç¨‹åˆ™å…³é—­äº† cgi_output ç®¡é“çš„å†™ç«¯å’Œ cgi_input ç®¡é“çš„è¯»ç«¯ close(cgi_output[1]); close(cgi_input[0]); // å¦‚æœæ˜¯ POST æ–¹æ³•çš„è¯å°±ç»§ç»­è¯» body çš„å†…å®¹ï¼Œå¹¶å†™åˆ° cgi_input ç®¡é“é‡Œè®©å­è¿›ç¨‹å»è¯» if (strcasecmp(method, \"POST\") == 0) for (i = 0; i &lt; content_length; i++) &#123; recv(client, &amp;c, 1, 0); write(cgi_input[1], &amp;c, 1); &#125; // ç„¶åä» cgi_output ç®¡é“ä¸­è¯»å­è¿›ç¨‹çš„è¾“å‡ºï¼Œå¹¶å‘é€åˆ°å®¢æˆ·ç«¯å» while (read(cgi_output[0], &amp;c, 1) &gt; 0) send(client, &amp;c, 1, 0); // å…³é—­ç®¡é“ close(cgi_output[0]); close(cgi_input[1]); // ç­‰å¾…å­è¿›ç¨‹çš„é€€å‡º waitpid(pid, &amp;status, 0); &#125;&#125; è¡¥å……CGI æœºåˆ¶CGI å…¨ç§°æ˜¯ â€œé€šç”¨ç½‘å…³æ¥å£â€(Common Gateway Interface)ï¼Œå®ƒå¯ä»¥è®©ä¸€ä¸ªå®¢æˆ·ç«¯ï¼Œä»ç½‘é¡µæµè§ˆå™¨å‘æ‰§è¡Œåœ¨ Web æœåŠ¡å™¨ä¸Šçš„ç¨‹åºè¯·æ±‚æ•°æ®ã€‚ CGI æè¿°äº†å®¢æˆ·ç«¯å’Œè¿™ä¸ªç¨‹åºä¹‹é—´ä¼ è¾“æ•°æ®çš„ä¸€ç§æ ‡å‡†ã€‚ CGI çš„ä¸€ä¸ªç›®çš„æ˜¯è¦ç‹¬ç«‹äºä»»ä½•è¯­è¨€çš„ï¼Œæ‰€ä»¥ CGI å¯ä»¥ç”¨ä»»ä½•ä¸€ç§è¯­è¨€ç¼–å†™ï¼Œåªè¦è¿™ç§è¯­è¨€å…·æœ‰æ ‡å‡†è¾“å…¥ã€è¾“å‡ºå’Œç¯å¢ƒå˜é‡ã€‚ å¦‚ phpï¼Œperlï¼Œtcl ç­‰ã€‚ å®¢æˆ·ç«¯è®¿é—®æŸä¸ª URL åœ°å€ä¹‹åï¼Œé€šè¿‡ GET/POST/PUT ç­‰æ–¹å¼æäº¤æ•°æ®ï¼Œå¹¶é€šè¿‡ HTTP åè®®å‘ Web æœåŠ¡å™¨å‘å‡ºè¯·æ±‚ã€‚ æœåŠ¡å™¨ç«¯çš„ HTTP Daemonï¼ˆå®ˆæŠ¤è¿›ç¨‹ï¼‰å¯åŠ¨ä¸€ä¸ªå­è¿›ç¨‹ã€‚ç„¶ååœ¨å­è¿›ç¨‹ä¸­ï¼Œå°† HTTP è¯·æ±‚é‡Œæè¿°çš„ä¿¡æ¯é€šè¿‡æ ‡å‡†è¾“å…¥ stdin å’Œç¯å¢ƒå˜é‡ä¼ é€’ç»™ URL æŒ‡å®šçš„ CGI ç¨‹åºï¼Œå¹¶å¯åŠ¨æ­¤åº”ç”¨ç¨‹åºè¿›è¡Œå¤„ç†ï¼Œå¤„ç†ç»“æœé€šè¿‡æ ‡å‡†è¾“å‡º stdout è¿”å›ç»™ HTTP Daemon å­è¿›ç¨‹ã€‚ å†ç”± HTTP Daemon å­è¿›ç¨‹é€šè¿‡ HTTP åè®®è¿”å›ç»™å®¢æˆ·ç«¯ã€‚","categories":[],"tags":[{"name":"ç½‘ç»œç¼–ç¨‹","slug":"ç½‘ç»œç¼–ç¨‹","permalink":"https://razertory.me/tags/ç½‘ç»œç¼–ç¨‹/"}]},{"title":"åŠ¨æ€è§„åˆ’å…¥é—¨","slug":"dynamic-programming","date":"2017-07-28T16:00:00.000Z","updated":"2020-03-28T13:02:10.000Z","comments":true,"path":"2017/07/29/dynamic-programming/","link":"","permalink":"https://razertory.me/2017/07/29/dynamic-programming/","excerpt":"","text":"åŠ¨æ€è§„åˆ’ä»è®¡ç®—æœºç³»ç»Ÿçš„æœ¬è´¨æ¥è¯´ï¼Œå°±æ˜¯åŠ ç¼“å­˜ã€‚ å…ˆä»ä¸€ä¸ªé¢˜ç›®è¯´èµ·å§ çº¦ç¿°çš„åèŠ±å›­çº¦ç¿°æƒ³åœ¨ä»–å®¶åé¢çš„ç©ºåœ°ä¸Šå»ºä¸€ä¸ªåèŠ±å›­ï¼Œç°åœ¨æœ‰ä¸¤ç§ç –ï¼Œä¸€ç§ 3 dm çš„é«˜åº¦ï¼Œ7 dm çš„é«˜åº¦ã€‚çº¦ç¿°æƒ³å›´æˆ x dm çš„å¢™ã€‚å¦‚æœçº¦ç¿°èƒ½åšåˆ°ï¼Œè¾“å‡º YESï¼Œå¦åˆ™è¾“å‡º NOã€‚ï¼ˆhttps://www.lintcode.com/problem/johns-backyard-garden/descriptionï¼‰ åˆ†æå¾ˆç»å…¸çš„ä¸€ä¸ªé—®é¢˜ã€‚åˆ¤æ–­èƒ½ä¸èƒ½è¢« 3 buildï¼Œå¦‚æœä¸èƒ½å°±å›æº¯ï¼Œç›´åˆ°åˆ¤æ–­è¢« 7build æˆ–è€…åˆ°æ ˆé¡¶ã€‚å®ç°èµ·æ¥ä¹Ÿæ¯”è¾ƒå®¹æ˜“ï¼š 1234567891011121314151617181920212223public class Solution &#123; /** * @param x: the wall's height * @return: YES or NO */ public String isBuild(int x) &#123; // write you code here if (helper(x) == true) return \"YES\"; else return \"NO\"; &#125; private boolean helper(int x)&#123; if (x == 0)&#123; return true; &#125; if (x &lt; 3)&#123; return false; &#125; return helper(x - 3) || helper(x - 7); &#125;&#125; æœ¬æ¥ä»¥ä¸ºè¿™æ ·çš„ç®—æ³•æ•ˆç‡å¹¶ä¸é«˜ï¼Œå› ä¸ºè¦åå¤æ‰§è¡Œ || è¿ç®—ã€‚ç„¶è€Œï¼Œç„¶è€Œï¼Œsome times too naive |-_- ã€‚äº‹å®æ˜¯é€Ÿåº¦å¹¶ä¸æ…¢ã€‚åœ¨ || è¿ç®—ä¸­ï¼Œåªè¦æœ‰ä¸€ä¸ª true äº§ç”Ÿã€‚é‚£ä¹ˆè¿™ä¸ªè¡¨è¾¾å¼çš„å€¼ä¸€å®šæ˜¯ trueã€‚å¯¹äºå¸ƒå°”è¿ç®—çš„é€’å½’ç¨‹åºåŒæ ·é€‚ç”¨ã€‚æ‰€ä»¥åœ¨ debug é˜¶æ®µå¯ä»¥çœ‹åˆ°å½“ helper é‡Œé¢ä¸€æ—¦æœ‰ true çš„æ—¶å€™ã€‚é€’å½’å°±ä¼šåœæ­¢ã€‚è¿™é‡Œä¸å¾—ä¸ä½©æœå‰äººåšçš„åŠªåŠ›ã€‚ æ–æ³¢é‚£å¥‘å…ˆæ¥ä¸€æŠŠä¼ ç»Ÿçš„é€’å½’å†™æ³• 123456789public int fib(int i)&#123; if (i == 0)&#123; return 0; &#125; if (i == 1) &#123; return 1; &#125; return fib(i - 1) + fib(i - 2);&#125; è¿™æ®µä»£ç ç®€æ´è€Œåˆä¼˜ç¾ï¼Œä½†å®é™…ä¸Šæ€§èƒ½çœŸçš„å¾ˆå·®ã€‚ä»å®é™…çš„è§’åº¦å‡ºå‘ï¼Œåœ¨æˆ‘è‡ªå·±çš„ MBP 2017ï¼ŒCPU 3.1 GHz Intel Core i5 çš„ç”µè„‘ä¸Šã€‚i = 40 ï¼Œ æœ€ç»ˆç»“æœ =102334155 çš„æ—¶å€™ï¼Œè·‘åˆ°å‡ºç»“æœèŠ±äº† 869 msã€‚ä»åˆ†æçš„è§’åº¦å‡ºå‘ï¼Œè¿™ç§é€’å½’ç¨‹åºæœ‰ä¸€ä¸ªç‰¹è´¨ï¼Œå°±æ˜¯å¤§é‡é‡å¤çš„è®¡ç®—ã€‚ä¸¾ä¸ªä¾‹å­ï¼šå½“ i = 5ï¼Œ ç¨‹åºé€’å½’ä¸‹å»å®é™…ä¸Šæ‰§è¡Œäº† 2 ä¸ª fib(3) å’Œ 3 ä¸ª fib(2)ã€‚å¯ä»¥è€ƒè™‘çš„æ˜¯ï¼Œå‘ç”Ÿè¿‡çš„äº‹æƒ…ï¼ŒçœŸçš„éœ€è¦è®©ä»–å†å‘ç”Ÿå—ï¼Ÿæ˜¯ä¸æ˜¯åªéœ€è¦è®°å¿†ç»“æœï¼Œé‚£ä¹ˆä¸‹æ¬¡å†æœ‰åŒæ ·çš„éœ€æ±‚å‘ç”Ÿçš„æ—¶å€™ï¼Œåªéœ€è¦å»å–å¾—ç»“æœï¼Œè€Œä¸å†æ˜¯è®¡ç®—ç›¸åŒçš„ä»»åŠ¡äº†ã€‚ æ‰€ä»¥ï¼Œè¯•ç€åŠ ä¸Šç¼“å­˜ã€‚åšæ³•å°±æ˜¯ç»´æŠ¤ä¸€ä¸ªæ•°æ®ç»“æ„ï¼Œå°†è®¡ç®—è¿‡çš„ä»»åŠ¡çš„ç»“æœä¿å­˜åœ¨é‡Œé¢ã€‚ 1234567891011121314151617int []cache = new int[10000]; // æš‚æ—¶ç”¨è¿™ä¹ˆå¤§ï¼Œå…ˆä¸è€ƒè™‘æå¤§æƒ…å†µã€‚cache[1] = 1;public int fib(int i) &#123; if (cache[i] != 0) &#123; return cache[i]; &#125; if (i &lt;= 0) &#123; return 0; &#125; int result = fib(i - 1) + fib(i - 2); cache[i] = result; return result;&#125; å¥½äº†ï¼Œæµ‹è¯•ä¸€å‘ã€‚å—¯ï¼Œç»“æœæ­£ç¡®ã€‚çœ‹çœ‹æ€§èƒ½ï¼šä¸åˆ° 5msã€‚ å­æ•°ç»„é—®é¢˜ç»™ä¸€ä¸ªéè´Ÿæ•´æ•°é›†åˆ setï¼Œä¸€ä¸ªç›®æ ‡å€¼å…ƒç´  sumï¼Œæ±‚åˆ¤æ–­è¯¥é›†åˆä¸­ï¼Œæ˜¯å¦åŒ…å«ä¸€ä¸ªå­é›†åˆï¼Œä½¿å¾—å­é›†åˆçš„å…ƒç´ å’Œç­‰äºç›®æ ‡å€¼ sumï¼Ÿ easy å­é›†åˆå¦‚æœå¤§å°ç¡®å®šä¸º 2ï¼Œé‚£ä¹ˆç›´æ¥å°±å¯ä»¥ç”¨ k-v æ˜ å°„æ¥åˆ¤æ–­ã€‚ï¼ˆåµŒå¥— for å¾ªç¯è§£å†³çš„çš„å°±è¿‡æ‰ï½ï¼‰ 123456789101112public boolean isSubsetSum(int[]set, int sum) &#123; HashMap map = new HashMap(); for (int i : set) &#123; map.put(sum - i, i); &#125; for (int i: set) &#123; if (map.containsKey(i)) &#123; return true; &#125; &#125; return false;&#125; hard çŠ¶æ€è½¬ç§»æ–¹ç¨‹ å­é›†åˆçš„å¤§å° 0 &lt; size &lt;= set.lengthã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œéœ€è¦è¿›ä¸€æ­¥æŠŠå¤§é—®é¢˜æ‹†åˆ†æˆå°é—®é¢˜ï¼Œæ¨å¯¼å‡ºçŠ¶æ€è½¬ç§»æ–¹ç¨‹ã€‚ 12345isSubsetSum(set, n, sum) = isSubsetSum(set, n-1, sum) || isSubsetSum(set, n-1, sum-set[n-1])Base Cases:isSubsetSum(set, n, sum) = false, if sum &gt; 0 and n == 0isSubsetSum(set, n, sum) = true, if sum == 0 ç´§æ¥ç€ï¼Œcoding 1234567891011121314151617boolean isSubsetSum(int set[], int n, int sum)&#123; // åŸºæœ¬æ¡ä»¶ if (sum == 0) return true; if (n == 0 &amp;&amp; sum != 0) return false; // å¦‚æœæœ€åä¸€ä¸ªå…ƒç´ å¤§äº sumï¼Œå¿½ç•¥æ‰ if (set[n-1] &gt; sum) return isSubsetSum(set, n-1, sum); /* å¦åˆ™ï¼Œæ£€æŸ¥ sum æ˜¯å¦èƒ½å¤Ÿè¢«ç»„åˆã€‚åˆ†ä¸ºä¸‹é¢ä¸¤ç§æƒ…å†µ (a) åŒ…å«æœ€åä¸€ä¸ªå…ƒç´  (b) ä¸åŒ…å«æœ€åä¸€ä¸ªå…ƒç´  */ return isSubsetSum(set, n-1, sum) || isSubsetSum(set, n-1, sum-set[n-1]);&#125; è¿™ä¸ªåšæ³•çš„å¤æ‚åº¦ä¸ºæŒ‡æ•°çº§åˆ« åŠ¨æ€è§„åˆ’çŸ©é˜µå…¶å®ï¼Œåœ¨ã€Šç®—æ³•å¯¼è®ºã€‹ä¸€ä¹¦ä¸­ï¼Œå…¶å®æœ‰ä¸€ç‚¹å¯ä»¥å¾ˆæ˜ç¡® â€œåº”ç”¨äºå­é—®é¢˜é‡å çš„æƒ…å†µâ€ã€‚åˆ†æä¸Šè¿°çš„ç®—æ³•ï¼Œå¯ä»¥å‘ç°æœ‰å¾ˆå¤šé‡å çš„å­é—®é¢˜ã€‚æ‰€ä»¥ï¼Œæœ‰å¿…è¦å›åˆ°æ–‡ç« æœ€å¼€å§‹çš„ä¸€ç‚¹ åŠ ç¼“å­˜ã€‚è¿™é‡Œè€ƒè™‘ç”¨ä¸€ä¸ªçŸ©é˜µæ¥ç¼“å­˜ç»“æœé›†ã€‚ 12345678910111213141516171819202122232425boolean isSubsetSum(int set[], int n, int sum) &#123; boolean subset[][] = new boolean[sum+1][n+1]; // sum ä¸º 0 çš„æƒ…å†µï¼Œç»“æœå§‹ç»ˆä¸º true for (int i = 0; i &lt;= n; i++) subset[0][i] = true; // sum ä¸ä¸º 0ï¼Œä½†é›†åˆä¸ºç©ºï¼Œå§‹ç»ˆä¸º false for (int i = 1; i &lt;= sum; i++) subset[i][0] = false; // è‡ªåº•å‘ä¸Šå¡«å……çŸ©é˜µ for (int i = 1; i &lt;= sum; i++) &#123; for (int j = 1; j &lt;= n; j++) &#123; subset[i][j] = subset[i][j-1]; if (i&gt;= set[j-1]) subset[i][j] = subset[i][j] || subset[i - set[j-1]][j-1]; &#125; &#125; return subset[sum][n];&#125; å¯ä»¥åˆ†æå‡ºï¼Œåªéœ€è¦çŸ©é˜µçº§åˆ«çš„å¤æ‚åº¦å°±å¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚ ç¬”è€…ç”¨äº†å¤§é‡çš„æ¡ˆä¾‹æ¥è¯´æ˜è§£å†³æŸäº›é—®é¢˜ï¼Œç”¨åŠ¨æ€è§„åˆ’çš„æ–¹å¼ã€‚åç»­å°†åŠ ä¸Šä¸€äº›æœ€çŸ­è·¯å¾„ç®—æ³•å’Œç»å…¸èƒŒåŒ…é—®é¢˜çš„è§£æ³•ã€‚ ç†è§£äº†åŠ¨æ€è§„åˆ’çš„å“²å­¦ï¼Œå¾ˆå¤§ç¨‹åº¦ä¸Šï¼Œåœ¨åšä¸€äº›é«˜æ€§èƒ½çš„ç³»ç»Ÿçš„æ—¶å€™ä¸€å®šä¼šæœ‰æ›´å¤šçš„æ€è·¯ã€‚","categories":[],"tags":[]}]}