---
layout: post
title:  "C实现的http服务器"
date:   2017-11-11
categories: jekyll update
---

第一次接触到服务端开发，应该是学Java的时候，了解到了`servlet`这么一个东西。后续，围绕着抹茶的那段时间，一直以来都是和`Tomcat`, `Jetty`这样的Web容器打交道。记得那段时间找到一本书《How Tomcat works》, 我花了一周的时间读完，然后又花了一周的时间再读了一遍。后来又陆陆续续接触到了Puma，Netty之类的。

> 我开始问自己，实现一个http服务器，到底需要做什么?

所以，直接上C吧。参照某个经典的案例。

首先在读源码之前，可以再温习一下基于TCP的协议是如何通信的。

![Alt text](图片链接 "optional title")

```C
int main(void)
{
 int server_sock = -1;
 u_short port = 0;
 int client_sock = -1;

 struct sockaddr_in client_name;
 int client_name_len = sizeof(client_name);
 //pthread_t newthread;

 server_sock = startup(&port);
 printf("httpd running on port %d\n", port);

 while (1)
 {
  client_sock = accept(server_sock,
                       (struct sockaddr *)&client_name,
                       &client_name_len);
  if (client_sock == -1)
  error_die("accept");
  accept_request(client_sock);
   perror("pthread_create");*/
 }

 close(server_sock);

 return(0);
}
```
