<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.9.0">
    
<!-- Google Analytics -->
<script>
window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
ga('create', 'UA-131782721-1', 'auto');
ga('send', 'pageview');
</script>
<script async src="https://www.google-analytics.com/analytics.js"></script>
<!-- End Google Analytics -->


    

    
<!-- Baidu Tongji -->
<script>var _hmt = _hmt || []</script>
<script async src="//hm.baidu.com/hm.js?62e6e4fa9639be49fa509da74f862dfb"></script>
<!-- End Baidu Tongji -->




    <meta charset="utf-8">
    
    
    
    
    <title>Scala å‡½æ•°å¼ç¼–ç¨‹è®¾è®¡ | Razertory çš„æŠ€æœ¯åšå®¢ | ä¸€æ›²è‚è‚ æ–­ï¼Œå¤©æ¶¯ä½•å¤„è§…çŸ¥éŸ³</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    
    <meta name="theme-color" content="#3F51B5">
    
    
    <meta name="keywords" content>
    <meta name="description" content="åœ¨è¿™ä¸ª 2020 å¹´åˆçš„ç‰¹æ®Šæ—¶æœŸã€‚ Scala æ˜¯ä¸€é—¨ç°ä»£åŒ–ï¼Œå¤šèŒƒå¼çš„ JVM è¯­è¨€ã€‚ ä¼ é€é—¨ï¼ˆå¯èƒ½éœ€è¦ğŸš€)  Functional Program Design in Scala on Coursera æ²¡ä»€ä¹ˆç”¨çš„ certificate   W1case class å’Œæ¨¡å¼åŒ¹é…ç”¨ Scala æ¥è¡¨ç¤º JSON å¯¹è±¡å¯ä»¥è¿™æ · 1234567abstract class JSONcase cla">
<meta name="keywords" content="Razertory">
<meta property="og:type" content="article">
<meta property="og:title" content="Scala å‡½æ•°å¼ç¼–ç¨‹è®¾è®¡">
<meta property="og:url" content="https://razertory.me/2020/02/20/functional-program-design-in-scala/index.html">
<meta property="og:site_name" content="Razertory çš„æŠ€æœ¯åšå®¢">
<meta property="og:description" content="åœ¨è¿™ä¸ª 2020 å¹´åˆçš„ç‰¹æ®Šæ—¶æœŸã€‚ Scala æ˜¯ä¸€é—¨ç°ä»£åŒ–ï¼Œå¤šèŒƒå¼çš„ JVM è¯­è¨€ã€‚ ä¼ é€é—¨ï¼ˆå¯èƒ½éœ€è¦ğŸš€)  Functional Program Design in Scala on Coursera æ²¡ä»€ä¹ˆç”¨çš„ certificate   W1case class å’Œæ¨¡å¼åŒ¹é…ç”¨ Scala æ¥è¡¨ç¤º JSON å¯¹è±¡å¯ä»¥è¿™æ · 1234567abstract class JSONcase cla">
<meta property="og:locale" content="cn">
<meta property="og:image" content="http://ww1.sinaimg.cn/large/a67b702fgy1gc6mm6fcccj21fo0rgh3a.jpg">
<meta property="og:image" content="http://ww1.sinaimg.cn/large/a67b702fgy1gc6mmvhps1j20tq0ja10b.jpg">
<meta property="og:updated_time" content="2020-03-28T13:02:10.018Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Scala å‡½æ•°å¼ç¼–ç¨‹è®¾è®¡">
<meta name="twitter:description" content="åœ¨è¿™ä¸ª 2020 å¹´åˆçš„ç‰¹æ®Šæ—¶æœŸã€‚ Scala æ˜¯ä¸€é—¨ç°ä»£åŒ–ï¼Œå¤šèŒƒå¼çš„ JVM è¯­è¨€ã€‚ ä¼ é€é—¨ï¼ˆå¯èƒ½éœ€è¦ğŸš€)  Functional Program Design in Scala on Coursera æ²¡ä»€ä¹ˆç”¨çš„ certificate   W1case class å’Œæ¨¡å¼åŒ¹é…ç”¨ Scala æ¥è¡¨ç¤º JSON å¯¹è±¡å¯ä»¥è¿™æ · 1234567abstract class JSONcase cla">
<meta name="twitter:image" content="http://ww1.sinaimg.cn/large/a67b702fgy1gc6mm6fcccj21fo0rgh3a.jpg">
    
        <link rel="alternate" type="application/atom+xml" title="Razertory çš„æŠ€æœ¯åšå®¢" href="/atom.xml">
    
    <link rel="shortcut icon" href="/favicon.ico">
    <link rel="stylesheet" href="//unpkg.com/hexo-theme-material-indigo@latest/css/style.css">
    <script>window.lazyScripts=[]</script>

    <!-- custom head -->
    

</head>

<body>
    <div id="loading" class="active"></div>

    <aside id="menu" class="hide" >
  <div class="inner flex-row-vertical">
    <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menu-off">
        <i class="icon icon-lg icon-close"></i>
    </a>
    <div class="brand-wrap" style="background-image:url(/img/brand.jpg)">
      <div class="brand">
        <a href="/" class="avatar waves-effect waves-circle waves-light">
          <img src="/img/avatar.jpg">
        </a>
        <hgroup class="introduce">
          <h5 class="nickname">Razertory</h5>
          <a href="mailto:razer.spring@gmail.com" title="razer.spring@gmail.com" class="mail">razer.spring@gmail.com</a>
        </hgroup>
      </div>
    </div>
    <div class="scroll-wrap flex-col">
      <ul class="nav">
        
            <li class="waves-block waves-effect">
              <a href="/archives"  >
                <i class="icon icon-lg icon-tags"></i>
                å½’æ¡£
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/algo-solution"  >
                <i class="icon icon-lg icon-code"></i>
                ç®—æ³•é¢˜è§£
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/cs"  >
                <i class="icon icon-lg icon-rocket"></i>
                è®¡ç®—æœºç³»ç»Ÿ
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/books"  >
                <i class="icon icon-lg icon-book"></i>
                è¯»ä¹¦
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/links"  >
                <i class="icon icon-lg icon-external-link-square"></i>
                å…³äºæœ¬åšå®¢
              </a>
            </li>
        
      </ul>
    </div>
  </div>
</aside>

    <main id="main">
        <header class="top-header" id="header">
    <div class="flex-row">
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light on" id="menu-toggle">
          <i class="icon icon-lg icon-navicon"></i>
        </a>
        <div class="flex-col header-title ellipsis">Scala å‡½æ•°å¼ç¼–ç¨‹è®¾è®¡</div>
        
        <div class="search-wrap" id="search-wrap">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="back">
                <i class="icon icon-lg icon-chevron-left"></i>
            </a>
            <input type="text" id="key" class="search-input" autocomplete="off" placeholder="æ¤œç´¢">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="search">
                <i class="icon icon-lg icon-search"></i>
            </a>
        </div>
        
        
    </div>
</header>
<header class="content-header post-header">

    <div class="container fade-scale">
        <h1 class="title">Scala å‡½æ•°å¼ç¼–ç¨‹è®¾è®¡</h1>
        <h5 class="subtitle">
            
                <time datetime="2020-02-20T15:53:05.000Z" itemprop="datePublished" class="page-time">
  2020-02-20
</time>


            
        </h5>
    </div>

    


</header>


<div class="container body-wrap">
    

<article id="post-functional-program-design-in-scala"
  class="post-article article-type-post fade" itemprop="blogPost">

    <div class="post-card">
        <h1 class="post-card-title">Scala å‡½æ•°å¼ç¼–ç¨‹è®¾è®¡</h1>
        <div class="post-meta">
            <time class="post-time" title="2020-02-20 23:53:05" datetime="2020-02-20T15:53:05.000Z"  itemprop="datePublished">2020-02-20</time>

            


            

        </div>
        <div class="post-content" id="post-content" itemprop="postContent">
            <p>åœ¨è¿™ä¸ª 2020 å¹´åˆçš„ç‰¹æ®Šæ—¶æœŸã€‚</p>
<p>Scala æ˜¯ä¸€é—¨ç°ä»£åŒ–ï¼Œå¤šèŒƒå¼çš„ JVM è¯­è¨€ã€‚</p>
<p>ä¼ é€é—¨ï¼ˆå¯èƒ½éœ€è¦ğŸš€)</p>
<ul>
<li><a href="https://www.coursera.org/learn/progfun2" target="_blank" rel="noopener">Functional Program Design in Scala on Coursera</a></li>
<li><a href="https://www.coursera.org/account/accomplishments/certificate/BP5FRUVSFPN8" target="_blank" rel="noopener">æ²¡ä»€ä¹ˆç”¨çš„ certificate</a></li>
</ul>
<hr>
<h2 id="W1"><a href="#W1" class="headerlink" title="W1"></a>W1</h2><h3 id="case-class-å’Œæ¨¡å¼åŒ¹é…"><a href="#case-class-å’Œæ¨¡å¼åŒ¹é…" class="headerlink" title="case class å’Œæ¨¡å¼åŒ¹é…"></a>case class å’Œæ¨¡å¼åŒ¹é…</h3><p>ç”¨ Scala æ¥è¡¨ç¤º JSON å¯¹è±¡å¯ä»¥è¿™æ ·</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">JSON</span></span></span><br><span class="line"><span class="class"><span class="title">case</span> <span class="title">class</span> <span class="title">JSeq</span> (<span class="params">elems: <span class="type">List</span>[<span class="type">JSON</span>]</span>) <span class="keyword">extends</span> <span class="title">JSON</span>  <span class="title">//</span> <span class="title">JSON</span> <span class="title">çš„æ•°ç»„</span></span></span><br><span class="line"><span class="class"><span class="title">case</span> <span class="title">class</span> <span class="title">JObj</span> (<span class="params">bindings: <span class="type">Map</span>[<span class="type">String</span>, <span class="type">JSON</span>]</span>) <span class="keyword">extends</span> <span class="title">JSON</span> <span class="title">//</span> <span class="title">JSON</span> <span class="title">å¯¹è±¡</span></span></span><br><span class="line"><span class="class"><span class="title">case</span> <span class="title">class</span> <span class="title">JNum</span> (<span class="params">num: <span class="type">Double</span></span>) <span class="keyword">extends</span> <span class="title">JSON</span> <span class="title">//</span> <span class="title">æ•°å­—ç±»å‹</span></span></span><br><span class="line"><span class="class"><span class="title">case</span> <span class="title">class</span> <span class="title">JStr</span> (<span class="params">str: <span class="type">String</span></span>) <span class="keyword">extends</span> <span class="title">JSON</span></span></span><br><span class="line"><span class="class"><span class="title">case</span> <span class="title">class</span> <span class="title">JBool</span>(<span class="params">b: <span class="type">Boolean</span></span>) <span class="keyword">extends</span> <span class="title">JSON</span></span></span><br><span class="line"><span class="class"><span class="title">case</span> <span class="title">object</span> <span class="title">JNull</span> <span class="keyword">extends</span> <span class="title">JSON</span> <span class="title">//</span> <span class="title">ç©º</span></span></span><br></pre></td></tr></table></figure>

<p>æ‰€ä»¥ï¼Œ</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">"firstName"</span> : <span class="string">"John"</span>,</span><br><span class="line">    <span class="attr">"lastName"</span> : <span class="string">"Smith"</span>,</span><br><span class="line">    <span class="attr">"address"</span> : &#123;</span><br><span class="line">        <span class="attr">"streetAddress"</span> : <span class="string">"21 2 nd Street"</span>,</span><br><span class="line">        <span class="attr">"state"</span> : <span class="string">"NY"</span>,</span><br><span class="line">        <span class="attr">"postalCode"</span>: <span class="number">10021</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">"phoneNumbers"</span>: [</span><br><span class="line">        &#123;<span class="attr">"type"</span> : <span class="string">"home"</span>,<span class="attr">"number "</span>: <span class="string">"212 555 -1234"</span>&#125; ,</span><br><span class="line">        &#123;<span class="attr">"type"</span> : <span class="string">"fax"</span>,<span class="attr">"number "</span>: <span class="string">"646 555 -4567"</span>&#125;</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥è¡¨ç¤ºä¸º</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> data = <span class="type">JObj</span>(<span class="type">Map</span>(</span><br><span class="line">    <span class="string">"firstName"</span> -&gt; <span class="type">JStr</span>(<span class="string">"John"</span>),</span><br><span class="line">    <span class="string">"lastName"</span> -&gt; <span class="type">JStr</span>(<span class="string">"Smith"</span>),</span><br><span class="line">    <span class="string">"address"</span> -&gt; <span class="type">JObj</span>(<span class="type">Map</span>(</span><br><span class="line">    <span class="string">"streetAddress"</span> -&gt; <span class="type">JStr</span>(<span class="string">"21 2nd Street"</span>),</span><br><span class="line">    <span class="string">"state"</span> -&gt; <span class="type">JStr</span>(<span class="string">"NY"</span>),</span><br><span class="line">    <span class="string">"postalCode"</span> -&gt; <span class="type">JNum</span>(<span class="number">10021</span>)</span><br><span class="line">)),</span><br><span class="line"><span class="string">"phoneNumbers"</span> -&gt; <span class="type">JSeq</span>(<span class="type">List</span>(</span><br><span class="line">    <span class="type">JObj</span>(<span class="type">Map</span>(</span><br><span class="line">    <span class="string">"type"</span> -&gt; <span class="type">JStr</span>(<span class="string">"home"</span>), <span class="string">"number"</span> -&gt; <span class="type">JStr</span>(<span class="string">"212 555-1234"</span>)</span><br><span class="line">)),</span><br><span class="line"><span class="type">JObj</span>(<span class="type">Map</span>(</span><br><span class="line">    <span class="string">"type"</span> -&gt; <span class="type">JStr</span>(<span class="string">"fax"</span>), <span class="string">"number"</span> -&gt; <span class="type">JStr</span>(<span class="string">"646 555-4567"</span>)</span><br><span class="line">)) )) ))</span><br></pre></td></tr></table></figure>

<p>æ¯”å¦‚è¯´æˆ‘è¦å®ç°ä¸€ä¸ªæ‰“å° JSON å¯¹è±¡çš„æ–¹æ³•ï¼Œå°±å¯ä»¥</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">show</span></span>(json: <span class="type">JSON</span>): <span class="type">String</span> = json <span class="keyword">match</span> &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="type">JSeq</span>(elems) =&gt;</span><br><span class="line">    <span class="string">"["</span> + (elems map show mkString <span class="string">", "</span>) + <span class="string">"]"</span></span><br><span class="line">    <span class="keyword">case</span> <span class="type">JObj</span>(bindings) =&gt;</span><br><span class="line">    <span class="keyword">val</span> assocs = bindings map &#123;</span><br><span class="line">        <span class="keyword">case</span> (key, value) =&gt; <span class="string">"\""</span> + key + <span class="string">"\": "</span> + show(value)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="string">"&#123;"</span> + (assocs mkString <span class="string">", "</span>) + <span class="string">"&#125;"</span></span><br><span class="line">    <span class="keyword">case</span> <span class="type">JNum</span>(num) =&gt; num.toString</span><br><span class="line">    <span class="keyword">case</span> <span class="type">JStr</span>(str) =&gt; '\<span class="string">"' + str + '\"'</span></span><br><span class="line"><span class="string">    case JBool(b) =&gt; b.toString</span></span><br><span class="line"><span class="string">    case JNull =&gt; "</span><span class="string">null"</span></span><br><span class="line"><span class="string">&#125;</span></span><br></pre></td></tr></table></figure>

<p>ä¸Šè¿°çš„ show(data) å°±è¾“å‡º</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">res1: <span class="type">String</span> = &#123;<span class="string">"firstName"</span>: <span class="string">"John"</span>, <span class="string">"lastName"</span>: <span class="string">"Smith"</span>, <span class="string">"address"</span>: &#123;<span class="string">"streetAddress"</span>: <span class="string">"21 2nd Street"</span>, <span class="string">"state"</span>: <span class="string">"NY"</span>, <span class="string">"postalCode"</span>: <span class="number">10021.0</span>&#125;, <span class="string">"phoneNumbers"</span>: [&#123;<span class="string">"type"</span>: <span class="string">"home"</span>, <span class="string">"number"</span>: <span class="string">"212 555-1234"</span>&#125;, &#123;<span class="string">"type"</span>: <span class="string">"fax"</span>, <span class="string">"number"</span>: <span class="string">"646 555-4567"</span>&#125;]&#125;</span><br></pre></td></tr></table></figure>

<p>ç¬¬ 6 è¡Œä»£ç é‡Œé¢ map ä¼ å…¥çš„å‡½æ•°æ˜¯ï¼Œæˆ‘ä»¬çŸ¥é“ï¼Œåœ¨è¿™é‡Œ map å‡½æ•°çš„ç­¾åæ˜¯ <code>def map[B](f: (A) =&gt; B): List[B]</code><br>é‚£ä¹ˆç¬¬å…­è¡Œçš„ <code>f</code> å°±æ˜¯ <code>case (key, value) =&gt; &quot;\&quot;&quot; + key + &quot;\&quot;: &quot; + show(value)</code>ã€‚ è¿™ä¸ªå‡½æ•°å¦‚æœå•ç‹¬æ‹å‡ºæ¥ï¼Œå…¶å®å°±æ˜¯</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> f: (<span class="type">String</span>, <span class="type">JSON</span>) =&gt; <span class="type">String</span> = &#123; <span class="keyword">case</span> (key, value) =&gt; key + â€: â€ + value &#125; <span class="comment">// æ³¨æ„çœ‹ JObj å®šä¹‰</span></span><br></pre></td></tr></table></figure>

<p>æ‰€ä»¥ç”¨ case class æœ€æ–¹ä¾¿çš„åœ°æ–¹åœ¨äº<strong>æ¨¡å¼åŒ¹é…ä¸­çš„ decompose</strong></p>
<h3 id="å‡½æ•°å³å¯¹è±¡"><a href="#å‡½æ•°å³å¯¹è±¡" class="headerlink" title="å‡½æ•°å³å¯¹è±¡"></a>å‡½æ•°å³å¯¹è±¡</h3><p>ä»»ä½•æƒ…å†µä¸‹ï¼Œå‡½æ•° <code>A =&gt; B</code> å…¶å®å°±æ˜¯</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">scala.<span class="type">Function1</span>[<span class="type">A</span>, <span class="type">B</span>]</span><br></pre></td></tr></table></figure>

<p>çš„ç®€å†™ã€‚</p>
<h4 id="æ™®é€šå‡½æ•°"><a href="#æ™®é€šå‡½æ•°" class="headerlink" title="æ™®é€šå‡½æ•°"></a>æ™®é€šå‡½æ•°</h4><p>æ ¹æ® Function1 çš„å®šä¹‰</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">trait</span> <span class="title">Function1</span>[-<span class="type">A</span>, +<span class="type">R</span>] </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">apply</span></span>(x: <span class="type">A</span>): <span class="type">R</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä¾‹å¦‚ï¼Œ</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> f1: <span class="type">Int</span> =&gt; <span class="type">Int</span> = (x: <span class="type">Int</span>) =&gt; x + <span class="number">1</span></span><br><span class="line"><span class="keyword">val</span> f2 = <span class="keyword">new</span> <span class="type">Function1</span>[<span class="type">Int</span>, <span class="type">Int</span>] &#123;<span class="function"><span class="keyword">def</span> <span class="title">apply</span></span>(x: <span class="type">Int</span>) = x + <span class="number">1</span>&#125;</span><br></pre></td></tr></table></figure>

<p>f1 å’Œ f2 ç­‰ä»·ã€‚</p>
<h4 id="åå‡½æ•°"><a href="#åå‡½æ•°" class="headerlink" title="åå‡½æ•°"></a>åå‡½æ•°</h4><p>å¯¹äºåå‡½æ•° PartialFunction å®šä¹‰ä¸º</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">trait</span> <span class="title">PartialFunction</span>[-<span class="type">A</span>, +<span class="type">R</span>] <span class="keyword">extends</span> <span class="title">Function1</span>[-<span class="type">A</span>, +<span class="type">R</span>] </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">apply</span></span>(x: <span class="type">A</span>): <span class="type">R</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">isDefinedAt</span></span>(x: <span class="type">A</span>): <span class="type">Boolean</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä¾‹å¦‚ï¼Œ</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> f1: <span class="type">PartialFunction</span>[<span class="type">String</span>, <span class="type">String</span>] = &#123; <span class="keyword">case</span> <span class="string">"ping"</span> =&gt; <span class="string">"pong"</span> &#125;</span><br><span class="line"><span class="keyword">val</span> f2 = <span class="keyword">new</span> <span class="type">PartialFunction</span>[<span class="type">String</span>, <span class="type">String</span>] &#123;</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">apply</span></span>(x: <span class="type">String</span>) = x <span class="keyword">match</span> &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">"ping"</span> =&gt; <span class="string">"pong"</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">isDefinedAt</span></span>(x: <span class="type">String</span>) = x <span class="keyword">match</span> &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">"ping"</span> =&gt; <span class="literal">true</span></span><br><span class="line">        <span class="keyword">case</span> _ =&gt; <span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>f1 å’Œ f2 ç­‰ä»·ã€‚</p>
<p>ps: ä»¥ä¸Šï¼Œã€Œç­‰ä»·ã€çš„æ„æ€æ˜¯ä¸¤ä¸ªå‡½æ•°åªè¦è¾“å…¥ç›¸åŒï¼Œè¾“å‡ºä¸€å®šç›¸åŒã€‚</p>
<h2 id="W2"><a href="#W2" class="headerlink" title="W2"></a>W2</h2><h3 id="LazyList"><a href="#LazyList" class="headerlink" title="LazyList"></a>LazyList</h3><p>ä¸‹é¢ä»£ç </p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f</span></span>(x: <span class="type">Int</span>): <span class="type">Boolean</span> = &#123;</span><br><span class="line">  println(x + <span class="string">" "</span>)</span><br><span class="line">  x % <span class="number">11</span> == <span class="number">0</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">val</span> v1 = (<span class="number">1</span> to <span class="number">100000</span>).filter(f)(<span class="number">1</span>)</span><br><span class="line"><span class="keyword">val</span> v2 = (<span class="number">1</span> to <span class="number">100000</span>).to(<span class="type">LazyList</span>).filter(f)(<span class="number">1</span>)</span><br></pre></td></tr></table></figure>

<p>v1 å’Œ v2 ç­‰ä»·ã€‚è®¡ç®— v1 çš„æ—¶å€™ä¼šæ‰“å° <code>1 2 3...9999 100000</code>, è€Œè®¡ç®— v2 çš„æ—¶å€™æ‰“å° <code>1 2 3 ... 21 22</code>ã€‚è¿™æ˜¯å› ä¸ºå¯¹äº v2ï¼Œ<code>(1 to 100000).to(LazyList)</code> äº§ç”Ÿçš„æ˜¯ <code>scala.collection.immutable.LazyList</code>ã€‚å…¶ä¸­å®˜æ–¹æ–‡æ¡£å¯¹å…¶æœ‰ä¸ªç®€å•çš„æè¿°</p>
<blockquote>
<p>This class implements an immutable linked list that evaluates elements in order and only when needed</p>
</blockquote>
<p>ä¹Ÿå°±æ˜¯å½“ LazyList é‡Œé¢çš„å…ƒç´ è¢«éœ€è¦çš„æ—¶å€™ï¼Œæ‰ä¼šè¿›è¡Œæœ‰åºè®¡ç®—ï¼Œå¹¶ä¸”è®¡ç®—ä¼šç»ˆæ­¢çŸ¥é“æ‰€éœ€çš„å…ƒç´ è®¡ç®—ç»“æŸã€‚è¿™ä¹Ÿå°±æ˜¯ä¸ºä»€ä¹ˆä¼šæœ‰ä¸Šè¿°çš„è¾“å‡ºäº†ã€‚</p>
<h3 id="æƒ°æ€§æ±‚å€¼-Lazy-Evaluation"><a href="#æƒ°æ€§æ±‚å€¼-Lazy-Evaluation" class="headerlink" title="æƒ°æ€§æ±‚å€¼ Lazy Evaluation"></a>æƒ°æ€§æ±‚å€¼ Lazy Evaluation</h3><p>åœ¨ Scala é‡Œé¢ï¼ŒLazy æ„å‘³ç€ä¸¤ç‚¹</p>
<ul>
<li><strong>å°½é‡å»¶åæ±‚å€¼è®¡ç®—</strong></li>
<li><strong>åªè®¡ç®—ä¸€æ¬¡</strong></li>
</ul>
<p>ä¾‹å¦‚</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">expr</span> </span>= &#123;</span><br><span class="line">  <span class="keyword">val</span> x = &#123; print(â€xâ€); <span class="number">1</span> &#125;</span><br><span class="line">  <span class="keyword">lazy</span> <span class="keyword">val</span> y = &#123; print(â€yâ€); <span class="number">2</span> &#125;</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">z</span> </span>= &#123; print(â€zâ€); <span class="number">3</span> &#125;</span><br><span class="line">  z + y + x + z + y + x <span class="comment">// last line</span></span><br><span class="line">&#125;</span><br><span class="line">expr</span><br></pre></td></tr></table></figure>

<p>è¿™æ ·çš„è¾“å‡ºä¸º <code>xzyz</code></p>
<h3 id="Infinite-Sequences"><a href="#Infinite-Sequences" class="headerlink" title="Infinite Sequences"></a>Infinite Sequences</h3><p>åˆ©ç”¨ LazyList çš„ç‰¹æ€§ï¼Œå¯ä»¥æ„é€ å‡ºæ— é™åºåˆ—ã€‚æ¯”å¦‚</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">scala&gt; <span class="function"><span class="keyword">def</span> <span class="title">from</span></span>(n: <span class="type">Int</span>): <span class="type">LazyList</span>[<span class="type">Int</span>] = n #:: from(n + <span class="number">1</span>) <span class="comment">// æ— é™åºåˆ—</span></span><br><span class="line">from: (n: <span class="type">Int</span>)<span class="type">LazyList</span>[<span class="type">Int</span>]</span><br><span class="line"></span><br><span class="line">scala&gt; <span class="keyword">val</span> natures = from(<span class="number">0</span>) <span class="comment">// è‡ªç„¶æ•°</span></span><br><span class="line">natures: <span class="type">LazyList</span>[<span class="type">Int</span>] = <span class="type">LazyList</span>(&lt;not computed&gt;)</span><br><span class="line"></span><br><span class="line">scala&gt; <span class="keyword">val</span> hundreds = natures.filter(_ % <span class="number">100</span> == <span class="number">0</span>)</span><br><span class="line">hundreds: scala.collection.immutable.<span class="type">LazyList</span>[<span class="type">Int</span>] = <span class="type">LazyList</span>(&lt;not computed&gt;)</span><br><span class="line"></span><br><span class="line">scala&gt; <span class="keyword">val</span> fourHundred = hundreds(<span class="number">4</span>) <span class="comment">// è®¡ç®—</span></span><br><span class="line">fourHundred: <span class="type">Int</span> = <span class="number">400</span></span><br></pre></td></tr></table></figure>

<p><strong>åŸƒæ‹‰æ‰˜æ–¯ç‰¹å°¼ç­›æ³•</strong></p>
<blockquote>
<p>åŸƒæ‹‰æ‰˜æ–¯ç‰¹å°¼ç­›æ³•æ˜¯åˆ—å‡ºæ‰€æœ‰å°ç´ æ•°æœ€æœ‰æ•ˆçš„æ–¹æ³•ä¹‹ä¸€ï¼Œå…¶åå­—æ¥è‡ªäºå¤å¸Œè…Šæ•°å­¦å®¶åŸƒæ‹‰æ‰˜æ–¯ç‰¹å°¼ï¼Œå¹¶ä¸”è¢«æè¿°åœ¨å¦ä¸€ä½å¤å¸Œè…Šæ•°å­¦å®¶å°¼ç§‘é©¬åº“æ–¯æ‰€è‘—çš„ã€Šç®—æœ¯å…¥é—¨ã€‹ä¸­ã€‚-<a href="https://zh.wikipedia.org/wiki/%E5%9F%83%E6%8B%89%E6%89%98%E6%96%AF%E7%89%B9%E5%B0%BC%E7%AD%9B%E6%B3%95" target="_blank" rel="noopener">ç»´åŸºç™¾ç§‘</a></p>
</blockquote>
<p>ç”¨ LazyList å®ç°ä¼šéå¸¸ç®€å•ï¼Œ</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">from</span></span>(n: <span class="type">Int</span>): <span class="type">LazyList</span>[<span class="type">Int</span>] = &#123;</span><br><span class="line">  n #:: from(n + <span class="number">1</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">sieve</span></span>(s: <span class="type">LazyList</span>[<span class="type">Int</span>]): <span class="type">LazyList</span>[<span class="type">Int</span>] = &#123;</span><br><span class="line">  s.head #:: sieve(s.tail.filter(_ % s.head != <span class="number">0</span>))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">primeNumber</span></span>(n: <span class="type">Int</span>): <span class="type">Int</span> = &#123;</span><br><span class="line">    sieve(from(<span class="number">2</span>))(n)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">val</span> n = sieve(from(<span class="number">2</span>))(<span class="number">100</span>) <span class="comment">// è¾“å‡º 547</span></span><br></pre></td></tr></table></figure>

<h3 id="é¢˜ç›®ï¼šå€’æ°´é—®é¢˜"><a href="#é¢˜ç›®ï¼šå€’æ°´é—®é¢˜" class="headerlink" title="é¢˜ç›®ï¼šå€’æ°´é—®é¢˜"></a>é¢˜ç›®ï¼šå€’æ°´é—®é¢˜</h3><p>ç»™å‡ ä¸ªçŸ¥é“å®¹é‡ï¼Œä½†æ˜¯æ²¡æœ‰åˆ»åº¦çš„æ¯å­ï¼Œæœ‰ä¸ªå¯ä»¥å–ä¹‹ä¸å°½çš„æ°´æºç”¨æ¥ç»™æ¯å­è£…æ»¡æ°´å’Œå°†æ¯å­çš„æ°´å…¨éƒ¨å€’å‡ºã€‚æˆ‘ä»¬éœ€è¦åšçš„å°±æ˜¯ç››å‡ºç»™å®šå®¹é‡çš„æ°´ã€‚æˆ‘ä»¬èƒ½åšçš„æ“ä½œæœ‰ä¸‰ä¸ª</p>
<ul>
<li>empty æ¸…ç©º</li>
<li>fill æ”¾æ»¡æ°´</li>
<li>pour(a, b) æŠŠ a çš„æ°´å…¨éƒ¨å¾€ b å€’ç›´è‡³ b æ¯æ»¡äº†æˆ–è€… a æ¯æ²¡æ°´äº†</li>
</ul>
<p>ç°åœ¨éœ€è¦æ‰¾åˆ°å–å¾—å®¹é‡ä¸º N çš„æ°´æ—¶ï¼Œéœ€è¦çš„æ“ä½œã€‚</p>
<p>é™„ï¼š1. <a href="https://github.com/razertory/scala-code-lab/blob/master/src/main/scala/scalaschool/WaterPouring.scala" target="_blank" rel="noopener">Scala å®Œæ•´ä»£ç </a> 2. <a href="https://www.youtube.com/watch?v=q6M_pco_5Vo" target="_blank" rel="noopener">python è§£æ³•</a></p>
<h2 id="W3"><a href="#W3" class="headerlink" title="W3"></a>W3</h2><blockquote>
<p>ä¸‹é¢ä¼šç”¨ Scala è¿›è¡ŒåŠ æ³•å™¨æ¨¡æ‹Ÿã€‚å¯¹äºè®¡ç®—æœºä¸­ï¼Œä¸¤ä¸ªæ•°å¦‚ä½•ç›¸åŠ ï¼Œå¯ä»¥æå‰é˜…è¯» <a href="https://zh.wikipedia.org/wiki/%E5%8A%A0%E6%B3%95%E5%99%A8" target="_blank" rel="noopener">ç»´åŸºç™¾ç§‘-åŠ æ³•å™¨</a>ï¼Œæœ€å¥½èƒ½å¤Ÿåšä¸€ä¸‹ <a href="/2019/11/11/add-by-bit/">ä½è¿ç®—å®ç°åŠ æ³•</a>ã€‚</p>
</blockquote>
<p>é€šè¿‡ä»¥ä¸Šå†…å®¹ï¼Œæˆ‘ä»¬éœ€è¦çŸ¥é“çš„æœ€é‡è¦çš„ç‚¹åœ¨äºï¼šä¸¤ä¸ªä¸€ä½äºŒè¿›åˆ¶æ•°ç›¸åŠ ï¼Œå°†ä¼šäº§ç”Ÿä¸¤ä¸ªè¾“å‡ºï¼Œå…¶ä¸­ä¸€ä¸ªæ˜¯å½“å‰ä½ç›¸åŠ çš„å€¼ Sï¼Œå¦ä¸€ä¸ªæ˜¯ç›¸åŠ åçš„è¿›ä½ä¿¡æ¯ Cã€‚å…¶ä¸­ S å¯ä»¥ç”¨<em>å¼‚æˆ–é—¨</em>ï¼Œè¿›ä½å¯ä»¥ç”¨<em>ä¸é—¨</em>ã€‚ä¸¤ä¸ªåŠåŠ å™¨ç”¨<em>æˆ–</em>é—¨ç»„åˆä¸ºä¸€ä¸ªå…¨åŠ å™¨ã€‚</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="http://ww1.sinaimg.cn/large/a67b702fgy1gc6mm6fcccj21fo0rgh3a.jpg" alt="å¼‚æˆ–çš„æ“ä½œé€šè¿‡ä¸‰ç§é—¨çš„ç»„åˆå®ç°" title>
                </div>
                <div class="image-caption">å¼‚æˆ–çš„æ“ä½œé€šè¿‡ä¸‰ç§é—¨çš„ç»„åˆå®ç°</div>
            </figure>

<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="http://ww1.sinaimg.cn/large/a67b702fgy1gc6mmvhps1j20tq0ja10b.jpg" alt="ä¸¤ä¸ªç”¨ä¸é—¨ç»„åˆçš„åŠåŠ å™¨æ„æˆä¸€ä¸ªå…¨åŠ å™¨" title>
                </div>
                <div class="image-caption">ä¸¤ä¸ªç”¨ä¸é—¨ç»„åˆçš„åŠåŠ å™¨æ„æˆä¸€ä¸ªå…¨åŠ å™¨</div>
            </figure>

<p>æ ¹æ®ä¸Šå›¾ï¼Œæˆ‘ä»¬è‡³å°‘éœ€è¦å®ç°çš„æ˜¯</p>
<ul>
<li><p>ç”µçº¿ï¼šç”¨æ¥ä¼ å¯¼ä¿¡å·ï¼Œä¿¡å·å¯ä»¥ç”¨ boolean ç±»å‹è¡¨ç¤º 0 å’Œ 1</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Wire</span> </span>&#123;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">var</span> sigVal = <span class="literal">false</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">getSignal</span></span>: <span class="type">Boolean</span> = sigVal</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">setSignal</span></span>(s: <span class="type">Boolean</span>): <span class="type">Unit</span> =</span><br><span class="line">    <span class="keyword">if</span> (s != sigVal) &#123;</span><br><span class="line">        sigVal = s</span><br><span class="line">        actions foreach(_())</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>ä¸é—¨ï¼šè¾“å…¥ä¸¤ä¸ªç”µä¿¡å·ï¼Œè¾“å‡º &amp; å¯¹åº”çš„ä¿¡å·</p>
</li>
</ul>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">andGate</span></span>(in1: <span class="type">Wire</span>, in2: <span class="type">Wire</span>, output: <span class="type">Wire</span>): <span class="type">Unit</span> = ???</span><br></pre></td></tr></table></figure>

<ul>
<li>æˆ–é—¨ï¼šè¾“å…¥ä¸¤ä¸ªç”µä¿¡å·ï¼Œè¾“å‡º | å¯¹åº”çš„ä¿¡å·</li>
</ul>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">orGate</span></span>(in1: <span class="type">Wire</span>, in2: <span class="type">Wire</span>, output: <span class="type">Wire</span>): <span class="type">Unit</span> = ???</span><br></pre></td></tr></table></figure>

<ul>
<li>é€†å˜å™¨ï¼šè¾“å…¥ç”µä¿¡å·ï¼Œè¾“å‡º ! å¯¹åº”çš„ä¿¡å·</li>
</ul>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">inverter</span></span>(in: <span class="type">Wire</span>, output: <span class="type">Wire</span>): <span class="type">Unit</span> = ???</span><br></pre></td></tr></table></figure>

<p>åœ¨æ­¤åŸºç¡€ä¸Šï¼Œå®ç°å‡ºåŠåŠ å™¨å’Œå…¨åŠ å™¨</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">halfAdder</span></span>(a: <span class="type">Wire</span>, b: <span class="type">Wire</span>, s: <span class="type">Wire</span>, c: <span class="type">Wire</span>): <span class="type">Unit</span> = &#123;</span><br><span class="line">  <span class="keyword">val</span> d = <span class="keyword">new</span> <span class="type">Wire</span></span><br><span class="line">  <span class="keyword">val</span> e = <span class="keyword">new</span> <span class="type">Wire</span></span><br><span class="line">  orGate(a, b, d)</span><br><span class="line">  andGate(a, b, c)</span><br><span class="line">  inverter(c, e)</span><br><span class="line">  andGate(d, e, s)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">fullAdder</span></span>(a: <span class="type">Wire</span>, b: <span class="type">Wire</span>, cin: <span class="type">Wire</span>, sum: <span class="type">Wire</span>, cout: <span class="type">Wire</span>): <span class="type">Unit</span> = &#123;</span><br><span class="line">  <span class="keyword">val</span> s = <span class="keyword">new</span> <span class="type">Wire</span></span><br><span class="line">  <span class="keyword">val</span> c1 = <span class="keyword">new</span> <span class="type">Wire</span></span><br><span class="line">  <span class="keyword">val</span> c2 = <span class="keyword">new</span> <span class="type">Wire</span></span><br><span class="line">  halfAdder(b, cin, s, c1)</span><br><span class="line">  halfAdder(a, s, sum, c2)</span><br><span class="line">  orGate(c1, c2, cout)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å®ç°äº†å…¨åŠ å™¨åã€‚åŠ å…¥æ¨¡æ‹Ÿä¿¡å·çš„è¾“å…¥è¾“å‡ºå³å¯ï¼Œå®Œæ•´ä»£ç  <a href="https://github.com/razertory/scala-code-lab/blob/master/src/main/scala/scalaschool/DigitalCircuitSimulator.scala" target="_blank" rel="noopener">æ¨¡æ‹ŸåŠ æ³•å™¨</a></p>
<h2 id="W4"><a href="#W4" class="headerlink" title="W4"></a>W4</h2><h3 id="Functional-Reactive-Programming-FRP"><a href="#Functional-Reactive-Programming-FRP" class="headerlink" title="Functional Reactive Programming (FRP)"></a>Functional Reactive Programming (FRP)</h3><p>åœ¨ MVC æ¨¡å‹ä¸­ï¼ŒFRP å¯ä»¥è®© model åœ¨äº§ç”Ÿå˜åŒ–çš„åŒæ—¶ view è‡ªåŠ¨å˜åŒ–ã€‚è¿™æ ·çš„æ¨¡å‹ä¸€èˆ¬ä¹Ÿå°±æ˜¯ pub-sub æ¨¡å‹æˆ–è€…å«è§‚å¯Ÿè€…æ¨¡å‹ (observers)ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Subscriber1   subscribe     ___________</span><br><span class="line">Subscriber2  ------------&gt; |          |</span><br><span class="line">Subscriber3                |Publisher |</span><br><span class="line">Subscriber4  &lt;------------ |          |</span><br><span class="line">Subscriber5    publish     |__________|</span><br></pre></td></tr></table></figure>

<p>é€šç”¨çš„è¯´æ¯”å¦‚ <code>a = f(b)</code> é‡Œé¢ã€‚å½“ b åœ¨å‘ç”Ÿå˜åŒ–çš„æ—¶å€™ a ä¹Ÿä¼šè·Ÿç€å˜ã€‚å®ç°è¿™ä¸€ç‚¹ï¼Œ<br>å¯ä»¥æŠŠã€Œå˜åŒ–ã€å½’åŒ–ä¸ºã€Œeventã€ï¼Œè€Œè‡ªåŠ¨æ£€æŸ¥è¿™äº›ã€Œeventã€çš„ä¸œè¥¿å«åš Signalã€‚åœ¨ Scala é‡Œé¢é€šå¸¸æŠŠè¿™æ ·çš„ Signal å®ç°ä¸ºä¸€ä¸ªç±»å‹ï¼Œé€šè¿‡ apply() ç»™å…¶èµ‹å€¼ã€‚æ¯”å¦‚</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> s = <span class="type">Signal</span>(<span class="number">1</span>)</span><br><span class="line"><span class="keyword">val</span> v = s() <span class="comment">// 1</span></span><br></pre></td></tr></table></figure>

<p>åŒæ—¶ï¼Œä¸ºäº†ç»™ Signal å†æ¬¡èµ‹å€¼ï¼Œå¯ä»¥æ‰©å±•æ–°å¢ä¸€ä¸ª update æ–¹æ³•ã€‚æ¯”å¦‚ <code>s.update(5)</code>ï¼Œé¡ºå¸¦å¯ä»¥å†™æˆ <code>s() = 5</code>ã€‚è¿™æ ·çš„è¯ï¼Œå®ç°ä¸€ä¸ªæ‰©å±•äº† Signal åä¸º <code>Var</code> çš„ç±»å‹ï¼Œè®©å…¶æ‹¥æœ‰ <code>update</code> æ–¹æ³•ã€‚</p>
<p>åœ¨è¿™æ ·çš„æ¡ä»¶ä¸‹ï¼Œ</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// (1)</span></span><br><span class="line"><span class="keyword">val</span> num = <span class="type">Var</span>(<span class="number">1</span>)</span><br><span class="line"><span class="keyword">val</span> twice = <span class="type">Signal</span>(num() * <span class="number">2</span>)</span><br><span class="line">num() = <span class="number">2</span></span><br><span class="line"><span class="comment">// (2)</span></span><br><span class="line"><span class="keyword">var</span> num = <span class="type">Var</span>(<span class="number">1</span>)</span><br><span class="line"><span class="keyword">val</span> twice = <span class="type">Signal</span>(num() * <span class="number">2</span>)</span><br><span class="line">num = <span class="type">Var</span>(<span class="number">2</span>)</span><br></pre></td></tr></table></figure>

<p>(1) é‡Œé¢çš„ twice å˜ä¸º 4ï¼Œï¼ˆ2ï¼‰é‡Œé¢çš„ twice è¿˜æ˜¯ 2ã€‚ä¸Šè¿°ä½“ç°çš„ FRP é‡Œé¢ï¼Œnum æ˜¯ <em>publisher</em>ï¼Œtwice æ˜¯ <em>subscriber</em>ã€‚num äº§ç”Ÿäº† eventï¼Œtwice æ¥å—è¿™æ ·çš„ eventã€‚å¹¶ä¸”æ‰€æœ‰çš„å˜é‡æœ¬èº«éƒ½æ˜¯ <em>immutable</em>ã€‚</p>
<h3 id="å®ç°-FRP"><a href="#å®ç°-FRP" class="headerlink" title="å®ç° FRP"></a>å®ç° FRP</h3><h4 id="Var-å’Œ-Signal"><a href="#Var-å’Œ-Signal" class="headerlink" title="Var å’Œ Signal"></a>Var å’Œ Signal</h4><p>æˆ‘ä»¬çŸ¥é“ Signal å’Œ Var åº”è¯¥æ˜¯è¿™æ ·</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// signal</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Signal</span>[<span class="type">T</span>](<span class="params">expr: =&gt; <span class="type">T</span></span>) </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">apply</span></span>(): <span class="type">T</span> = ???</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">Signal</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">apply</span></span>[<span class="type">T</span>](expr: =&gt; <span class="type">T</span>) = <span class="keyword">new</span> <span class="type">Signal</span>(expr)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// var</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Var</span>[<span class="type">T</span>](<span class="params">expr: =&gt; <span class="type">T</span></span>) <span class="keyword">extends</span> <span class="title">Signal</span>[<span class="type">T</span>](<span class="params">expr</span>) </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">update</span></span>(expr: =&gt; <span class="type">T</span>): <span class="type">Unit</span> = ???</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">Var</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">apply</span></span>[<span class="type">T</span>](expr: =&gt; <span class="type">T</span>) = <span class="keyword">new</span> <span class="type">Var</span>(expr)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="ç»´æŠ¤è®¢é˜…å…³ç³»"><a href="#ç»´æŠ¤è®¢é˜…å…³ç³»" class="headerlink" title="ç»´æŠ¤è®¢é˜…å…³ç³»"></a>ç»´æŠ¤è®¢é˜…å…³ç³»</h3><p>æœ‰äº†è¿™äº›æ–¹æ³•ï¼Œå°±å¯ä»¥åšåˆ°èµ‹å€¼å’Œå†æ¬¡èµ‹å€¼ã€‚è¿˜éœ€è¦çš„æ˜¯ï¼Œå½“ä¸€ä¸ª publisher äº§ç”Ÿäº† event çš„æ—¶å€™ï¼Œå¦‚ä½•è‡ªåŠ¨é€šçŸ¥åˆ°å¯¹åº”çš„ subscriberï¼Œå¹¶ä¸”è®©å…¶é‡æ–°è®¡ç®—ï¼ˆre-evaluateï¼‰ã€‚</p>
<p>ä¾‹å¦‚ï¼Œs æ˜¯ Var ç±»å‹ï¼Œå¹¶ä¸”è¿›å…¥åˆ°äº†è¡¨è¾¾å¼ expr é‡Œï¼Œå½¢å¦‚ <code>expr s</code>ï¼Œé‚£ä¹ˆå½“è¡¨è¾¾å¼ <code>expr s</code>ï¼Œä½œä¸ºå‚æ•°ä¼ é€’ç»™äº†æŸä¸ª Signal å½¢å¦‚ <code>val t = Signal(expr s)</code> çš„æ—¶å€™ã€‚å°±éœ€è¦ç»™ s ç»´æŠ¤ä¸€ä¸ª subscriberã€‚åŒç†ï¼Œå½“æœ‰å¤šä¸ª subscribers çš„æ—¶å€™å°±ç»™ s ç»´æŠ¤ä¸€ä¸ª subscriber çš„é›†åˆã€‚æ¯”å¦‚</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// val set = Set()</span></span><br><span class="line"><span class="keyword">var</span> num = <span class="type">Var</span>(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// è§¦å‘çš„æ¡ä»¶å°±æ˜¯ class Var çš„ apply æ–¹æ³•ã€‚</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// è§¦å‘ï¼šset += Signal(num() * 2)</span></span><br><span class="line"><span class="keyword">val</span> double = <span class="type">Signal</span>(num() * <span class="number">2</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// è§¦å‘ï¼šset += Signal(num() * 3)</span></span><br><span class="line"><span class="keyword">val</span> tiple = <span class="type">Signal</span>(num() * <span class="number">3</span>)</span><br></pre></td></tr></table></figure>

<p>è§¦å‘çš„æ¡ä»¶è¾¾åˆ°äº†ï¼Œå¯æ˜¯å¦‚ä½•æŠŠ <code>Signal(num() * 3)</code> è¿™æ ·çš„å¯¹è±¡ä¼ é€’ç»™ num çš„ set ï¼Ÿ</p>
<p>è¿™ä¸ªæ—¶å€™å°±éœ€è¦åœ¨ Object Signal é‡Œé¢æ–°å¢ä¸€å—ç”¨äºç»´æŠ¤æ–¹æ³•è°ƒç”¨çš„æ•°æ®ç»“æ„ï¼Œæ²¡åšå°±æ˜¯ stack</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">Signal</span> </span>&#123;</span><br><span class="line">  <span class="keyword">val</span> caller = <span class="keyword">new</span> <span class="type">StackableVariable</span>[<span class="type">Signal</span>[_]](<span class="type">NoSignal</span>)</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">apply</span></span>[<span class="type">T</span>](expr: =&gt; <span class="type">T</span>) = <span class="keyword">new</span> <span class="type">Signal</span>(expr)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>StackableVariable åœ¨å½“å‰çš„ä¸Šä¸‹æ–‡ä¸­å¤šä¸ª Signal/Object ä¼šå…±äº«ã€‚å½“è°ƒç”¨ class Signal çš„ apply() æ–¹æ³•çš„æ—¶å€™å°±å»è¿™é‡Œé¢æ‰¾åˆ°å½“å‰çš„è°ƒç”¨æ–¹ã€‚</p>
<h3 id="ç»´æŠ¤è°ƒç”¨æ ˆ"><a href="#ç»´æŠ¤è°ƒç”¨æ ˆ" class="headerlink" title="ç»´æŠ¤è°ƒç”¨æ ˆ"></a>ç»´æŠ¤è°ƒç”¨æ ˆ</h3><p>è°ƒç”¨æ ˆé‡Œé¢å­˜æ”¾æœ‰åºçš„ Signalã€‚ä¾‹å¦‚ï¼Œæœ‰ä¸‹é¢æµ‹è¯•ä»£ç </p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">test(<span class="string">"multi subscribers"</span>) &#123;</span><br><span class="line">  <span class="keyword">val</span> publisher = <span class="type">Var</span>(<span class="number">1</span>)</span><br><span class="line">  <span class="keyword">val</span> subscriber1 = <span class="type">Signal</span>(publisher() * <span class="number">20</span>) <span class="comment">// æ³¨æ„ scala çš„ call-by-name å’Œ call-by-valueã€‚è¿™é‡Œä¼ é€’çš„æ˜¯è¡¨è¾¾å¼</span></span><br><span class="line">  <span class="keyword">val</span> subscriber2 = <span class="type">Signal</span>(publisher() * <span class="number">30</span>)</span><br><span class="line">  <span class="keyword">val</span> subscriber3 = <span class="type">Signal</span>(publisher() * <span class="number">40</span>)</span><br><span class="line">  assert(subscriber1() == <span class="number">20</span>)</span><br><span class="line">  assert(subscriber2() == <span class="number">30</span>)</span><br><span class="line">  assert(subscriber3() == <span class="number">40</span>)</span><br><span class="line">  publisher() = <span class="number">2</span></span><br><span class="line">  assert(subscriber1() == <span class="number">40</span>)</span><br><span class="line">  assert(subscriber2() == <span class="number">60</span>)</span><br><span class="line">  assert(subscriber3() == <span class="number">80</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç¬¬ä¸‰è¡Œå¼€å§‹ï¼ŒåŒ…å«è¡¨è¾¾å¼çš„ Signal è¿›å…¥è°ƒç”¨æ ˆï¼Œå¹¶ä¸æ–­è¢«å¸¦å…¥ subscriber çš„é›†åˆã€‚</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">StackableVariable</span>[<span class="type">T</span>](<span class="params">init: <span class="type">T</span></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">var</span> values: <span class="type">List</span>[<span class="type">T</span>] = <span class="type">List</span>(init)</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">value</span></span>: <span class="type">T</span> = values.head</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">withValue</span></span>[<span class="type">R</span>](newValue: <span class="type">T</span>)(op: =&gt; <span class="type">R</span>): <span class="type">R</span> = &#123;</span><br><span class="line">    values = newValue :: values</span><br><span class="line">    <span class="keyword">try</span> op <span class="keyword">finally</span> values = values.tail</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><a href="https://github.com/razertory/scala-code-lab/blob/master/src/main/scala/scalaschool/SubPub.scala" target="_blank" rel="noopener">å®Œæ•´ä»£ç </a></p>

        </div>

        <blockquote class="post-copyright">
    
    <div class="content">
        

        
        æœ¬æ–‡ç”± <a href="https://razertory.me"> Razertory's Blog </a> ç‰ˆæƒæ‰€æœ‰ã€‚å¦‚è‹¥å‘ç°æœ‰è¯¯ï¼Œæ¬¢è¿æŒ‡æ­£(https://t.me/razertory)ã€‚å¦‚è‹¥è½¬è½½ï¼Œè¯·æ³¨æ˜å‡ºå¤„ã€‚åŸæ–‡åœ°å€ <a href="/2020/02/20/functional-program-design-in-scala/" target="_blank" rel="external">https://razertory.me/2020/02/20/functional-program-design-in-scala/</a>
        
    </div>
    
    <footer>
        <a href="https://razertory.me">
            <img src="/img/avatar.jpg" alt="Razertory">
            Razertory
        </a>
    </footer>
</blockquote>

        


        <div class="post-footer">
            

            


        </div>
    </div>

    
<nav class="post-nav flex-row flex-justify-between">
  
    <div class="waves-block waves-effect prev">
      <a href="/2020/04/11/linux-kernel-process/" id="post-prev" class="post-nav-link">
        <div class="tips"><i class="icon icon-angle-left icon-lg icon-pr"></i> Prev</div>
        <h4 class="title">ã€ŒLinux å†…æ ¸ã€è¿›ç¨‹ç®¡ç†</h4>
      </a>
    </div>
  

  
    <div class="waves-block waves-effect next">
      <a href="/2020/02/16/lru-cache/" id="post-next" class="post-nav-link">
        <div class="tips">Next <i class="icon icon-angle-right icon-lg icon-pl"></i></div>
        <h4 class="title">LRU ç¼“å­˜</h4>
      </a>
    </div>
  
</nav>



    

















<section class="comments" id="comments">
    <div id="gitalk-container"></div>
    <link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css">
    <script src="https://unpkg.com/gitalk/dist/gitalk.min.js"></script>
    <script>
        var id = location.pathname
        if (location.pathname.length > 50) {
          id = location.pathname.replace(/\/\d+\/\d+\/\d+\//, '').replace('/', '').substring(0, 50)
        }
        const gitalk = new Gitalk({
        //   clientID: '',
        //   clientSecret: '',
          accessToken: 'c31444be137a00f482e74d50f295dfb071bd6bc3',
          repo: 'razertory.github.io',
          owner: 'razertory',
          admin: ['razertory'],
          id: id,      // Ensure uniqueness and length less than 50
          title: document.title.split('|')[0],
          distractionFreeMode: false  // Facebook-like distraction free mode
        })

        gitalk.render('gitalk-container')
    </script>
</section>




</article>



</div>

        <footer class="footer">
    <div class="top">
        

        <p>
            
                <span><a href="/atom.xml" target="_blank" class="rss" title="rss"><i class="icon icon-lg icon-rss"></i></a></span>
            
            <span>ã“ã®ãƒ–ãƒ­ã‚°ã®å†…å®¹ç‰©ã¯<a rel="license" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.ja">ã‚¯ãƒªã‚¨ã‚¤ãƒ†ã‚£ãƒ–ãƒ»ã‚³ãƒ¢ãƒ³ã‚º è¡¨ç¤º - éå–¶åˆ© - ç¶™æ‰¿ 4.0 å›½éš›ãƒ©ã‚¤ã‚»ãƒ³ã‚¹ã®ä¸‹ã«æä¾›ã•ã‚Œã¦ã„ã¾ã™</a></span>
        </p>
    </div>
    <div class="bottom">
        <p><span>Razertory &copy; 2018 - 2020</span>
            <span>
                
                Power by <a href="http://hexo.io/" target="_blank">Hexo</a> Theme <a href="https://github.com/yscoder/hexo-theme-indigo" target="_blank">indigo</a>
            </span>
        </p>
    </div>
</footer>

    </main>
    <div class="mask" id="mask"></div>
<a href="javascript:;" id="gotop" class="waves-effect waves-circle waves-light"><span class="icon icon-lg icon-chevron-up"></span></a>


    <script src="//cdn.bootcss.com/node-waves/0.7.4/waves.min.js"></script>
<script>
var BLOG = { ROOT: '/', SHARE: false, REWARD: false };


</script>

<script src="//unpkg.com/hexo-theme-material-indigo@latest/js/main.min.js"></script>


<div class="search-panel" id="search-panel">
    <ul class="search-result" id="search-result"></ul>
</div>
<template id="search-tpl">
<li class="item">
    <a href="{path}" class="waves-block waves-effect">
        <div class="title ellipsis" title="{title}">{title}</div>
        <div class="flex-row flex-middle">
            <div class="tags ellipsis">
                {tags}
            </div>
            <time class="flex-col time">{date}</time>
        </div>
    </a>
</li>
</template>

<script src="//unpkg.com/hexo-theme-material-indigo@latest/js/search.min.js" async></script>



<!-- mathjax config similar to math.stackexchange -->

<script type="text/x-mathjax-config">
MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
        processEscapes: true,
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    }
});

MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';
    }
});
</script>

<script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" async></script>






<script>
(function() {
    var OriginTitile = document.title, titleTime;
    document.addEventListener('visibilitychange', function() {
        if (document.hidden) {
            document.title = 'ä¸€æ›²è‚è‚ æ–­ï¼Œå¤©æ¶¯ä½•å¤„è§…çŸ¥éŸ³';
            clearTimeout(titleTime);
        } else {
            document.title = 'Razertory';
            titleTime = setTimeout(function() {
                document.title = OriginTitile;
            },2000);
        }
    });
})();
</script>



</body>
</html>
