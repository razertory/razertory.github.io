<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Razertory çš„æŠ€æœ¯åšå®¢</title>
  
  <subtitle>ä¸€æ›²è‚è‚ æ–­ï¼Œå¤©æ¶¯ä½•å¤„è§…çŸ¥éŸ³</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="https://razertory.me/"/>
  <updated>2020-04-12T07:12:39.314Z</updated>
  <id>https://razertory.me/</id>
  
  <author>
    <name>Razertory</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>ã€ŒLinux å†…æ ¸ã€ç³»ç»Ÿè°ƒç”¨</title>
    <link href="https://razertory.me/2020/04/12/linux-kernel-system-call/"/>
    <id>https://razertory.me/2020/04/12/linux-kernel-system-call/</id>
    <published>2020-04-12T05:50:04.000Z</published>
    <updated>2020-04-12T07:12:39.314Z</updated>
    
    <content type="html"><![CDATA[<p>å†…æ ¸å†…å­˜ç©ºé—´åœ¨æ“ä½œç³»ç»Ÿä¸­æ˜¯å—ä¿æŠ¤çš„ã€‚é€šå¸¸æƒ…å†µä¸‹ï¼Œä¸€ä¸ªæ™®é€šç¨‹åºæ‰§è¡Œåœ¨ç”¨æˆ·ç©ºé—´ã€‚å½“éœ€è¦ä¸å†…æ ¸é€šä¿¡çš„æ—¶å€™ï¼Œæ¯”å¦‚å†™æ–‡ä»¶åˆ°ç£ç›˜ï¼Œå°±éœ€è¦è¿›è¡Œ<strong>ç³»ç»Ÿè°ƒç”¨</strong>ã€‚</p><p>æœ‰è¶£çš„æ˜¯ï¼Œå†…æ ¸åŸç”Ÿæä¾›çš„ç³»ç»Ÿè°ƒç”¨å¾ˆå°‘(å‚è€ƒ<a href="http://asm.sourceforge.net/syscall.html" target="_blank" rel="noopener">List of Linux/i386 system calls</a>)ã€‚å½“æˆ‘ä»¬éœ€è¦ç³»ç»Ÿè°ƒç”¨çš„æ—¶å€™ï¼Œå®é™…ä¸Šæ˜¯åœ¨è°ƒç”¨è°ƒç”¨çš„ä¸Šä¸€å±‚ APIã€‚è¿™ä¸€å±‚ API å°è£…äº†å„ç§ç³»ç»Ÿè°ƒç”¨ï¼ˆé€šå¸¸å°±æ˜¯æ“ä½œç³»ç»Ÿå†…ç½®çš„ C åº“ï¼‰ã€‚ç°é˜¶æ®µï¼Œè¿™ä¸€å±‚ API çš„æ ‡å‡†æ¥è‡ªäº IEEE ï¼Œåä¸º POSIXï¼ˆPortable Operating System Interfaceï¼‰ã€‚è¿™ä¹ˆåšçš„åŸå› æ˜¯ unix å€¡å¯¼çš„ <em>æä¾›æœºåˆ¶ï¼Œè€Œä¸æ˜¯æä¾›ç­–ç•¥</em>ã€‚æ„æ€æ˜¯æä¾›æœ‰é™çš„ï¼Œä½†å¯ä»¥å¾ˆå¥½ç»„åˆçš„å·¥å…·ã€æ–¹æ³•ï¼Œåœ¨æ­¤åŸºç¡€ä¸Šå®ç°å„ç§åŠŸèƒ½ã€‚</p><p>ä¾‹å¦‚ï¼Œ</p><p><code>get_pid()</code> åœ¨å†…æ ¸ä¸­çš„è¢«å®šä¹‰ä¸º <code>sys_getpid()</code><br><code>bar()</code> åœ¨å†…æ ¸ä¸­è¢«å®šä¹‰ä¸º <code>sys_bar()</code></p><p>ä¸€ä¸ªç”¨æˆ·ç©ºé—´çš„ç¨‹åºï¼Œè¦åšç³»ç»Ÿè°ƒç”¨ï¼Œå…·ä½“çš„è¿‡ç¨‹ä¸º</p><ul><li>é™·å…¥å†…æ ¸</li><li>ä¼ é€’ç³»ç»Ÿè°ƒç”¨ç¼–å·å’Œå‚æ•°</li><li>æ‰§è¡Œç³»ç»Ÿè°ƒç”¨</li><li>å°†ç³»ç»Ÿè°ƒç”¨çš„è¿”å›å€¼å¸¦ç»™ç”¨æˆ·ç©ºé—´</li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;å†…æ ¸å†…å­˜ç©ºé—´åœ¨æ“ä½œç³»ç»Ÿä¸­æ˜¯å—ä¿æŠ¤çš„ã€‚é€šå¸¸æƒ…å†µä¸‹ï¼Œä¸€ä¸ªæ™®é€šç¨‹åºæ‰§è¡Œåœ¨ç”¨æˆ·ç©ºé—´ã€‚å½“éœ€è¦ä¸å†…æ ¸é€šä¿¡çš„æ—¶å€™ï¼Œæ¯”å¦‚å†™æ–‡ä»¶åˆ°ç£ç›˜ï¼Œå°±éœ€è¦è¿›è¡Œ&lt;strong&gt;ç³»ç»Ÿè°ƒç”¨&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;p&gt;æœ‰è¶£çš„æ˜¯ï¼Œå†…æ ¸åŸç”Ÿæä¾›çš„ç³»ç»Ÿè°ƒç”¨å¾ˆå°‘(å‚è€ƒ&lt;a href=&quot;http://asm.so
      
    
    </summary>
    
    
      <category term="æ“ä½œç³»ç»Ÿ" scheme="https://razertory.me/tags/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/"/>
    
  </entry>
  
  <entry>
    <title>ã€ŒLinux å†…æ ¸ã€è¿›ç¨‹ç®¡ç†</title>
    <link href="https://razertory.me/2020/04/11/linux-kernel-process/"/>
    <id>https://razertory.me/2020/04/11/linux-kernel-process/</id>
    <published>2020-04-11T10:15:42.000Z</published>
    <updated>2020-04-11T11:54:05.665Z</updated>
    
    <content type="html"><![CDATA[<h4 id="æ¦‚è§ˆ"><a href="#æ¦‚è§ˆ" class="headerlink" title="æ¦‚è§ˆ"></a>æ¦‚è§ˆ</h4><p>è¿›ç¨‹æ˜¯å¤„äºæ‰§è¡ŒæœŸçš„ç¨‹åºä»¥åŠç›¸å…³èµ„æºçš„æ€»ç§°ã€‚æ¯”å¦‚æ‰“å¼€çš„æ–‡ä»¶ã€æŒ‚èµ·çš„ä¿¡å·ã€å†…æ ¸å†…éƒ¨æ•°æ®ç­‰ç­‰ã€‚åœ¨ linux æºç ä¸­ï¼Œä¸€ä¸ªè¿›ç¨‹çš„ç›¸å…³ä¿¡æ¯ç»´æŠ¤åœ¨ task_struct <a href="https://github.com/torvalds/linux/blob/master/include/linux/sched.h#L632" target="_blank" rel="noopener">task_struct</a>çš„ç»“æ„ä½“ä¸­ã€‚è¿™é‡Œé¢åŒ…å«äº†è¿›ç¨‹çš„çŠ¶æ€(pidï¼Œè¿è¡ŒçŠ¶æ€)ã€ç›¸å…³èµ„æºã€ä»¥åŠç›¸å…³è¿›ç¨‹ï¼ˆå­è¿›ç¨‹ã€çˆ¶è¿›ç¨‹ï¼‰ä¿¡æ¯ã€‚å†…æ ¸ä¼šç»´æŠ¤ä¸€ä¸ªåŒå‘é“¾è¡¨ï¼Œæ¯ä¸ªé“¾è¡¨çš„èŠ‚ç‚¹æŒ‡å‘å¯¹åº”çš„ task_structã€‚</p><h4 id="çŠ¶æ€"><a href="#çŠ¶æ€" class="headerlink" title="çŠ¶æ€"></a>çŠ¶æ€</h4><ul><li>TASK_RUNNING: å¯æ‰§è¡Œçš„ï¼›ç­‰å¾…æ‰§è¡Œçš„</li><li>TASK_INTERRUPTIBLE: å¯ä¸­æ–­çš„; æ¯”å¦‚è¢«é˜»å¡ã€æˆ–è€…åœ¨ sleep</li><li>TASK_UNINTERRUPTIBLE: ä¸å¯ä¸­æ–­çš„; å¯¹å¤–ç•Œçš„ä¿¡å·ä¸åšå‡ºå“åº”</li><li>EXIT_ZOMBIE: ä¸»åŠ¨é€€å‡ºï¼›è¿˜æ²¡æœ‰å®Œå…¨é‡Šæ”¾èµ„æº</li></ul><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="http://ww1.sinaimg.cn/large/a67b702fgy1gdq0dnlo0cg20fw09b0sw.gif" alt="è¿›ç¨‹çŠ¶æ€å›¾" title>                </div>                <div class="image-caption">è¿›ç¨‹çŠ¶æ€å›¾</div>            </figure><h4 id="ç”Ÿå‘½å‘¨æœŸ"><a href="#ç”Ÿå‘½å‘¨æœŸ" class="headerlink" title="ç”Ÿå‘½å‘¨æœŸ"></a>ç”Ÿå‘½å‘¨æœŸ</h4><p>åœ¨è¿›ç¨‹è¢« fork å‡ºæ¥ä¹‹å task_struct ä¼šæœ‰è‡ªå·±çš„ pid å’Œçˆ¶è¿›ç¨‹çš„ pidã€‚ä½†ä¸€äº›å¿…è¦çš„ç³»ç»Ÿèµ„æºå¹¶ä¸ä¼šæ‹·è´è¿‡æ¥ï¼Œè€Œæ˜¯å½“éœ€è¦å†™å…¥çš„æ—¶å€™å†åš(copy-on-write)ã€‚è¿›ç¨‹è°ƒç”¨ exit() ç»“æŸ, éƒ¨åˆ†èµ„æºä¼šé‡Šæ”¾ï¼ŒåŒæ—¶è°ƒç”¨ exit_notify() å‘çˆ¶è¿›ç¨‹å‘ä¿¡å·ã€‚è‹¥çˆ¶è¿›ç¨‹åŠæ—¶å“åº”ï¼Œæ­¤æ—¶é‡Šæ”¾æ‰€æœ‰çš„èµ„æºï¼›å¦åˆ™è®¤ä¸ºæ­¤æ—¶çš„è¿™ä¸ªè¿›ç¨‹æ˜¯åƒµå°¸è¿›ç¨‹ã€‚åŒç†ï¼Œå¦‚æœçˆ¶è¿›ç¨‹å…ˆäºå­è¿›ç¨‹é€€å‡ºï¼Œå­è¿›ç¨‹å°±ä¼šæˆä¸ºå­¤å„¿è¿›ç¨‹ã€‚å†…æ ¸ä¼šå°†è¿™ç±»è¿›ç¨‹å½’ç»™ pid ä¸º 1 çš„è¿›ç¨‹ã€‚</p><h4 id="çº¿ç¨‹"><a href="#çº¿ç¨‹" class="headerlink" title="çº¿ç¨‹"></a>çº¿ç¨‹</h4><p>çº¿ç¨‹æ˜¯ä¸€ç§ç‰¹æ®Šçš„è¿›ç¨‹ï¼ˆå¼ºè°ƒåªæ˜¯ linuxï¼‰åŒä¸€ä¸ªè¿›ç¨‹çš„ N ä¸ªçº¿ç¨‹åªæ˜¯ N ä¸ªå…±äº«åŒä¸€å—èµ„æºçš„<br>task_structã€‚æ¯”å¦‚è¿›ç¨‹åˆ›å»ºçš„æ—¶å€™ä¼šä¾èµ– clone æ–¹æ³•</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">clone(SIGCHLD, <span class="number">0</span>)</span><br></pre></td></tr></table></figure><p>è€Œçº¿ç¨‹çš„åˆ›å»ºå°±æ˜¯ä¼ é€’æ¥ä¸€äº›å‚æ•°æ¥æŒ‡æ˜è¢«å…±äº«çš„èµ„æºï¼Œè¿™ä¸ªè®¾è®¡ç°åœ¨çœ‹èµ·æ¥ä¹Ÿæ˜¯éå¸¸ä¼˜é›…çš„ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">clone(CLONE_VM | CLONE_FS | CLONE_FILES | CLONE_SIGHAND, <span class="number">0</span>)</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h4 id=&quot;æ¦‚è§ˆ&quot;&gt;&lt;a href=&quot;#æ¦‚è§ˆ&quot; class=&quot;headerlink&quot; title=&quot;æ¦‚è§ˆ&quot;&gt;&lt;/a&gt;æ¦‚è§ˆ&lt;/h4&gt;&lt;p&gt;è¿›ç¨‹æ˜¯å¤„äºæ‰§è¡ŒæœŸçš„ç¨‹åºä»¥åŠç›¸å…³èµ„æºçš„æ€»ç§°ã€‚æ¯”å¦‚æ‰“å¼€çš„æ–‡ä»¶ã€æŒ‚èµ·çš„ä¿¡å·ã€å†…æ ¸å†…éƒ¨æ•°æ®ç­‰ç­‰ã€‚åœ¨ linux æºç ä¸­ï¼Œä¸€ä¸ªè¿›ç¨‹çš„ç›¸å…³ä¿¡æ¯ç»´æŠ¤åœ¨ t
      
    
    </summary>
    
    
      <category term="æ“ä½œç³»ç»Ÿ" scheme="https://razertory.me/tags/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/"/>
    
  </entry>
  
  <entry>
    <title>Scala å‡½æ•°å¼ç¼–ç¨‹è®¾è®¡</title>
    <link href="https://razertory.me/2020/02/20/functional-program-design-in-scala/"/>
    <id>https://razertory.me/2020/02/20/functional-program-design-in-scala/</id>
    <published>2020-02-20T15:53:05.000Z</published>
    <updated>2020-03-28T13:02:10.018Z</updated>
    
    <content type="html"><![CDATA[<p>åœ¨è¿™ä¸ª 2020 å¹´åˆçš„ç‰¹æ®Šæ—¶æœŸã€‚</p><p>Scala æ˜¯ä¸€é—¨ç°ä»£åŒ–ï¼Œå¤šèŒƒå¼çš„ JVM è¯­è¨€ã€‚</p><p>ä¼ é€é—¨ï¼ˆå¯èƒ½éœ€è¦ğŸš€)</p><ul><li><a href="https://www.coursera.org/learn/progfun2" target="_blank" rel="noopener">Functional Program Design in Scala on Coursera</a></li><li><a href="https://www.coursera.org/account/accomplishments/certificate/BP5FRUVSFPN8" target="_blank" rel="noopener">æ²¡ä»€ä¹ˆç”¨çš„ certificate</a></li></ul><hr><h2 id="W1"><a href="#W1" class="headerlink" title="W1"></a>W1</h2><h3 id="case-class-å’Œæ¨¡å¼åŒ¹é…"><a href="#case-class-å’Œæ¨¡å¼åŒ¹é…" class="headerlink" title="case class å’Œæ¨¡å¼åŒ¹é…"></a>case class å’Œæ¨¡å¼åŒ¹é…</h3><p>ç”¨ Scala æ¥è¡¨ç¤º JSON å¯¹è±¡å¯ä»¥è¿™æ ·</p><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">JSON</span></span></span><br><span class="line"><span class="class"><span class="title">case</span> <span class="title">class</span> <span class="title">JSeq</span> (<span class="params">elems: <span class="type">List</span>[<span class="type">JSON</span>]</span>) <span class="keyword">extends</span> <span class="title">JSON</span>  <span class="title">//</span> <span class="title">JSON</span> <span class="title">çš„æ•°ç»„</span></span></span><br><span class="line"><span class="class"><span class="title">case</span> <span class="title">class</span> <span class="title">JObj</span> (<span class="params">bindings: <span class="type">Map</span>[<span class="type">String</span>, <span class="type">JSON</span>]</span>) <span class="keyword">extends</span> <span class="title">JSON</span> <span class="title">//</span> <span class="title">JSON</span> <span class="title">å¯¹è±¡</span></span></span><br><span class="line"><span class="class"><span class="title">case</span> <span class="title">class</span> <span class="title">JNum</span> (<span class="params">num: <span class="type">Double</span></span>) <span class="keyword">extends</span> <span class="title">JSON</span> <span class="title">//</span> <span class="title">æ•°å­—ç±»å‹</span></span></span><br><span class="line"><span class="class"><span class="title">case</span> <span class="title">class</span> <span class="title">JStr</span> (<span class="params">str: <span class="type">String</span></span>) <span class="keyword">extends</span> <span class="title">JSON</span></span></span><br><span class="line"><span class="class"><span class="title">case</span> <span class="title">class</span> <span class="title">JBool</span>(<span class="params">b: <span class="type">Boolean</span></span>) <span class="keyword">extends</span> <span class="title">JSON</span></span></span><br><span class="line"><span class="class"><span class="title">case</span> <span class="title">object</span> <span class="title">JNull</span> <span class="keyword">extends</span> <span class="title">JSON</span> <span class="title">//</span> <span class="title">ç©º</span></span></span><br></pre></td></tr></table></figure><p>æ‰€ä»¥ï¼Œ</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">"firstName"</span> : <span class="string">"John"</span>,</span><br><span class="line">    <span class="attr">"lastName"</span> : <span class="string">"Smith"</span>,</span><br><span class="line">    <span class="attr">"address"</span> : &#123;</span><br><span class="line">        <span class="attr">"streetAddress"</span> : <span class="string">"21 2 nd Street"</span>,</span><br><span class="line">        <span class="attr">"state"</span> : <span class="string">"NY"</span>,</span><br><span class="line">        <span class="attr">"postalCode"</span>: <span class="number">10021</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">"phoneNumbers"</span>: [</span><br><span class="line">        &#123;<span class="attr">"type"</span> : <span class="string">"home"</span>,<span class="attr">"number "</span>: <span class="string">"212 555 -1234"</span>&#125; ,</span><br><span class="line">        &#123;<span class="attr">"type"</span> : <span class="string">"fax"</span>,<span class="attr">"number "</span>: <span class="string">"646 555 -4567"</span>&#125;</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯ä»¥è¡¨ç¤ºä¸º</p><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> data = <span class="type">JObj</span>(<span class="type">Map</span>(</span><br><span class="line">    <span class="string">"firstName"</span> -&gt; <span class="type">JStr</span>(<span class="string">"John"</span>),</span><br><span class="line">    <span class="string">"lastName"</span> -&gt; <span class="type">JStr</span>(<span class="string">"Smith"</span>),</span><br><span class="line">    <span class="string">"address"</span> -&gt; <span class="type">JObj</span>(<span class="type">Map</span>(</span><br><span class="line">    <span class="string">"streetAddress"</span> -&gt; <span class="type">JStr</span>(<span class="string">"21 2nd Street"</span>),</span><br><span class="line">    <span class="string">"state"</span> -&gt; <span class="type">JStr</span>(<span class="string">"NY"</span>),</span><br><span class="line">    <span class="string">"postalCode"</span> -&gt; <span class="type">JNum</span>(<span class="number">10021</span>)</span><br><span class="line">)),</span><br><span class="line"><span class="string">"phoneNumbers"</span> -&gt; <span class="type">JSeq</span>(<span class="type">List</span>(</span><br><span class="line">    <span class="type">JObj</span>(<span class="type">Map</span>(</span><br><span class="line">    <span class="string">"type"</span> -&gt; <span class="type">JStr</span>(<span class="string">"home"</span>), <span class="string">"number"</span> -&gt; <span class="type">JStr</span>(<span class="string">"212 555-1234"</span>)</span><br><span class="line">)),</span><br><span class="line"><span class="type">JObj</span>(<span class="type">Map</span>(</span><br><span class="line">    <span class="string">"type"</span> -&gt; <span class="type">JStr</span>(<span class="string">"fax"</span>), <span class="string">"number"</span> -&gt; <span class="type">JStr</span>(<span class="string">"646 555-4567"</span>)</span><br><span class="line">)) )) ))</span><br></pre></td></tr></table></figure><p>æ¯”å¦‚è¯´æˆ‘è¦å®ç°ä¸€ä¸ªæ‰“å° JSON å¯¹è±¡çš„æ–¹æ³•ï¼Œå°±å¯ä»¥</p><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">show</span></span>(json: <span class="type">JSON</span>): <span class="type">String</span> = json <span class="keyword">match</span> &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="type">JSeq</span>(elems) =&gt;</span><br><span class="line">    <span class="string">"["</span> + (elems map show mkString <span class="string">", "</span>) + <span class="string">"]"</span></span><br><span class="line">    <span class="keyword">case</span> <span class="type">JObj</span>(bindings) =&gt;</span><br><span class="line">    <span class="keyword">val</span> assocs = bindings map &#123;</span><br><span class="line">        <span class="keyword">case</span> (key, value) =&gt; <span class="string">"\""</span> + key + <span class="string">"\": "</span> + show(value)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="string">"&#123;"</span> + (assocs mkString <span class="string">", "</span>) + <span class="string">"&#125;"</span></span><br><span class="line">    <span class="keyword">case</span> <span class="type">JNum</span>(num) =&gt; num.toString</span><br><span class="line">    <span class="keyword">case</span> <span class="type">JStr</span>(str) =&gt; '\<span class="string">"' + str + '\"'</span></span><br><span class="line"><span class="string">    case JBool(b) =&gt; b.toString</span></span><br><span class="line"><span class="string">    case JNull =&gt; "</span><span class="string">null"</span></span><br><span class="line"><span class="string">&#125;</span></span><br></pre></td></tr></table></figure><p>ä¸Šè¿°çš„ show(data) å°±è¾“å‡º</p><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">res1: <span class="type">String</span> = &#123;<span class="string">"firstName"</span>: <span class="string">"John"</span>, <span class="string">"lastName"</span>: <span class="string">"Smith"</span>, <span class="string">"address"</span>: &#123;<span class="string">"streetAddress"</span>: <span class="string">"21 2nd Street"</span>, <span class="string">"state"</span>: <span class="string">"NY"</span>, <span class="string">"postalCode"</span>: <span class="number">10021.0</span>&#125;, <span class="string">"phoneNumbers"</span>: [&#123;<span class="string">"type"</span>: <span class="string">"home"</span>, <span class="string">"number"</span>: <span class="string">"212 555-1234"</span>&#125;, &#123;<span class="string">"type"</span>: <span class="string">"fax"</span>, <span class="string">"number"</span>: <span class="string">"646 555-4567"</span>&#125;]&#125;</span><br></pre></td></tr></table></figure><p>ç¬¬ 6 è¡Œä»£ç é‡Œé¢ map ä¼ å…¥çš„å‡½æ•°æ˜¯ï¼Œæˆ‘ä»¬çŸ¥é“ï¼Œåœ¨è¿™é‡Œ map å‡½æ•°çš„ç­¾åæ˜¯ <code>def map[B](f: (A) =&gt; B): List[B]</code><br>é‚£ä¹ˆç¬¬å…­è¡Œçš„ <code>f</code> å°±æ˜¯ <code>case (key, value) =&gt; &quot;\&quot;&quot; + key + &quot;\&quot;: &quot; + show(value)</code>ã€‚ è¿™ä¸ªå‡½æ•°å¦‚æœå•ç‹¬æ‹å‡ºæ¥ï¼Œå…¶å®å°±æ˜¯</p><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> f: (<span class="type">String</span>, <span class="type">JSON</span>) =&gt; <span class="type">String</span> = &#123; <span class="keyword">case</span> (key, value) =&gt; key + â€: â€ + value &#125; <span class="comment">// æ³¨æ„çœ‹ JObj å®šä¹‰</span></span><br></pre></td></tr></table></figure><p>æ‰€ä»¥ç”¨ case class æœ€æ–¹ä¾¿çš„åœ°æ–¹åœ¨äº<strong>æ¨¡å¼åŒ¹é…ä¸­çš„ decompose</strong></p><h3 id="å‡½æ•°å³å¯¹è±¡"><a href="#å‡½æ•°å³å¯¹è±¡" class="headerlink" title="å‡½æ•°å³å¯¹è±¡"></a>å‡½æ•°å³å¯¹è±¡</h3><p>ä»»ä½•æƒ…å†µä¸‹ï¼Œå‡½æ•° <code>A =&gt; B</code> å…¶å®å°±æ˜¯</p><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">scala.<span class="type">Function1</span>[<span class="type">A</span>, <span class="type">B</span>]</span><br></pre></td></tr></table></figure><p>çš„ç®€å†™ã€‚</p><h4 id="æ™®é€šå‡½æ•°"><a href="#æ™®é€šå‡½æ•°" class="headerlink" title="æ™®é€šå‡½æ•°"></a>æ™®é€šå‡½æ•°</h4><p>æ ¹æ® Function1 çš„å®šä¹‰</p><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">trait</span> <span class="title">Function1</span>[-<span class="type">A</span>, +<span class="type">R</span>] </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">apply</span></span>(x: <span class="type">A</span>): <span class="type">R</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¾‹å¦‚ï¼Œ</p><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> f1: <span class="type">Int</span> =&gt; <span class="type">Int</span> = (x: <span class="type">Int</span>) =&gt; x + <span class="number">1</span></span><br><span class="line"><span class="keyword">val</span> f2 = <span class="keyword">new</span> <span class="type">Function1</span>[<span class="type">Int</span>, <span class="type">Int</span>] &#123;<span class="function"><span class="keyword">def</span> <span class="title">apply</span></span>(x: <span class="type">Int</span>) = x + <span class="number">1</span>&#125;</span><br></pre></td></tr></table></figure><p>f1 å’Œ f2 ç­‰ä»·ã€‚</p><h4 id="åå‡½æ•°"><a href="#åå‡½æ•°" class="headerlink" title="åå‡½æ•°"></a>åå‡½æ•°</h4><p>å¯¹äºåå‡½æ•° PartialFunction å®šä¹‰ä¸º</p><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">trait</span> <span class="title">PartialFunction</span>[-<span class="type">A</span>, +<span class="type">R</span>] <span class="keyword">extends</span> <span class="title">Function1</span>[-<span class="type">A</span>, +<span class="type">R</span>] </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">apply</span></span>(x: <span class="type">A</span>): <span class="type">R</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">isDefinedAt</span></span>(x: <span class="type">A</span>): <span class="type">Boolean</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¾‹å¦‚ï¼Œ</p><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> f1: <span class="type">PartialFunction</span>[<span class="type">String</span>, <span class="type">String</span>] = &#123; <span class="keyword">case</span> <span class="string">"ping"</span> =&gt; <span class="string">"pong"</span> &#125;</span><br><span class="line"><span class="keyword">val</span> f2 = <span class="keyword">new</span> <span class="type">PartialFunction</span>[<span class="type">String</span>, <span class="type">String</span>] &#123;</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">apply</span></span>(x: <span class="type">String</span>) = x <span class="keyword">match</span> &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">"ping"</span> =&gt; <span class="string">"pong"</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">isDefinedAt</span></span>(x: <span class="type">String</span>) = x <span class="keyword">match</span> &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">"ping"</span> =&gt; <span class="literal">true</span></span><br><span class="line">        <span class="keyword">case</span> _ =&gt; <span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>f1 å’Œ f2 ç­‰ä»·ã€‚</p><p>ps: ä»¥ä¸Šï¼Œã€Œç­‰ä»·ã€çš„æ„æ€æ˜¯ä¸¤ä¸ªå‡½æ•°åªè¦è¾“å…¥ç›¸åŒï¼Œè¾“å‡ºä¸€å®šç›¸åŒã€‚</p><h2 id="W2"><a href="#W2" class="headerlink" title="W2"></a>W2</h2><h3 id="LazyList"><a href="#LazyList" class="headerlink" title="LazyList"></a>LazyList</h3><p>ä¸‹é¢ä»£ç </p><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f</span></span>(x: <span class="type">Int</span>): <span class="type">Boolean</span> = &#123;</span><br><span class="line">  println(x + <span class="string">" "</span>)</span><br><span class="line">  x % <span class="number">11</span> == <span class="number">0</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">val</span> v1 = (<span class="number">1</span> to <span class="number">100000</span>).filter(f)(<span class="number">1</span>)</span><br><span class="line"><span class="keyword">val</span> v2 = (<span class="number">1</span> to <span class="number">100000</span>).to(<span class="type">LazyList</span>).filter(f)(<span class="number">1</span>)</span><br></pre></td></tr></table></figure><p>v1 å’Œ v2 ç­‰ä»·ã€‚è®¡ç®— v1 çš„æ—¶å€™ä¼šæ‰“å° <code>1 2 3...9999 100000</code>, è€Œè®¡ç®— v2 çš„æ—¶å€™æ‰“å° <code>1 2 3 ... 21 22</code>ã€‚è¿™æ˜¯å› ä¸ºå¯¹äº v2ï¼Œ<code>(1 to 100000).to(LazyList)</code> äº§ç”Ÿçš„æ˜¯ <code>scala.collection.immutable.LazyList</code>ã€‚å…¶ä¸­å®˜æ–¹æ–‡æ¡£å¯¹å…¶æœ‰ä¸ªç®€å•çš„æè¿°</p><blockquote><p>This class implements an immutable linked list that evaluates elements in order and only when needed</p></blockquote><p>ä¹Ÿå°±æ˜¯å½“ LazyList é‡Œé¢çš„å…ƒç´ è¢«éœ€è¦çš„æ—¶å€™ï¼Œæ‰ä¼šè¿›è¡Œæœ‰åºè®¡ç®—ï¼Œå¹¶ä¸”è®¡ç®—ä¼šç»ˆæ­¢çŸ¥é“æ‰€éœ€çš„å…ƒç´ è®¡ç®—ç»“æŸã€‚è¿™ä¹Ÿå°±æ˜¯ä¸ºä»€ä¹ˆä¼šæœ‰ä¸Šè¿°çš„è¾“å‡ºäº†ã€‚</p><h3 id="æƒ°æ€§æ±‚å€¼-Lazy-Evaluation"><a href="#æƒ°æ€§æ±‚å€¼-Lazy-Evaluation" class="headerlink" title="æƒ°æ€§æ±‚å€¼ Lazy Evaluation"></a>æƒ°æ€§æ±‚å€¼ Lazy Evaluation</h3><p>åœ¨ Scala é‡Œé¢ï¼ŒLazy æ„å‘³ç€ä¸¤ç‚¹</p><ul><li><strong>å°½é‡å»¶åæ±‚å€¼è®¡ç®—</strong></li><li><strong>åªè®¡ç®—ä¸€æ¬¡</strong></li></ul><p>ä¾‹å¦‚</p><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">expr</span> </span>= &#123;</span><br><span class="line">  <span class="keyword">val</span> x = &#123; print(â€xâ€); <span class="number">1</span> &#125;</span><br><span class="line">  <span class="keyword">lazy</span> <span class="keyword">val</span> y = &#123; print(â€yâ€); <span class="number">2</span> &#125;</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">z</span> </span>= &#123; print(â€zâ€); <span class="number">3</span> &#125;</span><br><span class="line">  z + y + x + z + y + x <span class="comment">// last line</span></span><br><span class="line">&#125;</span><br><span class="line">expr</span><br></pre></td></tr></table></figure><p>è¿™æ ·çš„è¾“å‡ºä¸º <code>xzyz</code></p><h3 id="Infinite-Sequences"><a href="#Infinite-Sequences" class="headerlink" title="Infinite Sequences"></a>Infinite Sequences</h3><p>åˆ©ç”¨ LazyList çš„ç‰¹æ€§ï¼Œå¯ä»¥æ„é€ å‡ºæ— é™åºåˆ—ã€‚æ¯”å¦‚</p><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">scala&gt; <span class="function"><span class="keyword">def</span> <span class="title">from</span></span>(n: <span class="type">Int</span>): <span class="type">LazyList</span>[<span class="type">Int</span>] = n #:: from(n + <span class="number">1</span>) <span class="comment">// æ— é™åºåˆ—</span></span><br><span class="line">from: (n: <span class="type">Int</span>)<span class="type">LazyList</span>[<span class="type">Int</span>]</span><br><span class="line"></span><br><span class="line">scala&gt; <span class="keyword">val</span> natures = from(<span class="number">0</span>) <span class="comment">// è‡ªç„¶æ•°</span></span><br><span class="line">natures: <span class="type">LazyList</span>[<span class="type">Int</span>] = <span class="type">LazyList</span>(&lt;not computed&gt;)</span><br><span class="line"></span><br><span class="line">scala&gt; <span class="keyword">val</span> hundreds = natures.filter(_ % <span class="number">100</span> == <span class="number">0</span>)</span><br><span class="line">hundreds: scala.collection.immutable.<span class="type">LazyList</span>[<span class="type">Int</span>] = <span class="type">LazyList</span>(&lt;not computed&gt;)</span><br><span class="line"></span><br><span class="line">scala&gt; <span class="keyword">val</span> fourHundred = hundreds(<span class="number">4</span>) <span class="comment">// è®¡ç®—</span></span><br><span class="line">fourHundred: <span class="type">Int</span> = <span class="number">400</span></span><br></pre></td></tr></table></figure><p><strong>åŸƒæ‹‰æ‰˜æ–¯ç‰¹å°¼ç­›æ³•</strong></p><blockquote><p>åŸƒæ‹‰æ‰˜æ–¯ç‰¹å°¼ç­›æ³•æ˜¯åˆ—å‡ºæ‰€æœ‰å°ç´ æ•°æœ€æœ‰æ•ˆçš„æ–¹æ³•ä¹‹ä¸€ï¼Œå…¶åå­—æ¥è‡ªäºå¤å¸Œè…Šæ•°å­¦å®¶åŸƒæ‹‰æ‰˜æ–¯ç‰¹å°¼ï¼Œå¹¶ä¸”è¢«æè¿°åœ¨å¦ä¸€ä½å¤å¸Œè…Šæ•°å­¦å®¶å°¼ç§‘é©¬åº“æ–¯æ‰€è‘—çš„ã€Šç®—æœ¯å…¥é—¨ã€‹ä¸­ã€‚-<a href="https://zh.wikipedia.org/wiki/%E5%9F%83%E6%8B%89%E6%89%98%E6%96%AF%E7%89%B9%E5%B0%BC%E7%AD%9B%E6%B3%95" target="_blank" rel="noopener">ç»´åŸºç™¾ç§‘</a></p></blockquote><p>ç”¨ LazyList å®ç°ä¼šéå¸¸ç®€å•ï¼Œ</p><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">from</span></span>(n: <span class="type">Int</span>): <span class="type">LazyList</span>[<span class="type">Int</span>] = &#123;</span><br><span class="line">  n #:: from(n + <span class="number">1</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">sieve</span></span>(s: <span class="type">LazyList</span>[<span class="type">Int</span>]): <span class="type">LazyList</span>[<span class="type">Int</span>] = &#123;</span><br><span class="line">  s.head #:: sieve(s.tail.filter(_ % s.head != <span class="number">0</span>))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">primeNumber</span></span>(n: <span class="type">Int</span>): <span class="type">Int</span> = &#123;</span><br><span class="line">    sieve(from(<span class="number">2</span>))(n)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">val</span> n = sieve(from(<span class="number">2</span>))(<span class="number">100</span>) <span class="comment">// è¾“å‡º 547</span></span><br></pre></td></tr></table></figure><h3 id="é¢˜ç›®ï¼šå€’æ°´é—®é¢˜"><a href="#é¢˜ç›®ï¼šå€’æ°´é—®é¢˜" class="headerlink" title="é¢˜ç›®ï¼šå€’æ°´é—®é¢˜"></a>é¢˜ç›®ï¼šå€’æ°´é—®é¢˜</h3><p>ç»™å‡ ä¸ªçŸ¥é“å®¹é‡ï¼Œä½†æ˜¯æ²¡æœ‰åˆ»åº¦çš„æ¯å­ï¼Œæœ‰ä¸ªå¯ä»¥å–ä¹‹ä¸å°½çš„æ°´æºç”¨æ¥ç»™æ¯å­è£…æ»¡æ°´å’Œå°†æ¯å­çš„æ°´å…¨éƒ¨å€’å‡ºã€‚æˆ‘ä»¬éœ€è¦åšçš„å°±æ˜¯ç››å‡ºç»™å®šå®¹é‡çš„æ°´ã€‚æˆ‘ä»¬èƒ½åšçš„æ“ä½œæœ‰ä¸‰ä¸ª</p><ul><li>empty æ¸…ç©º</li><li>fill æ”¾æ»¡æ°´</li><li>pour(a, b) æŠŠ a çš„æ°´å…¨éƒ¨å¾€ b å€’ç›´è‡³ b æ¯æ»¡äº†æˆ–è€… a æ¯æ²¡æ°´äº†</li></ul><p>ç°åœ¨éœ€è¦æ‰¾åˆ°å–å¾—å®¹é‡ä¸º N çš„æ°´æ—¶ï¼Œéœ€è¦çš„æ“ä½œã€‚</p><p>é™„ï¼š1. <a href="https://github.com/razertory/scala-code-lab/blob/master/src/main/scala/scalaschool/WaterPouring.scala" target="_blank" rel="noopener">Scala å®Œæ•´ä»£ç </a> 2. <a href="https://www.youtube.com/watch?v=q6M_pco_5Vo" target="_blank" rel="noopener">python è§£æ³•</a></p><h2 id="W3"><a href="#W3" class="headerlink" title="W3"></a>W3</h2><blockquote><p>ä¸‹é¢ä¼šç”¨ Scala è¿›è¡ŒåŠ æ³•å™¨æ¨¡æ‹Ÿã€‚å¯¹äºè®¡ç®—æœºä¸­ï¼Œä¸¤ä¸ªæ•°å¦‚ä½•ç›¸åŠ ï¼Œå¯ä»¥æå‰é˜…è¯» <a href="https://zh.wikipedia.org/wiki/%E5%8A%A0%E6%B3%95%E5%99%A8" target="_blank" rel="noopener">ç»´åŸºç™¾ç§‘-åŠ æ³•å™¨</a>ï¼Œæœ€å¥½èƒ½å¤Ÿåšä¸€ä¸‹ <a href="/2019/11/11/add-by-bit/">ä½è¿ç®—å®ç°åŠ æ³•</a>ã€‚</p></blockquote><p>é€šè¿‡ä»¥ä¸Šå†…å®¹ï¼Œæˆ‘ä»¬éœ€è¦çŸ¥é“çš„æœ€é‡è¦çš„ç‚¹åœ¨äºï¼šä¸¤ä¸ªä¸€ä½äºŒè¿›åˆ¶æ•°ç›¸åŠ ï¼Œå°†ä¼šäº§ç”Ÿä¸¤ä¸ªè¾“å‡ºï¼Œå…¶ä¸­ä¸€ä¸ªæ˜¯å½“å‰ä½ç›¸åŠ çš„å€¼ Sï¼Œå¦ä¸€ä¸ªæ˜¯ç›¸åŠ åçš„è¿›ä½ä¿¡æ¯ Cã€‚å…¶ä¸­ S å¯ä»¥ç”¨<em>å¼‚æˆ–é—¨</em>ï¼Œè¿›ä½å¯ä»¥ç”¨<em>ä¸é—¨</em>ã€‚ä¸¤ä¸ªåŠåŠ å™¨ç”¨<em>æˆ–</em>é—¨ç»„åˆä¸ºä¸€ä¸ªå…¨åŠ å™¨ã€‚</p><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="http://ww1.sinaimg.cn/large/a67b702fgy1gc6mm6fcccj21fo0rgh3a.jpg" alt="å¼‚æˆ–çš„æ“ä½œé€šè¿‡ä¸‰ç§é—¨çš„ç»„åˆå®ç°" title>                </div>                <div class="image-caption">å¼‚æˆ–çš„æ“ä½œé€šè¿‡ä¸‰ç§é—¨çš„ç»„åˆå®ç°</div>            </figure><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="http://ww1.sinaimg.cn/large/a67b702fgy1gc6mmvhps1j20tq0ja10b.jpg" alt="ä¸¤ä¸ªç”¨ä¸é—¨ç»„åˆçš„åŠåŠ å™¨æ„æˆä¸€ä¸ªå…¨åŠ å™¨" title>                </div>                <div class="image-caption">ä¸¤ä¸ªç”¨ä¸é—¨ç»„åˆçš„åŠåŠ å™¨æ„æˆä¸€ä¸ªå…¨åŠ å™¨</div>            </figure><p>æ ¹æ®ä¸Šå›¾ï¼Œæˆ‘ä»¬è‡³å°‘éœ€è¦å®ç°çš„æ˜¯</p><ul><li><p>ç”µçº¿ï¼šç”¨æ¥ä¼ å¯¼ä¿¡å·ï¼Œä¿¡å·å¯ä»¥ç”¨ boolean ç±»å‹è¡¨ç¤º 0 å’Œ 1</p><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Wire</span> </span>&#123;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">var</span> sigVal = <span class="literal">false</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">getSignal</span></span>: <span class="type">Boolean</span> = sigVal</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">setSignal</span></span>(s: <span class="type">Boolean</span>): <span class="type">Unit</span> =</span><br><span class="line">    <span class="keyword">if</span> (s != sigVal) &#123;</span><br><span class="line">        sigVal = s</span><br><span class="line">        actions foreach(_())</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>ä¸é—¨ï¼šè¾“å…¥ä¸¤ä¸ªç”µä¿¡å·ï¼Œè¾“å‡º &amp; å¯¹åº”çš„ä¿¡å·</p></li></ul><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">andGate</span></span>(in1: <span class="type">Wire</span>, in2: <span class="type">Wire</span>, output: <span class="type">Wire</span>): <span class="type">Unit</span> = ???</span><br></pre></td></tr></table></figure><ul><li>æˆ–é—¨ï¼šè¾“å…¥ä¸¤ä¸ªç”µä¿¡å·ï¼Œè¾“å‡º | å¯¹åº”çš„ä¿¡å·</li></ul><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">orGate</span></span>(in1: <span class="type">Wire</span>, in2: <span class="type">Wire</span>, output: <span class="type">Wire</span>): <span class="type">Unit</span> = ???</span><br></pre></td></tr></table></figure><ul><li>é€†å˜å™¨ï¼šè¾“å…¥ç”µä¿¡å·ï¼Œè¾“å‡º ! å¯¹åº”çš„ä¿¡å·</li></ul><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">inverter</span></span>(in: <span class="type">Wire</span>, output: <span class="type">Wire</span>): <span class="type">Unit</span> = ???</span><br></pre></td></tr></table></figure><p>åœ¨æ­¤åŸºç¡€ä¸Šï¼Œå®ç°å‡ºåŠåŠ å™¨å’Œå…¨åŠ å™¨</p><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">halfAdder</span></span>(a: <span class="type">Wire</span>, b: <span class="type">Wire</span>, s: <span class="type">Wire</span>, c: <span class="type">Wire</span>): <span class="type">Unit</span> = &#123;</span><br><span class="line">  <span class="keyword">val</span> d = <span class="keyword">new</span> <span class="type">Wire</span></span><br><span class="line">  <span class="keyword">val</span> e = <span class="keyword">new</span> <span class="type">Wire</span></span><br><span class="line">  orGate(a, b, d)</span><br><span class="line">  andGate(a, b, c)</span><br><span class="line">  inverter(c, e)</span><br><span class="line">  andGate(d, e, s)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">fullAdder</span></span>(a: <span class="type">Wire</span>, b: <span class="type">Wire</span>, cin: <span class="type">Wire</span>, sum: <span class="type">Wire</span>, cout: <span class="type">Wire</span>): <span class="type">Unit</span> = &#123;</span><br><span class="line">  <span class="keyword">val</span> s = <span class="keyword">new</span> <span class="type">Wire</span></span><br><span class="line">  <span class="keyword">val</span> c1 = <span class="keyword">new</span> <span class="type">Wire</span></span><br><span class="line">  <span class="keyword">val</span> c2 = <span class="keyword">new</span> <span class="type">Wire</span></span><br><span class="line">  halfAdder(b, cin, s, c1)</span><br><span class="line">  halfAdder(a, s, sum, c2)</span><br><span class="line">  orGate(c1, c2, cout)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å®ç°äº†å…¨åŠ å™¨åã€‚åŠ å…¥æ¨¡æ‹Ÿä¿¡å·çš„è¾“å…¥è¾“å‡ºå³å¯ï¼Œå®Œæ•´ä»£ç  <a href="https://github.com/razertory/scala-code-lab/blob/master/src/main/scala/scalaschool/DigitalCircuitSimulator.scala" target="_blank" rel="noopener">æ¨¡æ‹ŸåŠ æ³•å™¨</a></p><h2 id="W4"><a href="#W4" class="headerlink" title="W4"></a>W4</h2><h3 id="Functional-Reactive-Programming-FRP"><a href="#Functional-Reactive-Programming-FRP" class="headerlink" title="Functional Reactive Programming (FRP)"></a>Functional Reactive Programming (FRP)</h3><p>åœ¨ MVC æ¨¡å‹ä¸­ï¼ŒFRP å¯ä»¥è®© model åœ¨äº§ç”Ÿå˜åŒ–çš„åŒæ—¶ view è‡ªåŠ¨å˜åŒ–ã€‚è¿™æ ·çš„æ¨¡å‹ä¸€èˆ¬ä¹Ÿå°±æ˜¯ pub-sub æ¨¡å‹æˆ–è€…å«è§‚å¯Ÿè€…æ¨¡å‹ (observers)ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Subscriber1   subscribe     ___________</span><br><span class="line">Subscriber2  ------------&gt; |          |</span><br><span class="line">Subscriber3                |Publisher |</span><br><span class="line">Subscriber4  &lt;------------ |          |</span><br><span class="line">Subscriber5    publish     |__________|</span><br></pre></td></tr></table></figure><p>é€šç”¨çš„è¯´æ¯”å¦‚ <code>a = f(b)</code> é‡Œé¢ã€‚å½“ b åœ¨å‘ç”Ÿå˜åŒ–çš„æ—¶å€™ a ä¹Ÿä¼šè·Ÿç€å˜ã€‚å®ç°è¿™ä¸€ç‚¹ï¼Œ<br>å¯ä»¥æŠŠã€Œå˜åŒ–ã€å½’åŒ–ä¸ºã€Œeventã€ï¼Œè€Œè‡ªåŠ¨æ£€æŸ¥è¿™äº›ã€Œeventã€çš„ä¸œè¥¿å«åš Signalã€‚åœ¨ Scala é‡Œé¢é€šå¸¸æŠŠè¿™æ ·çš„ Signal å®ç°ä¸ºä¸€ä¸ªç±»å‹ï¼Œé€šè¿‡ apply() ç»™å…¶èµ‹å€¼ã€‚æ¯”å¦‚</p><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> s = <span class="type">Signal</span>(<span class="number">1</span>)</span><br><span class="line"><span class="keyword">val</span> v = s() <span class="comment">// 1</span></span><br></pre></td></tr></table></figure><p>åŒæ—¶ï¼Œä¸ºäº†ç»™ Signal å†æ¬¡èµ‹å€¼ï¼Œå¯ä»¥æ‰©å±•æ–°å¢ä¸€ä¸ª update æ–¹æ³•ã€‚æ¯”å¦‚ <code>s.update(5)</code>ï¼Œé¡ºå¸¦å¯ä»¥å†™æˆ <code>s() = 5</code>ã€‚è¿™æ ·çš„è¯ï¼Œå®ç°ä¸€ä¸ªæ‰©å±•äº† Signal åä¸º <code>Var</code> çš„ç±»å‹ï¼Œè®©å…¶æ‹¥æœ‰ <code>update</code> æ–¹æ³•ã€‚</p><p>åœ¨è¿™æ ·çš„æ¡ä»¶ä¸‹ï¼Œ</p><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// (1)</span></span><br><span class="line"><span class="keyword">val</span> num = <span class="type">Var</span>(<span class="number">1</span>)</span><br><span class="line"><span class="keyword">val</span> twice = <span class="type">Signal</span>(num() * <span class="number">2</span>)</span><br><span class="line">num() = <span class="number">2</span></span><br><span class="line"><span class="comment">// (2)</span></span><br><span class="line"><span class="keyword">var</span> num = <span class="type">Var</span>(<span class="number">1</span>)</span><br><span class="line"><span class="keyword">val</span> twice = <span class="type">Signal</span>(num() * <span class="number">2</span>)</span><br><span class="line">num = <span class="type">Var</span>(<span class="number">2</span>)</span><br></pre></td></tr></table></figure><p>(1) é‡Œé¢çš„ twice å˜ä¸º 4ï¼Œï¼ˆ2ï¼‰é‡Œé¢çš„ twice è¿˜æ˜¯ 2ã€‚ä¸Šè¿°ä½“ç°çš„ FRP é‡Œé¢ï¼Œnum æ˜¯ <em>publisher</em>ï¼Œtwice æ˜¯ <em>subscriber</em>ã€‚num äº§ç”Ÿäº† eventï¼Œtwice æ¥å—è¿™æ ·çš„ eventã€‚å¹¶ä¸”æ‰€æœ‰çš„å˜é‡æœ¬èº«éƒ½æ˜¯ <em>immutable</em>ã€‚</p><h3 id="å®ç°-FRP"><a href="#å®ç°-FRP" class="headerlink" title="å®ç° FRP"></a>å®ç° FRP</h3><h4 id="Var-å’Œ-Signal"><a href="#Var-å’Œ-Signal" class="headerlink" title="Var å’Œ Signal"></a>Var å’Œ Signal</h4><p>æˆ‘ä»¬çŸ¥é“ Signal å’Œ Var åº”è¯¥æ˜¯è¿™æ ·</p><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// signal</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Signal</span>[<span class="type">T</span>](<span class="params">expr: =&gt; <span class="type">T</span></span>) </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">apply</span></span>(): <span class="type">T</span> = ???</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">Signal</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">apply</span></span>[<span class="type">T</span>](expr: =&gt; <span class="type">T</span>) = <span class="keyword">new</span> <span class="type">Signal</span>(expr)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// var</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Var</span>[<span class="type">T</span>](<span class="params">expr: =&gt; <span class="type">T</span></span>) <span class="keyword">extends</span> <span class="title">Signal</span>[<span class="type">T</span>](<span class="params">expr</span>) </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">update</span></span>(expr: =&gt; <span class="type">T</span>): <span class="type">Unit</span> = ???</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">Var</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">apply</span></span>[<span class="type">T</span>](expr: =&gt; <span class="type">T</span>) = <span class="keyword">new</span> <span class="type">Var</span>(expr)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ç»´æŠ¤è®¢é˜…å…³ç³»"><a href="#ç»´æŠ¤è®¢é˜…å…³ç³»" class="headerlink" title="ç»´æŠ¤è®¢é˜…å…³ç³»"></a>ç»´æŠ¤è®¢é˜…å…³ç³»</h3><p>æœ‰äº†è¿™äº›æ–¹æ³•ï¼Œå°±å¯ä»¥åšåˆ°èµ‹å€¼å’Œå†æ¬¡èµ‹å€¼ã€‚è¿˜éœ€è¦çš„æ˜¯ï¼Œå½“ä¸€ä¸ª publisher äº§ç”Ÿäº† event çš„æ—¶å€™ï¼Œå¦‚ä½•è‡ªåŠ¨é€šçŸ¥åˆ°å¯¹åº”çš„ subscriberï¼Œå¹¶ä¸”è®©å…¶é‡æ–°è®¡ç®—ï¼ˆre-evaluateï¼‰ã€‚</p><p>ä¾‹å¦‚ï¼Œs æ˜¯ Var ç±»å‹ï¼Œå¹¶ä¸”è¿›å…¥åˆ°äº†è¡¨è¾¾å¼ expr é‡Œï¼Œå½¢å¦‚ <code>expr s</code>ï¼Œé‚£ä¹ˆå½“è¡¨è¾¾å¼ <code>expr s</code>ï¼Œä½œä¸ºå‚æ•°ä¼ é€’ç»™äº†æŸä¸ª Signal å½¢å¦‚ <code>val t = Signal(expr s)</code> çš„æ—¶å€™ã€‚å°±éœ€è¦ç»™ s ç»´æŠ¤ä¸€ä¸ª subscriberã€‚åŒç†ï¼Œå½“æœ‰å¤šä¸ª subscribers çš„æ—¶å€™å°±ç»™ s ç»´æŠ¤ä¸€ä¸ª subscriber çš„é›†åˆã€‚æ¯”å¦‚</p><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// val set = Set()</span></span><br><span class="line"><span class="keyword">var</span> num = <span class="type">Var</span>(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// è§¦å‘çš„æ¡ä»¶å°±æ˜¯ class Var çš„ apply æ–¹æ³•ã€‚</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// è§¦å‘ï¼šset += Signal(num() * 2)</span></span><br><span class="line"><span class="keyword">val</span> double = <span class="type">Signal</span>(num() * <span class="number">2</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// è§¦å‘ï¼šset += Signal(num() * 3)</span></span><br><span class="line"><span class="keyword">val</span> tiple = <span class="type">Signal</span>(num() * <span class="number">3</span>)</span><br></pre></td></tr></table></figure><p>è§¦å‘çš„æ¡ä»¶è¾¾åˆ°äº†ï¼Œå¯æ˜¯å¦‚ä½•æŠŠ <code>Signal(num() * 3)</code> è¿™æ ·çš„å¯¹è±¡ä¼ é€’ç»™ num çš„ set ï¼Ÿ</p><p>è¿™ä¸ªæ—¶å€™å°±éœ€è¦åœ¨ Object Signal é‡Œé¢æ–°å¢ä¸€å—ç”¨äºç»´æŠ¤æ–¹æ³•è°ƒç”¨çš„æ•°æ®ç»“æ„ï¼Œæ²¡åšå°±æ˜¯ stack</p><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">Signal</span> </span>&#123;</span><br><span class="line">  <span class="keyword">val</span> caller = <span class="keyword">new</span> <span class="type">StackableVariable</span>[<span class="type">Signal</span>[_]](<span class="type">NoSignal</span>)</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">apply</span></span>[<span class="type">T</span>](expr: =&gt; <span class="type">T</span>) = <span class="keyword">new</span> <span class="type">Signal</span>(expr)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>StackableVariable åœ¨å½“å‰çš„ä¸Šä¸‹æ–‡ä¸­å¤šä¸ª Signal/Object ä¼šå…±äº«ã€‚å½“è°ƒç”¨ class Signal çš„ apply() æ–¹æ³•çš„æ—¶å€™å°±å»è¿™é‡Œé¢æ‰¾åˆ°å½“å‰çš„è°ƒç”¨æ–¹ã€‚</p><h3 id="ç»´æŠ¤è°ƒç”¨æ ˆ"><a href="#ç»´æŠ¤è°ƒç”¨æ ˆ" class="headerlink" title="ç»´æŠ¤è°ƒç”¨æ ˆ"></a>ç»´æŠ¤è°ƒç”¨æ ˆ</h3><p>è°ƒç”¨æ ˆé‡Œé¢å­˜æ”¾æœ‰åºçš„ Signalã€‚ä¾‹å¦‚ï¼Œæœ‰ä¸‹é¢æµ‹è¯•ä»£ç </p><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">test(<span class="string">"multi subscribers"</span>) &#123;</span><br><span class="line">  <span class="keyword">val</span> publisher = <span class="type">Var</span>(<span class="number">1</span>)</span><br><span class="line">  <span class="keyword">val</span> subscriber1 = <span class="type">Signal</span>(publisher() * <span class="number">20</span>) <span class="comment">// æ³¨æ„ scala çš„ call-by-name å’Œ call-by-valueã€‚è¿™é‡Œä¼ é€’çš„æ˜¯è¡¨è¾¾å¼</span></span><br><span class="line">  <span class="keyword">val</span> subscriber2 = <span class="type">Signal</span>(publisher() * <span class="number">30</span>)</span><br><span class="line">  <span class="keyword">val</span> subscriber3 = <span class="type">Signal</span>(publisher() * <span class="number">40</span>)</span><br><span class="line">  assert(subscriber1() == <span class="number">20</span>)</span><br><span class="line">  assert(subscriber2() == <span class="number">30</span>)</span><br><span class="line">  assert(subscriber3() == <span class="number">40</span>)</span><br><span class="line">  publisher() = <span class="number">2</span></span><br><span class="line">  assert(subscriber1() == <span class="number">40</span>)</span><br><span class="line">  assert(subscriber2() == <span class="number">60</span>)</span><br><span class="line">  assert(subscriber3() == <span class="number">80</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç¬¬ä¸‰è¡Œå¼€å§‹ï¼ŒåŒ…å«è¡¨è¾¾å¼çš„ Signal è¿›å…¥è°ƒç”¨æ ˆï¼Œå¹¶ä¸æ–­è¢«å¸¦å…¥ subscriber çš„é›†åˆã€‚</p><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">StackableVariable</span>[<span class="type">T</span>](<span class="params">init: <span class="type">T</span></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">var</span> values: <span class="type">List</span>[<span class="type">T</span>] = <span class="type">List</span>(init)</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">value</span></span>: <span class="type">T</span> = values.head</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">withValue</span></span>[<span class="type">R</span>](newValue: <span class="type">T</span>)(op: =&gt; <span class="type">R</span>): <span class="type">R</span> = &#123;</span><br><span class="line">    values = newValue :: values</span><br><span class="line">    <span class="keyword">try</span> op <span class="keyword">finally</span> values = values.tail</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><a href="https://github.com/razertory/scala-code-lab/blob/master/src/main/scala/scalaschool/SubPub.scala" target="_blank" rel="noopener">å®Œæ•´ä»£ç </a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;åœ¨è¿™ä¸ª 2020 å¹´åˆçš„ç‰¹æ®Šæ—¶æœŸã€‚&lt;/p&gt;
&lt;p&gt;Scala æ˜¯ä¸€é—¨ç°ä»£åŒ–ï¼Œå¤šèŒƒå¼çš„ JVM è¯­è¨€ã€‚&lt;/p&gt;
&lt;p&gt;ä¼ é€é—¨ï¼ˆå¯èƒ½éœ€è¦ğŸš€)&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://www.coursera.org/learn/progfun2&quot; targ
      
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>LRU ç¼“å­˜</title>
    <link href="https://razertory.me/2020/02/16/lru-cache/"/>
    <id>https://razertory.me/2020/02/16/lru-cache/</id>
    <published>2020-02-16T09:39:04.000Z</published>
    <updated>2020-03-28T13:02:10.018Z</updated>
    
    <content type="html"><![CDATA[<p>LRU çš„å…¨ç§°æ˜¯ Least recently usedï¼Œæ˜¯ç¼“å­˜æ›¿æ¢ç­–ç•¥çš„ä¸€ç§ã€‚ç”µè„‘å­˜å‚¨å™¨ç©ºé—´çš„å¤§å°å›ºå®šï¼Œæ— æ³•å®¹çº³æœåŠ¡å™¨ä¸Šæ‰€æœ‰çš„æ–‡ä»¶ï¼Œæ‰€ä»¥å½“æœ‰æ–°çš„æ–‡ä»¶è¦è¢«ç½®æ¢å…¥ç¼“å­˜æ—¶ï¼Œå¿…é¡»æ ¹æ®ä¸€å®šçš„åŸåˆ™æ¥å–ä»£æ‰é€‚å½“çš„æ–‡ä»¶ã€‚æ­¤åŸåˆ™å³æ‰€è°“ç¼“å­˜æ›¿æ¢ç­–ç•¥ã€‚<br><a href="https://leetcode.com/problems/lru-cache/" target="_blank" rel="noopener">ä¼ é€é—¨</a></p><hr><p>å®ç° LRU ç¼“å­˜éœ€è¦ç”¨åˆ° kv ç±»å‹å’Œçº¿å‹çš„æ•°æ®ç»“æ„ï¼Œç”¨æ¥åšåˆ° O(1) çš„æŸ¥æ‰¾æ•ˆç‡å’Œå®ç°æ·˜æ±°æœºåˆ¶ã€‚æˆ‘ä»¬å¯ä»¥ç”¨ HashMap å’Œä¸€ä¸ªåŒå‘é“¾è¡¨ã€‚å…¶ä¸­ç”¨åŒå‘é“¾è¡¨çš„å¥½å¤„æ˜¯ï¼šå½“è¦åˆ é™¤çš„èŠ‚ç‚¹ä¸º node çš„æ—¶å€™ï¼Œé€šè¿‡ <code>node.pre</code> å’Œ <code>node.next</code> å¯ä»¥å¿«é€Ÿæ‰¾åˆ°å‰åèŠ‚ç‚¹ï¼Œä»è€Œåœ¨é“¾è¡¨ä¸­å»æ‰è¿™ä¸ªèŠ‚ç‚¹ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LRUCache</span> </span>&#123;</span><br><span class="line">  <span class="class"><span class="keyword">class</span> <span class="title">LinkNode</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> key;</span><br><span class="line">    <span class="keyword">int</span> value;</span><br><span class="line">    LinkNode prev;</span><br><span class="line">    LinkNode next;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// æ–°å¢çš„ node åªä½œä¸º head</span></span><br><span class="line">  <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">addNode</span><span class="params">(LinkNode node)</span> </span>&#123;</span><br><span class="line">    node.prev = head;</span><br><span class="line">    node.next = head.next;</span><br><span class="line"></span><br><span class="line">    head.next.prev = node;</span><br><span class="line">    head.next = node;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// é€šè¿‡ prev å’Œ next å¿«é€Ÿåˆ é™¤èŠ‚ç‚¹</span></span><br><span class="line">  <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">removeNode</span><span class="params">(LinkNode node)</span></span>&#123;</span><br><span class="line">    LinkNode prev = node.prev;</span><br><span class="line">    LinkNode next = node.next;</span><br><span class="line"></span><br><span class="line">    prev.next = next;</span><br><span class="line">    next.prev = prev;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// å…ˆåˆ é™¤ï¼Œåæ–°å¢ä»è€ŒæŒ‡å‘å¤´éƒ¨</span></span><br><span class="line">  <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">moveToHead</span><span class="params">(LinkNode node)</span></span>&#123;</span><br><span class="line">    removeNode(node);</span><br><span class="line">    addNode(node);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// æ·˜æ±°æœ«å°¾</span></span><br><span class="line">  <span class="function"><span class="keyword">private</span> LinkNode <span class="title">popTail</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    LinkNode res = tail.prev;</span><br><span class="line">    removeNode(res);</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> HashMap&lt;Integer, LinkNode&gt; cache =</span><br><span class="line">          <span class="keyword">new</span> HashMap&lt;Integer, LinkNode&gt;();</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">int</span> size;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">int</span> capacity;</span><br><span class="line">  <span class="keyword">private</span> LinkNode head, tail;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="title">LRUCache</span><span class="params">(<span class="keyword">int</span> capacity)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.size = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">this</span>.capacity = capacity;</span><br><span class="line"></span><br><span class="line">    head = <span class="keyword">new</span> LinkNode();</span><br><span class="line">    tail = <span class="keyword">new</span> LinkNode();</span><br><span class="line"></span><br><span class="line">    head.next = tail;</span><br><span class="line">    tail.prev = head;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">get</span><span class="params">(<span class="keyword">int</span> key)</span> </span>&#123;</span><br><span class="line">    LinkNode node = cache.get(key);</span><br><span class="line">    <span class="keyword">if</span> (node == <span class="keyword">null</span>) <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">    moveToHead(node);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> node.value;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">put</span><span class="params">(<span class="keyword">int</span> key, <span class="keyword">int</span> value)</span> </span>&#123;</span><br><span class="line">    LinkNode node = cache.get(key);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(node == <span class="keyword">null</span>) &#123;</span><br><span class="line">      LinkNode newNode = <span class="keyword">new</span> LinkNode();</span><br><span class="line">      newNode.key = key;</span><br><span class="line">      newNode.value = value;</span><br><span class="line"></span><br><span class="line">      cache.put(key, newNode);</span><br><span class="line">      addNode(newNode);</span><br><span class="line"></span><br><span class="line">      ++size;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span>(size &gt; capacity) &#123;</span><br><span class="line">        LinkNode tail = popTail();</span><br><span class="line">        cache.remove(tail.key);</span><br><span class="line">        --size;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      node.value = value;</span><br><span class="line">      moveToHead(node);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸€ç§æ›´ä¸ºä¼˜é›…çš„å®ç°æ˜¯è®©è¿™ä¸ªåŒå‘é“¾è¡¨æˆç¯çŠ¶ï¼Œåˆå§‹åŒ–ä¸º value éƒ½ä¸º -1ï¼Œå¤§å°ä¸º capacityã€‚æ¯å½“æœ‰ get å’Œ put æ“ä½œçš„æ—¶å€™å°±è°ƒæ•´ç¯ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LRUCache</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="class"><span class="keyword">class</span> <span class="title">Node</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> key, val;</span><br><span class="line">        Node next, pre;</span><br><span class="line">        Node(<span class="keyword">int</span> key, <span class="keyword">int</span> val, Node pre, Node next) &#123;</span><br><span class="line">            <span class="keyword">this</span>.key = key;</span><br><span class="line">            <span class="keyword">this</span>.val = val;</span><br><span class="line">            <span class="keyword">this</span>.pre = pre;</span><br><span class="line">            <span class="keyword">this</span>.next = next;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Node head = <span class="keyword">new</span> Node(-<span class="number">1</span>, -<span class="number">1</span>, <span class="keyword">null</span>, <span class="keyword">null</span>);</span><br><span class="line">    <span class="keyword">private</span> HashMap&lt;Integer, Node&gt; map = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">move2Head</span><span class="params">(Node cur)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (cur == head) &#123;</span><br><span class="line">            head = head.pre;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        cur.pre.next = cur.next;</span><br><span class="line">        cur.next.pre = cur.pre;</span><br><span class="line"></span><br><span class="line">        cur.next = head.next;</span><br><span class="line">        cur.next.pre = cur;</span><br><span class="line">        head.next = cur;</span><br><span class="line">        cur.pre = head;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    LRUCache(<span class="keyword">int</span> capacity)&#123;</span><br><span class="line">        Node cur = head;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; capacity - <span class="number">1</span>; i++) &#123;</span><br><span class="line">            cur.next = <span class="keyword">new</span> Node(-<span class="number">1</span>, -<span class="number">1</span>, cur, <span class="keyword">null</span>);</span><br><span class="line">            cur = cur.next;</span><br><span class="line">        &#125;</span><br><span class="line">        cur.next = head;</span><br><span class="line">        head.pre = cur;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">get</span><span class="params">(<span class="keyword">int</span> key)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!map.containsKey(key)) <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">        Node node = map.get(key);</span><br><span class="line">        move2Head(node);</span><br><span class="line">        <span class="keyword">return</span> node.val;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">put</span><span class="params">(<span class="keyword">int</span> key, <span class="keyword">int</span> val)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (map.containsKey(key)) &#123;</span><br><span class="line">            Node node = map.get(key);</span><br><span class="line">            node.val = val;</span><br><span class="line">            move2Head(node);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (head.val != -<span class="number">1</span>) map.remove(head.key);</span><br><span class="line">            head.key = key;</span><br><span class="line">            head.val = val;</span><br><span class="line">            map.put(key, head);</span><br><span class="line">            head = head.pre;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ­¤å¤–ï¼ŒJava ä¸­çš„ LinkedHashMap å¯ä»¥ç›´æ¥å®ç° LRU ç¼“å­˜ã€‚:)</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;LRU çš„å…¨ç§°æ˜¯ Least recently usedï¼Œæ˜¯ç¼“å­˜æ›¿æ¢ç­–ç•¥çš„ä¸€ç§ã€‚ç”µè„‘å­˜å‚¨å™¨ç©ºé—´çš„å¤§å°å›ºå®šï¼Œæ— æ³•å®¹çº³æœåŠ¡å™¨ä¸Šæ‰€æœ‰çš„æ–‡ä»¶ï¼Œæ‰€ä»¥å½“æœ‰æ–°çš„æ–‡ä»¶è¦è¢«ç½®æ¢å…¥ç¼“å­˜æ—¶ï¼Œå¿…é¡»æ ¹æ®ä¸€å®šçš„åŸåˆ™æ¥å–ä»£æ‰é€‚å½“çš„æ–‡ä»¶ã€‚æ­¤åŸåˆ™å³æ‰€è°“ç¼“å­˜æ›¿æ¢ç­–ç•¥ã€‚&lt;br&gt;&lt;a href=&quot;https://
      
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>ç¼–è¾‘è·ç¦»</title>
    <link href="https://razertory.me/2020/01/11/edit-distance/"/>
    <id>https://razertory.me/2020/01/11/edit-distance/</id>
    <published>2020-01-11T03:35:32.000Z</published>
    <updated>2020-03-28T13:02:10.016Z</updated>
    
    <content type="html"><![CDATA[<p>ç»™å‡ºä¸¤ä¸ªå•è¯ word1 å’Œ word2ï¼Œæ‰¾å‡ºæŠŠ word1 ç¼–è¾‘æˆ word2 çš„æœ€çŸ­ç¼–è¾‘è·ç¦»ã€‚ç»™å‡ºçš„å¯ç”¨ç¼–è¾‘æ“ä½œæœ‰ï¼š</p><ol><li>æ’å…¥ä¸€ä¸ªå­—ç¬¦ insert</li><li>åˆ é™¤ä¸€ä¸ªå­—ç¬¦ delete</li><li>æ›´æ–°ä¸€ä¸ªå­—ç¬¦ update</li></ol><blockquote><p>ç¼–è¾‘è·ç¦»æ˜¯é’ˆå¯¹äºŒä¸ªå­—ç¬¦ä¸²ï¼ˆä¾‹å¦‚è‹±æ–‡å­—ï¼‰çš„å·®å¼‚ç¨‹åº¦çš„é‡åŒ–é‡æµ‹ï¼Œé‡æµ‹æ–¹å¼æ˜¯çœ‹è‡³å°‘éœ€è¦å¤šå°‘æ¬¡çš„å¤„ç†æ‰èƒ½å°†ä¸€ä¸ªå­—ç¬¦ä¸²å˜æˆå¦ä¸€ä¸ªå­—ç¬¦ä¸²ã€‚ç¼–è¾‘è·ç¦»å¯ä»¥ç”¨åœ¨è‡ªç„¶è¯­è¨€å¤„ç†ä¸­ï¼Œä¾‹å¦‚æ‹¼å†™æ£€æŸ¥å¯ä»¥æ ¹æ®ä¸€ä¸ªæ‹¼é”™çš„å­—å’Œå…¶ä»–æ­£ç¡®çš„å­—çš„ç¼–è¾‘è·ç¦»ï¼Œåˆ¤æ–­å“ªä¸€ä¸ªï¼ˆæˆ–å“ªå‡ ä¸ªï¼‰æ˜¯æ¯”è¾ƒå¯èƒ½çš„å­—ã€‚DNAä¹Ÿå¯ä»¥è§†ä¸ºç”¨Aã€Cã€Gå’ŒTç»„æˆçš„å­—ç¬¦ä¸²ï¼Œå› æ­¤ç¼–è¾‘è·ç¦»ä¹Ÿç”¨åœ¨ç”Ÿç‰©ä¿¡æ¯å­¦ä¸­ï¼Œåˆ¤æ–­äºŒä¸ªDNAçš„ç±»ä¼¼ç¨‹åº¦ã€‚Unix ä¸‹çš„ diff åŠ patch å³æ˜¯åˆ©ç”¨ç¼–è¾‘è·ç¦»æ¥è¿›è¡Œæ–‡æœ¬ç¼–è¾‘å¯¹æ¯”çš„ä¾‹å­ã€‚</p></blockquote><h2 id="ä¼ é€é—¨"><a href="#ä¼ é€é—¨" class="headerlink" title="ä¼ é€é—¨"></a><a href="https://leetcode.com/problems/edit-distance/" target="_blank" rel="noopener">ä¼ é€é—¨</a></h2><p>å¯¹äº â€œaâ€, â€œâ€, æ‰§è¡Œæ­¥éª¤ 1<br>å¯¹äº â€œâ€, â€œaâ€, æ‰§è¡Œæ­¥éª¤ 2<br>å¯¹äº â€œaâ€, â€œbâ€, æ‰§è¡Œæ­¥éª¤ 3</p><p>å‡è®¾å­—ç¬¦ä¸²ä¸² word1 å’Œ word2 çš„æœ€å°ç¼–è¾‘è·ç¦»æ˜¯ <code>d[i][j]</code> (i å’Œ j ä»£è¡¨ word1 å’Œ word2 çš„é•¿åº¦ - 1)ï¼Œå½“æˆ‘ä»¬ç»™ word1 å’Œ word2 éƒ½ append ä¸€ä¸ªç›¸åŒçš„å­—ç¬¦çš„æ—¶å€™ï¼Œè¿™ä¸ªç¼–è¾‘è·ç¦»ä¸å˜ã€‚å› æ­¤å¯ä»¥è®¤ä¸ºï¼Œæ­¤æ—¶çš„ <code>d[i+1][j+1] == d[i][j]</code>ã€‚å½“ append çš„å­—ç¬¦ä¸åŒçš„çš„æ—¶å€™ã€‚å°±æ˜¯æ‰¾åˆ°ä¹‹å‰çš„æœ€å°ç¼–è¾‘è·ç¦» + 1ï¼Œè¿™ä¸ªä¹‹å‰çš„æœ€å°ç¼–è¾‘è·ç¦»å¯èƒ½æ˜¯ <code>d[i][j]</code>ã€<code>d[i][j+1]</code>ã€æˆ–è€… <code>d[i+1][j]</code>ã€‚</p><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="http://ww1.sinaimg.cn/large/a67b702fgy1gasiec3bhgj204q0710sl.jpg" alt="Edit-Distance.png" title>                </div>                <div class="image-caption">Edit-Distance.png</div>            </figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">minDistance</span><span class="params">(String word1, String word2)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (word1 == <span class="keyword">null</span> || word2 == <span class="keyword">null</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">int</span> m = word1.length() + <span class="number">1</span>, n = word2.length() + <span class="number">1</span>; <span class="comment">//å¤šçš„ä¸€è¡Œç•™ç»™ç©ºå­—ç¬¦ä¸²</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">int</span>[][] d = <span class="keyword">new</span> <span class="keyword">int</span>[m][n];</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; m; i++)</span><br><span class="line">            d[i][<span class="number">0</span>] = i;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; n; j++)</span><br><span class="line">            d[<span class="number">0</span>][j] = j;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; m; ++i) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span>; j &lt; n; ++j) &#123;</span><br><span class="line">                <span class="keyword">if</span> (word1.charAt(i-<span class="number">1</span>) == word2.charAt(j-<span class="number">1</span>))</span><br><span class="line">                    d[i][j] = d[i-<span class="number">1</span>][j-<span class="number">1</span>];</span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">                    d[i][j] = min(d[i-<span class="number">1</span>][j-<span class="number">1</span>], d[i][j-<span class="number">1</span>], d[i-<span class="number">1</span>][j]) + <span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> d[m-<span class="number">1</span>][n-<span class="number">1</span>];</span><br><span class="line">                </span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">int</span> <span class="title">min</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b, <span class="keyword">int</span> c)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> Math.min(a, Math.min(b, c));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;ç»™å‡ºä¸¤ä¸ªå•è¯ word1 å’Œ word2ï¼Œæ‰¾å‡ºæŠŠ word1 ç¼–è¾‘æˆ word2 çš„æœ€çŸ­ç¼–è¾‘è·ç¦»ã€‚ç»™å‡ºçš„å¯ç”¨ç¼–è¾‘æ“ä½œæœ‰ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;æ’å…¥ä¸€ä¸ªå­—ç¬¦ insert&lt;/li&gt;
&lt;li&gt;åˆ é™¤ä¸€ä¸ªå­—ç¬¦ delete&lt;/li&gt;
&lt;li&gt;æ›´æ–°ä¸€ä¸ªå­—ç¬¦ update&lt;/li
      
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>äºŒç»´æ•°ç»„ä¸­å’Œæœ€å°è·¯å¾„</title>
    <link href="https://razertory.me/2020/01/11/minimum-path-sum/"/>
    <id>https://razertory.me/2020/01/11/minimum-path-sum/</id>
    <published>2020-01-11T02:38:44.000Z</published>
    <updated>2020-03-28T13:02:10.017Z</updated>
    
    <content type="html"><![CDATA[<p>åœ¨ä¸€ä¸ª m * n å¤§çš„éè´Ÿç»„æ•´æ•°ç»„æˆçš„äºŒç»´æ•°ç»„ä¸­ï¼Œæ‰¾åˆ°ä¸€æ¡ä» left-top åˆ° right-bottom çš„å’Œæœ€å°çš„è·¯å¾„ã€‚è¾“å‡ºè¿™ä¸ªè·¯å¾„çš„å€¼ã€‚<a href="https://leetcode.com/problems/minimum-path-sum/" target="_blank" rel="noopener">ä¼ é€é—¨</a></p><hr><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[</span><br><span class="line">  [<span class="number">1</span>,<span class="number">3</span>,<span class="number">1</span>],</span><br><span class="line">  [<span class="number">1</span>,<span class="number">5</span>,<span class="number">1</span>],</span><br><span class="line">  [<span class="number">4</span>,<span class="number">2</span>,<span class="number">1</span>]</span><br><span class="line">]</span><br></pre></td></tr></table></figure><p>åœ¨è¿™æ ·ä¸€ä¸ªçŸ©é˜µä¸­ï¼Œä» <code>m[0][0]</code> åˆ° <code>m[2][2]</code> çš„æœ€çŸ­è·¯å¾„ï¼Œå¯ä»¥çœ‹ä½œæ˜¯ <code>m[0][0]</code> åˆ° <code>m[1][2]</code> çš„æœ€çŸ­è·¯å¾„ (1-&gt;3-&gt;1-&gt;1) ä»¥åŠ <code>m[2][1]</code> çš„æœ€çŸ­è·¯å¾„ä¸­å–åˆ°çš„æœ€å°å€¼ (1-&gt;1-&gt;4-&gt;2) åŠ ä¸Š <code>m[2][2]</code> å–åˆ°çš„æœ€å°å€¼ 1-&gt;3-&gt;1-&gt;1-&gt;1ã€‚å› æ­¤å¯ä»¥å¾—åˆ°å…³ç³»å¼ </p><p><code>dp[m][n] = min(dp[m-1][n], dp[m][n-1]) + g[m][n]</code></p><p>åˆ©ç”¨è¿™ä¸ªå…³ç³»å¼ï¼Œå¤„ç†å¥½ mï¼Œn ä¸º 0 çš„è¾¹ç•Œæƒ…å†µå³å¯å¾—å‡ºæœ€çŸ­è·¯å¾„</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    <span class="comment">// dp[m][n] = min(dp[m-1][n], dp[m][n-1]) + g[m][n] </span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">minPathSum</span><span class="params">(<span class="keyword">int</span>[][] g)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (g == <span class="keyword">null</span> || g[<span class="number">0</span>] == <span class="keyword">null</span>)  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">int</span> h = g.length, w = g[<span class="number">0</span>].length;</span><br><span class="line">        <span class="keyword">int</span>[][] dp = <span class="keyword">new</span> <span class="keyword">int</span>[h][w];</span><br><span class="line">        dp[<span class="number">0</span>][<span class="number">0</span>] = g[<span class="number">0</span>][<span class="number">0</span>];</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; h; i++)</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; w; j++) &#123;</span><br><span class="line">                <span class="keyword">if</span> (i == <span class="number">0</span> &amp;&amp; j == <span class="number">0</span>)</span><br><span class="line">                    <span class="keyword">continue</span>;</span><br><span class="line">                <span class="keyword">if</span> (i == <span class="number">0</span>)</span><br><span class="line">                    dp[i][j] = dp[i][j-<span class="number">1</span>] + g[i][j];</span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">if</span> (j == <span class="number">0</span>)</span><br><span class="line">                    dp[i][j] = dp[i-<span class="number">1</span>][j] + g[i][j];</span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">                    dp[i][j] = Math.min(dp[i-<span class="number">1</span>][j], dp[i][j-<span class="number">1</span>]) + g[i][j];</span><br><span class="line">            &#125;</span><br><span class="line">        <span class="keyword">return</span> dp[h-<span class="number">1</span>][w-<span class="number">1</span>];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;åœ¨ä¸€ä¸ª m * n å¤§çš„éè´Ÿç»„æ•´æ•°ç»„æˆçš„äºŒç»´æ•°ç»„ä¸­ï¼Œæ‰¾åˆ°ä¸€æ¡ä» left-top åˆ° right-bottom çš„å’Œæœ€å°çš„è·¯å¾„ã€‚è¾“å‡ºè¿™ä¸ªè·¯å¾„çš„å€¼ã€‚&lt;a href=&quot;https://leetcode.com/problems/minimum-path-sum/&quot; target
      
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>æœ€é•¿å›æ–‡å­ä¸²</title>
    <link href="https://razertory.me/2020/01/11/longest-palindromic-substring/"/>
    <id>https://razertory.me/2020/01/11/longest-palindromic-substring/</id>
    <published>2020-01-11T02:00:36.000Z</published>
    <updated>2020-03-28T13:02:10.017Z</updated>
    
    <content type="html"><![CDATA[<p>ç»™ä¸€ä¸ªå­—ç¬¦ä¸² sï¼Œæ‰¾åˆ°å…¶ä¸­æœ€é•¿çš„å›æ–‡ä¸²ã€‚<a href="https://leetcode.com/problems/longest-palindromic-substring/" target="_blank" rel="noopener">ä¼ é€é—¨</a></p><hr><p>å›æ–‡ä¸²æœ‰ä¸¤ç§æ¨¡å¼ï¼Œä¸€ç§æ˜¯ aabb ç±»å‹ï¼Œå¦ä¸€ç§æ˜¯ aacbb ç±»å‹ã€‚å½“æˆ‘ä»¬å¯¹ä¸€ä¸ªå­—ç¬¦ä¸²åšæ˜¯å¦æ˜¯å›æ–‡çš„æ—¶å€™å¯ä»¥å®ç°ä¸€ä¸ª expand å‡½æ•°ç”¨ä½œåˆ¤æ–­<code>int expand(String s, int lelf, int right)</code> å½“ s[left] == s[right] ä¸” left å’Œ right æ²¡æœ‰åˆ°è¾¾å­—ç¬¦ä¸²è¾¹ç•Œçš„æ—¶å€™è®¡ç®—é•¿åº¦å³ <code>right - left + 1</code>ã€‚</p><p>å®ç°äº† expand ä¹‹åï¼Œå¯¹äºä»»æ„å­—ç¬¦ä¸²å¯ä»¥ç¡®è®¤ï¼š</p><ol><li>å­—ç¬¦ä¸²é•¿åº¦ä¸º 1 çš„æ—¶å€™ï¼Œæœ¬èº«å°±æ˜¯å›æ–‡ä¸²</li><li>å­—ç¬¦ä¸²é•¿åº¦ä¸º 2 çš„æ—¶å€™ï¼Œåˆ¤æ–­ä¸¤ä¸ªå­—ç¬¦æ˜¯å¦ç›¸ç­‰ï¼Œç›¸ç­‰è¯´æ˜æœ¬èº«æ˜¯ï¼Œå¦åˆ™å’Œ 1 ä¸€è‡´</li><li>å­—ç¬¦ä¸²é•¿åº¦ä¸º n çš„æ—¶å€™ï¼Œåœ¨å¯¹å­—ç¬¦ä¸²è¿›è¡Œä»å·¦åˆ°å³æ‰«ææ‰¾åˆ°æœ€å¤§å€¼ <code>max (expand(s, i, i), expand(s, i, i + 1))</code></li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">longestPalindrome</span><span class="params">(String s)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> start = <span class="number">0</span>, max = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; s.length(); i++) &#123;</span><br><span class="line">            <span class="keyword">int</span> len1 = expand(s, i, i);</span><br><span class="line">            <span class="keyword">int</span> len2 = expand(s, i, i + <span class="number">1</span>);</span><br><span class="line">            <span class="keyword">int</span> len = Math.max(len1, len2);</span><br><span class="line">            <span class="keyword">if</span> (len &gt; max) &#123;</span><br><span class="line">                start = i - (len-<span class="number">1</span>)/<span class="number">2</span>;</span><br><span class="line">                max = len;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> s.substring(start, start + max);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">expand</span><span class="params">(String s, <span class="keyword">int</span> left, <span class="keyword">int</span> right)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">while</span>(left &gt;= <span class="number">0</span> &amp;&amp; right &lt; s.length() &amp;&amp; s.charAt(left) == s.charAt(right))&#123;</span><br><span class="line">            left--;</span><br><span class="line">            right++;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> right - left - <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;ç»™ä¸€ä¸ªå­—ç¬¦ä¸² sï¼Œæ‰¾åˆ°å…¶ä¸­æœ€é•¿çš„å›æ–‡ä¸²ã€‚&lt;a href=&quot;https://leetcode.com/problems/longest-palindromic-substring/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;ä¼ é€é—¨&lt;/a&gt;&lt;/p&gt;
&lt;hr
      
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>æŠ¢åŠ«æˆ¿å­</title>
    <link href="https://razertory.me/2020/01/11/house-robber/"/>
    <id>https://razertory.me/2020/01/11/house-robber/</id>
    <published>2020-01-11T01:33:19.000Z</published>
    <updated>2020-03-28T13:02:10.017Z</updated>
    
    <content type="html"><![CDATA[<p>ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„å°å·ï¼Œè®¡åˆ’å·çªƒæ²¿è¡—çš„æˆ¿å±‹ã€‚æ¯é—´æˆ¿å†…éƒ½è—æœ‰ä¸€å®šçš„ç°é‡‘ï¼Œå½±å“ä½ å·çªƒçš„å”¯ä¸€åˆ¶çº¦å› ç´ å°±æ˜¯ç›¸é‚»çš„æˆ¿å±‹è£…æœ‰ç›¸äº’è¿é€šçš„é˜²ç›—ç³»ç»Ÿï¼Œå¦‚æœä¸¤é—´ç›¸é‚»çš„æˆ¿å±‹åœ¨åŒä¸€æ™šä¸Šè¢«å°å·é—¯å…¥ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨æŠ¥è­¦ã€‚<br>ç»™å®šä¸€ä¸ªä»£è¡¨æ¯ä¸ªæˆ¿å±‹å­˜æ”¾é‡‘é¢çš„éè´Ÿæ•´æ•°æ•°ç»„ï¼Œè®¡ç®—ä½ åœ¨ä¸è§¦åŠ¨è­¦æŠ¥è£…ç½®çš„æƒ…å†µä¸‹ï¼Œèƒ½å¤Ÿå·çªƒåˆ°çš„æœ€é«˜é‡‘é¢ã€‚</p><p><a href="https://leetcode.com/problems/house-robber/" target="_blank" rel="noopener">ä¼ é€é—¨</a></p><hr><p>å‡è®¾æˆ¿å­å®šä¹‰ä¸º <code>house[i]</code></p><p>æˆ¿å±‹æ•°é‡æ˜¯ 1 çš„æ—¶å€™ï¼Œå°å·åªèƒ½å·è¿™ä¸€å®¶ <code>house[0]</code>ã€‚</p><p>æˆ¿å±‹æ•°é‡æ˜¯ 2 çš„æ—¶å€™ï¼Œå°å·ä»ç°æœ‰çš„é€‰ä¸€ä¸ªå¤šçš„ï¼Œä¹Ÿå°±æ˜¯ <code>max(house[0], house[1])</code></p><p>æˆ¿å±‹æ•°é‡æ˜¯ 3 çš„æ—¶å€™ï¼Œå°å·çš„é€‰æ‹©ä¸º <code>max(house[0] + house[2], house[1])</code></p><p>å¦‚æœæˆ‘ä»¬çŸ¥é“æˆ¿å±‹æ•°é‡ä¸º i - 1 çš„æ—¶å€™ï¼Œå°å·çš„æœ€ä½³é€‰æ‹©æ˜¯ <code>d[i-1]</code>ï¼Œé‚£ä¹ˆå½“å†å¢åŠ ä¸€ä¸ªæˆ¿å±‹ï¼Œå³æˆ¿å±‹æ•°é‡ä¸º i çš„æ—¶å€™ã€‚ä¾æ®é¢˜æ„å¯ä»¥æ¨å¯¼å‡º</p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">d[i] = max(house[i] + d[i-<span class="number">2</span>], d[i-<span class="number">1</span>])</span><br></pre></td></tr></table></figure><p>ç¿»è¯‘æˆä»£ç å°±æ˜¯ </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">rob</span><span class="params">(<span class="keyword">int</span>[] nums)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (nums == <span class="keyword">null</span> || nums.length == <span class="number">0</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">int</span>[] d = <span class="keyword">new</span> <span class="keyword">int</span>[nums.length];</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; nums.length; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (i == <span class="number">0</span>) d[i] = nums[i];</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (i == <span class="number">1</span>) d[i] = Math.max(nums[i], nums[i-<span class="number">1</span>]);</span><br><span class="line">            <span class="keyword">else</span> d[i] = Math.max(d[i-<span class="number">2</span>] + nums[i], d[i-<span class="number">1</span>]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> d[nums.length - <span class="number">1</span>];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„å°å·ï¼Œè®¡åˆ’å·çªƒæ²¿è¡—çš„æˆ¿å±‹ã€‚æ¯é—´æˆ¿å†…éƒ½è—æœ‰ä¸€å®šçš„ç°é‡‘ï¼Œå½±å“ä½ å·çªƒçš„å”¯ä¸€åˆ¶çº¦å› ç´ å°±æ˜¯ç›¸é‚»çš„æˆ¿å±‹è£…æœ‰ç›¸äº’è¿é€šçš„é˜²ç›—ç³»ç»Ÿï¼Œå¦‚æœä¸¤é—´ç›¸é‚»çš„æˆ¿å±‹åœ¨åŒä¸€æ™šä¸Šè¢«å°å·é—¯å…¥ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨æŠ¥è­¦ã€‚&lt;br&gt;ç»™å®šä¸€ä¸ªä»£è¡¨æ¯ä¸ªæˆ¿å±‹å­˜æ”¾é‡‘é¢çš„éè´Ÿæ•´æ•°æ•°ç»„ï¼Œè®¡ç®—ä½ åœ¨ä¸è§¦åŠ¨è­¦æŠ¥è£…ç½®çš„æƒ…å†µä¸‹ï¼Œèƒ½å¤Ÿå·
      
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>ä¹°å–è‚¡ç¥¨çš„æœ€å¤§åˆ©æ¶¦</title>
    <link href="https://razertory.me/2020/01/09/max-stock-profit/"/>
    <id>https://razertory.me/2020/01/09/max-stock-profit/</id>
    <published>2020-01-09T05:02:03.000Z</published>
    <updated>2020-03-28T13:02:10.016Z</updated>
    
    <content type="html"><![CDATA[<p>å‡è®¾æŠŠæŸè‚¡ç¥¨çš„ä»·æ ¼æŒ‰ç…§æ—¶é—´å…ˆåé¡ºåºå­˜å‚¨åœ¨æ•°ç»„ä¸­ï¼Œè¯·é—®ä¹°å– ä¸€æ¬¡ è¯¥è‚¡ç¥¨å¯èƒ½è·å¾—çš„åˆ©æ¶¦æ˜¯å¤šå°‘ï¼Ÿ</p><p>ä¾‹å¦‚ä¸€åªè‚¡ç¥¨åœ¨æŸäº›æ—¶é—´èŠ‚ç‚¹çš„ä»·æ ¼ä¸º [9, 11, 8, 5, 7, 12, 16, 14]ã€‚</p><p>å¦‚æœæˆ‘ä»¬èƒ½åœ¨ä»·æ ¼ä¸º 5 çš„æ—¶å€™ä¹°å…¥å¹¶åœ¨ä»·æ ¼ä¸º 16 æ—¶å–å‡ºï¼Œåˆ™èƒ½æ”¶è·æœ€å¤§çš„åˆ©æ¶¦ 11ã€‚<br><a href="https://leetcode.com/problems/best-time-to-buy-and-sell-stock/" target="_blank" rel="noopener">ä¼ é€é—¨</a></p><hr><p>è‚¡ç¥¨æœ€å¤§åˆ©æ¶¦ï¼Œå…¶å®å°±æ˜¯ä¸ªä»å¤´åˆ°å°¾ä¸€ç›´æ›´æ–°æœ€å¤§åˆ©æ¶¦ã€‚æœ€å¤§åˆ©æ¶¦ = Math.max(å‰é¢çš„æœ€å¤§åˆ©æ¶¦ï¼Œå½“å‰è‚¡ç¥¨ä»·æ ¼ - å‰é¢æœ€ä½ä»·æ ¼)</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">maxProfit</span><span class="params">(<span class="keyword">int</span>[] nums)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (nums == <span class="keyword">null</span> || nums.length == <span class="number">0</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">int</span> min = nums[<span class="number">0</span>], maxProfit = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; nums.length; i++) &#123;</span><br><span class="line">        min = Math.min(min, nums[i]);</span><br><span class="line">        maxProfit = Math.max(maxProfit, nums[i] - min);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> maxProfit;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;å‡è®¾æŠŠæŸè‚¡ç¥¨çš„ä»·æ ¼æŒ‰ç…§æ—¶é—´å…ˆåé¡ºåºå­˜å‚¨åœ¨æ•°ç»„ä¸­ï¼Œè¯·é—®ä¹°å– ä¸€æ¬¡ è¯¥è‚¡ç¥¨å¯èƒ½è·å¾—çš„åˆ©æ¶¦æ˜¯å¤šå°‘ï¼Ÿ&lt;/p&gt;
&lt;p&gt;ä¾‹å¦‚ä¸€åªè‚¡ç¥¨åœ¨æŸäº›æ—¶é—´èŠ‚ç‚¹çš„ä»·æ ¼ä¸º [9, 11, 8, 5, 7, 12, 16, 14]ã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æœæˆ‘ä»¬èƒ½åœ¨ä»·æ ¼ä¸º 5 çš„æ—¶å€™ä¹°å…¥å¹¶åœ¨ä»·æ ¼ä¸º 16 æ—¶å–
      
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>2020 æ–°å¹´å¿«ä¹</title>
    <link href="https://razertory.me/2020/01/01/happy-new-year-2020/"/>
    <id>https://razertory.me/2020/01/01/happy-new-year-2020/</id>
    <published>2020-01-01T04:25:41.000Z</published>
    <updated>2020-03-28T13:02:10.016Z</updated>
    
    <content type="html"><![CDATA[<p>ç°åœ¨æ˜¯ 2020 å¹´çš„ä¸€æœˆä¸€æ—¥ï¼Œå’Œæ™®é€šæ”¾å‡çš„æ—¥å¸¸ä¸€æ ·ï¼š1. KFCï¼Œ2.ç”µè„‘ï¼Œ 3.çœ‹ä¹¦/ç¼–ç¨‹ã€‚å’Œä¹‹å‰ä¸ä¸€æ ·çš„æ˜¯ï¼Œå’–å•¡ç‚¹çš„æ˜¯åŠ å†°çš„ç¾å¼ã€‚å›æƒ³èµ·è¿‡å»çš„ä¸€å¹´ï¼Œä¸åœ¨åŠå…¬å®¤çš„æ—¶å€™ï¼Œæˆ‘é€šå¸¸ä¹Ÿä¼šå»æ‰¾ä¸€ä¸ªåœ°æ–¹å­¦ä¹ ï¼Œå¸¸åšçš„äº‹æƒ…æœ‰</p><ul><li>åˆ·è¯¾ã€‚MIT 6.824ã€SICP é‚£ç§</li><li>åˆ· OJã€‚é€šå¸¸æ˜¯ Leetcode æˆ–è€… codewarsï¼Œå…¶ä¸­åœ¨ leetcode ä¸Šæ‰“äº†ä¸€æ®µæ—¶é—´çš„å‘¨èµ›</li><li>çœ‹ä¹¦ã€‚é€šå¸¸éƒ½æ˜¯è®¡ç®—æœºç›¸å…³çš„ä¹¦ç±ï¼Œæœ€è¿‘çœ‹çš„æ˜¯ FP ç›¸å…³</li><li>å†™åšå®¢ã€‚å’Œç°åœ¨ä¸€æ ·</li></ul><p>è¿™äº›äº‹æƒ…éƒ½æ˜¯æˆ‘æ¢ä¸ªäººå–œæ¬¢åšçš„ï¼Œä½†æ˜¯å¯¹å¤–å´æœ‰ä¼˜å…ˆçº§ã€‚æ¯”å¦‚è¯´å¦‚æœæˆ‘æœ€è¿‘è¦å‚åŠ é¢è¯•ï¼Œæˆ‘å¯èƒ½ä¼šèŠ±æ›´å¤šçš„æ—¶é—´åœ¨åˆ· OJï¼›å¦‚æœæˆ‘æœ€è¿‘è¦ç”¨ä¸€é—¨æ–°è¯­è¨€/æ¡†æ¶ï¼Œæˆ‘å¯èƒ½ä¼šé€‰æ‹©çœ‹ä¹¦ï¼›å¦‚æœæˆ‘æœ€è¿‘æ—¶é—´æ¯”è¾ƒå……è£•ä¸”æ²¡æœ‰å¤–éƒ¨çš„éœ€æ±‚ï¼Œé‚£ä¹ˆæˆ‘ä¼šåƒç°åœ¨ä¸€æ ·å†™åšå®¢æˆ–è€…ç”¨ä¸€æ®µè¿ç»­ä¸”è¶³å¤Ÿé•¿çš„æ—¶é—´æ¥åˆ·è¯¾ç¨‹ã€‚</p><p>è¿™ä¹ˆåšæ—¢æ»¡è¶³äº†è‡ªå·±çš„å–œå¥½ï¼Œä¹Ÿèƒ½å¤Ÿæ ¹æ®å¤–éƒ¨çš„çŠ¶æ€åŠè°ƒæ•´ã€‚</p><p>éšç€æ—¶é—´çš„æ¨ç§»ï¼Œæˆ‘è¶Šæ¥è¶Šè§‰å¾—è‡ªå·±å³å°†æˆä¸ºé‚£ç§å¾ˆæ ‡å‡†çš„ã€ŒèŒåœºç å†œã€ã€‚å¿«é€Ÿå®Œæˆå¤–éƒ¨çš„éœ€æ±‚ï¼Œç»™å›¢é˜Ÿå¸¦æ¥ä»·å€¼ï¼Œå¿«é€Ÿå­¦ä¹ ä¸€é—¨æ–°æŠ€æœ¯ï¼Œå¿«é€Ÿè¡¥å¿æŠ€æœ¯å€ºã€‚ä½†æ˜¯æˆ‘è‡ªå·±ä¹Ÿä¸å¾—ä¸æ‰¿è®¤ï¼Œå› ä¸ºè¿™ç§ç­–ç•¥ï¼Œæˆ‘åˆ°ç›®å‰æ²¡æœ‰é‚£ç§èƒ½åšåˆ° top çš„äº‹æƒ…ã€‚é¦–å…ˆè§£é‡Šä¸€ä¸‹åšåˆ° topï¼šæ¯”å¦‚è¯´åˆ· OJï¼Œæˆ‘å¯ä»¥é€šè¿‡å‘¨èµ›æˆ–è€…è‡ªå·±çš„ç§¯åˆ†æ’åæ¥åˆ¤æ–­ï¼Œæˆ–è€…æˆ‘å¯ä»¥å»ç»™æŸä¸ªçŸ¥åå¼€æºçš„æ¡†æ¶åšè´¡çŒ®ï¼Œé€šè¿‡ contributors æ’åæ¥çœ‹è‡ªå·±åšçš„ç¨‹åº¦ã€‚åšåˆ° top æœ‰æ—¶å€™ä¸ä»…ä»…æ˜¯å› ä¸ºè‡ªå·±å¤šå¤šå°‘å°‘æœ‰ã€Œè¿½åé€åˆ©ã€çš„æƒ…ç»“ï¼Œæ›´å› ä¸ºæˆ‘åšæŒè®¤ä¸ºï¼Œå¦‚æœå–œæ¬¢åšä¸€ä»¶äº‹æƒ…ï¼Œè‚¯å®šæœ‰æŠŠäº‹æƒ…åšå¥½çš„æ„æ„¿ï¼Œé‚£ä¹ˆåªè¦ä¸æ–­åšæŒåšè‡ªç„¶å°±ä¼šåšåˆ° topã€‚</p><p>å‰æ®µæ—¶é—´çš„ä¸€ä¸ªå‘¨æœ«ï¼Œæˆ‘å»äº†ä¸€å®¶æ‘Šé¥¼åº—ï¼Œæ‹ä¸‹äº†ä¸€è¡Œå­—</p><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="http://ww1.sinaimg.cn/mw690/a67b702fgy1gagzjtfpp5j20u01407fd.jpg" alt title>                </div>                <div class="image-caption"></div>            </figure><p>å¦‚æœè¯´ï¼Œä¸€ä¸ªäººå¯ä»¥ä¸€è¾ˆå­ä¸“æ³¨äºä¸€ä»¶äº‹æƒ…ä¸Šï¼Œå¹¶ä¸”ä¸ä¼šè¢«åˆ«çš„äº‹æƒ…æ‰€å¹²æ‰°æˆ–è€…è¯±æƒ‘åº”è¯¥æ˜¯éå¸¸å€¼å¾—ç¾¡æ…•çš„ã€‚å¯æ˜¯å¦‚æœç”¨èµ„æœ¬å®¶çš„çœ¼å…‰å»çœ‹å¾…è¿™ä¸ªï¼Œè‚¯å®šä¼šè®©äººè§‰å¾—è¿™ä¸ªäººåªçŸ¥é“æ‰“å·¥(è¿™é‡Œä¸æŠŠæ‰“å·¥åšè´¬ä¹‰)ã€‚æˆ‘è®°å¾—åœ¨ã€Œæ³°å›§ã€ç”µå½±é‡Œé¢æœ‰ä¸ªå¯¹ç™½</p><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="http://ww1.sinaimg.cn/mw690/a67b702fgy1gah030l1rhj20rs0doq4n.jpg" alt title>                </div>                <div class="image-caption"></div>            </figure><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="http://ww1.sinaimg.cn/mw690/a67b702fgy1gah03e89o2j20rt0dt40p.jpg" alt title>                </div>                <div class="image-caption"></div>            </figure><p>èµ„æœ¬å®¶çƒ­çˆ±ã€ŒæŒ£é’±ã€æœ¬èº«è¿™ä»¶äº‹æƒ…ï¼Œæ‰€ä»¥ä¼šç”¨ç»è¥ã€æ‰©å¼ çš„çœ¼å…‰å»çœ‹å¾…åšè‘±æ²¹é¥¼ã€‚è‘±æ²¹é¥¼å°å“¥è¯´ç§˜æ–¹å°±æ˜¯è¦è‡ªå·±äº²è‡ªåšï¼Œæ–°é²œå‡ºç‚‰ï¼Œè¿™æ˜¯çƒ­çˆ±åšè‘±æ²¹é¥¼äººçš„çœ¼å…‰ã€‚ä¸è¿‡è¿™ä¸ªä¸–ç•Œå°±æ˜¯éœ€è¦è¿™ä¸¤ç§äººã€‚</p><p>å¦‚æœæŠŠã€Œåšè‘±æ²¹é¥¼ã€æ¢æˆã€Œå†™ä»£ç ã€ï¼Œè¿™ä¸ªå¯¹ç™½äº§ç”Ÿçš„æ•ˆæœåº”è¯¥æ˜¯ç±»ä¼¼çš„ã€‚</p><p>æˆ‘æƒ³è¯´ä¸è®ºæ˜¯ä¸ºäº†æ›´é«˜çš„è–ªæ°´ä¸æ–­å­¦ä¹ ï¼Œè¿˜æ˜¯å› ä¸ºçƒ­çˆ±ç¼–ç¨‹æœ¬èº«ä¸æ–­å­¦ä¹ ï¼Œè¿™ä¸¤è€…åº”è¯¥æ˜¯éƒ½è¢«è®¤å¯çš„ã€‚åœ¨ç°å®ä¸–ç•Œä¸­ï¼Œæˆ‘è®¤ä¸ºè¿™ä¸¤ç§åŠ¨æœºåº”è¯¥æ˜¯éƒ½å­˜åœ¨çš„ï¼Œæˆ–è€…è¯´äººæœ¬èº«å°±æ˜¯è¿™æ ·çš„ï¼Œæ—¢å¸Œæœ›åšçš„äº‹æƒ…æ˜¯è‡ªå·±å–œæ¬¢çš„ï¼Œä¹Ÿå¸Œæœ›åšçš„äº‹æƒ…èƒ½ç»™è‡ªå·±å¸¦æ¥æ›´å¤šæ”¶å…¥ã€‚</p><p>2020å¹´ï¼Œæˆ‘ä»¬æ˜¯é‡æ€§å’Œæ–‡æ˜å…±å­˜çš„ã€‚</p><p>æ–°å¹´å¿«ä¹ï¼</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;ç°åœ¨æ˜¯ 2020 å¹´çš„ä¸€æœˆä¸€æ—¥ï¼Œå’Œæ™®é€šæ”¾å‡çš„æ—¥å¸¸ä¸€æ ·ï¼š1. KFCï¼Œ2.ç”µè„‘ï¼Œ 3.çœ‹ä¹¦/ç¼–ç¨‹ã€‚å’Œä¹‹å‰ä¸ä¸€æ ·çš„æ˜¯ï¼Œå’–å•¡ç‚¹çš„æ˜¯åŠ å†°çš„ç¾å¼ã€‚å›æƒ³èµ·è¿‡å»çš„ä¸€å¹´ï¼Œä¸åœ¨åŠå…¬å®¤çš„æ—¶å€™ï¼Œæˆ‘é€šå¸¸ä¹Ÿä¼šå»æ‰¾ä¸€ä¸ªåœ°æ–¹å­¦ä¹ ï¼Œå¸¸åšçš„äº‹æƒ…æœ‰&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;åˆ·è¯¾ã€‚MIT 6.824ã€SICP
      
    
    </summary>
    
    
      <category term="æ€è€ƒ" scheme="https://razertory.me/tags/%E6%80%9D%E8%80%83/"/>
    
  </entry>
  
  <entry>
    <title>æœ‰åºæ•°ç»„è½¬åŒ–ä¸ºå¹³è¡¡äºŒå‰æœç´¢æ ‘ï¼ˆBSTï¼‰</title>
    <link href="https://razertory.me/2019/12/12/sorted-arr-to-bst/"/>
    <id>https://razertory.me/2019/12/12/sorted-arr-to-bst/</id>
    <published>2019-12-12T13:41:57.000Z</published>
    <updated>2020-03-28T13:02:10.016Z</updated>
    
    <content type="html"><![CDATA[<p>ç»™å®šä¸€ä¸ªæœ‰åºæ•°ç»„ï¼Œæ•°ç»„å…ƒç´ å‡åºæ’åˆ—ï¼Œè¯•å°†è¯¥æ•°ç»„è½¬æ¢ä¸ºä¸€æ£µå¹³è¡¡äºŒå‰æœç´¢æ ‘ï¼ˆBalanced Binary Search Treeï¼‰ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">TreeNode <span class="title">convertToBST</span><span class="params">(ArrayList&lt;Integer&gt; arr)</span></span></span><br></pre></td></tr></table></figure><p>æ ¹æ® BST çš„å®šä¹‰ <em>äºŒå‰æ’åºæ ‘çš„æŸ¥æ‰¾è¿‡ç¨‹å’Œæ¬¡ä¼˜äºŒå‰æ ‘ç±»ä¼¼ï¼Œé€šå¸¸é‡‡å–äºŒå‰é“¾è¡¨ä½œä¸ºäºŒå‰æ’åºæ ‘çš„å­˜å‚¨ç»“æ„ã€‚ä¸­åºéå†äºŒå‰æ’åºæ ‘å¯å¾—åˆ°ä¸€ä¸ªå…³é”®å­—çš„æœ‰åºåºåˆ—ï¼Œä¸€ä¸ªæ— åºåºåˆ—å¯ä»¥é€šè¿‡æ„é€ ä¸€æ£µäºŒå‰æ’åºæ ‘å˜æˆä¸€ä¸ªæœ‰åºåºåˆ—ï¼Œæ„é€ æ ‘çš„è¿‡ç¨‹å³ä¸ºå¯¹æ— åºåºåˆ—è¿›è¡Œæ’åºçš„è¿‡ç¨‹ã€‚æ¯æ¬¡æ’å…¥çš„æ–°çš„ç»“ç‚¹éƒ½æ˜¯äºŒå‰æ’åºæ ‘ä¸Šæ–°çš„å¶å­ç»“ç‚¹ï¼Œåœ¨è¿›è¡Œæ’å…¥æ“ä½œæ—¶ï¼Œä¸å¿…ç§»åŠ¨å…¶å®ƒç»“ç‚¹ï¼Œåªéœ€æ”¹åŠ¨æŸä¸ªç»“ç‚¹çš„æŒ‡é’ˆï¼Œç”±ç©ºå˜ä¸ºéç©ºå³å¯ã€‚æœç´¢,æ’å…¥,åˆ é™¤çš„å¤æ‚åº¦ç­‰äºæ ‘é«˜ï¼ŒO(log(n)).</em> å¯ä»¥å¯¹å…¶è¿›è¡Œåä¸­åºçš„éå†ã€‚ä¹Ÿå°±æ˜¯ ä¸­-å·¦-å³ çš„ä¸€ä¸ªé€†å‘è¿‡ç¨‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">TreeNode <span class="title">convertToBST</span><span class="params">(ArrayList&lt;Integer&gt; arr)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (arr == <span class="keyword">null</span> || arr.length == <span class="number">0</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">return</span> convert(arr, <span class="number">0</span>, arr.length - <span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">TreeNode <span class="title">convert</span><span class="params">(ArrayList&lt;Integer&gt; arr, <span class="keyword">int</span> start, <span class="keyword">int</span> end)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (start &gt; end) <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">int</span> mid = start + (end - start) / <span class="number">2</span>;</span><br><span class="line">    TreeNode node = <span class="keyword">new</span> TreeNode(arr[mid]);</span><br><span class="line">    node.left = convert(arr, start, mid - <span class="number">1</span>);</span><br><span class="line">    node.right = convert(arr, mid + <span class="number">1</span>, end);</span><br><span class="line">    <span class="keyword">return</span> node;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;ç»™å®šä¸€ä¸ªæœ‰åºæ•°ç»„ï¼Œæ•°ç»„å…ƒç´ å‡åºæ’åˆ—ï¼Œè¯•å°†è¯¥æ•°ç»„è½¬æ¢ä¸ºä¸€æ£µå¹³è¡¡äºŒå‰æœç´¢æ ‘ï¼ˆBalanced Binary Search Treeï¼‰ã€‚&lt;/p&gt;
&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;
      
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>å®Œç¾çš„äºŒåˆ†æœç´¢</title>
    <link href="https://razertory.me/2019/11/28/binary-search/"/>
    <id>https://razertory.me/2019/11/28/binary-search/</id>
    <published>2019-11-28T14:45:06.000Z</published>
    <updated>2020-03-28T13:02:10.014Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>å‡è®¾ç»™ä¸€ä¸ªæœ‰åºçš„ int ç±»å‹çš„æ•°ç»„ arrï¼Œå’Œä¸€ä¸ªç›®æ ‡å€¼ targetï¼Œæ‰¾åˆ°è¿™ä¸ªç›®æ ‡å€¼åœ¨æ•°ç»„ä¸­çš„ä¸‹æ ‡ã€‚å¦‚æœæ•°ç»„ä¸­æ²¡æœ‰<br>target è¿”å› -1ã€‚</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">search</span><span class="params">(<span class="keyword">int</span>[] arr, <span class="keyword">int</span> target)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> start = <span class="number">0</span>, end = arr.length - <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span> (start &lt;= end) &#123;</span><br><span class="line">        <span class="keyword">int</span> mid = start + (end - start) / <span class="number">2</span>; <span class="comment">// éœ€è¦æ³¨æ„ç”¨ (start + end) / 2 åœ¨æ•°å­¦ä¸Šæ²¡æœ‰é—®é¢˜ã€‚ä½†æ˜¯è€ƒè™‘åˆ° start + end å¯èƒ½ä¼šæº¢å‡ºã€‚</span></span><br><span class="line">        <span class="keyword">if</span> (target == arr[mid]) </span><br><span class="line">            <span class="keyword">return</span> mid;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (target &lt; arr[mid])</span><br><span class="line">            end = mid - <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            start + mid + <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;blockquote&gt;
&lt;p&gt;å‡è®¾ç»™ä¸€ä¸ªæœ‰åºçš„ int ç±»å‹çš„æ•°ç»„ arrï¼Œå’Œä¸€ä¸ªç›®æ ‡å€¼ targetï¼Œæ‰¾åˆ°è¿™ä¸ªç›®æ ‡å€¼åœ¨æ•°ç»„ä¸­çš„ä¸‹æ ‡ã€‚å¦‚æœæ•°ç»„ä¸­æ²¡æœ‰&lt;br&gt;target è¿”å› -1ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;figure class=&quot;highlight java
      
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>æ±‰æ˜è·ç¦»</title>
    <link href="https://razertory.me/2019/11/17/hamming-distance/"/>
    <id>https://razertory.me/2019/11/17/hamming-distance/</id>
    <published>2019-11-17T02:46:03.000Z</published>
    <updated>2020-03-28T13:02:10.013Z</updated>
    
    <content type="html"><![CDATA[<p>ä¸¤ä¸ªæ•´æ•°ä¹‹é—´çš„æ±‰æ˜è·ç¦»æŒ‡çš„æ˜¯è¿™ä¸¤ä¸ªæ•°å­—å¯¹åº”äºŒè¿›åˆ¶ä½ä¸åŒçš„ä½ç½®çš„æ•°ç›®ã€‚ç»™å‡ºä¸¤ä¸ªæ•´æ•° x å’Œ yï¼Œè®¡ç®—å®ƒä»¬ä¹‹é—´çš„æ±‰æ˜è·ç¦»ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">hammingDistance</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y)</span></span></span><br></pre></td></tr></table></figure><p>å¯¹äº x, å’Œ y å…ˆè¿›è¡Œå¼‚æˆ–ï¼Œç„¶åå†è®¡ç®—ç»“æœä¸­çš„ 1 çš„ä¸ªæ•°å³å¯ã€‚ï¼ˆå…¶ä¸­ count ç®—æ³•æ¥è‡ª <a href="/2019/11/14/count-of-one/">äºŒè¿›åˆ¶ä¸­ 1 çš„ä¸ªæ•°</a>ï¼‰</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">hammingDistance</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> n = x ^ y;</span><br><span class="line">    <span class="keyword">return</span> count(n); </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;ä¸¤ä¸ªæ•´æ•°ä¹‹é—´çš„æ±‰æ˜è·ç¦»æŒ‡çš„æ˜¯è¿™ä¸¤ä¸ªæ•°å­—å¯¹åº”äºŒè¿›åˆ¶ä½ä¸åŒçš„ä½ç½®çš„æ•°ç›®ã€‚ç»™å‡ºä¸¤ä¸ªæ•´æ•° x å’Œ yï¼Œè®¡ç®—å®ƒä»¬ä¹‹é—´çš„æ±‰æ˜è·ç¦»ã€‚&lt;/p&gt;
&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span c
      
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>åªå‡ºç°ä¸€æ¬¡çš„æ•°</title>
    <link href="https://razertory.me/2019/11/17/single-number/"/>
    <id>https://razertory.me/2019/11/17/single-number/</id>
    <published>2019-11-17T02:31:09.000Z</published>
    <updated>2020-03-28T13:02:10.013Z</updated>
    
    <content type="html"><![CDATA[<p>ç»™å®šä¸€ä¸ªéç©ºæ•´æ•°æ•°ç»„ï¼Œé™¤äº†æŸä¸ªå…ƒç´ åªå‡ºç°ä¸€æ¬¡ä»¥å¤–ï¼Œå…¶ä½™æ¯ä¸ªå…ƒç´ å‡å‡ºç°ä¸¤æ¬¡ã€‚æ‰¾å‡ºé‚£ä¸ªåªå‡ºç°äº†ä¸€æ¬¡çš„å…ƒç´ ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">singleNumber</span><span class="params">(<span class="keyword">int</span>[] nums)</span></span></span><br></pre></td></tr></table></figure><p>è®¡ç®—æœºç§‘å­¦ä¸­ï¼Œå¼‚æˆ–æ»¡è¶³å››å¤§å®šå¾‹</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">1.æ’å®šå¾‹ï¼šA ^ 0 = A</span><br><span class="line">2.å½’é›¶ç‡ï¼šA ^ A = 0</span><br><span class="line">3.äº¤æ¢å¾‹ï¼šA ^ B = B ^ A</span><br><span class="line">4.ç»“åˆå¾‹ï¼š(A ^ B) ^ C = A ^ (B ^ C)</span><br></pre></td></tr></table></figure><p>å‡å¦‚ç»™å®šçš„æ•°ç»„æ˜¯ [1, 3, 1, 3, 2, 4, 4]ã€‚æ ¹æ®å¼‚æˆ–çš„å®šå¾‹ï¼Œå¯¹æ•°ç»„ä»å¤´åˆ°å°¾è¿›è¡Œå¼‚æˆ–å¯ä»¥ç­‰ä»·æˆåˆ†ç»„ä¹‹åçš„å¼‚æˆ–ï¼Œè¿™é‡Œå¯ä»¥ç†è§£æˆ [1, 1, 2, 3, 3, 4, 4]ã€‚ç›¸åŒçš„æ•°éƒ½ä¼šå˜ä¸º 0 ï¼Œæœ€åå‰©ä¸‹çš„é‚£ä¸ªæ•°ä¹Ÿå°±å’Œ 0 è¿›è¡Œå¼‚æˆ–ç­‰åˆ°è‡ªå·±æœ¬èº«ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">singleNumber</span><span class="params">(<span class="keyword">int</span>[] nums)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> result = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> num : nums) &#123;</span><br><span class="line">        result ^= num;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;ç»™å®šä¸€ä¸ªéç©ºæ•´æ•°æ•°ç»„ï¼Œé™¤äº†æŸä¸ªå…ƒç´ åªå‡ºç°ä¸€æ¬¡ä»¥å¤–ï¼Œå…¶ä½™æ¯ä¸ªå…ƒç´ å‡å‡ºç°ä¸¤æ¬¡ã€‚æ‰¾å‡ºé‚£ä¸ªåªå‡ºç°äº†ä¸€æ¬¡çš„å…ƒç´ ã€‚&lt;/p&gt;
&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;li
      
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>ä¸ªæ•°å¤šäºä¸€åŠçš„æ•°</title>
    <link href="https://razertory.me/2019/11/16/major-element/"/>
    <id>https://razertory.me/2019/11/16/major-element/</id>
    <published>2019-11-16T12:08:11.000Z</published>
    <updated>2020-03-28T13:02:10.013Z</updated>
    
    <content type="html"><![CDATA[<p>ç»™å®šä¸€ä¸ªå¤§å°ä¸º n çš„æ•°ç»„ï¼Œæ‰¾å‡ºå…¶ä¸­åœ¨æ•°ç»„ä¸­å‡ºç°æ¬¡æ•°å¤§äº âŒŠ n/2 âŒ‹ çš„å…ƒç´ ï¼ˆä¼—æ•°ï¼‰ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">majorityElement</span><span class="params">(<span class="keyword">int</span>[] nums)</span></span></span><br></pre></td></tr></table></figure><p>ç†è§£è¿™ä¸ªé—®é¢˜ï¼Œé¦–å…ˆå¯ä»¥æŠŠæ•°ç»„åˆ†ä¸ºä¸¤ä¸ªéƒ¨åˆ†ï¼šæ‰€æœ‰çš„ä¼—æ•°å’Œéä¼—æ•°ã€‚æŠŠä¼—æ•°å’Œéä¼—æ•°è¿›è¡Œä¸¤ä¸¤æŠµæ¶ˆï¼Œé‚£ä¹ˆæœ€åä¸€å®šè¿˜å‰©ä¸‹ä¼—æ•°ã€‚å®é™…ä¸Šè¿™ä¸ªä¹Ÿå°±æ˜¯æ‘©å°”æŠ•ç¥¨æ³•ã€‚åœ¨éå†æ•°ç»„çš„æ—¶å€™ä¸æ–­ç¡®è®¤å½“å‰çš„ä¼—æ•°ï¼Œå¦‚æœæ²¡æœ‰ï¼Œåˆ™è®¤ä¸ºä¸‹ä¸€ä¸ªå°±æ˜¯ã€‚ç»´æŠ¤ä¸€ä¸ªè®¡æ•°å™¨ï¼Œåœ¨é‡åˆ°ç›¸åŒçš„æ—¶å€™ç»™ä¼—æ•° +1ï¼Œä¸åŒçš„æ—¶å€™ -1ã€‚å½“è®¡æ•°å™¨ä¸º 0 çš„æ—¶å€™è®¤ä¸ºæ²¡æœ‰ä¼—æ•°ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">majorityElement</span><span class="params">(<span class="keyword">int</span>[] nums)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> count = <span class="number">0</span>;</span><br><span class="line">    Integer candidate = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> num : nums) &#123;</span><br><span class="line">        <span class="keyword">if</span> (count == <span class="number">0</span>) &#123;</span><br><span class="line">            candidate = num;</span><br><span class="line">        &#125;</span><br><span class="line">        count += (num == candidate) ? <span class="number">1</span> : -<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> candidate;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;ç»™å®šä¸€ä¸ªå¤§å°ä¸º n çš„æ•°ç»„ï¼Œæ‰¾å‡ºå…¶ä¸­åœ¨æ•°ç»„ä¸­å‡ºç°æ¬¡æ•°å¤§äº âŒŠ n/2 âŒ‹ çš„å…ƒç´ ï¼ˆä¼—æ•°ï¼‰ã€‚&lt;/p&gt;
&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;
      
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>äºŒè¿›åˆ¶ä¸­ 1 çš„ä¸ªæ•°</title>
    <link href="https://razertory.me/2019/11/14/count-of-one/"/>
    <id>https://razertory.me/2019/11/14/count-of-one/</id>
    <published>2019-11-14T01:42:44.000Z</published>
    <updated>2020-03-28T13:02:10.013Z</updated>
    
    <content type="html"><![CDATA[<p>å¯¹äºä»»æ„æ•´æ•°ï¼Œæ±‚è½¬æ¢æˆäºŒè¿›åˆ¶æ•°ä¹‹åï¼Œ1 çš„ä¸ªæ•°ã€‚æ¯”å¦‚ 5 è½¬æ¢æˆäºŒè¿›åˆ¶æ˜¯ 101ï¼Œå…¶ä¸­ 1 çš„ä¸ªæ•°æ˜¯ 2ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">count</span> <span class="params">(<span class="keyword">int</span> num)</span></span></span><br></pre></td></tr></table></figure><p>è¦åˆ¤æ–­ä¸€ä¸ªäºŒè¿›åˆ¶æ•°çš„æœ€ä½ä½æ˜¯å¦æ˜¯ 1ï¼Œåªéœ€è¦å’Œ 1 è¿›è¡Œ <code>&amp;</code> è¿ç®—å³å¯ã€‚é‚£ä¹ˆå…·ä½“çš„åšæ³•å°±ä¸€è¾¹ç§»ä½ä¸€è¾¹ç»Ÿè®¡ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">count</span> <span class="params">(<span class="keyword">int</span> num)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> count = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(num != <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (num &amp; <span class="number">1</span> == <span class="number">1</span>) count++;</span><br><span class="line">        num &gt;&gt; <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> count;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;å¯¹äºä»»æ„æ•´æ•°ï¼Œæ±‚è½¬æ¢æˆäºŒè¿›åˆ¶æ•°ä¹‹åï¼Œ1 çš„ä¸ªæ•°ã€‚æ¯”å¦‚ 5 è½¬æ¢æˆäºŒè¿›åˆ¶æ˜¯ 101ï¼Œå…¶ä¸­ 1 çš„ä¸ªæ•°æ˜¯ 2ã€‚&lt;/p&gt;
&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;
      
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>ä½è¿ç®—å®ç°åŠ æ³•</title>
    <link href="https://razertory.me/2019/11/11/add-by-bit/"/>
    <id>https://razertory.me/2019/11/11/add-by-bit/</id>
    <published>2019-11-11T14:56:31.000Z</published>
    <updated>2020-03-28T13:02:10.013Z</updated>
    
    <content type="html"><![CDATA[<p>è®¡ç®—æœºç§‘å­¦ä¸­ï¼ŒåŸºç¡€è¿ç®—è¿ç®—éƒ½æ¥è‡ªäºäºŒè¿›åˆ¶ä¸­çš„ä½è¿ç®—ã€‚å…¶ä¸­ä¸å…æåˆ°åŠ æ³•å™¨ï¼Œç»´åŸºç™¾ç§‘æ˜¯è¿™ä¹ˆå®šä¹‰çš„</p><blockquote><p>åœ¨ç”µå­å­¦ä¸­ï¼ŒåŠ æ³•å™¨ï¼ˆè‹±è¯­ï¼šadderï¼‰æ˜¯ä¸€ç§ç”¨äºæ‰§è¡ŒåŠ æ³•è¿ç®—çš„æ•°å­—ç”µè·¯éƒ¨ä»¶ï¼Œæ˜¯æ„æˆç”µå­è®¡ç®—æœºæ ¸å¿ƒå¾®å¤„ç†å™¨ä¸­ç®—æœ¯é€»è¾‘å•å…ƒçš„åŸºç¡€ã€‚åœ¨è¿™äº›ç”µå­ç³»ç»Ÿä¸­ï¼ŒåŠ æ³•å™¨ä¸»è¦è´Ÿè´£è®¡ç®—åœ°å€ã€ç´¢å¼•ç­‰æ•°æ®ã€‚é™¤æ­¤ä¹‹å¤–ï¼ŒåŠ æ³•å™¨ä¹Ÿæ˜¯å…¶ä»–ä¸€äº›ç¡¬ä»¶ï¼Œä¾‹å¦‚äºŒè¿›åˆ¶æ•°çš„ä¹˜æ³•å™¨çš„é‡è¦ç»„æˆéƒ¨åˆ†ã€‚<br>å°½ç®¡å¯ä»¥ä¸ºä¸åŒè®¡æ•°ç³»ç»Ÿè®¾è®¡ä¸“é—¨çš„åŠ æ³•å™¨ï¼Œä½†æ˜¯ç”±äºæ•°å­—ç”µè·¯é€šå¸¸ä»¥äºŒè¿›åˆ¶ä¸ºåŸºç¡€ï¼Œå› æ­¤äºŒè¿›åˆ¶åŠ æ³•å™¨åœ¨å®é™…åº”ç”¨ä¸­æœ€ä¸ºæ™®éã€‚åœ¨æ•°å­—ç”µè·¯ä¸­ï¼ŒäºŒè¿›åˆ¶æ•°çš„å‡æ³•å¯ä»¥é€šè¿‡åŠ ä¸€ä¸ªè´Ÿæ•°æ¥é—´æ¥å®Œæˆã€‚ä¸ºäº†ä½¿è´Ÿæ•°çš„è®¡ç®—èƒ½å¤Ÿç›´æ¥ç”¨åŠ æ³•å™¨æ¥å®Œæˆï¼Œè®¡ç®—ä¸­çš„è´Ÿæ•°å¯ä»¥ä½¿ç”¨äºŒè¡¥æ•°ï¼ˆè¡¥ç ï¼‰æ¥è¡¨ç¤ºï¼Œå…·ä½“çš„ç»†èŠ‚å¯ä»¥å‚è€ƒæ•°å­—ç”µè·¯ç›¸å…³çš„ä¹¦ç±</p></blockquote><p>å¯¹ä¸¤ä¸ªäºŒè¿›åˆ¶æ•°åšç›¸åŠ ï¼Œæœ‰ä»¥ä¸‹è§„å¾‹</p><p><em>äºŒè¿›åˆ¶åŠ æ³•</em></p><table><thead><tr><th>x</th><th>y</th><th>å’Œ</th><th>è¿›ä½</th></tr></thead><tbody><tr><td>0</td><td>0</td><td>0</td><td>0</td></tr><tr><td>0</td><td>1</td><td>1</td><td>0</td></tr><tr><td>1</td><td>0</td><td>1</td><td>0</td></tr><tr><td>1</td><td>1</td><td>0</td><td>1</td></tr></tbody></table><p>å‡è®¾ x + y ç›¸åŠ ç”¨ä»£ç è¡¨ç¤ºï¼Œé‚£ä¹ˆå°±éœ€è¦ä¸€ä¸ª sum å’Œ carry åˆ†åˆ«è¡¨ç¤ºå’Œä¸è¿›ä½ã€‚ä¸è¿‡è¿™ä¸ªè¿˜ä¸è¶³å¤Ÿè¡¨ç¤ºä¸¤ä¸ªæ•°ç›¸åŠ ã€‚</p><p>ä»”ç»†è§‚å¯Ÿå¯ä»¥å‘ç° x + y çš„ sum å’Œ carry å…¶å®åˆ†åˆ«æ˜¯å¼‚æˆ–<code>^</code>å’Œä¸<code>&amp;</code>è¿ç®—ã€‚å¦‚ä¸‹ï¼š</p><p><em>å¼‚æˆ–</em></p><table><thead><tr><th>x</th><th>y</th><th>^</th></tr></thead><tbody><tr><td>0</td><td>0</td><td>0</td></tr><tr><td>0</td><td>1</td><td>1</td></tr><tr><td>1</td><td>0</td><td>1</td></tr><tr><td>1</td><td>1</td><td>0</td></tr></tbody></table><p><em>ä¸</em></p><table><thead><tr><th>x</th><th>y</th><th>&amp;</th></tr></thead><tbody><tr><td>0</td><td>0</td><td>0</td></tr><tr><td>0</td><td>1</td><td>0</td></tr><tr><td>1</td><td>0</td><td>0</td></tr><tr><td>1</td><td>1</td><td>1</td></tr></tbody></table><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// äºŒè¿›åˆ¶å®ç°åŠ æ³•</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b)</span> </span>&#123;</span><br><span class="line">ã€€ã€€<span class="keyword">int</span> sum = a;</span><br><span class="line">ã€€ã€€<span class="keyword">int</span> carry = b;</span><br><span class="line">ã€€ã€€<span class="keyword">while</span>(carry != <span class="number">0</span> ) &#123;</span><br><span class="line">ã€€ã€€ã€€ã€€<span class="keyword">int</span> tmps = sum;</span><br><span class="line"> </span><br><span class="line">ã€€ã€€ã€€ã€€sum = tmps ^ carry;</span><br><span class="line">ã€€ã€€ã€€ã€€carry = (tmps &amp; carry) &lt;&lt; <span class="number">1</span>;</span><br><span class="line">ã€€ã€€&#125;</span><br><span class="line">ã€€ã€€<span class="keyword">return</span> sum;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;è®¡ç®—æœºç§‘å­¦ä¸­ï¼ŒåŸºç¡€è¿ç®—è¿ç®—éƒ½æ¥è‡ªäºäºŒè¿›åˆ¶ä¸­çš„ä½è¿ç®—ã€‚å…¶ä¸­ä¸å…æåˆ°åŠ æ³•å™¨ï¼Œç»´åŸºç™¾ç§‘æ˜¯è¿™ä¹ˆå®šä¹‰çš„&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;åœ¨ç”µå­å­¦ä¸­ï¼ŒåŠ æ³•å™¨ï¼ˆè‹±è¯­ï¼šadderï¼‰æ˜¯ä¸€ç§ç”¨äºæ‰§è¡ŒåŠ æ³•è¿ç®—çš„æ•°å­—ç”µè·¯éƒ¨ä»¶ï¼Œæ˜¯æ„æˆç”µå­è®¡ç®—æœºæ ¸å¿ƒå¾®å¤„ç†å™¨ä¸­ç®—æœ¯é€»è¾‘å•å…ƒçš„åŸºç¡€ã€‚åœ¨è¿™äº›ç”µå­ç³»ç»Ÿ
      
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>æ‹¬å·çš„åˆæ³•åºåˆ—</title>
    <link href="https://razertory.me/2019/11/10/valid-brackets/"/>
    <id>https://razertory.me/2019/11/10/valid-brackets/</id>
    <published>2019-11-10T01:55:10.000Z</published>
    <updated>2020-03-28T13:02:10.012Z</updated>
    
    <content type="html"><![CDATA[<p>ç»™ä½ ä¸€ä¸ªæ‹¬å·åºåˆ—ï¼Œé‡Œé¢åŒ…å«å°æ‹¬å·ï¼Œä¸­æ‹¬å·å’Œå¤§æ‹¬å·ã€‚ä½ è¦åˆ¤æ–­è¿™ä¸ªæ‹¬å·åºåˆ—æ˜¯å¦æœ‰æ•ˆã€‚æœ‰æ•ˆçš„æ‹¬å·åºåˆ—è¦æ±‚ï¼Œæ¯ä¸ªå·¦æ‹¬å·éƒ½å¿…é¡»æœ‰ä¸€ä¸ªåŒç±»çš„å³æ‹¬å·ä¸å®ƒæ­£ç¡®é…å¯¹ã€‚å¦å¤–ï¼Œç©ºå­—ç¬¦ä¸²è®¤ä¸ºæ˜¯æœ‰æ•ˆçš„æ‹¬å·åºåˆ—ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">æ¯”å¦‚è¯´ï¼Œç»™ä½ çš„åºåˆ—æ˜¯ï¼š</span><br><span class="line"></span><br><span class="line">()[]&#123;&#125;</span><br><span class="line"></span><br><span class="line">å°æ‹¬å·/ä¸­æ‹¬å·/å¤§æ‹¬å·çš„å·¦å³æ‹¬å·éƒ½èƒ½æ­£ç¡®é…å¯¹ï¼Œå› æ­¤è¿™æ˜¯ä¸€ä¸ªæœ‰æ•ˆçš„æ‹¬å·åºåˆ—ã€‚</span><br><span class="line"></span><br><span class="line">å†æ¯”å¦‚è¯´ç»™ä½ çš„åºåˆ—æ˜¯ï¼š</span><br><span class="line"></span><br><span class="line">([)]</span><br><span class="line"></span><br><span class="line">è¿™é‡Œé¢è™½ç„¶æ­£å¥½æœ‰ä¸€å¯¹å°æ‹¬å·å’Œä¸€å¯¹ä¸­æ‹¬å·ï¼Œä½†å®ƒä»¬çš„é¡ºåºä¸å¯¹ï¼Œæ‹¬å·é—´æ— æ³•æ­£ç¡®é…å¯¹ï¼Œå› æ­¤è¿™ä¸æ˜¯ä¸€ä¸ªæœ‰æ•ˆçš„æ‹¬å·åºåˆ—</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isValidBrackets</span><span class="params">(String s)</span> </span>&#123;</span><br></pre></td></tr></table></figure><p>ç»´æŠ¤ä¸€ä¸ª stackï¼Œå­˜æ”¾ charã€‚åœ¨éå† s çš„è¿‡ç¨‹ä¸­ï¼Œä¸æ–­å¯¹é‡åˆ°å·¦æ‹¬å·è¿›è¡Œ pushï¼Œå³æ‹¬å·è¿›è¡Œ popã€‚å½“æœ€å stack ä¸ºç©ºçš„æ—¶å€™è¯´æ˜æ˜¯åˆæ³•çš„æ‹¬å·åºåˆ—.</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isValidBrackets</span><span class="params">(String s)</span> </span>&#123;</span><br><span class="line">    Stack&lt;Character&gt; stack = <span class="keyword">new</span> Stack&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; s.length(); ++i) &#123;</span><br><span class="line">      <span class="keyword">if</span> (s.charAt(i) == <span class="string">'('</span> || s.charAt(i) == <span class="string">'['</span> || s.charAt(i) == <span class="string">'&#123;'</span>) &#123;</span><br><span class="line">        stack.push(s.charAt(i));</span><br><span class="line">      &#125; <span class="keyword">else</span> <span class="keyword">if</span> (stack.isEmpty()) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (s.charAt(i) == <span class="string">')'</span> &amp;&amp; stack.peek() != <span class="string">'('</span>) <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        <span class="keyword">if</span> (s.charAt(i) == <span class="string">']'</span> &amp;&amp; stack.peek() != <span class="string">'['</span>) <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        <span class="keyword">if</span> (s.charAt(i) == <span class="string">'&#125;'</span> &amp;&amp; stack.peek() != <span class="string">'&#123;'</span>) <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        stack.pop();</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> stack.isEmpty();</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;ç»™ä½ ä¸€ä¸ªæ‹¬å·åºåˆ—ï¼Œé‡Œé¢åŒ…å«å°æ‹¬å·ï¼Œä¸­æ‹¬å·å’Œå¤§æ‹¬å·ã€‚ä½ è¦åˆ¤æ–­è¿™ä¸ªæ‹¬å·åºåˆ—æ˜¯å¦æœ‰æ•ˆã€‚æœ‰æ•ˆçš„æ‹¬å·åºåˆ—è¦æ±‚ï¼Œæ¯ä¸ªå·¦æ‹¬å·éƒ½å¿…é¡»æœ‰ä¸€ä¸ªåŒç±»çš„å³æ‹¬å·ä¸å®ƒæ­£ç¡®é…å¯¹ã€‚å¦å¤–ï¼Œç©ºå­—ç¬¦ä¸²è®¤ä¸ºæ˜¯æœ‰æ•ˆçš„æ‹¬å·åºåˆ—ã€‚&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;
      
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>æ ˆå®ç°é˜Ÿåˆ—</title>
    <link href="https://razertory.me/2019/11/10/queue-by-stack/"/>
    <id>https://razertory.me/2019/11/10/queue-by-stack/</id>
    <published>2019-11-10T01:45:31.000Z</published>
    <updated>2020-03-28T13:02:10.012Z</updated>
    
    <content type="html"><![CDATA[<p>ç»´æŠ¤ä¸€ä¸ª inï¼Œout æ ˆè¡¨ç¤ºè¿›å‡ºé¡ºåºï¼Œå®ç°ä¸€ä¸ªä» in åˆ° out çš„è½¬ç§»æ–¹æ³•ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyQueue</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Stack&lt;Integer&gt; in, out;</span><br><span class="line"></span><br><span class="line">    MyQueue() &#123;</span><br><span class="line">        in = <span class="keyword">new</span> Stack&lt;&gt;();</span><br><span class="line">        out = <span class="keyword">new</span> Stack&lt;&gt;();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">push</span><span class="params">(<span class="keyword">int</span> val)</span> </span>&#123;</span><br><span class="line">        in.push(val);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">pop</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        transferIfEmpty();</span><br><span class="line">        <span class="keyword">return</span> out.pop();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">peek</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        transferIfEmpty();</span><br><span class="line">        <span class="keyword">return</span> out.peek();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">isEmpty</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> in.isEmpty() &amp;&amp; out.empty();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">transferIfEmpty</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(out.empty()) &#123;</span><br><span class="line">            <span class="keyword">while</span>(!in.empty()) &#123;</span><br><span class="line">                out.push(in.pop());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;ç»´æŠ¤ä¸€ä¸ª inï¼Œout æ ˆè¡¨ç¤ºè¿›å‡ºé¡ºåºï¼Œå®ç°ä¸€ä¸ªä» in åˆ° out çš„è½¬ç§»æ–¹æ³•ã€‚&lt;/p&gt;
&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/spa
      
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>uber-go-guide</title>
    <link href="https://razertory.me/2019/11/08/uber-go-guide-cn/"/>
    <id>https://razertory.me/2019/11/08/uber-go-guide-cn/</id>
    <published>2019-11-08T00:04:22.000Z</published>
    <updated>2020-03-28T13:02:10.012Z</updated>
    
    <content type="html"><![CDATA[<p>æœ¬æ–‡é•¿æœŸç»´æŠ¤åœ°å€: <a href="https://github.com/xxjwxc/uber_go_guide_cn" target="_blank" rel="noopener">https://github.com/xxjwxc/uber_go_guide_cn</a></p><h1 id="Uber-Go-è¯­è¨€ç¼–ç è§„èŒƒ"><a href="#Uber-Go-è¯­è¨€ç¼–ç è§„èŒƒ" class="headerlink" title="Uber Go è¯­è¨€ç¼–ç è§„èŒƒ"></a>Uber Go è¯­è¨€ç¼–ç è§„èŒƒ</h1><p> <a href="https://www.uber.com/" target="_blank" rel="noopener">Uber</a> æ˜¯ä¸€å®¶ç¾å›½ç¡…è°·çš„ç§‘æŠ€å…¬å¸ï¼Œä¹Ÿæ˜¯ Go è¯­è¨€çš„æ—©æœŸ adopterã€‚å…¶å¼€æºäº†å¾ˆå¤š golang é¡¹ç›®ï¼Œè¯¸å¦‚è¢« Gopher åœˆç†ŸçŸ¥çš„ <a href="https://github.com/uber-go/zap" target="_blank" rel="noopener">zap</a>ã€<a href="https://github.com/jaegertracing/jaeger" target="_blank" rel="noopener">jaeger</a> ç­‰ã€‚2018 å¹´å¹´æœ« Uber å°†å†…éƒ¨çš„ <a href="https://github.com/uber-go/guide" target="_blank" rel="noopener">Go é£æ ¼è§„èŒƒ</a> å¼€æºåˆ° GitHubï¼Œç»è¿‡ä¸€å¹´çš„ç§¯ç´¯å’Œæ›´æ–°ï¼Œè¯¥è§„èŒƒå·²ç»åˆå…·è§„æ¨¡ï¼Œå¹¶å—åˆ°å¹¿å¤§ Gopher çš„å…³æ³¨ã€‚æœ¬æ–‡æ˜¯è¯¥è§„èŒƒçš„ä¸­æ–‡ç‰ˆæœ¬ã€‚æœ¬ç‰ˆæœ¬ä¼šæ ¹æ®åŸç‰ˆå®æ—¶æ›´æ–°ã€‚</p><h2 id="ç‰ˆæœ¬"><a href="#ç‰ˆæœ¬" class="headerlink" title="ç‰ˆæœ¬"></a>ç‰ˆæœ¬</h2><ul><li>å½“å‰æ›´æ–°ç‰ˆæœ¬ï¼š2019-11-01 ç‰ˆæœ¬åœ°å€ï¼š<a href="https://github.com/uber-go/guide/commit/7eb64c6cb304471c868273d919c2d34993e2daa7" target="_blank" rel="noopener">commit:#68</a></li><li>å¦‚æœæ‚¨å‘ç°ä»»ä½•æ›´æ–°ã€é—®é¢˜æˆ–æ”¹è¿›ï¼Œè¯·éšæ—¶ fork å’Œ PR</li><li>Please feel free to fork and PR if you find any updates, issues or improvement.</li></ul><h2 id="ç›®å½•"><a href="#ç›®å½•" class="headerlink" title="ç›®å½•"></a>ç›®å½•</h2><ul><li><a href="#ä»‹ç»">ä»‹ç»</a></li><li><a href="#æŒ‡å¯¼åŸåˆ™">æŒ‡å¯¼åŸåˆ™</a><ul><li><a href="#æŒ‡å‘-interface-çš„æŒ‡é’ˆ">æŒ‡å‘ interface çš„æŒ‡é’ˆ</a></li><li><a href="#æ¥æ”¶å™¨-receiver-ä¸æ¥å£">æ¥æ”¶å™¨ (receiver) ä¸æ¥å£</a></li><li><a href="#é›¶å€¼-Mutex-æ˜¯æœ‰æ•ˆçš„">é›¶å€¼ Mutex æ˜¯æœ‰æ•ˆçš„</a></li><li><a href="#åœ¨è¾¹ç•Œå¤„æ‹·è´-Slices-å’Œ-Maps">åœ¨è¾¹ç•Œå¤„æ‹·è´ Slices å’Œ Maps</a></li><li><a href="#ä½¿ç”¨-defer-é‡Šæ”¾èµ„æº">ä½¿ç”¨ defer é‡Šæ”¾èµ„æº</a></li><li><a href="#Channel-çš„-size-è¦ä¹ˆæ˜¯-1è¦ä¹ˆæ˜¯æ— ç¼“å†²çš„">Channel çš„ size è¦ä¹ˆæ˜¯ 1ï¼Œè¦ä¹ˆæ˜¯æ— ç¼“å†²çš„</a></li><li><a href="#æšä¸¾ä»-1-å¼€å§‹">æšä¸¾ä» 1 å¼€å§‹</a></li><li><a href="#é”™è¯¯ç±»å‹">é”™è¯¯ç±»å‹</a></li><li><a href="#é”™è¯¯åŒ…è£…-(Error-Wrapping)">é”™è¯¯åŒ…è£… (Error Wrapping)</a></li><li><a href="#å¤„ç†ç±»å‹æ–­è¨€å¤±è´¥">å¤„ç†ç±»å‹æ–­è¨€å¤±è´¥</a></li><li><a href="#ä¸è¦-panic">ä¸è¦ panic</a></li><li><a href="#ä½¿ç”¨-gouberorgatomic">ä½¿ç”¨ go.uber.org/atomic</a></li></ul></li><li><a href="#æ€§èƒ½">æ€§èƒ½</a><ul><li><a href="#ä¼˜å…ˆä½¿ç”¨-strconv-è€Œä¸æ˜¯-fmt">ä¼˜å…ˆä½¿ç”¨ strconv è€Œä¸æ˜¯ fmt</a></li><li><a href="#é¿å…å­—ç¬¦ä¸²åˆ°å­—èŠ‚çš„è½¬æ¢">é¿å…å­—ç¬¦ä¸²åˆ°å­—èŠ‚çš„è½¬æ¢</a></li><li><a href="#å°½é‡åˆå§‹åŒ–æ—¶æŒ‡å®š-Map-å®¹é‡">å°½é‡åˆå§‹åŒ–æ—¶æŒ‡å®š Map å®¹é‡</a></li></ul></li><li><a href="#è§„èŒƒ">è§„èŒƒ</a><ul><li><a href="#ä¸€è‡´æ€§">ä¸€è‡´æ€§</a></li><li><a href="#ç›¸ä¼¼çš„å£°æ˜æ”¾åœ¨ä¸€ç»„">ç›¸ä¼¼çš„å£°æ˜æ”¾åœ¨ä¸€ç»„</a></li><li><a href="#import-åˆ†ç»„">import åˆ†ç»„</a></li><li><a href="#åŒ…å">åŒ…å</a></li><li><a href="#å‡½æ•°å">å‡½æ•°å</a></li><li><a href="#å¯¼å…¥åˆ«å">å¯¼å…¥åˆ«å</a></li><li><a href="#å‡½æ•°åˆ†ç»„ä¸é¡ºåº">å‡½æ•°åˆ†ç»„ä¸é¡ºåº</a></li><li><a href="#å‡å°‘åµŒå¥—">å‡å°‘åµŒå¥—</a></li><li><a href="#ä¸å¿…è¦çš„-else">ä¸å¿…è¦çš„ else</a></li><li><a href="#é¡¶å±‚å˜é‡å£°æ˜">é¡¶å±‚å˜é‡å£°æ˜</a></li><li><a href="#å¯¹äºæœªå¯¼å‡ºçš„é¡¶å±‚å¸¸é‡å’Œå˜é‡ä½¿ç”¨_ä½œä¸ºå‰ç¼€">å¯¹äºæœªå¯¼å‡ºçš„é¡¶å±‚å¸¸é‡å’Œå˜é‡ï¼Œä½¿ç”¨_ä½œä¸ºå‰ç¼€</a></li><li><a href="#ç»“æ„ä½“ä¸­çš„åµŒå…¥">ç»“æ„ä½“ä¸­çš„åµŒå…¥</a></li><li><a href="#ä½¿ç”¨å­—æ®µååˆå§‹åŒ–ç»“æ„ä½“">ä½¿ç”¨å­—æ®µååˆå§‹åŒ–ç»“æ„ä½“</a></li><li><a href="#æœ¬åœ°å˜é‡å£°æ˜">æœ¬åœ°å˜é‡å£°æ˜</a></li><li><a href="#nil-æ˜¯ä¸€ä¸ªæœ‰æ•ˆçš„-slice">nil æ˜¯ä¸€ä¸ªæœ‰æ•ˆçš„ slice</a></li><li><a href="#å°å˜é‡ä½œç”¨åŸŸ">å°å˜é‡ä½œç”¨åŸŸ</a></li><li><a href="#é¿å…å‚æ•°è¯­ä¹‰ä¸æ˜ç¡®Avoid-Naked-Parameters">é¿å…å‚æ•°è¯­ä¹‰ä¸æ˜ç¡®ï¼ˆAvoid Naked Parametersï¼‰</a></li><li><a href="#ä½¿ç”¨åŸå§‹å­—ç¬¦ä¸²å­—é¢å€¼é¿å…è½¬ä¹‰">ä½¿ç”¨åŸå§‹å­—ç¬¦ä¸²å­—é¢å€¼ï¼Œé¿å…è½¬ä¹‰</a></li><li><a href="#åˆå§‹åŒ–-Struct-å¼•ç”¨">åˆå§‹åŒ– Struct å¼•ç”¨</a></li><li><a href="#åˆå§‹åŒ–-maps">åˆå§‹åŒ– Maps</a></li><li><a href="#å­—ç¬¦ä¸²-string-format">å­—ç¬¦ä¸² string format </a></li><li><a href="#å‘½å-Printf-æ ·å¼çš„å‡½æ•°">å‘½å Printf æ ·å¼çš„å‡½æ•°</a></li></ul></li><li><a href="#ç¼–ç¨‹æ¨¡å¼">ç¼–ç¨‹æ¨¡å¼</a><ul><li><a href="#è¡¨é©±åŠ¨æµ‹è¯•">è¡¨é©±åŠ¨æµ‹è¯•</a></li><li><a href="#åŠŸèƒ½é€‰é¡¹">åŠŸèƒ½é€‰é¡¹</a></li></ul></li></ul><h2 id="ä»‹ç»"><a href="#ä»‹ç»" class="headerlink" title="ä»‹ç»"></a>ä»‹ç»</h2><p>æ ·å¼ (style) æ˜¯æ”¯é…æˆ‘ä»¬ä»£ç çš„æƒ¯ä¾‹ã€‚æœ¯è¯­<code>æ ·å¼</code>æœ‰ç‚¹ç”¨è¯ä¸å½“ï¼Œå› ä¸ºè¿™äº›çº¦å®šæ¶µç›–çš„èŒƒå›´ä¸é™äºç”± gofmt æ›¿æˆ‘ä»¬å¤„ç†çš„æºæ–‡ä»¶æ ¼å¼ã€‚</p><p>æœ¬æŒ‡å—çš„ç›®çš„æ˜¯é€šè¿‡è¯¦ç»†æè¿°åœ¨ Uber ç¼–å†™ Go ä»£ç çš„æ³¨æ„äº‹é¡¹æ¥ç®¡ç†è¿™ç§å¤æ‚æ€§ã€‚è¿™äº›è§„åˆ™çš„å­˜åœ¨æ˜¯ä¸ºäº†ä½¿ä»£ç åº“æ˜“äºç®¡ç†ï¼ŒåŒæ—¶ä»ç„¶å…è®¸å·¥ç¨‹å¸ˆæ›´æœ‰æ•ˆåœ°ä½¿ç”¨ Go è¯­è¨€åŠŸèƒ½ã€‚</p><p>è¯¥æŒ‡å—æœ€åˆç”± <a href="https://github.com/prashantv" target="_blank" rel="noopener">Prashant Varanasi</a> å’Œ <a href="https://github.com/nomis52" target="_blank" rel="noopener">Simon Newton</a> ç¼–å†™ï¼Œç›®çš„æ˜¯ä½¿ä¸€äº›åŒäº‹èƒ½å¿«é€Ÿä½¿ç”¨ Goã€‚å¤šå¹´æ¥ï¼Œè¯¥æŒ‡å—å·²æ ¹æ®å…¶ä»–äººçš„åé¦ˆè¿›è¡Œäº†ä¿®æ”¹ã€‚</p><p>æœ¬æ–‡æ¡£è®°å½•äº†æˆ‘ä»¬åœ¨ Uber éµå¾ªçš„ Go ä»£ç ä¸­çš„æƒ¯ç”¨çº¦å®šã€‚å…¶ä¸­è®¸å¤šæ˜¯ Go çš„é€šç”¨å‡†åˆ™ï¼Œè€Œå…¶ä»–æ‰©å±•å‡†åˆ™ä¾èµ–äºä¸‹é¢å¤–éƒ¨çš„æŒ‡å—ï¼š</p><ol><li><a href="https://golang.org/doc/effective_go.html" target="_blank" rel="noopener">Effective Go</a></li><li><a href="https://github.com/golang/go/wiki/CodeReviewComments" target="_blank" rel="noopener">The Go common mistakes guide</a></li></ol><p>æ‰€æœ‰ä»£ç éƒ½åº”è¯¥é€šè¿‡<code>golint</code>å’Œ<code>go vet</code>çš„æ£€æŸ¥å¹¶æ— é”™è¯¯ã€‚æˆ‘ä»¬å»ºè®®æ‚¨å°†ç¼–è¾‘å™¨è®¾ç½®ä¸ºï¼š</p><ul><li>ä¿å­˜æ—¶è¿è¡Œ <code>goimports</code></li><li>è¿è¡Œ <code>golint</code> å’Œ <code>go vet</code> æ£€æŸ¥é”™è¯¯</li></ul><p>æ‚¨å¯ä»¥åœ¨ä»¥ä¸‹ Go ç¼–è¾‘å™¨å·¥å…·æ”¯æŒé¡µé¢ä¸­æ‰¾åˆ°æ›´ä¸ºè¯¦ç»†çš„ä¿¡æ¯ï¼š<br><a href="https://github.com/golang/go/wiki/IDEsAndTextEditorPlugins" target="_blank" rel="noopener">https://github.com/golang/go/wiki/IDEsAndTextEditorPlugins</a></p><h2 id="æŒ‡å¯¼åŸåˆ™"><a href="#æŒ‡å¯¼åŸåˆ™" class="headerlink" title="æŒ‡å¯¼åŸåˆ™"></a>æŒ‡å¯¼åŸåˆ™</h2><h3 id="æŒ‡å‘-interface-çš„æŒ‡é’ˆ"><a href="#æŒ‡å‘-interface-çš„æŒ‡é’ˆ" class="headerlink" title="æŒ‡å‘ interface çš„æŒ‡é’ˆ"></a>æŒ‡å‘ interface çš„æŒ‡é’ˆ</h3><p>æ‚¨å‡ ä¹ä¸éœ€è¦æŒ‡å‘æ¥å£ç±»å‹çš„æŒ‡é’ˆã€‚æ‚¨åº”è¯¥å°†æ¥å£ä½œä¸ºå€¼è¿›è¡Œä¼ é€’ï¼Œåœ¨è¿™æ ·çš„ä¼ é€’è¿‡ç¨‹ä¸­ï¼Œå®è´¨ä¸Šä¼ é€’çš„åº•å±‚æ•°æ®ä»ç„¶å¯ä»¥æ˜¯æŒ‡é’ˆã€‚</p><p>æ¥å£å®è´¨ä¸Šåœ¨åº•å±‚ç”¨ä¸¤ä¸ªå­—æ®µè¡¨ç¤ºï¼š</p><ol><li>ä¸€ä¸ªæŒ‡å‘æŸäº›ç‰¹å®šç±»å‹ä¿¡æ¯çš„æŒ‡é’ˆã€‚æ‚¨å¯ä»¥å°†å…¶è§†ä¸ºâ€typeâ€ã€‚</li><li>æ•°æ®æŒ‡é’ˆã€‚å¦‚æœå­˜å‚¨çš„æ•°æ®æ˜¯æŒ‡é’ˆï¼Œåˆ™ç›´æ¥å­˜å‚¨ã€‚å¦‚æœå­˜å‚¨çš„æ•°æ®æ˜¯ä¸€ä¸ªå€¼ï¼Œåˆ™å­˜å‚¨æŒ‡å‘è¯¥å€¼çš„æŒ‡é’ˆã€‚</li></ol><p>å¦‚æœå¸Œæœ›æ¥å£æ–¹æ³•ä¿®æ”¹åŸºç¡€æ•°æ®ï¼Œåˆ™å¿…é¡»ä½¿ç”¨æŒ‡é’ˆä¼ é€’ã€‚</p><h3 id="æ¥æ”¶å™¨-receiver-ä¸æ¥å£"><a href="#æ¥æ”¶å™¨-receiver-ä¸æ¥å£" class="headerlink" title="æ¥æ”¶å™¨ (receiver) ä¸æ¥å£"></a>æ¥æ”¶å™¨ (receiver) ä¸æ¥å£</h3><p>ä½¿ç”¨å€¼æ¥æ”¶å™¨çš„æ–¹æ³•æ—¢å¯ä»¥é€šè¿‡å€¼è°ƒç”¨ï¼Œä¹Ÿå¯ä»¥é€šè¿‡æŒ‡é’ˆè°ƒç”¨ã€‚</p><p>ä¾‹å¦‚ï¼Œ</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> S <span class="keyword">struct</span> &#123;</span><br><span class="line">  data <span class="keyword">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s S)</span> <span class="title">Read</span><span class="params">()</span> <span class="title">string</span></span> &#123;</span><br><span class="line">  <span class="keyword">return</span> s.data</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s *S)</span> <span class="title">Write</span><span class="params">(str <span class="keyword">string</span>)</span></span> &#123;</span><br><span class="line">  s.data = str</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">sVals := <span class="keyword">map</span>[<span class="keyword">int</span>]S&#123;<span class="number">1</span>: &#123;<span class="string">"A"</span>&#125;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä½ åªèƒ½é€šè¿‡å€¼è°ƒç”¨ Read</span></span><br><span class="line">sVals[<span class="number">1</span>].Read()</span><br><span class="line"></span><br><span class="line"><span class="comment">// è¿™ä¸èƒ½ç¼–è¯‘é€šè¿‡ï¼š</span></span><br><span class="line"><span class="comment">//  sVals[1].Write("test")</span></span><br><span class="line"></span><br><span class="line">sPtrs := <span class="keyword">map</span>[<span class="keyword">int</span>]*S&#123;<span class="number">1</span>: &#123;<span class="string">"A"</span>&#125;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// é€šè¿‡æŒ‡é’ˆæ—¢å¯ä»¥è°ƒç”¨ Readï¼Œä¹Ÿå¯ä»¥è°ƒç”¨ Write æ–¹æ³•</span></span><br><span class="line">sPtrs[<span class="number">1</span>].Read()</span><br><span class="line">sPtrs[<span class="number">1</span>].Write(<span class="string">"test"</span>)</span><br></pre></td></tr></table></figure><p>åŒæ ·ï¼Œå³ä½¿è¯¥æ–¹æ³•å…·æœ‰å€¼æ¥æ”¶å™¨ï¼Œä¹Ÿå¯ä»¥é€šè¿‡æŒ‡é’ˆæ¥æ»¡è¶³æ¥å£ã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> F <span class="keyword">interface</span> &#123;</span><br><span class="line">  f()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> S1 <span class="keyword">struct</span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s S1)</span> <span class="title">f</span><span class="params">()</span></span> &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> S2 <span class="keyword">struct</span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s *S2)</span> <span class="title">f</span><span class="params">()</span></span> &#123;&#125;</span><br><span class="line"></span><br><span class="line">s1Val := S1&#123;&#125;</span><br><span class="line">s1Ptr := &amp;S1&#123;&#125;</span><br><span class="line">s2Val := S2&#123;&#125;</span><br><span class="line">s2Ptr := &amp;S2&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> i F</span><br><span class="line">i = s1Val</span><br><span class="line">i = s1Ptr</span><br><span class="line">i = s2Ptr</span><br><span class="line"></span><br><span class="line"><span class="comment">//  ä¸‹é¢ä»£ç æ— æ³•é€šè¿‡ç¼–è¯‘ã€‚å› ä¸º s2Val æ˜¯ä¸€ä¸ªå€¼ï¼Œè€Œ S2 çš„ f æ–¹æ³•ä¸­æ²¡æœ‰ä½¿ç”¨å€¼æ¥æ”¶å™¨</span></span><br><span class="line"><span class="comment">//   i = s2Val</span></span><br></pre></td></tr></table></figure><p><a href="https://golang.org/doc/effective_go.html" target="_blank" rel="noopener">Effective Go</a> ä¸­æœ‰ä¸€æ®µå…³äº <a href="https://golang.org/doc/effective_go.html#pointers_vs_values" target="_blank" rel="noopener">pointers vs. values</a> çš„ç²¾å½©è®²è§£ã€‚</p><h3 id="é›¶å€¼-Mutex-æ˜¯æœ‰æ•ˆçš„"><a href="#é›¶å€¼-Mutex-æ˜¯æœ‰æ•ˆçš„" class="headerlink" title="é›¶å€¼ Mutex æ˜¯æœ‰æ•ˆçš„"></a>é›¶å€¼ Mutex æ˜¯æœ‰æ•ˆçš„</h3><p>é›¶å€¼ <code>sync.Mutex</code> å’Œ <code>sync.RWMutex</code> æ˜¯æœ‰æ•ˆçš„ã€‚æ‰€ä»¥æŒ‡å‘ mutex çš„æŒ‡é’ˆåŸºæœ¬æ˜¯ä¸å¿…è¦çš„ã€‚</p><table><thead><tr><th>Bad</th><th>Good</th></tr></thead><tbody><tr><td><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mu := <span class="built_in">new</span>(sync.Mutex)</span><br><span class="line">mu.Lock()</span><br></pre></td></tr></table></figure></td><td><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> mu sync.Mutex</span><br><span class="line">mu.Lock()</span><br></pre></td></tr></table></figure></td></tr></tbody></table><p>å¦‚æœä½ ä½¿ç”¨ç»“æ„ä½“æŒ‡é’ˆï¼Œmutex å¯ä»¥éæŒ‡é’ˆå½¢å¼ä½œä¸ºç»“æ„ä½“çš„ç»„æˆå­—æ®µï¼Œæˆ–è€…æ›´å¥½çš„æ–¹å¼æ˜¯ç›´æ¥åµŒå…¥åˆ°ç»“æ„ä½“ä¸­ã€‚<br>å¦‚æœæ˜¯ç§æœ‰ç»“æ„ä½“ç±»å‹æˆ–æ˜¯è¦å®ç° Mutex æ¥å£çš„ç±»å‹ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨åµŒå…¥ mutex çš„æ–¹æ³•ï¼š</p><table><tbody><tr><td><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> smap <span class="keyword">struct</span> &#123;</span><br><span class="line">  sync.Mutex <span class="comment">// only for unexported typesï¼ˆä»…é€‚ç”¨äºéå¯¼å‡ºç±»å‹ï¼‰</span></span><br><span class="line"></span><br><span class="line">  data <span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">newSMap</span><span class="params">()</span> *<span class="title">smap</span></span> &#123;</span><br><span class="line">  <span class="keyword">return</span> &amp;smap&#123;</span><br><span class="line">    data: <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">string</span>),</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(m *smap)</span> <span class="title">Get</span><span class="params">(k <span class="keyword">string</span>)</span> <span class="title">string</span></span> &#123;</span><br><span class="line">  m.Lock()</span><br><span class="line">  <span class="keyword">defer</span> m.Unlock()</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> m.data[k]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></td><td><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> SMap <span class="keyword">struct</span> &#123;</span><br><span class="line">  mu sync.Mutex <span class="comment">// å¯¹äºå¯¼å‡ºç±»å‹ï¼Œè¯·ä½¿ç”¨ç§æœ‰é”</span></span><br><span class="line"></span><br><span class="line">  data <span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewSMap</span><span class="params">()</span> *<span class="title">SMap</span></span> &#123;</span><br><span class="line">  <span class="keyword">return</span> &amp;SMap&#123;</span><br><span class="line">    data: <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">string</span>),</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(m *SMap)</span> <span class="title">Get</span><span class="params">(k <span class="keyword">string</span>)</span> <span class="title">string</span></span> &#123;</span><br><span class="line">  m.mu.Lock()</span><br><span class="line">  <span class="keyword">defer</span> m.mu.Unlock()</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> m.data[k]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></td></tr><tr><td>ä¸ºç§æœ‰ç±»å‹æˆ–éœ€è¦å®ç°äº’æ–¥æ¥å£çš„ç±»å‹åµŒå…¥ã€‚</td><td>å¯¹äºå¯¼å‡ºçš„ç±»å‹ï¼Œè¯·ä½¿ç”¨ä¸“ç”¨å­—æ®µã€‚</td></tr></tbody></table><h3 id="åœ¨è¾¹ç•Œå¤„æ‹·è´-Slices-å’Œ-Maps"><a href="#åœ¨è¾¹ç•Œå¤„æ‹·è´-Slices-å’Œ-Maps" class="headerlink" title="åœ¨è¾¹ç•Œå¤„æ‹·è´ Slices å’Œ Maps"></a>åœ¨è¾¹ç•Œå¤„æ‹·è´ Slices å’Œ Maps</h3><p>slices å’Œ maps åŒ…å«äº†æŒ‡å‘åº•å±‚æ•°æ®çš„æŒ‡é’ˆï¼Œå› æ­¤åœ¨éœ€è¦å¤åˆ¶å®ƒä»¬æ—¶è¦ç‰¹åˆ«æ³¨æ„ã€‚</p><h4 id="æ¥æ”¶-Slices-å’Œ-Maps"><a href="#æ¥æ”¶-Slices-å’Œ-Maps" class="headerlink" title="æ¥æ”¶ Slices å’Œ Maps"></a>æ¥æ”¶ Slices å’Œ Maps</h4><p>è¯·è®°ä½ï¼Œå½“ map æˆ– slice ä½œä¸ºå‡½æ•°å‚æ•°ä¼ å…¥æ—¶ï¼Œå¦‚æœæ‚¨å­˜å‚¨äº†å¯¹å®ƒä»¬çš„å¼•ç”¨ï¼Œåˆ™ç”¨æˆ·å¯ä»¥å¯¹å…¶è¿›è¡Œä¿®æ”¹ã€‚</p><table><thead><tr><th>Bad</th> <th>Good</th></tr></thead><tbody><tr><td><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(d *Driver)</span> <span class="title">SetTrips</span><span class="params">(trips []Trip)</span></span> &#123;</span><br><span class="line">  d.trips = trips</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">trips := ...</span><br><span class="line">d1.SetTrips(trips)</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä½ æ˜¯è¦ä¿®æ”¹ d1.trips å—ï¼Ÿ</span></span><br><span class="line">trips[<span class="number">0</span>] = ...</span><br></pre></td></tr></table></figure></td><td><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(d *Driver)</span> <span class="title">SetTrips</span><span class="params">(trips []Trip)</span></span> &#123;</span><br><span class="line">  d.trips = <span class="built_in">make</span>([]Trip, <span class="built_in">len</span>(trips))</span><br><span class="line">  <span class="built_in">copy</span>(d.trips, trips)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">trips := ...</span><br><span class="line">d1.SetTrips(trips)</span><br><span class="line"></span><br><span class="line"><span class="comment">// è¿™é‡Œæˆ‘ä»¬ä¿®æ”¹ trips[0]ï¼Œä½†ä¸ä¼šå½±å“åˆ° d1.trips</span></span><br><span class="line">trips[<span class="number">0</span>] = ...</span><br></pre></td></tr></table></figure></td></tr></tbody></table><h4 id="è¿”å›-slices-æˆ–-maps"><a href="#è¿”å›-slices-æˆ–-maps" class="headerlink" title="è¿”å› slices æˆ– maps"></a>è¿”å› slices æˆ– maps</h4><p>åŒæ ·ï¼Œè¯·æ³¨æ„ç”¨æˆ·å¯¹æš´éœ²å†…éƒ¨çŠ¶æ€çš„ map æˆ– slice çš„ä¿®æ”¹ã€‚</p><table><thead><tr><th>Bad</th><th>Good</th></tr></thead><tbody><tr><td><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Stats <span class="keyword">struct</span> &#123;</span><br><span class="line">  mu sync.Mutex</span><br><span class="line"></span><br><span class="line">  counters <span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Snapshot è¿”å›å½“å‰çŠ¶æ€ã€‚</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s *Stats)</span> <span class="title">Snapshot</span><span class="params">()</span> <span class="title">map</span>[<span class="title">string</span>]<span class="title">int</span></span> &#123;</span><br><span class="line">  s.mu.Lock()</span><br><span class="line">  <span class="keyword">defer</span> s.mu.Unlock()</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> s.counters</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// snapshot ä¸å†å—äº’æ–¥é”ä¿æŠ¤</span></span><br><span class="line"><span class="comment">// å› æ­¤å¯¹ snapshot çš„ä»»ä½•è®¿é—®éƒ½å°†å—åˆ°æ•°æ®ç«äº‰çš„å½±å“</span></span><br><span class="line"><span class="comment">// å½±å“ stats.counters</span></span><br><span class="line">snapshot := stats.Snapshot()</span><br></pre></td></tr></table></figure></td><td><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Stats <span class="keyword">struct</span> &#123;</span><br><span class="line">  mu sync.Mutex</span><br><span class="line"></span><br><span class="line">  counters <span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s *Stats)</span> <span class="title">Snapshot</span><span class="params">()</span> <span class="title">map</span>[<span class="title">string</span>]<span class="title">int</span></span> &#123;</span><br><span class="line">  s.mu.Lock()</span><br><span class="line">  <span class="keyword">defer</span> s.mu.Unlock()</span><br><span class="line"></span><br><span class="line">  result := <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">int</span>, <span class="built_in">len</span>(s.counters))</span><br><span class="line">  <span class="keyword">for</span> k, v := <span class="keyword">range</span> s.counters &#123;</span><br><span class="line">    result[k] = v</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// snapshot ç°åœ¨æ˜¯ä¸€ä¸ªæ‹·è´</span></span><br><span class="line">snapshot := stats.Snapshot()</span><br></pre></td></tr></table></figure></td></tr></tbody></table><h3 id="ä½¿ç”¨-defer-é‡Šæ”¾èµ„æº"><a href="#ä½¿ç”¨-defer-é‡Šæ”¾èµ„æº" class="headerlink" title="ä½¿ç”¨ defer é‡Šæ”¾èµ„æº"></a>ä½¿ç”¨ defer é‡Šæ”¾èµ„æº</h3><p>ä½¿ç”¨ defer é‡Šæ”¾èµ„æºï¼Œè¯¸å¦‚æ–‡ä»¶å’Œé”ã€‚</p><table><thead><tr><th>Bad</th><th>Good</th></tr></thead><tbody><tr><td><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">p.Lock()</span><br><span class="line"><span class="keyword">if</span> p.count &lt; <span class="number">10</span> &#123;</span><br><span class="line">  p.Unlock()</span><br><span class="line">  <span class="keyword">return</span> p.count</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">p.count++</span><br><span class="line">newCount := p.count</span><br><span class="line">p.Unlock()</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> newCount</span><br><span class="line"></span><br><span class="line"><span class="comment">// å½“æœ‰å¤šä¸ª return åˆ†æ”¯æ—¶ï¼Œå¾ˆå®¹æ˜“é—å¿˜ unlock</span></span><br></pre></td></tr></table></figure></td><td><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">p.Lock()</span><br><span class="line"><span class="keyword">defer</span> p.Unlock()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> p.count &lt; <span class="number">10</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> p.count</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">p.count++</span><br><span class="line"><span class="keyword">return</span> p.count</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ›´å¯è¯»</span></span><br></pre></td></tr></table></figure></td></tr></tbody></table><p>Defer çš„å¼€é”€éå¸¸å°ï¼Œåªæœ‰åœ¨æ‚¨å¯ä»¥è¯æ˜å‡½æ•°æ‰§è¡Œæ—¶é—´å¤„äºçº³ç§’çº§çš„ç¨‹åº¦æ—¶ï¼Œæ‰åº”é¿å…è¿™æ ·åšã€‚ä½¿ç”¨ defer æå‡å¯è¯»æ€§æ˜¯å€¼å¾—çš„ï¼Œå› ä¸ºä½¿ç”¨å®ƒä»¬çš„æˆæœ¬å¾®ä¸è¶³é“ã€‚å°¤å…¶é€‚ç”¨äºé‚£äº›ä¸ä»…ä»…æ˜¯ç®€å•å†…å­˜è®¿é—®çš„è¾ƒå¤§çš„æ–¹æ³•ï¼Œåœ¨è¿™äº›æ–¹æ³•ä¸­å…¶ä»–è®¡ç®—çš„èµ„æºæ¶ˆè€—è¿œè¶…è¿‡ <code>defer</code>ã€‚</p><h3 id="Channel-çš„-size-è¦ä¹ˆæ˜¯-1ï¼Œè¦ä¹ˆæ˜¯æ— ç¼“å†²çš„"><a href="#Channel-çš„-size-è¦ä¹ˆæ˜¯-1ï¼Œè¦ä¹ˆæ˜¯æ— ç¼“å†²çš„" class="headerlink" title="Channel çš„ size è¦ä¹ˆæ˜¯ 1ï¼Œè¦ä¹ˆæ˜¯æ— ç¼“å†²çš„"></a>Channel çš„ size è¦ä¹ˆæ˜¯ 1ï¼Œè¦ä¹ˆæ˜¯æ— ç¼“å†²çš„</h3><p>channel é€šå¸¸ size åº”ä¸º 1 æˆ–æ˜¯æ— ç¼“å†²çš„ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œchannel æ˜¯æ— ç¼“å†²çš„ï¼Œå…¶ size ä¸ºé›¶ã€‚ä»»ä½•å…¶ä»–å°ºå¯¸éƒ½å¿…é¡»ç»è¿‡ä¸¥æ ¼çš„å®¡æŸ¥ã€‚è€ƒè™‘å¦‚ä½•ç¡®å®šå¤§å°ï¼Œæ˜¯ä»€ä¹ˆé˜»æ­¢äº† channel åœ¨è´Ÿè½½ä¸‹è¢«å¡«æ»¡å¹¶é˜»æ­¢å†™å…¥ï¼Œä»¥åŠå‘ç”Ÿè¿™ç§æƒ…å†µæ—¶å‘ç”Ÿäº†ä»€ä¹ˆã€‚</p><table><thead><tr><th>Bad</th><th>Good</th></tr></thead><tbody><tr><td><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åº”è¯¥è¶³ä»¥æ»¡è¶³ä»»ä½•æƒ…å†µï¼</span></span><br><span class="line">c := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">int</span>, <span class="number">64</span>)</span><br></pre></td></tr></table></figure></td><td><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å¤§å°ï¼š1</span></span><br><span class="line">c := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">int</span>, <span class="number">1</span>) <span class="comment">// æˆ–è€…</span></span><br><span class="line"><span class="comment">// æ— ç¼“å†² channelï¼Œå¤§å°ä¸º 0</span></span><br><span class="line">c := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">int</span>)</span><br></pre></td></tr></table></figure></td></tr></tbody></table><h3 id="æšä¸¾ä»-1-å¼€å§‹"><a href="#æšä¸¾ä»-1-å¼€å§‹" class="headerlink" title="æšä¸¾ä» 1 å¼€å§‹"></a>æšä¸¾ä» 1 å¼€å§‹</h3><p>åœ¨ Go ä¸­å¼•å…¥æšä¸¾çš„æ ‡å‡†æ–¹æ³•æ˜¯å£°æ˜ä¸€ä¸ªè‡ªå®šä¹‰ç±»å‹å’Œä¸€ä¸ªä½¿ç”¨äº† iota çš„ const ç»„ã€‚ç”±äºå˜é‡çš„é»˜è®¤å€¼ä¸º 0ï¼Œå› æ­¤é€šå¸¸åº”ä»¥éé›¶å€¼å¼€å¤´æšä¸¾ã€‚</p><table><thead><tr><th>Bad</th><th>Good</th></tr></thead><tbody><tr><td><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Operation <span class="keyword">int</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> (</span><br><span class="line">  Add Operation = <span class="literal">iota</span></span><br><span class="line">  Subtract</span><br><span class="line">  Multiply</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// Add=0, Subtract=1, Multiply=2</span></span><br></pre></td></tr></table></figure></td><td><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Operation <span class="keyword">int</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> (</span><br><span class="line">  Add Operation = <span class="literal">iota</span> + <span class="number">1</span></span><br><span class="line">  Subtract</span><br><span class="line">  Multiply</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// Add=1, Subtract=2, Multiply=3</span></span><br></pre></td></tr></table></figure></td></tr></tbody></table><p>åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œä½¿ç”¨é›¶å€¼æ˜¯æœ‰æ„ä¹‰çš„ï¼ˆæšä¸¾ä»é›¶å¼€å§‹ï¼‰ï¼Œä¾‹å¦‚ï¼Œå½“é›¶å€¼æ˜¯ç†æƒ³çš„é»˜è®¤è¡Œä¸ºæ—¶ã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> LogOutput <span class="keyword">int</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> (</span><br><span class="line">  LogToStdout LogOutput = <span class="literal">iota</span></span><br><span class="line">  LogToFile</span><br><span class="line">  LogToRemote</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// LogToStdout=0, LogToFile=1, LogToRemote=2</span></span><br></pre></td></tr></table></figure><!-- TODO: section on String methods for enums --><h3 id="é”™è¯¯ç±»å‹"><a href="#é”™è¯¯ç±»å‹" class="headerlink" title="é”™è¯¯ç±»å‹"></a>é”™è¯¯ç±»å‹</h3><p>Go ä¸­æœ‰å¤šç§å£°æ˜é”™è¯¯ï¼ˆError) çš„é€‰é¡¹ï¼š</p><ul><li><a href="https://golang.org/pkg/errors/#New" target="_blank" rel="noopener"><code>errors.New</code></a> å¯¹äºç®€å•é™æ€å­—ç¬¦ä¸²çš„é”™è¯¯</li><li><a href="https://golang.org/pkg/fmt/#Errorf" target="_blank" rel="noopener"><code>fmt.Errorf</code></a> ç”¨äºæ ¼å¼åŒ–çš„é”™è¯¯å­—ç¬¦ä¸²</li><li>å®ç° <code>Error()</code> æ–¹æ³•çš„è‡ªå®šä¹‰ç±»å‹</li><li>ç”¨ <a href="https://godoc.org/github.com/pkg/errors#Wrap" target="_blank" rel="noopener"><code>&quot;pkg/errors&quot;.Wrap</code></a> çš„ Wrapped errors</li></ul><p>è¿”å›é”™è¯¯æ—¶ï¼Œè¯·è€ƒè™‘ä»¥ä¸‹å› ç´ ä»¥ç¡®å®šæœ€ä½³é€‰æ‹©ï¼š</p><ul><li>è¿™æ˜¯ä¸€ä¸ªä¸éœ€è¦é¢å¤–ä¿¡æ¯çš„ç®€å•é”™è¯¯å—ï¼Ÿå¦‚æœæ˜¯è¿™æ ·ï¼Œ<a href="https://golang.org/pkg/errors/#New" target="_blank" rel="noopener"><code>errors.New</code></a> è¶³å¤Ÿäº†ã€‚</li><li>å®¢æˆ·éœ€è¦æ£€æµ‹å¹¶å¤„ç†æ­¤é”™è¯¯å—ï¼Ÿå¦‚æœæ˜¯è¿™æ ·ï¼Œåˆ™åº”ä½¿ç”¨è‡ªå®šä¹‰ç±»å‹å¹¶å®ç°è¯¥ <code>Error()</code> æ–¹æ³•ã€‚</li><li>æ‚¨æ˜¯å¦æ­£åœ¨ä¼ æ’­ä¸‹æ¸¸å‡½æ•°è¿”å›çš„é”™è¯¯ï¼Ÿå¦‚æœæ˜¯è¿™æ ·ï¼Œè¯·æŸ¥çœ‹æœ¬æ–‡åé¢æœ‰å…³é”™è¯¯åŒ…è£… <a href="#é”™è¯¯åŒ…è£…" title="Error-Wrapping">section on error wrapping</a> éƒ¨åˆ†çš„å†…å®¹ã€‚</li><li>å¦åˆ™ <a href="https://golang.org/pkg/fmt/#Errorf" target="_blank" rel="noopener"><code>fmt.Errorf</code></a> å°±å¯ä»¥äº†ã€‚</li></ul><p>å¦‚æœå®¢æˆ·ç«¯éœ€è¦æ£€æµ‹é”™è¯¯ï¼Œå¹¶ä¸”æ‚¨å·²ä½¿ç”¨åˆ›å»ºäº†ä¸€ä¸ªç®€å•çš„é”™è¯¯ <a href="https://golang.org/pkg/errors/#New" target="_blank" rel="noopener"><code>errors.New</code></a>ï¼Œè¯·ä½¿ç”¨ä¸€ä¸ªé”™è¯¯å˜é‡ã€‚</p><table><thead><tr><th>Bad</th><th>Good</th></tr></thead><tbody><tr><td><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// package foo</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Open</span><span class="params">()</span> <span class="title">error</span></span> &#123;</span><br><span class="line">  <span class="keyword">return</span> errors.New(<span class="string">"could not open"</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// package bar</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">use</span><span class="params">()</span></span> &#123;</span><br><span class="line">  <span class="keyword">if</span> err := foo.Open(); err != <span class="literal">nil</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> err.Error() == <span class="string">"could not open"</span> &#123;</span><br><span class="line">      <span class="comment">// handle</span></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="built_in">panic</span>(<span class="string">"unknown error"</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></td><td><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// package foo</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> ErrCouldNotOpen = errors.New(<span class="string">"could not open"</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Open</span><span class="params">()</span> <span class="title">error</span></span> &#123;</span><br><span class="line">  <span class="keyword">return</span> ErrCouldNotOpen</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// package bar</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> err := foo.Open(); err != <span class="literal">nil</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> err == foo.ErrCouldNotOpen &#123;</span><br><span class="line">    <span class="comment">// handle</span></span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="built_in">panic</span>(<span class="string">"unknown error"</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></td></tr></tbody></table><p>å¦‚æœæ‚¨æœ‰å¯èƒ½éœ€è¦å®¢æˆ·ç«¯æ£€æµ‹çš„é”™è¯¯ï¼Œå¹¶ä¸”æƒ³å‘å…¶ä¸­æ·»åŠ æ›´å¤šä¿¡æ¯ï¼ˆä¾‹å¦‚ï¼Œå®ƒä¸æ˜¯é™æ€å­—ç¬¦ä¸²ï¼‰ï¼Œåˆ™åº”ä½¿ç”¨è‡ªå®šä¹‰ç±»å‹ã€‚</p><table><thead><tr><th>Bad</th><th>Good</th></tr></thead><tbody><tr><td><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">open</span><span class="params">(file <span class="keyword">string</span>)</span> <span class="title">error</span></span> &#123;</span><br><span class="line">  <span class="keyword">return</span> fmt.Errorf(<span class="string">"file %q not found"</span>, file)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">use</span><span class="params">()</span></span> &#123;</span><br><span class="line">  <span class="keyword">if</span> err := open(); err != <span class="literal">nil</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> strings.Contains(err.Error(), <span class="string">"not found"</span>) &#123;</span><br><span class="line">      <span class="comment">// handle</span></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="built_in">panic</span>(<span class="string">"unknown error"</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></td><td><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> errNotFound <span class="keyword">struct</span> &#123;</span><br><span class="line">  file <span class="keyword">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(e errNotFound)</span> <span class="title">Error</span><span class="params">()</span> <span class="title">string</span></span> &#123;</span><br><span class="line">  <span class="keyword">return</span> fmt.Sprintf(<span class="string">"file %q not found"</span>, e.file)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">open</span><span class="params">(file <span class="keyword">string</span>)</span> <span class="title">error</span></span> &#123;</span><br><span class="line">  <span class="keyword">return</span> errNotFound&#123;file: file&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">use</span><span class="params">()</span></span> &#123;</span><br><span class="line">  <span class="keyword">if</span> err := open(); err != <span class="literal">nil</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> _, ok := err.(errNotFound); ok &#123;</span><br><span class="line">      <span class="comment">// handle</span></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="built_in">panic</span>(<span class="string">"unknown error"</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></td></tr></tbody></table><p>ç›´æ¥å¯¼å‡ºè‡ªå®šä¹‰é”™è¯¯ç±»å‹æ—¶è¦å°å¿ƒï¼Œå› ä¸ºå®ƒä»¬å·²æˆä¸ºç¨‹åºåŒ…å…¬å…± API çš„ä¸€éƒ¨åˆ†ã€‚æœ€å¥½å…¬å¼€åŒ¹é…å™¨åŠŸèƒ½ä»¥æ£€æŸ¥é”™è¯¯ã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// package foo</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> errNotFound <span class="keyword">struct</span> &#123;</span><br><span class="line">  file <span class="keyword">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(e errNotFound)</span> <span class="title">Error</span><span class="params">()</span> <span class="title">string</span></span> &#123;</span><br><span class="line">  <span class="keyword">return</span> fmt.Sprintf(<span class="string">"file %q not found"</span>, e.file)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">IsNotFoundError</span><span class="params">(err error)</span> <span class="title">bool</span></span> &#123;</span><br><span class="line">  _, ok := err.(errNotFound)</span><br><span class="line">  <span class="keyword">return</span> ok</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Open</span><span class="params">(file <span class="keyword">string</span>)</span> <span class="title">error</span></span> &#123;</span><br><span class="line">  <span class="keyword">return</span> errNotFound&#123;file: file&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// package bar</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> err := foo.Open(<span class="string">"foo"</span>); err != <span class="literal">nil</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> foo.IsNotFoundError(err) &#123;</span><br><span class="line">    <span class="comment">// handle</span></span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="built_in">panic</span>(<span class="string">"unknown error"</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><!-- TODO: Exposing the information to callers with accessor functions. --><h3 id="é”™è¯¯åŒ…è£…-Error-Wrapping"><a href="#é”™è¯¯åŒ…è£…-Error-Wrapping" class="headerlink" title="é”™è¯¯åŒ…è£… (Error Wrapping)"></a>é”™è¯¯åŒ…è£… (Error Wrapping)</h3><p>ä¸€ä¸ªï¼ˆå‡½æ•°/æ–¹æ³•ï¼‰è°ƒç”¨å¤±è´¥æ—¶ï¼Œæœ‰ä¸‰ç§ä¸»è¦çš„é”™è¯¯ä¼ æ’­æ–¹å¼ï¼š</p><ul><li><p>å¦‚æœæ²¡æœ‰è¦æ·»åŠ çš„å…¶ä»–ä¸Šä¸‹æ–‡ï¼Œå¹¶ä¸”æ‚¨æƒ³è¦ç»´æŠ¤åŸå§‹é”™è¯¯ç±»å‹ï¼Œåˆ™è¿”å›åŸå§‹é”™è¯¯ã€‚</p></li><li><p>æ·»åŠ ä¸Šä¸‹æ–‡ï¼Œä½¿ç”¨ <a href="https://godoc.org/github.com/pkg/errors#Wrap" target="_blank" rel="noopener"><code>&quot;pkg/errors&quot;.Wrap</code></a> ä»¥ä¾¿é”™è¯¯æ¶ˆæ¯æä¾›æ›´å¤šä¸Šä¸‹æ–‡ ,<a href="https://godoc.org/github.com/pkg/errors#Cause" target="_blank" rel="noopener"><code>&quot;pkg/errors&quot;.Cause</code></a> å¯ç”¨äºæå–åŸå§‹é”™è¯¯ã€‚<br>Use fmt.Errorf if the callers do not need to detect or handle that specific error case.</p></li><li><p>å¦‚æœè°ƒç”¨è€…ä¸éœ€è¦æ£€æµ‹æˆ–å¤„ç†çš„ç‰¹å®šé”™è¯¯æƒ…å†µï¼Œä½¿ç”¨ <a href="https://golang.org/pkg/fmt/#Errorf" target="_blank" rel="noopener"><code>fmt.Errorf</code></a>ã€‚</p></li></ul><p>å»ºè®®åœ¨å¯èƒ½çš„åœ°æ–¹æ·»åŠ ä¸Šä¸‹æ–‡ï¼Œä»¥ä½¿æ‚¨è·å¾—è¯¸å¦‚â€œè°ƒç”¨æœåŠ¡ fooï¼šè¿æ¥è¢«æ‹’ç»â€ä¹‹ç±»çš„æ›´æœ‰ç”¨çš„é”™è¯¯ï¼Œè€Œä¸æ˜¯è¯¸å¦‚â€œè¿æ¥è¢«æ‹’ç»â€ä¹‹ç±»çš„æ¨¡ç³Šé”™è¯¯ã€‚</p><p>åœ¨å°†ä¸Šä¸‹æ–‡æ·»åŠ åˆ°è¿”å›çš„é”™è¯¯æ—¶ï¼Œè¯·é¿å…ä½¿ç”¨â€œfailed toâ€ä¹‹ç±»çš„çŸ­è¯­æ¥ä¿æŒä¸Šä¸‹æ–‡ç®€æ´ï¼Œè¿™äº›çŸ­è¯­ä¼šé™ˆè¿°æ˜æ˜¾çš„å†…å®¹ï¼Œå¹¶éšç€é”™è¯¯åœ¨å †æ ˆä¸­çš„æ¸—é€è€Œé€æ¸å †ç§¯ï¼š</p><table><thead><tr><th>Bad</th><th>Good</th></tr></thead><tbody><tr><td><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">s, err := store.New()</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> fmt.Errorf(</span><br><span class="line">        <span class="string">"failed to create new store: %s"</span>, err)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></td><td><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">s, err := store.New()</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> fmt.Errorf(</span><br><span class="line">        <span class="string">"new store: %s"</span>, err)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></td></tr><tr><td><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">failed to x: failed to y: failed to create new store: the error</span><br></pre></td></tr></table></figure></td><td><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">x: y: new store: the error</span><br></pre></td></tr></table></figure></td></tr></tbody></table><p>ä½†æ˜¯ï¼Œä¸€æ—¦å°†é”™è¯¯å‘é€åˆ°å¦ä¸€ä¸ªç³»ç»Ÿï¼Œå°±åº”è¯¥æ˜ç¡®æ¶ˆæ¯æ˜¯é”™è¯¯æ¶ˆæ¯ï¼ˆä¾‹å¦‚ä½¿ç”¨<code>err</code>æ ‡è®°ï¼Œæˆ–åœ¨æ—¥å¿—ä¸­ä»¥â€Failedâ€ä¸ºå‰ç¼€ï¼‰ã€‚</p><p>å¦è¯·å‚è§ <a href="https://dave.cheney.net/2016/04/27/dont-just-check-errors-handle-them-gracefully" target="_blank" rel="noopener">Donâ€™t just check errors, handle them gracefully</a>. ä¸è¦åªæ˜¯æ£€æŸ¥é”™è¯¯ï¼Œè¦ä¼˜é›…åœ°å¤„ç†é”™è¯¯</p><h3 id="å¤„ç†ç±»å‹æ–­è¨€å¤±è´¥"><a href="#å¤„ç†ç±»å‹æ–­è¨€å¤±è´¥" class="headerlink" title="å¤„ç†ç±»å‹æ–­è¨€å¤±è´¥"></a>å¤„ç†ç±»å‹æ–­è¨€å¤±è´¥</h3><p><a href="https://golang.org/ref/spec#Type_assertions" target="_blank" rel="noopener">type assertion</a> çš„å•ä¸ªè¿”å›å€¼å½¢å¼é’ˆå¯¹ä¸æ­£ç¡®çš„ç±»å‹å°†äº§ç”Ÿ panicã€‚å› æ­¤ï¼Œè¯·å§‹ç»ˆä½¿ç”¨â€œcomma okâ€çš„æƒ¯ç”¨æ³•ã€‚</p><table><thead><tr><th>Bad</th><th>Good</th></tr></thead><tbody><tr><td><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">t := i.(<span class="keyword">string</span>)</span><br></pre></td></tr></table></figure></td><td><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">t, ok := i.(<span class="keyword">string</span>)</span><br><span class="line"><span class="keyword">if</span> !ok &#123;</span><br><span class="line">  <span class="comment">// ä¼˜é›…åœ°å¤„ç†é”™è¯¯</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></td></tr></tbody></table><!-- TODO: There are a few situations where the single assignment form isfine. --><h3 id="ä¸è¦-panic"><a href="#ä¸è¦-panic" class="headerlink" title="ä¸è¦ panic"></a>ä¸è¦ panic</h3><p>åœ¨ç”Ÿäº§ç¯å¢ƒä¸­è¿è¡Œçš„ä»£ç å¿…é¡»é¿å…å‡ºç° panicã€‚panic æ˜¯ <a href="https://en.wikipedia.org/wiki/Cascading_failure" target="_blank" rel="noopener">cascading failures</a> çº§è”å¤±è´¥çš„ä¸»è¦æ ¹æº ã€‚å¦‚æœå‘ç”Ÿé”™è¯¯ï¼Œè¯¥å‡½æ•°å¿…é¡»è¿”å›é”™è¯¯ï¼Œå¹¶å…è®¸è°ƒç”¨æ–¹å†³å®šå¦‚ä½•å¤„ç†å®ƒã€‚</p><table><thead><tr><th>Bad</th><th>Good</th></tr></thead><tbody><tr><td><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">foo</span><span class="params">(bar <span class="keyword">string</span>)</span></span> &#123;</span><br><span class="line">  <span class="keyword">if</span> <span class="built_in">len</span>(bar) == <span class="number">0</span> &#123;</span><br><span class="line">    <span class="built_in">panic</span>(<span class="string">"bar must not be empty"</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">  <span class="keyword">if</span> <span class="built_in">len</span>(os.Args) != <span class="number">2</span> &#123;</span><br><span class="line">    fmt.Println(<span class="string">"USAGE: foo &lt;bar&gt;"</span>)</span><br><span class="line">    os.Exit(<span class="number">1</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  foo(os.Args[<span class="number">1</span>])</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></td><td><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">foo</span><span class="params">(bar <span class="keyword">string</span>)</span> <span class="title">error</span></span> &#123;</span><br><span class="line">  <span class="keyword">if</span> <span class="built_in">len</span>(bar) == <span class="number">0</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> errors.New(<span class="string">"bar must not be empty"</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">  <span class="keyword">if</span> <span class="built_in">len</span>(os.Args) != <span class="number">2</span> &#123;</span><br><span class="line">    fmt.Println(<span class="string">"USAGE: foo &lt;bar&gt;"</span>)</span><br><span class="line">    os.Exit(<span class="number">1</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> err := foo(os.Args[<span class="number">1</span>]); err != <span class="literal">nil</span> &#123;</span><br><span class="line">    <span class="built_in">panic</span>(err)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></td></tr></tbody></table><p>panic/recover ä¸æ˜¯é”™è¯¯å¤„ç†ç­–ç•¥ã€‚ä»…å½“å‘ç”Ÿä¸å¯æ¢å¤çš„äº‹æƒ…ï¼ˆä¾‹å¦‚ï¼šnil å¼•ç”¨ï¼‰æ—¶ï¼Œç¨‹åºæ‰å¿…é¡» panicã€‚ç¨‹åºåˆå§‹åŒ–æ˜¯ä¸€ä¸ªä¾‹å¤–ï¼šç¨‹åºå¯åŠ¨æ—¶åº”ä½¿ç¨‹åºä¸­æ­¢çš„ä¸è‰¯æƒ…å†µå¯èƒ½ä¼šå¼•èµ· panicã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> _statusTemplate = template.Must(template.New(<span class="string">"name"</span>).Parse(<span class="string">"_statusHTML"</span>))</span><br></pre></td></tr></table></figure><p>å³ä½¿åœ¨æµ‹è¯•ä»£ç ä¸­ï¼Œä¹Ÿä¼˜å…ˆä½¿ç”¨<code>t.Fatal</code>æˆ–è€…<code>t.FailNow</code>è€Œä¸æ˜¯ panic æ¥ç¡®ä¿å¤±è´¥è¢«æ ‡è®°ã€‚</p><table><thead><tr><th>Bad</th><th>Good</th></tr></thead><tbody><tr><td><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// func TestFoo(t *testing.T)</span></span><br><span class="line"></span><br><span class="line">f, err := ioutil.TempFile(<span class="string">""</span>, <span class="string">"test"</span>)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">  <span class="built_in">panic</span>(<span class="string">"failed to set up test"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></td><td><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// func TestFoo(t *testing.T)</span></span><br><span class="line"></span><br><span class="line">f, err := ioutil.TempFile(<span class="string">""</span>, <span class="string">"test"</span>)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">  t.Fatal(<span class="string">"failed to set up test"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></td></tr></tbody></table><!-- TODO: Explain how to use _test packages. --><h3 id="ä½¿ç”¨-go-uber-org-atomic"><a href="#ä½¿ç”¨-go-uber-org-atomic" class="headerlink" title="ä½¿ç”¨ go.uber.org/atomic"></a>ä½¿ç”¨ go.uber.org/atomic</h3><p>ä½¿ç”¨ <a href="https://golang.org/pkg/sync/atomic/" target="_blank" rel="noopener">sync/atomic</a> åŒ…çš„åŸå­æ“ä½œå¯¹åŸå§‹ç±»å‹ (<code>int32</code>, <code>int64</code>ç­‰ï¼‰è¿›è¡Œæ“ä½œï¼Œå› ä¸ºå¾ˆå®¹æ˜“å¿˜è®°ä½¿ç”¨åŸå­æ“ä½œæ¥è¯»å–æˆ–ä¿®æ”¹å˜é‡ã€‚</p><p><a href="https://godoc.org/go.uber.org/atomic" target="_blank" rel="noopener">go.uber.org/atomic</a> é€šè¿‡éšè—åŸºç¡€ç±»å‹ä¸ºè¿™äº›æ“ä½œå¢åŠ äº†ç±»å‹å®‰å…¨æ€§ã€‚æ­¤å¤–ï¼Œå®ƒåŒ…æ‹¬ä¸€ä¸ªæ–¹ä¾¿çš„<code>atomic.Bool</code>ç±»å‹ã€‚</p><table><thead><tr><th>Bad</th><th>Good</th></tr></thead><tbody><tr><td><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> foo <span class="keyword">struct</span> &#123;</span><br><span class="line">  running <span class="keyword">int32</span>  <span class="comment">// atomic</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(f* foo)</span> <span class="title">start</span><span class="params">()</span></span> &#123;</span><br><span class="line">  <span class="keyword">if</span> atomic.SwapInt32(&amp;f.running, <span class="number">1</span>) == <span class="number">1</span> &#123;</span><br><span class="line">     <span class="comment">// already runningâ€¦</span></span><br><span class="line">     <span class="keyword">return</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// start the Foo</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(f *foo)</span> <span class="title">isRunning</span><span class="params">()</span> <span class="title">bool</span></span> &#123;</span><br><span class="line">  <span class="keyword">return</span> f.running == <span class="number">1</span>  <span class="comment">// race!</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></td><td><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> foo <span class="keyword">struct</span> &#123;</span><br><span class="line">  running atomic.Bool</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(f *foo)</span> <span class="title">start</span><span class="params">()</span></span> &#123;</span><br><span class="line">  <span class="keyword">if</span> f.running.Swap(<span class="literal">true</span>) &#123;</span><br><span class="line">     <span class="comment">// already runningâ€¦</span></span><br><span class="line">     <span class="keyword">return</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// start the Foo</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(f *foo)</span> <span class="title">isRunning</span><span class="params">()</span> <span class="title">bool</span></span> &#123;</span><br><span class="line">  <span class="keyword">return</span> f.running.Load()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></td></tr></tbody></table><h2 id="æ€§èƒ½"><a href="#æ€§èƒ½" class="headerlink" title="æ€§èƒ½"></a>æ€§èƒ½</h2><p>æ€§èƒ½æ–¹é¢çš„ç‰¹å®šå‡†åˆ™åªé€‚ç”¨äºé«˜é¢‘åœºæ™¯ã€‚</p><h3 id="ä¼˜å…ˆä½¿ç”¨-strconv-è€Œä¸æ˜¯-fmt"><a href="#ä¼˜å…ˆä½¿ç”¨-strconv-è€Œä¸æ˜¯-fmt" class="headerlink" title="ä¼˜å…ˆä½¿ç”¨ strconv è€Œä¸æ˜¯ fmt"></a>ä¼˜å…ˆä½¿ç”¨ strconv è€Œä¸æ˜¯ fmt</h3><p>å°†åŸè¯­è½¬æ¢ä¸ºå­—ç¬¦ä¸²æˆ–ä»å­—ç¬¦ä¸²è½¬æ¢æ—¶ï¼Œ<code>strconv</code>é€Ÿåº¦æ¯”<code>fmt</code>å¿«ã€‚</p><table><thead><tr><th>Bad</th><th>Good</th></tr></thead><tbody><tr><td><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> i := <span class="number">0</span>; i &lt; b.N; i++ &#123;</span><br><span class="line">  s := fmt.Sprint(rand.Int())</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></td><td><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> i := <span class="number">0</span>; i &lt; b.N; i++ &#123;</span><br><span class="line">  s := strconv.Itoa(rand.Int())</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></td></tr><tr><td><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">BenchmarkFmtSprint-4    143 ns/op    2 allocs/op</span><br></pre></td></tr></table></figure></td><td><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">BenchmarkStrconv-4    64.2 ns/op    1 allocs/op</span><br></pre></td></tr></table></figure></td></tr></tbody></table><h3 id="é¿å…å­—ç¬¦ä¸²åˆ°å­—èŠ‚çš„è½¬æ¢"><a href="#é¿å…å­—ç¬¦ä¸²åˆ°å­—èŠ‚çš„è½¬æ¢" class="headerlink" title="é¿å…å­—ç¬¦ä¸²åˆ°å­—èŠ‚çš„è½¬æ¢"></a>é¿å…å­—ç¬¦ä¸²åˆ°å­—èŠ‚çš„è½¬æ¢</h3><p>ä¸è¦åå¤ä»å›ºå®šå­—ç¬¦ä¸²åˆ›å»ºå­—èŠ‚ sliceã€‚ç›¸åï¼Œè¯·æ‰§è¡Œä¸€æ¬¡è½¬æ¢å¹¶æ•è·ç»“æœã€‚</p><table><thead><tr><th>Bad</th><th>Good</th></tr></thead><tbody><tr><td><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> i := <span class="number">0</span>; i &lt; b.N; i++ &#123;</span><br><span class="line">  w.Write([]<span class="keyword">byte</span>(<span class="string">"Hello world"</span>))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></td><td><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">data := []<span class="keyword">byte</span>(<span class="string">"Hello world"</span>)</span><br><span class="line"><span class="keyword">for</span> i := <span class="number">0</span>; i &lt; b.N; i++ &#123;</span><br><span class="line">  w.Write(data)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></td></tr><tr><td><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">BenchmarkBad-4   50000000   22.2 ns/op</span><br></pre></td></tr></table></figure></td><td><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">BenchmarkGood-4  500000000   3.25 ns/op</span><br></pre></td></tr></table></figure></td></tr></tbody></table><h3 id="å°½é‡åˆå§‹åŒ–æ—¶æŒ‡å®š-Map-å®¹é‡"><a href="#å°½é‡åˆå§‹åŒ–æ—¶æŒ‡å®š-Map-å®¹é‡" class="headerlink" title="å°½é‡åˆå§‹åŒ–æ—¶æŒ‡å®š Map å®¹é‡"></a>å°½é‡åˆå§‹åŒ–æ—¶æŒ‡å®š Map å®¹é‡</h3><p>åœ¨å°½å¯èƒ½çš„æƒ…å†µä¸‹ï¼Œåœ¨ä½¿ç”¨ <code>make()</code> åˆå§‹åŒ–çš„æ—¶å€™æä¾›å®¹é‡ä¿¡æ¯</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">make</span>(<span class="keyword">map</span>[T1]T2, hint)</span><br></pre></td></tr></table></figure><p>ä¸º <code>make()</code> æä¾›å®¹é‡ä¿¡æ¯ï¼ˆhintï¼‰å°è¯•åœ¨åˆå§‹åŒ–æ—¶è°ƒæ•´ map å¤§å°ï¼Œ<br>è¿™å‡å°‘äº†åœ¨å°†å…ƒç´ æ·»åŠ åˆ° map æ—¶å¢é•¿å’Œåˆ†é…çš„å¼€é”€ã€‚<br>æ³¨æ„ï¼Œmap ä¸èƒ½ä¿è¯åˆ†é… hint ä¸ªå®¹é‡ã€‚å› æ­¤ï¼Œå³ä½¿æä¾›äº†å®¹é‡ï¼Œæ·»åŠ å…ƒç´ ä»ç„¶å¯ä»¥è¿›è¡Œåˆ†é…ã€‚ </p><table><thead><tr><th>Bad</th><th>Good</th></tr></thead><tbody><tr><td><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">m := <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="keyword">string</span>]os.FileInfo)</span><br><span class="line"></span><br><span class="line">files, _ := ioutil.ReadDir(<span class="string">"./files"</span>)</span><br><span class="line"><span class="keyword">for</span> _, f := <span class="keyword">range</span> files &#123;</span><br><span class="line">    m[f.Name()] = f</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></td><td><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">files, _ := ioutil.ReadDir(<span class="string">"./files"</span>)</span><br><span class="line"></span><br><span class="line">m := <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="keyword">string</span>]os.FileInfo, <span class="built_in">len</span>(files))</span><br><span class="line"><span class="keyword">for</span> _, f := <span class="keyword">range</span> files &#123;</span><br><span class="line">    m[f.Name()] = f</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></td></tr><tr><td><p><code>m</code> æ˜¯åœ¨æ²¡æœ‰å¤§å°æç¤ºçš„æƒ…å†µä¸‹åˆ›å»ºçš„ï¼› åœ¨è¿è¡Œæ—¶å¯èƒ½ä¼šæœ‰æ›´å¤šåˆ†é…ã€‚</p></td><td><p><code>m</code> æ˜¯æœ‰å¤§å°æç¤ºåˆ›å»ºçš„ï¼›åœ¨è¿è¡Œæ—¶å¯èƒ½ä¼šæœ‰æ›´å°‘çš„åˆ†é…ã€‚</p></td></tr></tbody></table><h2 id="è§„èŒƒ"><a href="#è§„èŒƒ" class="headerlink" title="è§„èŒƒ"></a>è§„èŒƒ</h2><h3 id="ä¸€è‡´æ€§"><a href="#ä¸€è‡´æ€§" class="headerlink" title="ä¸€è‡´æ€§"></a>ä¸€è‡´æ€§</h3><p>æœ¬æ–‡ä¸­æ¦‚è¿°çš„ä¸€äº›æ ‡å‡†éƒ½æ˜¯å®¢è§‚æ€§çš„è¯„ä¼°ï¼Œæ˜¯æ ¹æ®åœºæ™¯ã€ä¸Šä¸‹æ–‡ã€æˆ–è€…ä¸»è§‚æ€§çš„åˆ¤æ–­ï¼›</p><p>ä½†æ˜¯æœ€é‡è¦çš„æ˜¯ï¼Œ<strong>ä¿æŒä¸€è‡´</strong>.</p><p>ä¸€è‡´æ€§çš„ä»£ç æ›´å®¹æ˜“ç»´æŠ¤ã€æ˜¯æ›´åˆç†çš„ã€éœ€è¦æ›´å°‘çš„å­¦ä¹ æˆæœ¬ã€å¹¶ä¸”éšç€æ–°çš„çº¦å®šå‡ºç°æˆ–è€…å‡ºç°é”™è¯¯åæ›´å®¹æ˜“è¿ç§»ã€æ›´æ–°ã€ä¿®å¤ bug</p><p>ç›¸åï¼Œä¸€ä¸ªå•ä¸€çš„ä»£ç åº“ä¼šå¯¼è‡´ç»´æŠ¤æˆæœ¬å¼€é”€ã€ä¸ç¡®å®šæ€§å’Œè®¤çŸ¥åå·®ã€‚æ‰€æœ‰è¿™äº›éƒ½ä¼šç›´æ¥å¯¼è‡´é€Ÿåº¦é™ä½ã€<br>ä»£ç å®¡æŸ¥ç—›è‹¦ã€è€Œä¸”å¢åŠ  bug æ•°é‡</p><p>å°†è¿™äº›æ ‡å‡†åº”ç”¨äºä»£ç åº“æ—¶ï¼Œå»ºè®®åœ¨ packageï¼ˆæˆ–æ›´å¤§ï¼‰çº§åˆ«è¿›è¡Œæ›´æ”¹ï¼Œå­åŒ…çº§åˆ«çš„åº”ç”¨ç¨‹åºé€šè¿‡å°†å¤šä¸ªæ ·å¼å¼•å…¥åˆ°åŒä¸€ä»£ç ä¸­ï¼Œè¿åäº†ä¸Šè¿°å…³æ³¨ç‚¹ã€‚</p><h3 id="ç›¸ä¼¼çš„å£°æ˜æ”¾åœ¨ä¸€ç»„"><a href="#ç›¸ä¼¼çš„å£°æ˜æ”¾åœ¨ä¸€ç»„" class="headerlink" title="ç›¸ä¼¼çš„å£°æ˜æ”¾åœ¨ä¸€ç»„"></a>ç›¸ä¼¼çš„å£°æ˜æ”¾åœ¨ä¸€ç»„</h3><p>Go è¯­è¨€æ”¯æŒå°†ç›¸ä¼¼çš„å£°æ˜æ”¾åœ¨ä¸€ä¸ªç»„å†…ã€‚</p><table><thead><tr><th>Bad</th><th>Good</th></tr></thead><tbody><tr><td><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">"a"</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">"b"</span></span><br></pre></td></tr></table></figure></td><td><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> (</span><br><span class="line">  <span class="string">"a"</span></span><br><span class="line">  <span class="string">"b"</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure></td></tr></tbody></table><p>è¿™åŒæ ·é€‚ç”¨äºå¸¸é‡ã€å˜é‡å’Œç±»å‹å£°æ˜ï¼š</p><table><thead><tr><th>Bad</th><th>Good</th></tr></thead><tbody><tr><td><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">const</span> a = <span class="number">1</span></span><br><span class="line"><span class="keyword">const</span> b = <span class="number">2</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> a = <span class="number">1</span></span><br><span class="line"><span class="keyword">var</span> b = <span class="number">2</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Area <span class="keyword">float64</span></span><br><span class="line"><span class="keyword">type</span> Volume <span class="keyword">float64</span></span><br></pre></td></tr></table></figure></td><td><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> (</span><br><span class="line">  a = <span class="number">1</span></span><br><span class="line">  b = <span class="number">2</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> (</span><br><span class="line">  a = <span class="number">1</span></span><br><span class="line">  b = <span class="number">2</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> (</span><br><span class="line">  Area <span class="keyword">float64</span></span><br><span class="line">  Volume <span class="keyword">float64</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure></td></tr></tbody></table><p>ä»…å°†ç›¸å…³çš„å£°æ˜æ”¾åœ¨ä¸€ç»„ã€‚ä¸è¦å°†ä¸ç›¸å…³çš„å£°æ˜æ”¾åœ¨ä¸€ç»„ã€‚</p><table><thead><tr><th>Bad</th><th>Good</th></tr></thead><tbody><tr><td><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Operation <span class="keyword">int</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> (</span><br><span class="line">  Add Operation = <span class="literal">iota</span> + <span class="number">1</span></span><br><span class="line">  Subtract</span><br><span class="line">  Multiply</span><br><span class="line">  ENV_VAR = <span class="string">"MY_ENV"</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure></td><td><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Operation <span class="keyword">int</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> (</span><br><span class="line">  Add Operation = <span class="literal">iota</span> + <span class="number">1</span></span><br><span class="line">  Subtract</span><br><span class="line">  Multiply</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> ENV_VAR = <span class="string">"MY_ENV"</span></span><br></pre></td></tr></table></figure></td></tr></tbody></table><p>åˆ†ç»„ä½¿ç”¨çš„ä½ç½®æ²¡æœ‰é™åˆ¶ï¼Œä¾‹å¦‚ï¼šä½ å¯ä»¥åœ¨å‡½æ•°å†…éƒ¨ä½¿ç”¨å®ƒä»¬ï¼š</p><table><thead><tr><th>Bad</th><th>Good</th></tr></thead><tbody><tr><td><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">f</span><span class="params">()</span> <span class="title">string</span></span> &#123;</span><br><span class="line">  <span class="keyword">var</span> red = color.New(<span class="number">0xff</span>0000)</span><br><span class="line">  <span class="keyword">var</span> green = color.New(<span class="number">0x00ff</span>00)</span><br><span class="line">  <span class="keyword">var</span> blue = color.New(<span class="number">0x0000ff</span>)</span><br><span class="line"></span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></td><td><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">f</span><span class="params">()</span> <span class="title">string</span></span> &#123;</span><br><span class="line">  <span class="keyword">var</span> (</span><br><span class="line">    red   = color.New(<span class="number">0xff</span>0000)</span><br><span class="line">    green = color.New(<span class="number">0x00ff</span>00)</span><br><span class="line">    blue  = color.New(<span class="number">0x0000ff</span>)</span><br><span class="line">  )</span><br><span class="line"></span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></td></tr></tbody></table><h3 id="import-åˆ†ç»„"><a href="#import-åˆ†ç»„" class="headerlink" title="import åˆ†ç»„"></a>import åˆ†ç»„</h3><p>å¯¼å…¥åº”è¯¥åˆ†ä¸ºä¸¤ç»„ï¼š</p><ul><li>æ ‡å‡†åº“</li><li>å…¶ä»–åº“</li></ul><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œè¿™æ˜¯ goimports åº”ç”¨çš„åˆ†ç»„ã€‚</p><table><thead><tr><th>Bad</th><th>Good</th></tr></thead><tbody><tr><td><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> (</span><br><span class="line">  <span class="string">"fmt"</span></span><br><span class="line">  <span class="string">"os"</span></span><br><span class="line">  <span class="string">"go.uber.org/atomic"</span></span><br><span class="line">  <span class="string">"golang.org/x/sync/errgroup"</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure></td><td><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> (</span><br><span class="line">  <span class="string">"fmt"</span></span><br><span class="line">  <span class="string">"os"</span></span><br><span class="line"></span><br><span class="line">  <span class="string">"go.uber.org/atomic"</span></span><br><span class="line">  <span class="string">"golang.org/x/sync/errgroup"</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure></td></tr></tbody></table><h3 id="åŒ…å"><a href="#åŒ…å" class="headerlink" title="åŒ…å"></a>åŒ…å</h3><p>å½“å‘½ååŒ…æ—¶ï¼Œè¯·æŒ‰ä¸‹é¢è§„åˆ™é€‰æ‹©ä¸€ä¸ªåç§°ï¼š</p><ul><li>å…¨éƒ¨å°å†™ã€‚æ²¡æœ‰å¤§å†™æˆ–ä¸‹åˆ’çº¿ã€‚</li><li>å¤§å¤šæ•°ä½¿ç”¨å‘½åå¯¼å…¥çš„æƒ…å†µä¸‹ï¼Œä¸éœ€è¦é‡å‘½åã€‚</li><li>ç®€çŸ­è€Œç®€æ´ã€‚è¯·è®°ä½ï¼Œåœ¨æ¯ä¸ªä½¿ç”¨çš„åœ°æ–¹éƒ½å®Œæ•´æ ‡è¯†äº†è¯¥åç§°ã€‚</li><li>ä¸ç”¨å¤æ•°ã€‚ä¾‹å¦‚<code>net/url</code>ï¼Œè€Œä¸æ˜¯<code>net/urls</code>ã€‚</li><li>ä¸è¦ç”¨â€œcommonâ€ï¼Œâ€œutilâ€ï¼Œâ€œsharedâ€æˆ–â€œlibâ€ã€‚è¿™äº›æ˜¯ä¸å¥½çš„ï¼Œä¿¡æ¯é‡ä¸è¶³çš„åç§°ã€‚</li></ul><p>å¦è¯·å‚é˜… <a href="https://blog.golang.org/package-names" target="_blank" rel="noopener">Package Names</a> å’Œ <a href="https://rakyll.org/style-packages/" target="_blank" rel="noopener">Go åŒ…æ ·å¼æŒ‡å—</a>.</p><h3 id="å‡½æ•°å"><a href="#å‡½æ•°å" class="headerlink" title="å‡½æ•°å"></a>å‡½æ•°å</h3><p>æˆ‘ä»¬éµå¾ª Go ç¤¾åŒºå…³äºä½¿ç”¨ <a href="https://golang.org/doc/effective_go.html#mixed-caps" target="_blank" rel="noopener">MixedCaps ä½œä¸ºå‡½æ•°å</a> çš„çº¦å®šã€‚æœ‰ä¸€ä¸ªä¾‹å¤–ï¼Œä¸ºäº†å¯¹ç›¸å…³çš„æµ‹è¯•ç”¨ä¾‹è¿›è¡Œåˆ†ç»„ï¼Œå‡½æ•°åå¯èƒ½åŒ…å«ä¸‹åˆ’çº¿ï¼Œå¦‚ï¼š<code>TestMyFunction_WhatIsBeingTested</code>.</p><h3 id="å¯¼å…¥åˆ«å"><a href="#å¯¼å…¥åˆ«å" class="headerlink" title="å¯¼å…¥åˆ«å"></a>å¯¼å…¥åˆ«å</h3><p>å¦‚æœç¨‹åºåŒ…åç§°ä¸å¯¼å…¥è·¯å¾„çš„æœ€åä¸€ä¸ªå…ƒç´ ä¸åŒ¹é…ï¼Œåˆ™å¿…é¡»ä½¿ç”¨å¯¼å…¥åˆ«åã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> (</span><br><span class="line">  <span class="string">"net/http"</span></span><br><span class="line"></span><br><span class="line">  client <span class="string">"example.com/client-go"</span></span><br><span class="line">  trace <span class="string">"example.com/trace/v2"</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure><p>åœ¨æ‰€æœ‰å…¶ä»–æƒ…å†µä¸‹ï¼Œé™¤éå¯¼å…¥ä¹‹é—´æœ‰ç›´æ¥å†²çªï¼Œå¦åˆ™åº”é¿å…å¯¼å…¥åˆ«åã€‚</p><table><thead><tr><th>Bad</th><th>Good</th></tr></thead><tbody><tr><td><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> (</span><br><span class="line">  <span class="string">"fmt"</span></span><br><span class="line">  <span class="string">"os"</span></span><br><span class="line"></span><br><span class="line">  nettrace <span class="string">"golang.net/x/trace"</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure></td><td><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> (</span><br><span class="line">  <span class="string">"fmt"</span></span><br><span class="line">  <span class="string">"os"</span></span><br><span class="line">  <span class="string">"runtime/trace"</span></span><br><span class="line"></span><br><span class="line">  nettrace <span class="string">"golang.net/x/trace"</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure></td></tr></tbody></table><h3 id="å‡½æ•°åˆ†ç»„ä¸é¡ºåº"><a href="#å‡½æ•°åˆ†ç»„ä¸é¡ºåº" class="headerlink" title="å‡½æ•°åˆ†ç»„ä¸é¡ºåº"></a>å‡½æ•°åˆ†ç»„ä¸é¡ºåº</h3><ul><li>å‡½æ•°åº”æŒ‰ç²—ç•¥çš„è°ƒç”¨é¡ºåºæ’åºã€‚</li><li>åŒä¸€æ–‡ä»¶ä¸­çš„å‡½æ•°åº”æŒ‰æ¥æ”¶è€…åˆ†ç»„ã€‚</li></ul><p>å› æ­¤ï¼Œå¯¼å‡ºçš„å‡½æ•°åº”å…ˆå‡ºç°åœ¨æ–‡ä»¶ä¸­ï¼Œæ”¾åœ¨<code>struct</code>, <code>const</code>, <code>var</code>å®šä¹‰çš„åé¢ã€‚</p><p>åœ¨å®šä¹‰ç±»å‹ä¹‹åï¼Œä½†åœ¨æ¥æ”¶è€…çš„å…¶ä½™æ–¹æ³•ä¹‹å‰ï¼Œå¯èƒ½ä¼šå‡ºç°ä¸€ä¸ª <code>newXYZ()</code>/<code>NewXYZ()</code> </p><p>ç”±äºå‡½æ•°æ˜¯æŒ‰æ¥æ”¶è€…åˆ†ç»„çš„ï¼Œå› æ­¤æ™®é€šå·¥å…·å‡½æ•°åº”åœ¨æ–‡ä»¶æœ«å°¾å‡ºç°ã€‚</p><table><thead><tr><th>Bad</th><th>Good</th></tr></thead><tbody><tr><td><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s *something)</span> <span class="title">Cost</span><span class="params">()</span></span> &#123;</span><br><span class="line">  <span class="keyword">return</span> calcCost(s.weights)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> something <span class="keyword">struct</span>&#123; ... &#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">calcCost</span><span class="params">(n []<span class="keyword">int</span>)</span> <span class="title">int</span></span> &#123;...&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s *something)</span> <span class="title">Stop</span><span class="params">()</span></span> &#123;...&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">newSomething</span><span class="params">()</span> *<span class="title">something</span></span> &#123;</span><br><span class="line">    <span class="keyword">return</span> &amp;something&#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></td><td><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> something <span class="keyword">struct</span>&#123; ... &#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">newSomething</span><span class="params">()</span> *<span class="title">something</span></span> &#123;</span><br><span class="line">    <span class="keyword">return</span> &amp;something&#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s *something)</span> <span class="title">Cost</span><span class="params">()</span></span> &#123;</span><br><span class="line">  <span class="keyword">return</span> calcCost(s.weights)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s *something)</span> <span class="title">Stop</span><span class="params">()</span></span> &#123;...&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">calcCost</span><span class="params">(n []<span class="keyword">int</span>)</span> <span class="title">int</span></span> &#123;...&#125;</span><br></pre></td></tr></table></figure></td></tr></tbody></table><h3 id="å‡å°‘åµŒå¥—"><a href="#å‡å°‘åµŒå¥—" class="headerlink" title="å‡å°‘åµŒå¥—"></a>å‡å°‘åµŒå¥—</h3><p>ä»£ç åº”é€šè¿‡å°½å¯èƒ½å…ˆå¤„ç†é”™è¯¯æƒ…å†µ/ç‰¹æ®Šæƒ…å†µå¹¶å°½æ—©è¿”å›æˆ–ç»§ç»­å¾ªç¯æ¥å‡å°‘åµŒå¥—ã€‚å‡å°‘åµŒå¥—å¤šä¸ªçº§åˆ«çš„ä»£ç çš„ä»£ç é‡ã€‚</p><table><thead><tr><th>Bad</th><th>Good</th></tr></thead><tbody><tr><td><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> _, v := <span class="keyword">range</span> data &#123;</span><br><span class="line">  <span class="keyword">if</span> v.F1 == <span class="number">1</span> &#123;</span><br><span class="line">    v = process(v)</span><br><span class="line">    <span class="keyword">if</span> err := v.Call(); err == <span class="literal">nil</span> &#123;</span><br><span class="line">      v.Send()</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> err</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    log.Printf(<span class="string">"Invalid v: %v"</span>, v)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></td><td><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> _, v := <span class="keyword">range</span> data &#123;</span><br><span class="line">  <span class="keyword">if</span> v.F1 != <span class="number">1</span> &#123;</span><br><span class="line">    log.Printf(<span class="string">"Invalid v: %v"</span>, v)</span><br><span class="line">    <span class="keyword">continue</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  v = process(v)</span><br><span class="line">  <span class="keyword">if</span> err := v.Call(); err != <span class="literal">nil</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> err</span><br><span class="line">  &#125;</span><br><span class="line">  v.Send()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></td></tr></tbody></table><h3 id="ä¸å¿…è¦çš„-else"><a href="#ä¸å¿…è¦çš„-else" class="headerlink" title="ä¸å¿…è¦çš„ else"></a>ä¸å¿…è¦çš„ else</h3><p>å¦‚æœåœ¨ if çš„ä¸¤ä¸ªåˆ†æ”¯ä¸­éƒ½è®¾ç½®äº†å˜é‡ï¼Œåˆ™å¯ä»¥å°†å…¶æ›¿æ¢ä¸ºå•ä¸ª ifã€‚</p><table><thead><tr><th>Bad</th><th>Good</th></tr></thead><tbody><tr><td><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a <span class="keyword">int</span></span><br><span class="line"><span class="keyword">if</span> b &#123;</span><br><span class="line">  a = <span class="number">100</span></span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">  a = <span class="number">10</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></td><td><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">a := <span class="number">10</span></span><br><span class="line"><span class="keyword">if</span> b &#123;</span><br><span class="line">  a = <span class="number">100</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></td></tr></tbody></table><h3 id="é¡¶å±‚å˜é‡å£°æ˜"><a href="#é¡¶å±‚å˜é‡å£°æ˜" class="headerlink" title="é¡¶å±‚å˜é‡å£°æ˜"></a>é¡¶å±‚å˜é‡å£°æ˜</h3><p>åœ¨é¡¶å±‚ï¼Œä½¿ç”¨æ ‡å‡†<code>var</code>å…³é”®å­—ã€‚è¯·å‹¿æŒ‡å®šç±»å‹ï¼Œé™¤éå®ƒä¸è¡¨è¾¾å¼çš„ç±»å‹ä¸åŒã€‚</p><table><thead><tr><th>Bad</th><th>Good</th></tr></thead><tbody><tr><td><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> _s <span class="keyword">string</span> = F()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">F</span><span class="params">()</span> <span class="title">string</span></span> &#123; <span class="keyword">return</span> <span class="string">"A"</span> &#125;</span><br></pre></td></tr></table></figure></td><td><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> _s = F()</span><br><span class="line"><span class="comment">// ç”±äº F å·²ç»æ˜ç¡®äº†è¿”å›ä¸€ä¸ªå­—ç¬¦ä¸²ç±»å‹ï¼Œå› æ­¤æˆ‘ä»¬æ²¡æœ‰å¿…è¦æ˜¾å¼æŒ‡å®š_s çš„ç±»å‹</span></span><br><span class="line"><span class="comment">// è¿˜æ˜¯é‚£ç§ç±»å‹</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">F</span><span class="params">()</span> <span class="title">string</span></span> &#123; <span class="keyword">return</span> <span class="string">"A"</span> &#125;</span><br></pre></td></tr></table></figure></td></tr></tbody></table><p>å¦‚æœè¡¨è¾¾å¼çš„ç±»å‹ä¸æ‰€éœ€çš„ç±»å‹ä¸å®Œå…¨åŒ¹é…ï¼Œè¯·æŒ‡å®šç±»å‹ã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> myError <span class="keyword">struct</span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(myError)</span> <span class="title">Error</span><span class="params">()</span> <span class="title">string</span></span> &#123; <span class="keyword">return</span> <span class="string">"error"</span> &#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">F</span><span class="params">()</span> <span class="title">myError</span></span> &#123; <span class="keyword">return</span> myError&#123;&#125; &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> _e error = F()</span><br><span class="line"><span class="comment">// F è¿”å›ä¸€ä¸ª myError ç±»å‹çš„å®ä¾‹ï¼Œä½†æ˜¯æˆ‘ä»¬è¦ error ç±»å‹</span></span><br></pre></td></tr></table></figure><h3 id="å¯¹äºæœªå¯¼å‡ºçš„é¡¶å±‚å¸¸é‡å’Œå˜é‡ï¼Œä½¿ç”¨-ä½œä¸ºå‰ç¼€"><a href="#å¯¹äºæœªå¯¼å‡ºçš„é¡¶å±‚å¸¸é‡å’Œå˜é‡ï¼Œä½¿ç”¨-ä½œä¸ºå‰ç¼€" class="headerlink" title="å¯¹äºæœªå¯¼å‡ºçš„é¡¶å±‚å¸¸é‡å’Œå˜é‡ï¼Œä½¿ç”¨_ä½œä¸ºå‰ç¼€"></a>å¯¹äºæœªå¯¼å‡ºçš„é¡¶å±‚å¸¸é‡å’Œå˜é‡ï¼Œä½¿ç”¨_ä½œä¸ºå‰ç¼€</h3><p>åœ¨æœªå¯¼å‡ºçš„é¡¶çº§<code>vars</code>å’Œ<code>consts</code>ï¼Œ å‰é¢åŠ ä¸Šå‰ç¼€_ï¼Œä»¥ä½¿å®ƒä»¬åœ¨ä½¿ç”¨æ—¶æ˜ç¡®è¡¨ç¤ºå®ƒä»¬æ˜¯å…¨å±€ç¬¦å·ã€‚</p><p>ä¾‹å¤–ï¼šæœªå¯¼å‡ºçš„é”™è¯¯å€¼ï¼Œåº”ä»¥<code>err</code>å¼€å¤´ã€‚</p><p>åŸºæœ¬ä¾æ®ï¼šé¡¶çº§å˜é‡å’Œå¸¸é‡å…·æœ‰åŒ…èŒƒå›´ä½œç”¨åŸŸã€‚ä½¿ç”¨é€šç”¨åç§°å¯èƒ½å¾ˆå®¹æ˜“åœ¨å…¶ä»–æ–‡ä»¶ä¸­æ„å¤–ä½¿ç”¨é”™è¯¯çš„å€¼ã€‚</p><table><thead><tr><th>Bad</th><th>Good</th></tr></thead><tbody><tr><td><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// foo.go</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> (</span><br><span class="line">  defaultPort = <span class="number">8080</span></span><br><span class="line">  defaultUser = <span class="string">"user"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// bar.go</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Bar</span><span class="params">()</span></span> &#123;</span><br><span class="line">  defaultPort := <span class="number">9090</span></span><br><span class="line">  ...</span><br><span class="line">  fmt.Println(<span class="string">"Default port"</span>, defaultPort)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// We will not see a compile error if the first line of</span></span><br><span class="line">  <span class="comment">// Bar() is deleted.</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></td><td><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// foo.go</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> (</span><br><span class="line">  _defaultPort = <span class="number">8080</span></span><br><span class="line">  _defaultUser = <span class="string">"user"</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure></td></tr></tbody></table><h3 id="ç»“æ„ä½“ä¸­çš„åµŒå…¥"><a href="#ç»“æ„ä½“ä¸­çš„åµŒå…¥" class="headerlink" title="ç»“æ„ä½“ä¸­çš„åµŒå…¥"></a>ç»“æ„ä½“ä¸­çš„åµŒå…¥</h3><p>åµŒå…¥å¼ç±»å‹ï¼ˆä¾‹å¦‚ mutexï¼‰åº”ä½äºç»“æ„ä½“å†…çš„å­—æ®µåˆ—è¡¨çš„é¡¶éƒ¨ï¼Œå¹¶ä¸”å¿…é¡»æœ‰ä¸€ä¸ªç©ºè¡Œå°†åµŒå…¥å¼å­—æ®µä¸å¸¸è§„å­—æ®µåˆ†éš”å¼€ã€‚</p><table><thead><tr><th>Bad</th><th>Good</th></tr></thead><tbody><tr><td><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Client <span class="keyword">struct</span> &#123;</span><br><span class="line">  version <span class="keyword">int</span></span><br><span class="line">  http.Client</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></td><td><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Client <span class="keyword">struct</span> &#123;</span><br><span class="line">  http.Client</span><br><span class="line"></span><br><span class="line">  version <span class="keyword">int</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></td></tr></tbody></table><h3 id="ä½¿ç”¨å­—æ®µååˆå§‹åŒ–ç»“æ„ä½“"><a href="#ä½¿ç”¨å­—æ®µååˆå§‹åŒ–ç»“æ„ä½“" class="headerlink" title="ä½¿ç”¨å­—æ®µååˆå§‹åŒ–ç»“æ„ä½“"></a>ä½¿ç”¨å­—æ®µååˆå§‹åŒ–ç»“æ„ä½“</h3><p>åˆå§‹åŒ–ç»“æ„ä½“æ—¶ï¼Œå‡ ä¹å§‹ç»ˆåº”è¯¥æŒ‡å®šå­—æ®µåç§°ã€‚ç°åœ¨ç”± <a href="https://golang.org/cmd/vet/" target="_blank" rel="noopener"><code>go vet</code></a> å¼ºåˆ¶æ‰§è¡Œã€‚</p><table><thead><tr><th>Bad</th><th>Good</th></tr></thead><tbody><tr><td><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">k := User&#123;<span class="string">"John"</span>, <span class="string">"Doe"</span>, <span class="literal">true</span>&#125;</span><br></pre></td></tr></table></figure></td><td><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">k := User&#123;</span><br><span class="line">    FirstName: <span class="string">"John"</span>,</span><br><span class="line">    LastName: <span class="string">"Doe"</span>,</span><br><span class="line">    Admin: <span class="literal">true</span>,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></td></tr></tbody></table><p>ä¾‹å¤–ï¼šå¦‚æœæœ‰ 3 ä¸ªæˆ–æ›´å°‘çš„å­—æ®µï¼Œåˆ™å¯ä»¥åœ¨æµ‹è¯•è¡¨ä¸­çœç•¥å­—æ®µåç§°ã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">tests := []<span class="keyword">struct</span>&#123;</span><br><span class="line">  op Operation</span><br><span class="line">  want <span class="keyword">string</span></span><br><span class="line">&#125;&#123;</span><br><span class="line">  &#123;Add, <span class="string">"add"</span>&#125;,</span><br><span class="line">  &#123;Subtract, <span class="string">"subtract"</span>&#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æœ¬åœ°å˜é‡å£°æ˜"><a href="#æœ¬åœ°å˜é‡å£°æ˜" class="headerlink" title="æœ¬åœ°å˜é‡å£°æ˜"></a>æœ¬åœ°å˜é‡å£°æ˜</h3><p>å¦‚æœå°†å˜é‡æ˜ç¡®è®¾ç½®ä¸ºæŸä¸ªå€¼ï¼Œåˆ™åº”ä½¿ç”¨çŸ­å˜é‡å£°æ˜å½¢å¼ (<code>:=</code>)ã€‚</p><table><thead><tr><th>Bad</th><th>Good</th></tr></thead><tbody><tr><td><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> s = <span class="string">"foo"</span></span><br></pre></td></tr></table></figure></td><td><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">s := <span class="string">"foo"</span></span><br></pre></td></tr></table></figure></td></tr></tbody></table><p>ä½†æ˜¯ï¼Œåœ¨æŸäº›æƒ…å†µä¸‹ï¼Œ<code>var</code> ä½¿ç”¨å…³é”®å­—æ—¶é»˜è®¤å€¼ä¼šæ›´æ¸…æ™°ã€‚ä¾‹å¦‚ï¼Œå£°æ˜ç©ºåˆ‡ç‰‡ã€‚</p><table><thead><tr><th>Bad</th><th>Good</th></tr></thead><tbody><tr><td><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">f</span><span class="params">(list []<span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line">  filtered := []<span class="keyword">int</span>&#123;&#125;</span><br><span class="line">  <span class="keyword">for</span> _, v := <span class="keyword">range</span> list &#123;</span><br><span class="line">    <span class="keyword">if</span> v &gt; <span class="number">10</span> &#123;</span><br><span class="line">      filtered = <span class="built_in">append</span>(filtered, v)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></td><td><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">f</span><span class="params">(list []<span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line">  <span class="keyword">var</span> filtered []<span class="keyword">int</span></span><br><span class="line">  <span class="keyword">for</span> _, v := <span class="keyword">range</span> list &#123;</span><br><span class="line">    <span class="keyword">if</span> v &gt; <span class="number">10</span> &#123;</span><br><span class="line">      filtered = <span class="built_in">append</span>(filtered, v)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></td></tr></tbody></table><h3 id="nil-æ˜¯ä¸€ä¸ªæœ‰æ•ˆçš„-slice"><a href="#nil-æ˜¯ä¸€ä¸ªæœ‰æ•ˆçš„-slice" class="headerlink" title="nil æ˜¯ä¸€ä¸ªæœ‰æ•ˆçš„ slice"></a>nil æ˜¯ä¸€ä¸ªæœ‰æ•ˆçš„ slice</h3><p><code>nil</code> æ˜¯ä¸€ä¸ªæœ‰æ•ˆçš„é•¿åº¦ä¸º 0 çš„ sliceï¼Œè¿™æ„å‘³ç€ï¼Œ</p><ul><li><p>æ‚¨ä¸åº”æ˜ç¡®è¿”å›é•¿åº¦ä¸ºé›¶çš„åˆ‡ç‰‡ã€‚åº”è¯¥è¿”å›<code>nil</code> æ¥ä»£æ›¿ã€‚</p><table><thead><tr><th>Bad</th><th>Good</th></tr></thead><tbody><tr><td><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> x == <span class="string">""</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> []<span class="keyword">int</span>&#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></td><td><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> x == <span class="string">""</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></td></tr></tbody></table></li><li><p>è¦æ£€æŸ¥åˆ‡ç‰‡æ˜¯å¦ä¸ºç©ºï¼Œè¯·å§‹ç»ˆä½¿ç”¨<code>len(s) == 0</code>ã€‚è€Œé <code>nil</code>ã€‚</p><table><thead><tr><th>Bad</th><th>Good</th></tr></thead><tbody><tr><td><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">isEmpty</span><span class="params">(s []<span class="keyword">string</span>)</span> <span class="title">bool</span></span> &#123;</span><br><span class="line">  <span class="keyword">return</span> s == <span class="literal">nil</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></td><td><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">isEmpty</span><span class="params">(s []<span class="keyword">string</span>)</span> <span class="title">bool</span></span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">len</span>(s) == <span class="number">0</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></td></tr></tbody></table></li><li><p>é›¶å€¼åˆ‡ç‰‡ï¼ˆç”¨<code>var</code>å£°æ˜çš„åˆ‡ç‰‡ï¼‰å¯ç«‹å³ä½¿ç”¨ï¼Œæ— éœ€è°ƒç”¨<code>make()</code>åˆ›å»ºã€‚</p><table><thead><tr><th>Bad</th><th>Good</th></tr></thead><tbody><tr><td><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">nums := []<span class="keyword">int</span>&#123;&#125;</span><br><span class="line"><span class="comment">// or, nums := make([]int)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> add1 &#123;</span><br><span class="line">  nums = <span class="built_in">append</span>(nums, <span class="number">1</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> add2 &#123;</span><br><span class="line">  nums = <span class="built_in">append</span>(nums, <span class="number">2</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></td><td><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> nums []<span class="keyword">int</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> add1 &#123;</span><br><span class="line">  nums = <span class="built_in">append</span>(nums, <span class="number">1</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> add2 &#123;</span><br><span class="line">  nums = <span class="built_in">append</span>(nums, <span class="number">2</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></td></tr></tbody></table></li></ul><h3 id="å°å˜é‡ä½œç”¨åŸŸ"><a href="#å°å˜é‡ä½œç”¨åŸŸ" class="headerlink" title="å°å˜é‡ä½œç”¨åŸŸ"></a>å°å˜é‡ä½œç”¨åŸŸ</h3><p>å¦‚æœæœ‰å¯èƒ½ï¼Œå°½é‡ç¼©å°å˜é‡ä½œç”¨èŒƒå›´ã€‚é™¤éå®ƒä¸ <a href="#å‡å°‘åµŒå¥—">å‡å°‘åµŒå¥—</a>çš„è§„åˆ™å†²çªã€‚</p><table><thead><tr><th>Bad</th><th>Good</th></tr></thead><tbody><tr><td><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">err := ioutil.WriteFile(name, data, <span class="number">0644</span>)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line"> <span class="keyword">return</span> err</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></td><td><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> err := ioutil.WriteFile(name, data, <span class="number">0644</span>); err != <span class="literal">nil</span> &#123;</span><br><span class="line"> <span class="keyword">return</span> err</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></td></tr></tbody></table><p>å¦‚æœéœ€è¦åœ¨ if ä¹‹å¤–ä½¿ç”¨å‡½æ•°è°ƒç”¨çš„ç»“æœï¼Œåˆ™ä¸åº”å°è¯•ç¼©å°èŒƒå›´ã€‚</p><table><thead><tr><th>Bad</th><th>Good</th></tr></thead><tbody><tr><td><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> data, err := ioutil.ReadFile(name); err == <span class="literal">nil</span> &#123;</span><br><span class="line">  err = cfg.Decode(data)</span><br><span class="line">  <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> err</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  fmt.Println(cfg)</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> err</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></td><td><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">data, err := ioutil.ReadFile(name)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">   <span class="keyword">return</span> err</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> err := cfg.Decode(data); err != <span class="literal">nil</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> err</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">fmt.Println(cfg)</span><br><span class="line"><span class="keyword">return</span> <span class="literal">nil</span></span><br></pre></td></tr></table></figure></td></tr></tbody></table><h3 id="é¿å…å‚æ•°è¯­ä¹‰ä¸æ˜ç¡®-Avoid-Naked-Parameters"><a href="#é¿å…å‚æ•°è¯­ä¹‰ä¸æ˜ç¡®-Avoid-Naked-Parameters" class="headerlink" title="é¿å…å‚æ•°è¯­ä¹‰ä¸æ˜ç¡®(Avoid Naked Parameters)"></a>é¿å…å‚æ•°è¯­ä¹‰ä¸æ˜ç¡®(Avoid Naked Parameters)</h3><p>å‡½æ•°è°ƒç”¨ä¸­çš„<code>æ„ä¹‰ä¸æ˜ç¡®çš„å‚æ•°</code>å¯èƒ½ä¼šæŸå®³å¯è¯»æ€§ã€‚å½“å‚æ•°åç§°çš„å«ä¹‰ä¸æ˜æ˜¾æ—¶ï¼Œè¯·ä¸ºå‚æ•°æ·»åŠ  C æ ·å¼æ³¨é‡Š (<code>/* ... */</code>)</p><table><thead><tr><th>Bad</th><th>Good</th></tr></thead><tbody><tr><td><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// func printInfo(name string, isLocal, done bool)</span></span><br><span class="line"></span><br><span class="line">printInfo(<span class="string">"foo"</span>, <span class="literal">true</span>, <span class="literal">true</span>)</span><br></pre></td></tr></table></figure></td><td><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// func printInfo(name string, isLocal, done bool)</span></span><br><span class="line"></span><br><span class="line">printInfo(<span class="string">"foo"</span>, <span class="literal">true</span> <span class="comment">/* isLocal */</span>, <span class="literal">true</span> <span class="comment">/* done */</span>)</span><br></pre></td></tr></table></figure></td></tr></tbody></table><p>å¯¹äºä¸Šé¢çš„ç¤ºä¾‹ä»£ç ï¼Œè¿˜æœ‰ä¸€ç§æ›´å¥½çš„å¤„ç†æ–¹å¼æ˜¯å°†ä¸Šé¢çš„ <code>bool</code> ç±»å‹æ¢æˆè‡ªå®šä¹‰ç±»å‹ã€‚å°†æ¥ï¼Œè¯¥å‚æ•°å¯ä»¥æ”¯æŒä¸ä»…ä»…å±€é™äºä¸¤ä¸ªçŠ¶æ€ï¼ˆtrue/falseï¼‰ã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Region <span class="keyword">int</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> (</span><br><span class="line">  UnknownRegion Region = <span class="literal">iota</span></span><br><span class="line">  Local</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Status <span class="keyword">int</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> (</span><br><span class="line">  StatusReady = <span class="literal">iota</span> + <span class="number">1</span></span><br><span class="line">  StatusDone</span><br><span class="line">  <span class="comment">// Maybe we will have a StatusInProgress in the future.</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">printInfo</span><span class="params">(name <span class="keyword">string</span>, region Region, status Status)</span></span></span><br></pre></td></tr></table></figure><h3 id="ä½¿ç”¨åŸå§‹å­—ç¬¦ä¸²å­—é¢å€¼ï¼Œé¿å…è½¬ä¹‰"><a href="#ä½¿ç”¨åŸå§‹å­—ç¬¦ä¸²å­—é¢å€¼ï¼Œé¿å…è½¬ä¹‰" class="headerlink" title="ä½¿ç”¨åŸå§‹å­—ç¬¦ä¸²å­—é¢å€¼ï¼Œé¿å…è½¬ä¹‰"></a>ä½¿ç”¨åŸå§‹å­—ç¬¦ä¸²å­—é¢å€¼ï¼Œé¿å…è½¬ä¹‰</h3><p>Go æ”¯æŒä½¿ç”¨ <a href="https://golang.org/ref/spec#raw_string_lit" target="_blank" rel="noopener">åŸå§‹å­—ç¬¦ä¸²å­—é¢å€¼</a>ï¼Œä¹Ÿå°±æ˜¯ â€œ ` â€œ æ¥è¡¨ç¤ºåŸç”Ÿå­—ç¬¦ä¸²ï¼Œåœ¨éœ€è¦è½¬ä¹‰çš„åœºæ™¯ä¸‹ï¼Œæˆ‘ä»¬åº”è¯¥å°½é‡ä½¿ç”¨è¿™ç§æ–¹æ¡ˆæ¥æ›¿æ¢ã€‚</p><p>å¯ä»¥è·¨è¶Šå¤šè¡Œå¹¶åŒ…å«å¼•å·ã€‚ä½¿ç”¨è¿™äº›å­—ç¬¦ä¸²å¯ä»¥é¿å…æ›´éš¾é˜…è¯»çš„æ‰‹å·¥è½¬ä¹‰çš„å­—ç¬¦ä¸²ã€‚</p><table><thead><tr><th>Bad</th><th>Good</th></tr></thead><tbody><tr><td><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wantError := <span class="string">"unknown name:\"test\""</span></span><br></pre></td></tr></table></figure></td><td><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wantError := <span class="string">`unknown error:"test"`</span></span><br></pre></td></tr></table></figure></td></tr></tbody></table><h3 id="åˆå§‹åŒ–-Struct-å¼•ç”¨"><a href="#åˆå§‹åŒ–-Struct-å¼•ç”¨" class="headerlink" title="åˆå§‹åŒ– Struct å¼•ç”¨"></a>åˆå§‹åŒ– Struct å¼•ç”¨</h3><p>åœ¨åˆå§‹åŒ–ç»“æ„å¼•ç”¨æ—¶ï¼Œè¯·ä½¿ç”¨<code>&amp;T{}</code>ä»£æ›¿<code>new(T)</code>ï¼Œä»¥ä½¿å…¶ä¸ç»“æ„ä½“åˆå§‹åŒ–ä¸€è‡´ã€‚</p><table><thead><tr><th>Bad</th><th>Good</th></tr></thead><tbody><tr><td><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">sval := T&#123;Name: <span class="string">"foo"</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// inconsistent</span></span><br><span class="line">sptr := <span class="built_in">new</span>(T)</span><br><span class="line">sptr.Name = <span class="string">"bar"</span></span><br></pre></td></tr></table></figure></td><td><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sval := T&#123;Name: <span class="string">"foo"</span>&#125;</span><br><span class="line"></span><br><span class="line">sptr := &amp;T&#123;Name: <span class="string">"bar"</span>&#125;</span><br></pre></td></tr></table></figure></td></tr></tbody></table><h3 id="åˆå§‹åŒ–-Maps"><a href="#åˆå§‹åŒ–-Maps" class="headerlink" title="åˆå§‹åŒ– Maps"></a>åˆå§‹åŒ– Maps</h3><p>å¯¹äºç©º map è¯·ä½¿ç”¨ <code>make(..)</code> åˆå§‹åŒ–ï¼Œ å¹¶ä¸” map æ˜¯é€šè¿‡ç¼–ç¨‹æ–¹å¼å¡«å……çš„ã€‚<br>è¿™ä½¿å¾— map åˆå§‹åŒ–åœ¨è¡¨ç°ä¸Šä¸åŒäºå£°æ˜ï¼Œå¹¶ä¸”å®ƒè¿˜å¯ä»¥æ–¹ä¾¿åœ°åœ¨ make åæ·»åŠ å¤§å°æç¤ºã€‚</p><table><thead><tr><th>Bad</th><th>Good</th></tr></thead><tbody><tr><td><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> (</span><br><span class="line">  <span class="comment">// m1 è¯»å†™å®‰å…¨;</span></span><br><span class="line">  <span class="comment">// m2 åœ¨å†™å…¥æ—¶ä¼š panic</span></span><br><span class="line">  m1 = <span class="keyword">map</span>[T1]T2&#123;&#125;</span><br><span class="line">  m2 <span class="keyword">map</span>[T1]T2</span><br><span class="line">)</span><br></pre></td></tr></table></figure></td><td><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> (</span><br><span class="line">  <span class="comment">// m1 è¯»å†™å®‰å…¨;</span></span><br><span class="line">  <span class="comment">// m2 åœ¨å†™å…¥æ—¶ä¼š panic</span></span><br><span class="line">  m1 = <span class="built_in">make</span>(<span class="keyword">map</span>[T1]T2)</span><br><span class="line">  m2 <span class="keyword">map</span>[T1]T2</span><br><span class="line">)</span><br></pre></td></tr></table></figure></td></tr><tr><td><p>å£°æ˜å’Œåˆå§‹åŒ–çœ‹èµ·æ¥éå¸¸ç›¸ä¼¼çš„ã€‚</p></td><td><p>å£°æ˜å’Œåˆå§‹åŒ–çœ‹èµ·æ¥å·®åˆ«éå¸¸å¤§ã€‚</p></td></tr></tbody></table><p>åœ¨å°½å¯èƒ½çš„æƒ…å†µä¸‹ï¼Œè¯·åœ¨åˆå§‹åŒ–æ—¶æä¾› map å®¹é‡å¤§å°ï¼Œè¯¦ç»†è¯·çœ‹ <a href="#å°½é‡åˆå§‹åŒ–æ—¶æŒ‡å®š-Map-å®¹é‡">å°½é‡åˆå§‹åŒ–æ—¶æŒ‡å®š Map å®¹é‡</a>ã€‚</p><p>å¦å¤–ï¼Œå¦‚æœ map åŒ…å«å›ºå®šçš„å…ƒç´ åˆ—è¡¨ï¼Œåˆ™ä½¿ç”¨ map literals(map åˆå§‹åŒ–åˆ—è¡¨) åˆå§‹åŒ–æ˜ å°„ã€‚</p><table><thead><tr><th>Bad</th><th>Good</th></tr></thead><tbody><tr><td><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">m := <span class="built_in">make</span>(<span class="keyword">map</span>[T1]T2, <span class="number">3</span>)</span><br><span class="line">m[k1] = v1</span><br><span class="line">m[k2] = v2</span><br><span class="line">m[k3] = v3</span><br></pre></td></tr></table></figure></td><td><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">m := <span class="keyword">map</span>[T1]T2&#123;</span><br><span class="line">  k1: v1,</span><br><span class="line">  k2: v2,</span><br><span class="line">  k3: v3,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></td></tr></tbody></table><p>åŸºæœ¬å‡†åˆ™æ˜¯ï¼šåœ¨åˆå§‹åŒ–æ—¶ä½¿ç”¨ map åˆå§‹åŒ–åˆ—è¡¨ æ¥æ·»åŠ ä¸€ç»„å›ºå®šçš„å…ƒç´ ã€‚å¦åˆ™ä½¿ç”¨ <code>make</code> (å¦‚æœå¯ä»¥ï¼Œè¯·å°½é‡æŒ‡å®š map å®¹é‡)ã€‚</p><h3 id="å­—ç¬¦ä¸²-string-format"><a href="#å­—ç¬¦ä¸²-string-format" class="headerlink" title="å­—ç¬¦ä¸² string format"></a>å­—ç¬¦ä¸² string format</h3><p>å¦‚æœä½ ä¸º<code>Printf</code>-style å‡½æ•°å£°æ˜æ ¼å¼å­—ç¬¦ä¸²ï¼Œè¯·å°†æ ¼å¼åŒ–å­—ç¬¦ä¸²æ”¾åœ¨å¤–é¢ï¼Œå¹¶å°†å…¶è®¾ç½®ä¸º<code>const</code>å¸¸é‡ã€‚</p><p>è¿™æœ‰åŠ©äº<code>go vet</code>å¯¹æ ¼å¼å­—ç¬¦ä¸²æ‰§è¡Œé™æ€åˆ†æã€‚</p><table><thead><tr><th>Bad</th><th>Good</th></tr></thead><tbody><tr><td><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">msg := <span class="string">"unexpected values %v, %v\n"</span></span><br><span class="line">fmt.Printf(msg, <span class="number">1</span>, <span class="number">2</span>)</span><br></pre></td></tr></table></figure></td><td><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> msg = <span class="string">"unexpected values %v, %v\n"</span></span><br><span class="line">fmt.Printf(msg, <span class="number">1</span>, <span class="number">2</span>)</span><br></pre></td></tr></table></figure></td></tr></tbody></table><h3 id="å‘½å-Printf-æ ·å¼çš„å‡½æ•°"><a href="#å‘½å-Printf-æ ·å¼çš„å‡½æ•°" class="headerlink" title="å‘½å Printf æ ·å¼çš„å‡½æ•°"></a>å‘½å Printf æ ·å¼çš„å‡½æ•°</h3><p>å£°æ˜<code>Printf</code>-style å‡½æ•°æ—¶ï¼Œè¯·ç¡®ä¿<code>go vet</code>å¯ä»¥æ£€æµ‹åˆ°å®ƒå¹¶æ£€æŸ¥æ ¼å¼å­—ç¬¦ä¸²ã€‚</p><p>è¿™æ„å‘³ç€æ‚¨åº”å°½å¯èƒ½ä½¿ç”¨é¢„å®šä¹‰çš„<code>Printf</code>-style å‡½æ•°åç§°ã€‚<code>go vet</code>å°†é»˜è®¤æ£€æŸ¥è¿™äº›ã€‚æœ‰å…³æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚è§ <a href="https://golang.org/cmd/vet/#hdr-Printf_family" target="_blank" rel="noopener">Printf ç³»åˆ—</a>ã€‚</p><p>å¦‚æœä¸èƒ½ä½¿ç”¨é¢„å®šä¹‰çš„åç§°ï¼Œè¯·ä»¥ f ç»“æŸé€‰æ‹©çš„åç§°ï¼š<code>Wrapf</code>ï¼Œè€Œä¸æ˜¯<code>Wrap</code>ã€‚<code>go vet</code>å¯ä»¥è¦æ±‚æ£€æŸ¥ç‰¹å®šçš„ Printf æ ·å¼åç§°ï¼Œä½†åç§°å¿…é¡»ä»¥<code>f</code>ç»“å°¾ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span> go vet -printfuncs=wrapf,statusf</span><br></pre></td></tr></table></figure><p>å¦è¯·å‚é˜… <a href="https://kuzminva.wordpress.com/2017/11/07/go-vet-printf-family-check/" target="_blank" rel="noopener">go vet: Printf family check</a>.</p><h2 id="ç¼–ç¨‹æ¨¡å¼"><a href="#ç¼–ç¨‹æ¨¡å¼" class="headerlink" title="ç¼–ç¨‹æ¨¡å¼"></a>ç¼–ç¨‹æ¨¡å¼</h2><h3 id="è¡¨é©±åŠ¨æµ‹è¯•"><a href="#è¡¨é©±åŠ¨æµ‹è¯•" class="headerlink" title="è¡¨é©±åŠ¨æµ‹è¯•"></a>è¡¨é©±åŠ¨æµ‹è¯•</h3><p>å½“æµ‹è¯•é€»è¾‘æ˜¯é‡å¤çš„æ—¶å€™ï¼Œé€šè¿‡  <a href="https://blog.golang.org/subtests" target="_blank" rel="noopener">subtests</a> ä½¿ç”¨ table é©±åŠ¨çš„æ–¹å¼ç¼–å†™ case ä»£ç çœ‹ä¸Šå»ä¼šæ›´ç®€æ´ã€‚</p><table><thead><tr><th>Bad</th><th>Good</th></tr></thead><tbody><tr><td><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// func TestSplitHostPort(t *testing.T)</span></span><br><span class="line"></span><br><span class="line">host, port, err := net.SplitHostPort(<span class="string">"192.0.2.0:8000"</span>)</span><br><span class="line">require.NoError(t, err)</span><br><span class="line">assert.Equal(t, <span class="string">"192.0.2.0"</span>, host)</span><br><span class="line">assert.Equal(t, <span class="string">"8000"</span>, port)</span><br><span class="line"></span><br><span class="line">host, port, err = net.SplitHostPort(<span class="string">"192.0.2.0:http"</span>)</span><br><span class="line">require.NoError(t, err)</span><br><span class="line">assert.Equal(t, <span class="string">"192.0.2.0"</span>, host)</span><br><span class="line">assert.Equal(t, <span class="string">"http"</span>, port)</span><br><span class="line"></span><br><span class="line">host, port, err = net.SplitHostPort(<span class="string">":8000"</span>)</span><br><span class="line">require.NoError(t, err)</span><br><span class="line">assert.Equal(t, <span class="string">""</span>, host)</span><br><span class="line">assert.Equal(t, <span class="string">"8000"</span>, port)</span><br><span class="line"></span><br><span class="line">host, port, err = net.SplitHostPort(<span class="string">"1:8"</span>)</span><br><span class="line">require.NoError(t, err)</span><br><span class="line">assert.Equal(t, <span class="string">"1"</span>, host)</span><br><span class="line">assert.Equal(t, <span class="string">"8"</span>, port)</span><br></pre></td></tr></table></figure></td><td><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// func TestSplitHostPort(t *testing.T)</span></span><br><span class="line"></span><br><span class="line">tests := []<span class="keyword">struct</span>&#123;</span><br><span class="line">  give     <span class="keyword">string</span></span><br><span class="line">  wantHost <span class="keyword">string</span></span><br><span class="line">  wantPort <span class="keyword">string</span></span><br><span class="line">&#125;&#123;</span><br><span class="line">  &#123;</span><br><span class="line">    give:     <span class="string">"192.0.2.0:8000"</span>,</span><br><span class="line">    wantHost: <span class="string">"192.0.2.0"</span>,</span><br><span class="line">    wantPort: <span class="string">"8000"</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    give:     <span class="string">"192.0.2.0:http"</span>,</span><br><span class="line">    wantHost: <span class="string">"192.0.2.0"</span>,</span><br><span class="line">    wantPort: <span class="string">"http"</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    give:     <span class="string">":8000"</span>,</span><br><span class="line">    wantHost: <span class="string">""</span>,</span><br><span class="line">    wantPort: <span class="string">"8000"</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    give:     <span class="string">"1:8"</span>,</span><br><span class="line">    wantHost: <span class="string">"1"</span>,</span><br><span class="line">    wantPort: <span class="string">"8"</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> _, tt := <span class="keyword">range</span> tests &#123;</span><br><span class="line">  t.Run(tt.give, <span class="function"><span class="keyword">func</span><span class="params">(t *testing.T)</span></span> &#123;</span><br><span class="line">    host, port, err := net.SplitHostPort(tt.give)</span><br><span class="line">    require.NoError(t, err)</span><br><span class="line">    assert.Equal(t, tt.wantHost, host)</span><br><span class="line">    assert.Equal(t, tt.wantPort, port)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></td></tr></tbody></table><p>å¾ˆæ˜æ˜¾ï¼Œä½¿ç”¨ test table çš„æ–¹å¼åœ¨ä»£ç é€»è¾‘æ‰©å±•çš„æ—¶å€™ï¼Œæ¯”å¦‚æ–°å¢ test caseï¼Œéƒ½ä¼šæ˜¾å¾—æ›´åŠ çš„æ¸…æ™°ã€‚</p><p>æˆ‘ä»¬éµå¾ªè¿™æ ·çš„çº¦å®šï¼šå°†ç»“æ„ä½“åˆ‡ç‰‡ç§°ä¸º<code>tests</code>ã€‚ æ¯ä¸ªæµ‹è¯•ç”¨ä¾‹ç§°ä¸º<code>tt</code>ã€‚æ­¤å¤–ï¼Œæˆ‘ä»¬é¼“åŠ±ä½¿ç”¨<code>give</code>å’Œ<code>want</code>å‰ç¼€è¯´æ˜æ¯ä¸ªæµ‹è¯•ç”¨ä¾‹çš„è¾“å…¥å’Œè¾“å‡ºå€¼ã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">tests := []<span class="keyword">struct</span>&#123;</span><br><span class="line">  give     <span class="keyword">string</span></span><br><span class="line">  wantHost <span class="keyword">string</span></span><br><span class="line">  wantPort <span class="keyword">string</span></span><br><span class="line">&#125;&#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> _, tt := <span class="keyword">range</span> tests &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="åŠŸèƒ½é€‰é¡¹"><a href="#åŠŸèƒ½é€‰é¡¹" class="headerlink" title="åŠŸèƒ½é€‰é¡¹"></a>åŠŸèƒ½é€‰é¡¹</h3><p>åŠŸèƒ½é€‰é¡¹æ˜¯ä¸€ç§æ¨¡å¼ï¼Œæ‚¨å¯ä»¥åœ¨å…¶ä¸­å£°æ˜ä¸€ä¸ªä¸é€æ˜ Option ç±»å‹ï¼Œè¯¥ç±»å‹åœ¨æŸäº›å†…éƒ¨ç»“æ„ä¸­è®°å½•ä¿¡æ¯ã€‚æ‚¨æ¥å—è¿™äº›é€‰é¡¹çš„å¯å˜ç¼–å·ï¼Œå¹¶æ ¹æ®å†…éƒ¨ç»“æ„ä¸Šçš„é€‰é¡¹è®°å½•çš„å…¨éƒ¨ä¿¡æ¯é‡‡å–è¡ŒåŠ¨ã€‚</p><p>å°†æ­¤æ¨¡å¼ç”¨äºæ‚¨éœ€è¦æ‰©å±•çš„æ„é€ å‡½æ•°å’Œå…¶ä»–å…¬å…± API ä¸­çš„å¯é€‰å‚æ•°ï¼Œå°¤å…¶æ˜¯åœ¨è¿™äº›åŠŸèƒ½ä¸Šå·²ç»å…·æœ‰ä¸‰ä¸ªæˆ–æ›´å¤šå‚æ•°çš„æƒ…å†µä¸‹ã€‚</p><table><thead><tr><th>Bad</th><th>Good</th></tr></thead><tbody><tr><td><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// package db</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Connect</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">  addr <span class="keyword">string</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">  timeout time.Duration,</span></span></span><br><span class="line"><span class="function"><span class="params">  caching <span class="keyword">bool</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">)</span> <span class="params">(*Connection, error)</span></span> &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Timeout and caching must always be provided,</span></span><br><span class="line"><span class="comment">// even if the user wants to use the default.</span></span><br><span class="line"></span><br><span class="line">db.Connect(addr, db.DefaultTimeout, db.DefaultCaching)</span><br><span class="line">db.Connect(addr, newTimeout, db.DefaultCaching)</span><br><span class="line">db.Connect(addr, db.DefaultTimeout, <span class="literal">false</span> <span class="comment">/* caching */</span>)</span><br><span class="line">db.Connect(addr, newTimeout, <span class="literal">false</span> <span class="comment">/* caching */</span>)</span><br></pre></td></tr></table></figure></td><td><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> options <span class="keyword">struct</span> &#123;</span><br><span class="line">  timeout time.Duration</span><br><span class="line">  caching <span class="keyword">bool</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Option overrides behavior of Connect.</span></span><br><span class="line"><span class="keyword">type</span> Option <span class="keyword">interface</span> &#123;</span><br><span class="line">  apply(*options)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> optionFunc <span class="function"><span class="keyword">func</span><span class="params">(*options)</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="title">func</span> <span class="params">(f optionFunc)</span> <span class="title">apply</span><span class="params">(o *options)</span></span> &#123;</span><br><span class="line">  f(o)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">WithTimeout</span><span class="params">(t time.Duration)</span> <span class="title">Option</span></span> &#123;</span><br><span class="line">  <span class="keyword">return</span> optionFunc(<span class="function"><span class="keyword">func</span><span class="params">(o *options)</span></span> &#123;</span><br><span class="line">    o.timeout = t</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">WithCaching</span><span class="params">(cache <span class="keyword">bool</span>)</span> <span class="title">Option</span></span> &#123;</span><br><span class="line">  <span class="keyword">return</span> optionFunc(<span class="function"><span class="keyword">func</span><span class="params">(o *options)</span></span> &#123;</span><br><span class="line">    o.caching = cache</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Connect creates a connection.</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Connect</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">  addr <span class="keyword">string</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">  opts ...Option,</span></span></span><br><span class="line"><span class="function"><span class="params">)</span> <span class="params">(*Connection, error)</span></span> &#123;</span><br><span class="line">  options := options&#123;</span><br><span class="line">    timeout: defaultTimeout,</span><br><span class="line">    caching: defaultCaching,</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> _, o := <span class="keyword">range</span> opts &#123;</span><br><span class="line">    o.apply(&amp;options)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Options must be provided only if needed.</span></span><br><span class="line"></span><br><span class="line">db.Connect(addr)</span><br><span class="line">db.Connect(addr, db.WithTimeout(newTimeout))</span><br><span class="line">db.Connect(addr, db.WithCaching(<span class="literal">false</span>))</span><br><span class="line">db.Connect(</span><br><span class="line">  addr,</span><br><span class="line">  db.WithCaching(<span class="literal">false</span>),</span><br><span class="line">  db.WithTimeout(newTimeout),</span><br><span class="line">)</span><br></pre></td></tr></table></figure></td></tr></tbody></table><p>è¿˜å¯ä»¥å‚è€ƒä¸‹é¢èµ„æ–™ï¼š</p><ul><li><a href="https://commandcenter.blogspot.com/2014/01/self-referential-functions-and-design.html" target="_blank" rel="noopener">Self-referential functions and the design of options</a></li><li><a href="https://dave.cheney.net/2014/10/17/functional-options-for-friendly-apis" target="_blank" rel="noopener">Functional options for friendly APIs</a></li></ul><!-- TODO: replace this with parameter structs and functional options, when touse one vs other -->]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;æœ¬æ–‡é•¿æœŸç»´æŠ¤åœ°å€: &lt;a href=&quot;https://github.com/xxjwxc/uber_go_guide_cn&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;https://github.com/xxjwxc/uber_go_guide_cn&lt;
      
    
    </summary>
    
    
      <category term="Golang" scheme="https://razertory.me/tags/Golang/"/>
    
  </entry>
  
</feed>
